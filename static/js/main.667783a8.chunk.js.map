{"version":3,"sources":["../../../packages/core/dist/tw/util/id.js","../../../packages/core/dist/tw/event/emitter.js","../../../packages/core/dist/tw/command/registry.js","../../../packages/core/dist/tw/command/service.js","../../../packages/core/dist/tw/tree/node-list.js","../../../packages/core/dist/tw/tree/node.js","../../../packages/core/dist/tw/view/node.js","../../../packages/core/dist/tw/view/line.js","../../../packages/core/dist/tw/component/line-component.js","../../../packages/core/dist/tw/component/components/line.js","../../../packages/core/dist/tw/view/page.js","../../../packages/core/dist/tw/component/page-component.js","../../../packages/core/dist/tw/component/components/page.js","../../../packages/core/dist/tw/component/registry.js","../../../packages/core/dist/tw/component/service.js","../../../packages/core/dist/tw/config/service.js","../../../packages/core/dist/tw/command/handlers/clipboard.js","../../../packages/core/dist/tw/util/dom.js","../../../packages/core/dist/tw/layout/position.js","../../../packages/core/dist/tw/transform/transformation.js","../../../packages/core/dist/tw/command/handlers/cursor.js","../../../packages/core/dist/tw/command/handlers/history.js","../../../packages/core/dist/tw/model/change/change.js","../../../packages/core/dist/tw/model/change/mapping.js","../../../packages/core/dist/tw/model/change/apply-attribute.js","../../../packages/core/dist/tw/model/change/replace.js","../../../packages/core/dist/tw/command/handlers/state.js","../../../packages/core/dist/tw/command/handlers/view.js","../../../packages/core/dist/tw/model/node.js","../../../packages/core/dist/tw/model/root.js","../../../packages/core/dist/tw/render/node.js","../../../packages/core/dist/tw/render/doc.js","../../../packages/core/dist/tw/view/doc.js","../../../packages/core/dist/tw/component/component.js","../../../packages/core/dist/tw/component/components/doc.js","../../../packages/core/dist/tw/model/branch.js","../../../packages/core/dist/tw/render/block.js","../../../packages/core/dist/tw/render/text.js","../../../packages/core/dist/tw/text/service.js","../../../packages/core/dist/tw/view/block.js","../../../packages/core/dist/tw/view/text.js","../../../packages/core/dist/tw/component/components/paragraph.js","../../../packages/core/dist/tw/model/leaf.js","../../../packages/core/dist/tw/component/components/text.js","../../../packages/core/dist/tw/config/util.js","../../../packages/core/dist/tw/cursor/state.js","../../../packages/core/dist/tw/cursor/service.js","../../../packages/core/dist/tw/dom/service.js","../../../packages/core/dist/tw/history/action.js","../../../packages/core/dist/tw/history/state.js","../../../packages/core/dist/tw/history/service.js","../../../packages/core/dist/tw/util/platform.js","../../../packages/core/dist/tw/key-binding/service.js","../../../packages/core/dist/tw/layout/node.js","../../../packages/core/dist/tw/layout/atom.js","../../../packages/core/dist/tw/layout/block.js","../../../packages/core/dist/tw/layout/doc.js","../../../packages/core/dist/tw/layout/line.js","../../../packages/core/dist/tw/layout/page.js","../../../packages/core/dist/tw/layout/text.js","../../../packages/core/dist/tw/layout/word.js","../../../packages/core/dist/tw/layout/engine.js","../../../packages/core/dist/tw/layout/state.js","../../../packages/core/dist/tw/layout/service.js","../../../packages/core/dist/tw/model/state.js","../../../packages/core/dist/tw/model/service.js","../../../packages/core/dist/tw/render/state.js","../../../packages/core/dist/tw/render/service.js","../../../packages/core/dist/tw/service/registry.js","../../../packages/core/dist/tw/transform/service.js","../../../packages/core/dist/tw/view/cursor.js","../../../packages/core/dist/tw/view/clipboard-observer.js","../../../packages/core/dist/tw/view/focus-observer.js","../../../packages/core/dist/tw/view/keyboard-observer.js","../../../packages/core/dist/tw/view/pointer-observer.js","../../../packages/core/dist/tw/view/dom-controller.js","../../../packages/core/dist/tw/view/state.js","../../../packages/core/dist/tw/view/service.js","../../../packages/core/dist/tw/taleweaver.js","Editor/ToolBar.tsx","Editor/Editor.tsx","Editor/index.ts","../../../packages/core/dist/tw/util/serialize.js","samples/littleRedRidingHood.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["bytes16","Uint8Array","generateId","Buffer","from","String","fromCharCode","apply","Array","crypto","randomFillSync","toString","EventEmitter","this","listeners","prototype","on","listener","_this","push","dispose","index","indexOf","splice","emit","event","forEach","CommandRegistry","commandsMap","Map","registerCommand","commandId","commandHandler","set","getCommandHandler","get","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","__spreadArrays","s","i","il","arguments","r","k","a","j","jl","CommandService","configService","serviceRegistry","willExecuteCommandEventEmitter","didExecuteCommandEventEmitter","registry","_i","_a","Object","entries","getConfig","commands","_b","onWillExecuteCommand","onDidExecuteCommand","executeCommand","args","NodeList","nodes","defineProperty","enumerable","configurable","at","Error","node","findIndex","id","callbackFn","map","reduce","initialValue","filter","callbackfn","slice","start","end","find","Node","parent","internalChildren","children","siblings","ownIndex","previousSibling","root","parentPreviousSibling","previousCrossParentSibling","lastChild","nextSibling","parentNextSibling","nextCrossParentSibling","firstChild","findDescendant","leaf","nn","boundOffset","offset","Math","min","contentLength","max","__extends","extendStatics","d","b","setPrototypeOf","__proto__","p","hasOwnProperty","__","constructor","create","ViewNode","_super","domContainer","componentId","renderId","layoutId","text","style","domService","child","undefined","internalSize","size","ViewLine","LineComponent","width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","innerHTML","appendChild","AbstractViewLine","buildViewNode","getService","AbstractLineComponent","ViewPage","PageComponent","position","marginLeft","marginRight","domContentContainer","findOrCreateDOMContentContainer","setAttribute","getAttribute","createElement","AbstractViewPage","AbstractPageComponent","ComponentRegistry","componentsMap","registerComponent","component","registerPageComponent","pageComponent","registerLineComponent","lineComponent","getComponent","getPageComponent","getLineComponent","ComponentService","components","Component","convertModelToDOM","to","fromOffset","toOffset","toDOM","partId","attributes","substring","domChildren","ConfigService","config","externalConfig","applyExternalConfig","coreConfig","page","iframe","window","document","scrolling","src","border","zIndex","opacity","overflow","left","top","createHiddenIframe","copy","cursorService","modelService","renderService","componentService","anchor","head","html","iframeDocument","hasCursor","getCursor","getRoot","resolvePosition","convertRenderToModelPosition","outerHTML","contentDocument","execCommand","paste","atLine","type","atWord","Transformation","changes","modelCursorHead","modelCursorAnchor","keepLeftLock","layoutService","originalCursorModelAnchor","originalCursorModelHead","changeResults","applyChanges","cursorAnchor","cursorHead","convertModelToRenderPosition","setCursor","_c","line","linePosition","setLeftLock","resolveBoundingBoxes","boundingBoxes","reverseChanges","reverseMappings","changeResult","reverseChange","reverseMapping","mapping","reverse","TransformationResult","mappings","_loop_1","change","shift","applyChange","c","getDocSize","transformation","reverseTransformation","atPreviousLine","leftLock","previousLine","convertCoordinatesToPosition","atNextLine","nextLine","atPreviousWord","word","wordPosition","previousWord","atNextWord","whitespaceSize","nextWord","atLineStart","atLineEnd","move","transformService","modelOffset","applyTransformation","moveBackward","newModelPosition","newPosition","moveForward","moveBackwardByLine","moveForwardByLine","moveBackwardByWord","moveForwardByWord","moveToLineStart","moveToLineEnd","moveToDocStart","moveToDocEnd","moveHead","modelAnchor","newModelHead","moveHeadBackward","moveHeadForward","moveHeadBackwardByLine","newHead","moveHeadForwardByLine","moveHeadBackwardByWord","moveHeadForwardByWord","moveHeadToLineStart","moveHeadToLineEnd","moveHeadToDocStart","moveHeadToDocEnd","selectAll","newModelAnchor","selectWord","newAnchor","selectBlock","block","blockPosition","atBlock","undo","redo","ModelChange","Mapping","descs","desc","internalMap","toBefore","toAfter","isPositionGreaterThanOrEqualTo","position1","position2","identity","ApplyAttribute","key","applyNode","originalValue","applyAttribute","Remover","ran","run","remove","replace","removed","joinedChildrenAt","joinNodes","removedChildFragment","node1","node2","Inserter","fragment","internalInsertedTo","insertedTo","insert","trimEnds","insertAt","fragmentDepth","ceil","positionDepth","beforeContents","afterContents","childInsertedExtra","splitAt","splitNode","child1","child2","contents","mergeContents","resolvedFrom","fromLeaf","removeNode","mapFrom","mapToBefore","resolvedTo","toLeaf","previousLeaf","content2","buildModelNode","mergedContent","content","concat","ReplaceChange","correctPosition","inserter","resolvedOffset","__assign","assign","findNodesByComponentIdAndPartId","results","cloneNodeWithAttribute","attributeKey","attributeValue","textFrom","textTo","cumulatedOffset","childFrom","childTo","modelFrom","modelTo","newModelOffset","deleteBackward","deleteForward","breakLine","findResults","nodePosition","nodeFrom","nodeTo","depth","currentNode","getNodeEdgeDepth","unshift","applyAttributeAround","buildModelPosition","focus","requestFocus","blur","requestBlur","ModelNode","internalNeedRender","childDidUpdateDisposableMap","didUpdateEventEmitter","handleChildDidUpdate","internalText","onDidUpdate","canJoin","clearNeedRender","replacedContent","resolvedPosition","ModelRoot","RenderNode","modelId","internalNeedLayout","clearNeedLayout","cumulatedSize","childSize","modelPosition","renderPosition","nextNonModelSize","m","nextChild","RenderDoc","ViewDoc","attached","ModelDoc","AbstractRenderDoc","textAlign","cursor","userSelect","AbstractViewDoc","DocComponent","buildRenderNode","pageConfig","$element_1","ModelBranch","RenderBlock","RenderText","DEFAULT_FONT","weight","family","letterSpacing","underline","italic","strikethrough","color","BREAKABLE_CHARS","TextService","$canvas","measure","font","fontWithDefault","applyDefaultFont","ctx","getContext","fixFontFamily","measurement","measureText","breakIntoWords","words","char","includes","fontConfigWithDefault","fontFamily","ViewBlock","ViewText","ModelParagraph","RenderParagraph","RenderParagraphLineBreak","ViewParagraph","lineHeight","ViewParagraphLineBreak","ParagraphComponent","ModelLeaf","ModelText","JSON","stringify","textService","AbstractRenderText","display","whiteSpace","fontSize","fontWeight","textDecoration","fontStyle","AbstractViewText","TextComponent","$element","innerText","buildBaseConfig","clipboardCommandHandlers","cursorCommandHandlers","historyCommandHandlers","stateCommandHandlers","viewCommandHandlers","doc","paragraph","disable","caretColor","caretInactiveColor","selectionColor","selectionInactiveColor","history","collapseThreshold","maxCollapseDuration","keyBindings","common","command","preventDefault","right","up","down","backspace","delete","enter","macos","windows","home","linux","CursorState","internalCursor","assertCursor","CursorService","state","DOMService","getWindow","getDocument","getBody","tagName","createContainer","container","createMutationObserver","callback","MutationObserver","HistoryAction","internalTransformationResults","beganAt","Date","now","internalEndedAt","recordTransformationResult","transformationResult","transformationResults","HistoryState","actions","handleDidApplyTransformation","some","tnResult","recordToNewAction","currentItem","endedAt","recordToLastAction","onDidApplyTransformation","action","consumeNextUndoableAction","consumeNextRedoableAction","HistoryService","detectPlatform","navigator","platform","startsWith","KeyBindingService","commandService","viewService","handleDidPressKey","keyBinding","originalKeyboardEvent","keyBindingsConfig","bindKeys","onDidPressKey","binding","LayoutNode","internalNeedView","paddingHorizontal","paddingVertical","clearNeedView","LayoutAtom","x","innerWidth","innerHeight","bottom","LayoutBlock","internalNeedReflow","internalHeight","clearNeedReflow","cumulatedHeight","childHeight","resolvedChildren","childFrom_1","childTo_1","childResult","boundingBox","LayoutDoc","resolvedChild","LayoutLine","internalContentWidth","contentWidth","cumulatedWidth","childWidth","lastWord","left1","left2","box","LayoutPage","internalContentHeight","contentHeight","contentX","contentY","LayoutText","internalWidth","internalTrimmedWidth","trimmedWidth","LayoutWord","trimmedText","lastWidth","width_1","breakAt","LayoutEngine","updateDoc","renderDoc","needLayout","pages","childrenMap","newChildren","updateBlock","buildDoc","reflowPages","blocks","renderBlock","lines","blocks_1","renderChild","updateText","updateAtom","buildBlock","reflowLines","texts","renderText","buildWord","getNextId","buildText","atoms","renderAtom","buildAtom","newPages","reflowNeeded","checkNeedsReflow","currentHeight","nodeChildren","mm","nodeChild","newPage","parentId","newLines","currentWidth","newNodeChildren","brokenNodeChild1","brokenNodeChild2","newLine","previousId","prefix","segments","split","parseInt","needReflow","LayoutState","didUpdateLayoutStateEventEmitter","engine","internalDoc","getDoc","onDidUpdateRenderState","handleDidUpdateRenderStateEvent","onDidUpdateLayoutState","update","LayoutService","ModelState","ModelService","getRootSize","onDidUpdateModelState","RenderState","didUpdateRenderStateEventEmitter","modelRoot","updateNode","handleDidUpdateModelState","modelNode","needRender","modelChild","buildNode","RenderService","resolveFont","_d","_e","_f","_g","_h","resolvedFont","nodeQueue","nodeFont","fontProp","childOffset_1","childIndex","ServiceRegistry","services","registerService","service","TransformService","didApplyTransformationEventEmitter","tn","CursorView","instanceId","blinkInterval","blinkState","domSelections","cursorConfig","domCaret","className","pointerEvents","onDidFocus","handleDidFocus","onDidBlur","handleDidBlur","attach","updateView","clearDOMSelections","headPageId","headLeft","headTop","headHeight","rect","docBoxResult","viewDoc","layoutDoc","focused","isFocused","firstPageId","firstBoxOffset","lastPageId","lastBoxOffset","pageBoxResult","pageOffset","boxOffset","domSelection","buildDOMSelection","background","pageDOMContentContainer","parentElement","removeChild","blinkStop","blinkStart","setInterval","updateDOMBlink","visibility","clearInterval","ClipboardObserver","$contentEditable","didCopyEventEmitter","didPasteEventEmitter","handleCopy","handlePaste","data","clipboardData","addEventListener","onDidCopy","onDidPaste","FocusObserver","didFocusEventEmitter","didBlurEventEmitter","handleFocus","handleBlur","KeyboardObserver","composing","didInsertEventEmitter","didPressKeyEventEmitter","compositionDidStartEventEmitter","compositionDidEndEventEmitter","keyInterpreter","KeyInterpreter","handleDidMutate","setTimeout","handleKeyDown","interpretFromKeyboardEvent","handleCompositionStart","handleCompositionEnd","mutationObserver","observe","subtree","characterData","childList","onDidInsert","onCompositionDidStart","onCompositionDidEnd","toLowerCase","metaKey","altKey","shiftKey","ctrlKey","PointerObserver","clickThreshold","consecutiveClickThreshold","lastPointerDown","lastClick","consecutiveClickCount","pointerDidDownEventEmitter","pointerDidMoveEventEmitter","pointerDidUpEventEmitter","pointerDidClickEventEmitter","handleMouseDown","resolveOffset","clientX","clientY","timestamp","consecutive","handleMouseMove","pointerDown","handleMouseUp","clicked","consecutiveCount","onPointerDidDown","onPointerDidMove","onPointerDidUp","onPointerDidClick","viewPage","layoutPage","pageBoundingClientRect","getBoundingClientRect","pageX","pageY","DOMController","mouseDown","handleDidInsert","handleCompositionDidStart","handleCompositionDidEnd","handlePointerDidDown","handlePointerDidMove","handlePointerDidClick","getData","$container","$body","querySelector","domNodes","console","log","createContentEditable","keyboardObserver","pointerObserver","focusObserver","clipboardObserver","isComposing","contentEditable","ViewState","didUpdateViewStateEventEmitter","handleDidUpdateLayoutStateEvent","onDidUpdateViewState","reattachDoc","layoutNode","renderNode","needView","renderChildrenMap","layoutChild","buildPageNode","buildLineNode","join","applyMetadataToDOMContainer","viewNode","ViewService","domController","Taleweaver","historyService","keyBindingService","getServiceRegistry","Wrapper","styled","div","Container","Group","Item","button","disabled","active","SelectItem","select","ItemColorLine","ToolBar","taleweaver","useState","setFont","refreshFront","useCallback","useEffect","onChange","onClick","EditorWrapper","initialDoc","containerRef","useRef","current","setTaleweaver","mergedConfig","internalParse","parse","ref","Hero","BrandWrapper","Brand","span","Tagline","h1","SupportingTagline","h2","Links","Link","DemoHintWrapper","DemoHint","App","React","render","href","sample","Boolean","location","hostname","match","ReactDOM","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.667783a8.chunk.js","sourcesContent":["import crypto from 'crypto';\nvar bytes16 = new Uint8Array(16);\nfunction generateRandomBytes16() {\n    return crypto.randomFillSync(bytes16);\n}\nexport function generateId() {\n    return Buffer.from(String.fromCharCode.apply(String, Array.from(generateRandomBytes16()))).toString('base64');\n}\n","var EventEmitter = /** @class */ (function () {\n    function EventEmitter() {\n        this.listeners = [];\n    }\n    EventEmitter.prototype.on = function (listener) {\n        var _this = this;\n        this.listeners.push(listener);\n        return {\n            dispose: function () {\n                var index = _this.listeners.indexOf(listener);\n                if (index < 0) {\n                    return;\n                }\n                _this.listeners.splice(index, 1);\n            },\n        };\n    };\n    EventEmitter.prototype.emit = function (event) {\n        this.listeners.forEach(function (listener) { return listener(event); });\n    };\n    return EventEmitter;\n}());\nexport { EventEmitter };\n","var CommandRegistry = /** @class */ (function () {\n    function CommandRegistry() {\n        this.commandsMap = new Map();\n    }\n    CommandRegistry.prototype.registerCommand = function (commandId, commandHandler) {\n        this.commandsMap.set(commandId, commandHandler);\n    };\n    CommandRegistry.prototype.getCommandHandler = function (commandId) {\n        return this.commandsMap.get(commandId);\n    };\n    return CommandRegistry;\n}());\nexport { CommandRegistry };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { CommandRegistry } from './registry';\nvar CommandService = /** @class */ (function () {\n    function CommandService(configService, serviceRegistry) {\n        this.serviceRegistry = serviceRegistry;\n        this.willExecuteCommandEventEmitter = new EventEmitter();\n        this.didExecuteCommandEventEmitter = new EventEmitter();\n        this.registry = new CommandRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().commands); _i < _a.length; _i++) {\n            var _b = _a[_i], commandId = _b[0], commandHandler = _b[1];\n            this.registry.registerCommand(commandId, commandHandler);\n        }\n    }\n    CommandService.prototype.onWillExecuteCommand = function (listener) {\n        return this.willExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.onDidExecuteCommand = function (listener) {\n        return this.didExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.executeCommand = function (commandId) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var commandHandler;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        commandHandler = this.registry.getCommandHandler(commandId);\n                        if (!commandHandler) {\n                            return [2 /*return*/];\n                        }\n                        this.willExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [4 /*yield*/, commandHandler.apply(void 0, __spreadArrays([this.serviceRegistry], args))];\n                    case 1:\n                        _a.sent();\n                        this.didExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return CommandService;\n}());\nexport { CommandService };\n","var NodeList = /** @class */ (function () {\n    function NodeList(nodes) {\n        if (nodes === void 0) { nodes = []; }\n        this.nodes = nodes;\n    }\n    Object.defineProperty(NodeList.prototype, \"length\", {\n        get: function () {\n            return this.nodes.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    NodeList.prototype.at = function (index) {\n        if (index < 0 || index >= this.nodes.length) {\n            throw new Error(\"Index \" + index + \" is out of range.\");\n        }\n        return this.nodes[index];\n    };\n    NodeList.prototype.indexOf = function (node) {\n        return this.nodes.findIndex(function (n) { return n.id === node.id; });\n    };\n    NodeList.prototype.forEach = function (callbackFn) {\n        return this.nodes.forEach(callbackFn);\n    };\n    NodeList.prototype.map = function (callbackFn) {\n        return this.nodes.map(callbackFn);\n    };\n    NodeList.prototype.reduce = function (callbackFn, initialValue) {\n        return this.nodes.reduce(callbackFn, initialValue);\n    };\n    NodeList.prototype.filter = function (callbackfn) {\n        return this.nodes.filter(callbackfn);\n    };\n    NodeList.prototype.slice = function (start, end) {\n        return this.nodes.slice(start, end);\n    };\n    NodeList.prototype.find = function (callbackFn) {\n        return this.nodes.find(callbackFn);\n    };\n    return NodeList;\n}());\nexport { NodeList };\n","import { NodeList } from './node-list';\nvar Node = /** @class */ (function () {\n    function Node(id) {\n        this.id = id;\n        this.parent = null;\n        this.internalChildren = new NodeList();\n    }\n    Object.defineProperty(Node.prototype, \"children\", {\n        get: function () {\n            return this.internalChildren;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"firstChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(0);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"lastChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(this.children.length - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === 0) {\n                return null;\n            }\n            return siblings.at(ownIndex - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === siblings.length - 1) {\n                return null;\n            }\n            return siblings.at(ownIndex + 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousCrossParentSibling\", {\n        get: function () {\n            var previousSibling = this.previousSibling;\n            if (previousSibling) {\n                return previousSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentPreviousSibling = parent.previousCrossParentSibling;\n            if (!parentPreviousSibling) {\n                return null;\n            }\n            return parentPreviousSibling.lastChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextCrossParentSibling\", {\n        get: function () {\n            var nextSibling = this.nextSibling;\n            if (nextSibling) {\n                return nextSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentNextSibling = parent.nextCrossParentSibling;\n            if (!parentNextSibling) {\n                return null;\n            }\n            return parentNextSibling.firstChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Node.prototype.findDescendant = function (id) {\n        if (this.id === id) {\n            return this;\n        }\n        if (this.leaf) {\n            return null;\n        }\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var result = child.findDescendant(id);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    };\n    Node.prototype.boundOffset = function (offset) {\n        return Math.min(this.contentLength, Math.max(0, offset));\n    };\n    return Node;\n}());\nexport { Node };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar ViewNode = /** @class */ (function (_super) {\n    __extends(ViewNode, _super);\n    function ViewNode(domContainer, componentId, renderId, layoutId, text, style, children, domService) {\n        var _this = _super.call(this, layoutId) || this;\n        _this.domContainer = domContainer;\n        _this.componentId = componentId;\n        _this.renderId = renderId;\n        _this.layoutId = layoutId;\n        _this.text = text;\n        _this.style = style;\n        _this.domService = domService;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(ViewNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewNode;\n}(Node));\nexport { ViewNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(ViewNode));\nexport { ViewLine };\n","var LineComponent = /** @class */ (function () {\n    function LineComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return LineComponent;\n}());\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewLine as AbstractViewLine } from '../../view/line';\nimport { LineComponent as AbstractLineComponent } from '../line-component';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"partId\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(AbstractViewLine));\nexport { ViewLine };\nvar LineComponent = /** @class */ (function (_super) {\n    __extends(LineComponent, _super);\n    function LineComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    LineComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewLine(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return LineComponent;\n}(AbstractLineComponent));\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewPage;\n}(ViewNode));\nexport { ViewPage };\n","var PageComponent = /** @class */ (function () {\n    function PageComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return PageComponent;\n}());\nexport { PageComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewPage as AbstractViewPage } from '../../view/page';\nimport { PageComponent as AbstractPageComponent } from '../page-component';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.domContainer.style.position = 'relative';\n        _this.domContainer.style.marginLeft = 'auto';\n        _this.domContainer.style.marginRight = 'auto';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        _this.domContentContainer = _this.findOrCreateDOMContentContainer();\n        _this.domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return _this.domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(_this.domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"partId\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewPage.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('div');\n    };\n    return ViewPage;\n}(AbstractViewPage));\nexport { ViewPage };\nvar PageComponent = /** @class */ (function (_super) {\n    __extends(PageComponent, _super);\n    function PageComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PageComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewPage(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return PageComponent;\n}(AbstractPageComponent));\nexport { PageComponent };\n","var ComponentRegistry = /** @class */ (function () {\n    function ComponentRegistry() {\n        this.componentsMap = new Map();\n    }\n    ComponentRegistry.prototype.registerComponent = function (componentId, component) {\n        this.componentsMap.set(componentId, component);\n    };\n    ComponentRegistry.prototype.registerPageComponent = function (pageComponent) {\n        this.pageComponent = pageComponent;\n    };\n    ComponentRegistry.prototype.registerLineComponent = function (lineComponent) {\n        this.lineComponent = lineComponent;\n    };\n    ComponentRegistry.prototype.getComponent = function (componentId) {\n        var component = this.componentsMap.get(componentId);\n        if (!component) {\n            throw new Error(\"Component \" + componentId + \" is not registered.\");\n        }\n        return component;\n    };\n    ComponentRegistry.prototype.getPageComponent = function () {\n        if (!this.pageComponent) {\n            throw new Error('Page component is not registered.');\n        }\n        return this.pageComponent;\n    };\n    ComponentRegistry.prototype.getLineComponent = function () {\n        if (!this.lineComponent) {\n            throw new Error('Line component is not registered.');\n        }\n        return this.lineComponent;\n    };\n    return ComponentRegistry;\n}());\nexport { ComponentRegistry };\n","import { LineComponent } from './components/line';\nimport { PageComponent } from './components/page';\nimport { ComponentRegistry } from './registry';\nvar ComponentService = /** @class */ (function () {\n    function ComponentService(configService, serviceRegistry) {\n        this.configService = configService;\n        this.serviceRegistry = serviceRegistry;\n        this.registry = new ComponentRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().components); _i < _a.length; _i++) {\n            var _b = _a[_i], componentId = _b[0], Component = _b[1];\n            this.registry.registerComponent(componentId, new Component(componentId, serviceRegistry));\n        }\n        this.registry.registerPageComponent(new PageComponent('page', serviceRegistry));\n        this.registry.registerLineComponent(new LineComponent('line', serviceRegistry));\n    }\n    ComponentService.prototype.getComponent = function (componentId) {\n        return this.registry.getComponent(componentId);\n    };\n    ComponentService.prototype.getPageComponent = function () {\n        return this.registry.getPageComponent();\n    };\n    ComponentService.prototype.getLineComponent = function () {\n        return this.registry.getLineComponent();\n    };\n    ComponentService.prototype.convertModelToDOM = function (node, from, to) {\n        var fromOffset = from ? from[0].offset : 0;\n        var toOffset = to ? to[0].offset : node.contentLength - 1;\n        var component = this.getComponent(node.componentId);\n        if (node.leaf) {\n            return component.toDOM(node.partId, node.attributes, node.text.substring(fromOffset, toOffset), []);\n        }\n        var domChildren = [];\n        for (var n = fromOffset; n <= toOffset; n++) {\n            var child = node.children.at(n);\n            domChildren.push(this.convertModelToDOM(child, from && n === fromOffset ? from.slice(1) : null, to && n === toOffset ? to.slice(1) : null));\n        }\n        return component.toDOM(node.partId, node.attributes, '', domChildren);\n    };\n    return ComponentService;\n}());\nexport { ComponentService };\n","var ConfigService = /** @class */ (function () {\n    function ConfigService(config, externalConfig) {\n        this.config = config;\n        this.applyExternalConfig(externalConfig);\n    }\n    ConfigService.prototype.getConfig = function () {\n        return this.config;\n    };\n    ConfigService.prototype.applyExternalConfig = function (externalConfig) {\n        var coreConfig = externalConfig['tw.core'];\n        if (coreConfig) {\n            if (coreConfig.page) {\n                this.config.page = coreConfig.page;\n            }\n        }\n    };\n    return ConfigService;\n}());\nexport { ConfigService };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { createHiddenIframe, isDOMAvailable } from '../../util/dom';\nvar iframe;\nif (isDOMAvailable()) {\n    iframe = createHiddenIframe();\n    document.body.appendChild(iframe);\n}\nexport var copy = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var cursorService, modelService, renderService, componentService, _a, anchor, head, html, iframeDocument;\n    return __generator(this, function (_b) {\n        if (!iframe) {\n            return [2 /*return*/];\n        }\n        cursorService = serviceRegistry.getService('cursor');\n        modelService = serviceRegistry.getService('model');\n        renderService = serviceRegistry.getService('render');\n        componentService = serviceRegistry.getService('component');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            return [2 /*return*/];\n        }\n        html = componentService.convertModelToDOM(modelService.getRoot(), modelService.resolvePosition(renderService.convertRenderToModelPosition(Math.min(anchor, head))), modelService.resolvePosition(renderService.convertRenderToModelPosition(Math.max(anchor, head)))).outerHTML;\n        iframeDocument = iframe.contentDocument;\n        if (!iframeDocument) {\n            return [2 /*return*/];\n        }\n        iframeDocument.body.innerHTML = html;\n        iframeDocument.execCommand('selectAll');\n        iframeDocument.execCommand('copy');\n        iframeDocument.body.innerHTML = '';\n        return [2 /*return*/];\n    });\n}); };\nexport var paste = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        return [2 /*return*/];\n    });\n}); };\n","export function isDOMAvailable() {\n    return typeof window !== 'undefined';\n}\nexport function createHiddenIframe() {\n    var iframe = document.createElement('iframe');\n    iframe.scrolling = 'no';\n    iframe.src = 'about:blank';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = 'none';\n    iframe.style.position = 'fixed';\n    iframe.style.zIndex = '-1';\n    iframe.style.opacity = '0';\n    iframe.style.overflow = 'hidden';\n    iframe.style.left = '-1000000px';\n    iframe.style.top = '-1000000px';\n    return iframe;\n}\n","export function atLine(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'line') {\n            return position[n];\n        }\n    }\n    throw new Error('No line found.');\n}\nexport function atWord(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'word') {\n            return position[n];\n        }\n    }\n    throw new Error('No word found.');\n}\nexport function atBlock(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'block') {\n            return position[n];\n        }\n    }\n    throw new Error('No block found.');\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { atLine } from '../layout/position';\nvar Transformation = /** @class */ (function () {\n    function Transformation(changes, modelCursorHead, modelCursorAnchor, keepLeftLock) {\n        if (keepLeftLock === void 0) { keepLeftLock = false; }\n        this.changes = changes;\n        this.modelCursorHead = modelCursorHead;\n        this.modelCursorAnchor = modelCursorAnchor;\n        this.keepLeftLock = keepLeftLock;\n    }\n    Transformation.prototype.apply = function (modelService, cursorService, renderService, layoutService) {\n        var originalCursorModelAnchor = undefined;\n        var originalCursorModelHead = undefined;\n        if (cursorService.hasCursor()) {\n            var _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n            originalCursorModelAnchor = renderService.convertRenderToModelPosition(anchor);\n            originalCursorModelHead = renderService.convertRenderToModelPosition(head);\n        }\n        var changeResults = this.applyChanges(modelService);\n        if (cursorService.hasCursor()) {\n            var _b = cursorService.getCursor(), cursorAnchor = _b.anchor, cursorHead = _b.head;\n            if (this.modelCursorHead !== undefined) {\n                cursorHead = renderService.convertModelToRenderPosition(this.modelCursorHead);\n                cursorAnchor = cursorHead;\n                if (this.modelCursorAnchor !== undefined) {\n                    cursorAnchor = renderService.convertModelToRenderPosition(this.modelCursorAnchor);\n                }\n            }\n            cursorAnchor = this.boundOffset(cursorAnchor, renderService);\n            cursorHead = this.boundOffset(cursorHead, renderService);\n            cursorService.setCursor(cursorAnchor, cursorHead);\n            if (!this.keepLeftLock) {\n                var _c = atLine(layoutService.resolvePosition(cursorService.getCursor().head)), line = _c.node, linePosition = _c.position;\n                cursorService.setLeftLock(line.resolveBoundingBoxes(linePosition, linePosition).boundingBoxes[0].left);\n            }\n        }\n        var reverseChanges = [];\n        var reverseMappings = [];\n        for (var n = changeResults.length - 1; n >= 0; n--) {\n            var changeResult = changeResults[n];\n            reverseChanges.push(reverseMappings.reduce(function (reverseChange, reverseMapping) { return reverseChange.map(reverseMapping); }, changeResult.reverseChange));\n            reverseMappings.push(changeResult.mapping.reverse());\n        }\n        return new TransformationResult(this, changeResults, new Transformation(reverseChanges, originalCursorModelHead, originalCursorModelAnchor, this.keepLeftLock));\n    };\n    Transformation.prototype.applyChanges = function (modelService) {\n        var changeResults = [];\n        var mappings = [];\n        var changes = __spreadArrays(this.changes);\n        var _loop_1 = function () {\n            var change = changes.shift();\n            var changeResult = modelService.applyChange(change);\n            var mapping = changeResult.mapping;\n            mappings.push(mapping);\n            changes = changes.map(function (c) { return c.map(mapping); });\n            changeResults.push(changeResult);\n        };\n        while (changes.length > 0) {\n            _loop_1();\n        }\n        return changeResults;\n    };\n    Transformation.prototype.boundOffset = function (offset, renderService) {\n        return Math.max(0, Math.min(renderService.getDocSize() - 1, offset));\n    };\n    return Transformation;\n}());\nexport { Transformation };\nvar TransformationResult = /** @class */ (function () {\n    function TransformationResult(transformation, changeResults, reverseTransformation) {\n        this.transformation = transformation;\n        this.changeResults = changeResults;\n        this.reverseTransformation = reverseTransformation;\n    }\n    return TransformationResult;\n}());\nexport { TransformationResult };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { atBlock, atLine, atWord } from '../../layout/position';\nimport { Transformation } from '../../transform/transformation';\nfunction atPreviousLine(position, leftLock, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    var previousLine = line.previousCrossParentSibling;\n    if (!previousLine) {\n        return position - linePosition;\n    }\n    return position - linePosition - previousLine.size + previousLine.convertCoordinatesToPosition(leftLock, 0);\n}\nfunction atNextLine(position, leftLock, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    var nextLine = line.nextCrossParentSibling;\n    if (!nextLine) {\n        return position - linePosition + line.size - 1;\n    }\n    return position - linePosition + line.size + nextLine.convertCoordinatesToPosition(leftLock, 0);\n}\nfunction atPreviousWord(position, layoutService) {\n    var _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.offset;\n    if (wordPosition > 0) {\n        return position - wordPosition;\n    }\n    var previousWord = word.previousCrossParentSibling;\n    if (!previousWord) {\n        return position;\n    }\n    return position - previousWord.size;\n}\nfunction atNextWord(position, layoutService) {\n    var _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.offset;\n    if (wordPosition < word.size - 1) {\n        return position - wordPosition + word.size - word.whitespaceSize;\n    }\n    var nextWord = word.nextCrossParentSibling;\n    if (!nextWord) {\n        return position;\n    }\n    return position - wordPosition + word.size + nextWord.size - nextWord.whitespaceSize;\n}\nfunction atLineStart(position, layoutService) {\n    var linePosition = atLine(layoutService.resolvePosition(position)).position;\n    if (linePosition === 0) {\n        return position;\n    }\n    return position - linePosition;\n}\nfunction atLineEnd(position, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    if (linePosition >= line.size - 1) {\n        return position;\n    }\n    return position - linePosition + line.size - 1;\n}\nexport var move = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, modelOffset;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        modelOffset = renderService.convertRenderToModelPosition(position);\n        transformService.applyTransformation(new Transformation([], modelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelPosition, newPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelPosition = renderService.convertRenderToModelPosition(anchor - 1);\n        }\n        else {\n            newPosition = Math.min(anchor, head);\n            newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        }\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelPosition, newPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelPosition = renderService.convertRenderToModelPosition(anchor + 1);\n        }\n        else {\n            newPosition = Math.max(anchor, head);\n            newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        }\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        position = Math.min(anchor, head);\n        newPosition = atPreviousLine(position, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition, newModelPosition, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        position = Math.max(anchor, head);\n        newPosition = atNextLine(position, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition, newModelPosition, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.min(anchor, head);\n        newPosition = atPreviousWord(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.max(anchor, head);\n        newPosition = atNextWord(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.min(anchor, head);\n        newPosition = atLineStart(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.max(anchor, head);\n        newPosition = atLineEnd(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newPosition, newModelPosition;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newPosition = 0;\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newPosition, newModelPosition;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newPosition = renderService.getDocSize() - 1;\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHead = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(position);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(head - 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(head + 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atPreviousLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atNextLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atPreviousWord(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atNextWord(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineStart(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineEnd(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = 0;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = renderService.getDocSize() - 1;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectAll = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, newAnchor, newHead, newModelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        newAnchor = 0;\n        newHead = renderService.getDocSize() - 1;\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectWord = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, word, wordPosition, previousWord, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.position;\n        if (word.size - word.whitespaceSize === 0) {\n            previousWord = word.previousCrossParentSibling;\n            if (!previousWord) {\n                return [2 /*return*/];\n            }\n            word = previousWord;\n            wordPosition += word.size;\n        }\n        newHead = position - wordPosition + word.size - word.whitespaceSize;\n        newAnchor = position - wordPosition;\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectBlock = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, block, blockPosition, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = atBlock(layoutService.resolvePosition(position)), block = _a.node, blockPosition = _a.position;\n        newHead = position - blockPosition + block.size - 1;\n        newAnchor = position - blockPosition;\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var undo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').undo();\n        return [2 /*return*/];\n    });\n}); };\nexport var redo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').redo();\n        return [2 /*return*/];\n    });\n}); };\n","var ModelChange = /** @class */ (function () {\n    function ModelChange() {\n    }\n    return ModelChange;\n}());\nexport { ModelChange };\n","var Mapping = /** @class */ (function () {\n    function Mapping(descs) {\n        this.descs = descs;\n    }\n    Mapping.prototype.map = function (position) {\n        var _this = this;\n        return this.descs.reduce(function (newPosition, desc) { return _this.internalMap(newPosition, desc.from, desc.toBefore, desc.toAfter); }, position);\n    };\n    Mapping.prototype.reverse = function () {\n        return new Mapping(this.descs.map(function (desc) { return ({ from: desc.from, toBefore: desc.toAfter, toAfter: desc.toBefore }); }));\n    };\n    Mapping.prototype.internalMap = function (position, from, toBefore, toAfter) {\n        if (!isPositionGreaterThanOrEqualTo(position, toBefore)) {\n            return position;\n        }\n        var newPosition = [toAfter[0] + position[0] - toBefore[0]];\n        if (position[0] === toBefore[0]) {\n            newPosition.push.apply(newPosition, this.internalMap(position.slice(1), from.slice(1), toBefore.slice(1), toAfter.slice(1)));\n        }\n        else {\n            newPosition.push.apply(newPosition, position.slice(1));\n        }\n        return newPosition;\n    };\n    return Mapping;\n}());\nexport { Mapping };\nexport var identity = {\n    map: function (position) { return position; },\n    reverse: function () { return identity; },\n};\nfunction isPositionGreaterThanOrEqualTo(position1, position2) {\n    if (position1.length === 0 || position2.length === 0) {\n        return false;\n    }\n    if (position1[0] < position2[0]) {\n        return false;\n    }\n    if (position1[0] > position2[0]) {\n        return true;\n    }\n    if (position1.length === 1 && position2.length === 1) {\n        return true;\n    }\n    return isPositionGreaterThanOrEqualTo(position1.slice(1), position2.slice(1));\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelChange } from './change';\nimport { identity } from './mapping';\nvar ApplyAttribute = /** @class */ (function (_super) {\n    __extends(ApplyAttribute, _super);\n    function ApplyAttribute(position, key, value) {\n        var _this = _super.call(this) || this;\n        _this.position = position;\n        _this.key = key;\n        _this.value = value;\n        return _this;\n    }\n    ApplyAttribute.prototype.map = function (mapping) {\n        return this;\n    };\n    ApplyAttribute.prototype.apply = function (root, componentService) {\n        return this.applyNode(root, this.position);\n    };\n    ApplyAttribute.prototype.applyNode = function (node, position) {\n        if (position.length === 0) {\n            var originalValue = node.applyAttribute(this.key, this.value);\n            return {\n                change: this,\n                reverseChange: new ApplyAttribute(this.position, this.key, originalValue),\n                mapping: identity,\n            };\n        }\n        var offset = position[0];\n        return this.applyNode(node.children.at(offset), position.slice(1));\n    };\n    return ApplyAttribute;\n}(ModelChange));\nexport { ApplyAttribute };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { generateId } from '../../util/id';\nimport { ModelChange } from './change';\nimport { Mapping } from './mapping';\nvar Remover = /** @class */ (function () {\n    function Remover(root, from, to) {\n        this.root = root;\n        this.from = from;\n        this.to = to;\n        this.ran = false;\n    }\n    Remover.prototype.run = function () {\n        if (this.ran) {\n            throw new Error('Remover already ran.');\n        }\n        this.remove(this.root, this.from, this.to);\n        this.ran = true;\n    };\n    Remover.prototype.remove = function (node, from, to) {\n        if (node.leaf) {\n            return [node.replace(from[0], to[0], '')];\n        }\n        var removed = [];\n        var child = node.children.at(from[0]);\n        var joinedChildrenAt = 0;\n        if (from[0] < to[0]) {\n            removed.push(node.replace(from[0] + 1, to[0], []));\n            joinedChildrenAt = child.contentLength;\n            this.joinNodes(child, node.children.at(from[0] + 1));\n        }\n        var removedChildFragment = this.remove(child, from.slice(1), __spreadArrays([joinedChildrenAt + to[1]], to.slice(2)));\n        removed.splice.apply(removed, __spreadArrays([0, 0], removedChildFragment.slice(0, joinedChildrenAt)));\n        removed.push.apply(removed, removedChildFragment.slice(joinedChildrenAt));\n        return removed;\n    };\n    Remover.prototype.joinNodes = function (node1, node2) {\n        if (node1.leaf) {\n            node1.replace(0, node1.text.length, node1.text + node2.text);\n        }\n        else {\n            node1.replace(0, node1.children.length, __spreadArrays(node1.children.slice(), node2.children.slice()));\n        }\n        var parent = node1.parent;\n        parent.replace(0, parent.children.length, parent.children.filter(function (child) { return child !== node2; }));\n    };\n    return Remover;\n}());\nvar Inserter = /** @class */ (function () {\n    function Inserter(root, position, fragment, componentService) {\n        this.root = root;\n        this.position = position;\n        this.fragment = fragment;\n        this.componentService = componentService;\n        this.ran = false;\n        this.internalInsertedTo = [];\n    }\n    Object.defineProperty(Inserter.prototype, \"insertedTo\", {\n        get: function () {\n            return this.internalInsertedTo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Inserter.prototype.run = function () {\n        if (this.ran) {\n            throw new Error('Inserter already ran.');\n        }\n        this.insertedTo.push(this.position[0]);\n        this.insert(this.root, this.position, this.fragment);\n        this.trimEnds();\n        this.ran = true;\n    };\n    Inserter.prototype.insert = function (node, position, fragment) {\n        var insertAt = position[0];\n        var fragmentDepth = Math.ceil(fragment.length / 2);\n        var positionDepth = position.length;\n        if (fragmentDepth < positionDepth) {\n            this.insertedTo.push(position[1]);\n            this.insert(node.children.at(insertAt), position.slice(1), fragment);\n            return 0;\n        }\n        var beforeContents = fragment.slice(0, fragmentDepth - 1);\n        var afterContents = fragment.slice(fragment.length - fragmentDepth + 1);\n        if (positionDepth > 1) {\n            this.insertedTo.push(0);\n            var child = node.children.at(insertAt);\n            var childInsertedExtra = this.insert(child, position.slice(1), __spreadArrays(beforeContents, afterContents));\n            var splitAt = position[1] + beforeContents[beforeContents.length - 1].length + childInsertedExtra;\n            var _a = this.splitNode(child, splitAt), child1 = _a[0], child2 = _a[1];\n            node.replace(insertAt, insertAt + 1, [child1, child2]);\n            insertAt++;\n        }\n        var contents = fragment.slice(fragmentDepth - 1, fragment.length - fragmentDepth + 1);\n        node.replace(insertAt, insertAt, this.mergeContents(contents));\n        this.insertedTo[this.insertedTo.length - position.length] += contents[contents.length - 1].length;\n        if (!node.leaf) {\n            this.insertedTo[this.insertedTo.length - position.length]++;\n        }\n        return insertAt - position[0];\n    };\n    Inserter.prototype.trimEnds = function () {\n        var from = this.position;\n        var resolvedFrom = this.root.resolvePosition(from);\n        var fromLeaf = resolvedFrom[resolvedFrom.length - 1].node;\n        if (fromLeaf.text.length === 0) {\n            var nextLeaf = fromLeaf.nextSibling;\n            if (nextLeaf) {\n                this.removeNode(fromLeaf);\n                var mapFrom = from;\n                var mapToBefore = __spreadArrays(from.slice(0, from.length - 2), [from[from.length - 2] + 1, 0]);\n                var mapToAfter = from;\n                var mapping = new Mapping([{ from: mapFrom, toBefore: mapToBefore, toAfter: mapToAfter }]);\n                this.internalInsertedTo = mapping.map(this.insertedTo);\n            }\n        }\n        var to = this.insertedTo;\n        var resolvedTo = this.root.resolvePosition(to);\n        var toLeaf = resolvedTo[resolvedTo.length - 1].node;\n        if (toLeaf.text.length === 0) {\n            var previousLeaf = toLeaf.previousSibling;\n            if (previousLeaf) {\n                this.removeNode(toLeaf);\n                var mapFrom = __spreadArrays(to.slice(0, to.length - 2), [to[to.length - 2] - 1, previousLeaf.contentLength]);\n                var mapToBefore = to;\n                var mapToAfter = mapFrom;\n                var mapping = new Mapping([{ from: mapFrom, toBefore: mapToBefore, toAfter: mapToAfter }]);\n                this.internalInsertedTo = mapping.map(this.insertedTo);\n            }\n        }\n    };\n    Inserter.prototype.removeNode = function (node) {\n        var parent = node.parent;\n        parent.replace(0, parent.children.length, parent.children.filter(function (child) { return child !== node; }));\n    };\n    Inserter.prototype.splitNode = function (node, offset) {\n        var component = this.componentService.getComponent(node.componentId);\n        var node2;\n        if (node.leaf) {\n            var content2 = node.replace(0, offset, '');\n            node2 = component.buildModelNode(node.partId, generateId(), content2, node.attributes, []);\n        }\n        else {\n            var content2 = node.replace(0, offset, []);\n            node2 = component.buildModelNode(node.partId, generateId(), '', node.attributes, content2);\n        }\n        return [node2, node];\n    };\n    Inserter.prototype.mergeContents = function (contents) {\n        if (typeof contents[0] === 'string') {\n            var textContents = contents;\n            return textContents.reduce(function (mergedContent, content) { return mergedContent + content; }, '');\n        }\n        var nodeContents = contents;\n        return nodeContents.reduce(function (mergedContent, content) { return mergedContent.concat(content); }, []);\n    };\n    return Inserter;\n}());\nvar ReplaceChange = /** @class */ (function (_super) {\n    __extends(ReplaceChange, _super);\n    function ReplaceChange(from, to, fragment) {\n        var _this = _super.call(this) || this;\n        _this.from = from;\n        _this.to = to;\n        _this.fragment = fragment;\n        if (fragment.length % 2 !== 1) {\n            throw new Error('Fragment is invalid.');\n        }\n        return _this;\n    }\n    ReplaceChange.prototype.map = function (mapping) {\n        var from = mapping.map(this.from);\n        var to = mapping.map(this.to);\n        return new ReplaceChange(from, to, this.fragment);\n    };\n    ReplaceChange.prototype.apply = function (root, componentService) {\n        var from = this.correctPosition(root, this.from);\n        var to = this.correctPosition(root, this.to);\n        var remover = new Remover(root, from, to);\n        remover.run();\n        var inserter = new Inserter(root, from, this.fragment, componentService);\n        inserter.run();\n        return {\n            change: this,\n            reverseChange: new ReplaceChange(from, inserter.insertedTo, ['TODO']),\n            mapping: new Mapping([{ from: from, toBefore: to, toAfter: inserter.insertedTo }]),\n        };\n    };\n    ReplaceChange.prototype.correctPosition = function (root, position) {\n        return root.resolvePosition(position).map(function (resolvedOffset) { return resolvedOffset.offset; });\n    };\n    return ReplaceChange;\n}(ModelChange));\nexport { ReplaceChange };\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { ApplyAttribute } from '../../model/change/apply-attribute';\nimport { ReplaceChange } from '../../model/change/replace';\nimport { Transformation } from '../../transform/transformation';\nimport { generateId } from '../../util/id';\nfunction findNodesByComponentIdAndPartId(node, componentId, partId, from, to, position) {\n    if (position === void 0) { position = []; }\n    var results = [];\n    if (node.componentId === componentId && node.partId === partId) {\n        results.push({\n            node: node,\n            position: position,\n            from: from ? from[0].offset : 0,\n            to: to ? to[0].offset : node.contentLength,\n        });\n    }\n    if (!node.leaf) {\n        var fromOffset = from ? from[0].offset : 0;\n        var toOffset = to ? to[0].offset : node.contentLength - 1;\n        for (var n = fromOffset; n <= toOffset; n++) {\n            var child = node.children.at(n);\n            results.push.apply(results, findNodesByComponentIdAndPartId(child, componentId, partId, from && n === fromOffset ? from.slice(1) : null, to && n === toOffset ? to.slice(1) : null, __spreadArrays(position, [n])));\n        }\n    }\n    return results;\n}\nfunction cloneNodeWithAttribute(node, attributeKey, attributeValue, from, to, componentService) {\n    var _a, _b;\n    var component = componentService.getComponent(node.componentId);\n    if (node.leaf) {\n        var textFrom = Math.max(0, from);\n        var textTo = Math.min(node.text.length, to);\n        return component.buildModelNode(node.partId, generateId(), node.text.substring(textFrom, textTo), __assign(__assign({}, node.attributes), (_a = {}, _a[attributeKey] = attributeValue, _a)), []);\n    }\n    var children = [];\n    var cumulatedOffset = 1;\n    node.children.forEach(function (child) {\n        var childFrom = Math.max(0, from - cumulatedOffset);\n        var childTo = Math.min(child.size, to - cumulatedOffset);\n        if (cumulatedOffset <= to && from <= cumulatedOffset + child.size) {\n            children.push(cloneNodeWithAttribute(child, attributeKey, attributeValue, childFrom, childTo, componentService));\n        }\n        cumulatedOffset += child.size;\n    });\n    return component.buildModelNode(node.partId, generateId(), '', __assign(__assign({}, node.attributes), (_b = {}, _b[attributeKey] = attributeValue, _b)), children);\n}\nfunction getNodeEdgeDepth(node) {\n    var currentNode = node;\n    var depth = -1;\n    while (currentNode) {\n        depth++;\n        currentNode = currentNode.firstChild;\n    }\n    return depth;\n}\nfunction buildModelPosition(node) {\n    var position = [];\n    var currentNode = node;\n    while (currentNode.parent) {\n        position.unshift(currentNode.parent.children.indexOf(currentNode));\n        currentNode = currentNode.parent;\n    }\n    return position;\n}\nexport var insert = function (serviceRegistry, content) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        newModelOffset = __spreadArrays(modelFrom);\n        newModelOffset[newModelOffset.length - 1] += content.length;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [content])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head === 0) {\n                return [2 /*return*/];\n            }\n            from = head - 1;\n            to = head;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [''])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head >= renderService.getDocSize() - 1) {\n                return [2 /*return*/];\n            }\n            from = head;\n            to = head + 1;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [''])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var breakLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        newModelOffset = __spreadArrays(modelFrom);\n        newModelOffset[newModelOffset.length - 3]++;\n        newModelOffset[newModelOffset.length - 2] = 0;\n        newModelOffset[newModelOffset.length - 1] = 0;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, ['', [], [], [], ''])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var applyAttribute = function (serviceRegistry, componentId, partId, attributeKey, attributeValue) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, componentService, cursorService, renderService, modelService, _a, anchor, head, from, to, modelFrom, modelTo, findResults;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        componentService = serviceRegistry.getService('component');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        modelService = serviceRegistry.getService('model');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        findResults = findNodesByComponentIdAndPartId(modelService.getRoot(), componentId, partId, modelService.resolvePosition(modelFrom), modelService.resolvePosition(modelTo));\n        transformService.applyTransformation(new Transformation(findResults\n            .filter(function (_a) {\n            var node = _a.node;\n            return node.attributes[attributeKey] !== attributeValue;\n        })\n            .filter(function (_a) {\n            var nodeFrom = _a.from, nodeTo = _a.to;\n            return nodeFrom !== nodeTo;\n        })\n            .map(function (_a) {\n            var node = _a.node, nodePosition = _a.position, nodeFrom = _a.from, nodeTo = _a.to;\n            if (nodeFrom === 0 && nodeTo === node.size) {\n                return new ApplyAttribute(nodePosition, attributeKey, attributeValue);\n            }\n            var newNode = cloneNodeWithAttribute(node, attributeKey, attributeValue, nodeFrom, nodeTo, componentService);\n            var depth = getNodeEdgeDepth(newNode);\n            var fragment = [\n                [\n                    cloneNodeWithAttribute(node, attributeKey, attributeValue, nodeFrom, nodeTo, componentService),\n                ],\n            ];\n            for (var n = 0; n < depth; n++) {\n                fragment.unshift([]);\n                fragment.push([]);\n            }\n            fragment.unshift('');\n            fragment.push('');\n            return new ReplaceChange(__spreadArrays(nodePosition, [nodeFrom]), __spreadArrays(nodePosition, [nodeTo]), fragment);\n        })));\n        return [2 /*return*/];\n    });\n}); };\nexport var applyAttributeAround = function (serviceRegistry, componentId, partId, attributeKey, attributeValue) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, modelService, _a, anchor, head, from, to, modelFrom, modelTo, findResults;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        modelService = serviceRegistry.getService('model');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        findResults = findNodesByComponentIdAndPartId(modelService.getRoot(), componentId, partId, modelService.resolvePosition(modelFrom), modelService.resolvePosition(modelTo));\n        transformService.applyTransformation(new Transformation(findResults.map(function (_a) {\n            var node = _a.node;\n            return new ApplyAttribute(buildModelPosition(node), attributeKey, attributeValue);\n        })));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var focus = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestFocus();\n        return [2 /*return*/];\n    });\n}); };\nexport var blur = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestBlur();\n        return [2 /*return*/];\n    });\n}); };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar ModelNode = /** @class */ (function (_super) {\n    __extends(ModelNode, _super);\n    function ModelNode(componentId, id, text, attributes, children) {\n        var _this = _super.call(this, id) || this;\n        _this.componentId = componentId;\n        _this.attributes = attributes;\n        _this.internalNeedRender = true;\n        _this.childDidUpdateDisposableMap = new Map();\n        _this.didUpdateEventEmitter = new EventEmitter();\n        _this.handleChildDidUpdate = function () {\n            _this.didUpdateEventEmitter.emit({});\n        };\n        _this.internalText = text;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n            _this.childDidUpdateDisposableMap.set(child.id, child.onDidUpdate(_this.handleChildDidUpdate));\n        });\n        _this.onDidUpdate(function () {\n            _this.internalSize = undefined;\n            _this.internalNeedRender = true;\n        });\n        return _this;\n    }\n    Object.defineProperty(ModelNode.prototype, \"text\", {\n        get: function () {\n            return this.internalText;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = 2 + this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 2);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"needRender\", {\n        get: function () {\n            return this.internalNeedRender;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelNode.prototype.canJoin = function (node) {\n        return false;\n    };\n    ModelNode.prototype.clearNeedRender = function () {\n        this.internalNeedRender = false;\n    };\n    ModelNode.prototype.applyAttribute = function (key, value) {\n        // @ts-ignore\n        var originalValue = this.attributes[key];\n        // @ts-ignore\n        this.attributes[key] = value;\n        this.didUpdateEventEmitter.emit({});\n        return originalValue;\n    };\n    ModelNode.prototype.replace = function (from, to, content) {\n        var _this = this;\n        if (from > to) {\n            throw new Error('Range is invalid.');\n        }\n        if (this.leaf) {\n            if (typeof content !== 'string') {\n                throw new Error('Leaf node content must be string.');\n            }\n            if (from < 0 || to > this.text.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        else {\n            if (typeof content === 'string') {\n                throw new Error('Non-leaf node content must not be string.');\n            }\n            if (from < 0 || to > this.children.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        var replacedContent;\n        if (typeof content === 'string') {\n            replacedContent = this.internalText.substring(from, to);\n            this.internalText = this.internalText.slice(0, from) + content + this.internalText.slice(to);\n        }\n        else {\n            replacedContent = this.children.slice(from, to);\n            this.internalChildren = new NodeList(__spreadArrays(this.children.slice(0, from), content, this.children.slice(to)));\n            var removedNodes = this.children.slice(from, to);\n            removedNodes.forEach(function (node) { var _a; return (_a = _this.childDidUpdateDisposableMap.get(node.id)) === null || _a === void 0 ? void 0 : _a.dispose(); });\n            content.forEach(function (node) {\n                node.parent = _this;\n                _this.childDidUpdateDisposableMap.set(node.id, node.onDidUpdate(_this.handleChildDidUpdate));\n            });\n        }\n        this.didUpdateEventEmitter.emit({});\n        return replacedContent;\n    };\n    ModelNode.prototype.resolvePosition = function (position) {\n        if (position.length === 0) {\n            position = [0];\n        }\n        var offset = this.boundOffset(position[0]);\n        var resolvedPosition = [{ node: this, offset: offset }];\n        if (!this.leaf) {\n            if (offset < this.children.length) {\n                var child = this.children.at(offset);\n                resolvedPosition.push.apply(resolvedPosition, child.resolvePosition(position.slice(1)));\n            }\n            else {\n                var child = this.children.at(this.children.length - 1);\n                resolvedPosition.push.apply(resolvedPosition, child.resolvePosition([child.contentLength]));\n            }\n        }\n        return resolvedPosition;\n    };\n    ModelNode.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelNode;\n}(Node));\nexport { ModelNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelRoot = /** @class */ (function (_super) {\n    __extends(ModelRoot, _super);\n    function ModelRoot(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Doc node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelRoot.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelRoot.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelRoot;\n}(ModelNode));\nexport { ModelRoot };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { generateId } from '../util/id';\nvar RenderNode = /** @class */ (function (_super) {\n    __extends(RenderNode, _super);\n    function RenderNode(componentId, modelId, text, attributes, children) {\n        var _this = _super.call(this, modelId || generateId()) || this;\n        _this.componentId = componentId;\n        _this.modelId = modelId;\n        _this.text = text;\n        _this.attributes = attributes;\n        _this.internalNeedLayout = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(RenderNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.contentLength;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"needLayout\", {\n        get: function () {\n            return this.internalNeedLayout;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderNode.prototype.clearNeedLayout = function () {\n        this.internalNeedLayout = false;\n    };\n    RenderNode.prototype.resolvePosition = function (position) {\n        if (position < 0 || position >= this.size) {\n            throw new Error(\"Offset \" + position + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return [{ node: this, offset: position, position: position }];\n        }\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedSize + childSize > position) {\n                return __spreadArrays([\n                    { node: this, offset: n, position: cumulatedSize }\n                ], child.resolvePosition(position - cumulatedSize));\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    RenderNode.prototype.convertModelToRenderPosition = function (modelPosition) {\n        var modelOffset = this.boundOffset(modelPosition[0]);\n        if (this.leaf) {\n            return modelOffset;\n        }\n        var offset = 0;\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            if (child.modelId) {\n                if (offset === modelOffset) {\n                    return cumulatedSize + child.convertModelToRenderPosition(modelPosition.slice(1));\n                }\n                offset++;\n            }\n            cumulatedSize += child.size;\n        }\n        throw new Error(\"Model offset \" + modelOffset + \" is out of range.\");\n    };\n    RenderNode.prototype.convertRenderToModelPosition = function (renderPosition) {\n        if (renderPosition < 0 || renderPosition > this.size) {\n            throw new Error('Render position is out of range.');\n        }\n        if (this.leaf) {\n            return [this.boundOffset(renderPosition)];\n        }\n        var cumulatedSize = 0;\n        var modelOffset = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (child.modelId) {\n                var nextNonModelSize = 0;\n                for (var m = n + 1; m < nn; m++) {\n                    var nextChild = this.children.at(m);\n                    if (nextChild.modelId) {\n                        break;\n                    }\n                    nextNonModelSize += nextChild.size;\n                }\n                if (cumulatedSize + childSize + nextNonModelSize > renderPosition) {\n                    return __spreadArrays([modelOffset], child.convertRenderToModelPosition(renderPosition - cumulatedSize));\n                }\n                modelOffset++;\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error(\"Render offset \" + renderPosition + \" is out of range.\");\n    };\n    return RenderNode;\n}(Node));\nexport { RenderNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(RenderNode));\nexport { RenderDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n        _this.attached = false;\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(ViewNode));\nexport { ViewDoc };\n","var Component = /** @class */ (function () {\n    function Component(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return Component;\n}());\nexport { Component };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelRoot } from '../../model/root';\nimport { RenderDoc as AbstractRenderDoc } from '../../render/doc';\nimport { ViewDoc as AbstractViewDoc } from '../../view/doc';\nimport { Component } from '../component';\nvar ModelDoc = /** @class */ (function (_super) {\n    __extends(ModelDoc, _super);\n    function ModelDoc() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelDoc;\n}(ModelRoot));\nexport { ModelDoc };\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, componentId, modelId, attributes, children) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        return _this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(AbstractRenderDoc));\nexport { RenderDoc };\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.textAlign = 'left';\n        _this.domContainer.style.cursor = 'text';\n        _this.domContainer.style.userSelect = 'none';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = domService.createElement('div');\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(AbstractViewDoc));\nexport { ViewDoc };\nvar DocComponent = /** @class */ (function (_super) {\n    __extends(DocComponent, _super);\n    function DocComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DocComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelDoc(this.id, id, attributes, children);\n    };\n    DocComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var configService = this.serviceRegistry.getService('config');\n        switch (partId) {\n            case 'doc':\n                var pageConfig = configService.getConfig().page;\n                return new RenderDoc(this.id, modelId, attributes, children, pageConfig.width, pageConfig.height, pageConfig.paddingTop, pageConfig.paddingBottom, pageConfig.paddingLeft, pageConfig.paddingRight);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    DocComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'doc':\n                return new ViewDoc(domContainer, this.id, renderId, layoutId, style, children, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    DocComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'doc': {\n                var $element_1 = document.createElement('div');\n                children.forEach(function (child) { return $element_1.appendChild(child); });\n                return $element_1;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return DocComponent;\n}(Component));\nexport { DocComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelBranch = /** @class */ (function (_super) {\n    __extends(ModelBranch, _super);\n    function ModelBranch(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Branch node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelBranch.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelBranch.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelBranch;\n}(ModelNode));\nexport { ModelBranch };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderBlock = /** @class */ (function (_super) {\n    __extends(RenderBlock, _super);\n    function RenderBlock(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderBlock;\n}(RenderNode));\nexport { RenderBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, text, attributes) {\n        return _super.call(this, componentId, modelId, text, attributes, []) || this;\n    }\n    Object.defineProperty(RenderText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(RenderNode));\nexport { RenderText };\n","export var DEFAULT_FONT = {\n    weight: 400,\n    size: 16,\n    family: 'sans-serif',\n    letterSpacing: 0,\n    underline: false,\n    italic: false,\n    strikethrough: false,\n    color: 'black',\n};\nexport var BREAKABLE_CHARS = [' ', '\\n', '\\t'];\nvar TextService = /** @class */ (function () {\n    function TextService(domService) {\n        this.$canvas = domService.createElement('canvas');\n    }\n    TextService.prototype.measure = function (text, font) {\n        var fontWithDefault = this.applyDefaultFont(font);\n        var ctx = this.$canvas.getContext('2d');\n        var weight = fontWithDefault.weight;\n        var size = fontWithDefault.size;\n        var family = this.fixFontFamily(fontWithDefault.family);\n        var letterSpacing = fontWithDefault.letterSpacing;\n        ctx.font = weight + \" \" + size + \"px \" + family;\n        var measurement = ctx.measureText(text);\n        var width = letterSpacing === 0 || text.length <= 1\n            ? measurement.width\n            : measurement.width + (text.length - 1) * letterSpacing;\n        return {\n            width: width,\n            height: size,\n        };\n    };\n    TextService.prototype.breakIntoWords = function (text) {\n        var words = [];\n        var word = '';\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var char = text[n];\n            word += char;\n            if (BREAKABLE_CHARS.includes(char)) {\n                words.push({\n                    text: word,\n                    whitespaceSize: 1,\n                });\n                word = '';\n            }\n        }\n        if (word.length > 0) {\n            words.push({\n                text: word,\n                whitespaceSize: 0,\n            });\n        }\n        return words;\n    };\n    TextService.prototype.applyDefaultFont = function (font) {\n        var fontConfigWithDefault = {};\n        for (var key in DEFAULT_FONT) {\n            if (key in font && font[key] !== undefined) {\n                fontConfigWithDefault[key] = font[key];\n            }\n            else {\n                fontConfigWithDefault[key] = DEFAULT_FONT[key];\n            }\n        }\n        return fontConfigWithDefault;\n    };\n    TextService.prototype.fixFontFamily = function (fontFamily) {\n        if (fontFamily.indexOf(' ') >= 0) {\n            return \"'\" + fontFamily + \"'\";\n        }\n        return fontFamily;\n    };\n    return TextService;\n}());\nexport { TextService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewBlock = /** @class */ (function (_super) {\n    __extends(ViewBlock, _super);\n    function ViewBlock(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n    }\n    Object.defineProperty(ViewBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewBlock;\n}(ViewNode));\nexport { ViewBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, text, style, [], domService) || this;\n    }\n    Object.defineProperty(ViewText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewText;\n}(ViewNode));\nexport { ViewText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { ModelBranch } from '../../model/branch';\nimport { RenderBlock } from '../../render/block';\nimport { RenderText } from '../../render/text';\nimport { DEFAULT_FONT } from '../../text/service';\nimport { ViewBlock } from '../../view/block';\nimport { ViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelParagraph = /** @class */ (function (_super) {\n    __extends(ModelParagraph, _super);\n    function ModelParagraph() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelParagraph;\n}(ModelBranch));\nexport { ModelParagraph };\nvar RenderParagraph = /** @class */ (function (_super) {\n    __extends(RenderParagraph, _super);\n    function RenderParagraph(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, attributes, __spreadArrays(children, [new RenderParagraphLineBreak(componentId)])) || this;\n    }\n    Object.defineProperty(RenderParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingBottom\", {\n        get: function () {\n            return 12;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderParagraph;\n}(RenderBlock));\nexport { RenderParagraph };\nvar RenderParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(RenderParagraphLineBreak, _super);\n    function RenderParagraphLineBreak(componentId) {\n        var _this = _super.call(this, componentId, null, ' ', null) || this;\n        _this.componentId = componentId;\n        return _this;\n    }\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"pseudo\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"style\", {\n        get: function () {\n            return null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"font\", {\n        get: function () {\n            var node = this.previousSibling;\n            while (node) {\n                if (node.type === 'text') {\n                    return node.font;\n                }\n                node = node.previousSibling;\n            }\n            return DEFAULT_FONT;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderParagraphLineBreak;\n}(RenderText));\nexport { RenderParagraphLineBreak };\nvar ViewParagraph = /** @class */ (function (_super) {\n    __extends(ViewParagraph, _super);\n    function ViewParagraph(domContainer, componentId, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraph.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraph;\n}(ViewBlock));\nexport { ViewParagraph };\nvar ViewParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(ViewParagraphLineBreak, _super);\n    function ViewParagraphLineBreak(domContainer, componentId, renderId, layoutId, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, ' ', null, domService) || this;\n    }\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraphLineBreak;\n}(ViewText));\nexport { ViewParagraphLineBreak };\nvar ParagraphComponent = /** @class */ (function (_super) {\n    __extends(ParagraphComponent, _super);\n    function ParagraphComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ParagraphComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelParagraph(this.id, id, attributes, children);\n    };\n    ParagraphComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        switch (partId) {\n            case 'paragraph':\n                return new RenderParagraph(this.id, modelId, attributes, children);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    ParagraphComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'paragraph':\n                return new ViewParagraph(domContainer, this.id, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            case 'line-break':\n                return new ViewParagraphLineBreak(domContainer, this.id, renderId, layoutId, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    ParagraphComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'paragraph': {\n                var $element_1 = document.createElement('p');\n                children.forEach(function (child) { return $element_1.appendChild(child); });\n                return $element_1;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return ParagraphComponent;\n}(Component));\nexport { ParagraphComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelLeaf = /** @class */ (function (_super) {\n    __extends(ModelLeaf, _super);\n    function ModelLeaf(componentId, id, text, attributes) {\n        return _super.call(this, componentId, id, text, attributes, []) || this;\n    }\n    Object.defineProperty(ModelLeaf.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelLeaf.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelLeaf;\n}(ModelNode));\nexport { ModelLeaf };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelLeaf } from '../../model/leaf';\nimport { RenderText as AbstractRenderText } from '../../render/text';\nimport { ViewText as AbstractViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelText = /** @class */ (function (_super) {\n    __extends(ModelText, _super);\n    function ModelText() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelText.prototype.canJoin = function (node) {\n        if (this.componentId !== node.componentId) {\n            return false;\n        }\n        if (this.partId !== node.partId) {\n            return false;\n        }\n        if (JSON.stringify(this.attributes) !== JSON.stringify(node.attributes)) {\n            return false;\n        }\n        return true;\n    };\n    return ModelText;\n}(ModelLeaf));\nexport { ModelText };\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, textService, text, attributes) {\n        var _this = _super.call(this, componentId, modelId, text, attributes) || this;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(RenderText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"style\", {\n        get: function () {\n            return this.textService.applyDefaultFont(this.attributes);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"font\", {\n        get: function () {\n            return this.style;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(AbstractRenderText));\nexport { RenderText };\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, text, style, domService) || this;\n        _this.domContainer.style.display = 'inline-block';\n        _this.domContainer.style.whiteSpace = 'pre';\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.fontFamily = style.family;\n        _this.domContainer.style.fontSize = style.size + \"px\";\n        _this.domContainer.style.letterSpacing = style.letterSpacing + \"px\";\n        _this.domContainer.style.fontWeight = \"\" + style.weight;\n        _this.domContainer.style.color = style.color;\n        _this.domContainer.style.textDecoration = style.underline ? 'underline' : '';\n        _this.domContainer.style.fontStyle = style.italic ? 'italic' : '';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = _this.findOrCreateDOMContentContainer();\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        domContentContainer.style.textDecoration = style.strikethrough ? 'line-through' : '';\n        domContentContainer.innerHTML = text;\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewText.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('span');\n    };\n    return ViewText;\n}(AbstractViewText));\nexport { ViewText };\nvar TextComponent = /** @class */ (function (_super) {\n    __extends(TextComponent, _super);\n    function TextComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TextComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelText(this.id, id, text, attributes);\n    };\n    TextComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var textService = this.serviceRegistry.getService('text');\n        switch (partId) {\n            case 'text':\n                return new RenderText(this.id, modelId, textService, text, attributes);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    TextComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'text':\n                return new ViewText(domContainer, this.id, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    TextComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'text': {\n                var $element = document.createElement('span');\n                $element.innerText = text;\n                return $element;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return TextComponent;\n}(Component));\nexport { TextComponent };\n","import * as clipboardCommandHandlers from '../command/handlers/clipboard';\nimport * as cursorCommandHandlers from '../command/handlers/cursor';\nimport * as historyCommandHandlers from '../command/handlers/history';\nimport * as stateCommandHandlers from '../command/handlers/state';\nimport * as viewCommandHandlers from '../command/handlers/view';\nimport { DocComponent } from '../component/components/doc';\nimport { ParagraphComponent } from '../component/components/paragraph';\nimport { TextComponent } from '../component/components/text';\nexport function buildBaseConfig() {\n    return {\n        commands: {\n            'tw.clipboard.copy': clipboardCommandHandlers.copy,\n            'tw.clipboard.paste': clipboardCommandHandlers.paste,\n            'tw.cursor.move': cursorCommandHandlers.move,\n            'tw.cursor.moveBackwardByLine': cursorCommandHandlers.moveBackwardByLine,\n            'tw.cursor.moveForwardByLine': cursorCommandHandlers.moveForwardByLine,\n            'tw.cursor.moveBackward': cursorCommandHandlers.moveBackward,\n            'tw.cursor.moveForward': cursorCommandHandlers.moveForward,\n            'tw.cursor.moveBackwardByWord': cursorCommandHandlers.moveBackwardByWord,\n            'tw.cursor.moveForwardByWord': cursorCommandHandlers.moveForwardByWord,\n            'tw.cursor.moveToLineStart': cursorCommandHandlers.moveToLineStart,\n            'tw.cursor.moveToLineEnd': cursorCommandHandlers.moveToLineEnd,\n            'tw.cursor.moveToDocStart': cursorCommandHandlers.moveToDocStart,\n            'tw.cursor.moveToDocEnd': cursorCommandHandlers.moveToDocEnd,\n            'tw.cursor.moveHead': cursorCommandHandlers.moveHead,\n            'tw.cursor.moveHeadBackwardByLine': cursorCommandHandlers.moveHeadBackwardByLine,\n            'tw.cursor.moveHeadForwardByLine': cursorCommandHandlers.moveHeadForwardByLine,\n            'tw.cursor.moveHeadBackward': cursorCommandHandlers.moveHeadBackward,\n            'tw.cursor.moveHeadForward': cursorCommandHandlers.moveHeadForward,\n            'tw.cursor.moveHeadBackwardByWord': cursorCommandHandlers.moveHeadBackwardByWord,\n            'tw.cursor.moveHeadForwardByWord': cursorCommandHandlers.moveHeadForwardByWord,\n            'tw.cursor.moveHeadToLineStart': cursorCommandHandlers.moveHeadToLineStart,\n            'tw.cursor.moveHeadToLineEnd': cursorCommandHandlers.moveHeadToLineEnd,\n            'tw.cursor.moveHeadToDocStart': cursorCommandHandlers.moveHeadToDocStart,\n            'tw.cursor.moveHeadToDocEnd': cursorCommandHandlers.moveHeadToDocEnd,\n            'tw.cursor.selectAll': cursorCommandHandlers.selectAll,\n            'tw.cursor.selectWord': cursorCommandHandlers.selectWord,\n            'tw.cursor.selectBlock': cursorCommandHandlers.selectBlock,\n            'tw.history.undo': historyCommandHandlers.undo,\n            'tw.history.redo': historyCommandHandlers.redo,\n            'tw.state.insert': stateCommandHandlers.insert,\n            'tw.state.deleteBackward': stateCommandHandlers.deleteBackward,\n            'tw.state.deleteForward': stateCommandHandlers.deleteForward,\n            'tw.state.breakLine': stateCommandHandlers.breakLine,\n            'tw.state.applyAttribute': stateCommandHandlers.applyAttribute,\n            'tw.state.applyAttributeAround': stateCommandHandlers.applyAttributeAround,\n            'tw.view.focus': viewCommandHandlers.focus,\n            'tw.view.blur': viewCommandHandlers.blur,\n        },\n        components: {\n            doc: DocComponent,\n            paragraph: ParagraphComponent,\n            text: TextComponent,\n        },\n        cursor: {\n            disable: false,\n            caretColor: \"hsla(213, 100%, 50%, 1)\",\n            caretInactiveColor: 'hsla(0, 0%, 0%, 0.5)',\n            selectionColor: \"hsla(213, 100%, 50%, 0.2)\",\n            selectionInactiveColor: 'hsla(0, 0%, 0%, 0.08)',\n        },\n        history: {\n            collapseThreshold: 500,\n            maxCollapseDuration: 2000,\n        },\n        keyBindings: {\n            common: {\n                left: { command: 'tw.cursor.moveBackward', preventDefault: true },\n                right: { command: 'tw.cursor.moveForward', preventDefault: true },\n                up: { command: 'tw.cursor.moveBackwardByLine', preventDefault: true },\n                down: { command: 'tw.cursor.moveForwardByLine', preventDefault: true },\n                'shift+left': { command: 'tw.cursor.moveHeadBackward', preventDefault: true },\n                'shift+right': { command: 'tw.cursor.moveHeadForward', preventDefault: true },\n                'shift+up': { command: 'tw.cursor.moveHeadBackwardByLine', preventDefault: true },\n                'shift+down': { command: 'tw.cursor.moveHeadForwardByLine', preventDefault: true },\n                backspace: { command: 'tw.state.deleteBackward', preventDefault: true },\n                delete: { command: 'tw.state.deleteForward', preventDefault: true },\n                enter: { command: 'tw.state.breakLine', preventDefault: true },\n            },\n            macos: {\n                'alt+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'alt+right': { command: 'tw.cursor.moveForwardByWord' },\n                'shift+alt+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'shift+alt+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                'cmd+left': { command: 'tw.cursor.moveToLineStart' },\n                'cmd+right': { command: 'tw.cursor.moveToLineEnd' },\n                'cmd+up': { command: 'tw.cursor.moveToDocStart' },\n                'cmd+down': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+cmd+left': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+cmd+right': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'shift+cmd+up': { command: 'tw.cursor.moveHeadToDocStart' },\n                'shift+cmd+down': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'cmd+a': { command: 'tw.cursor.selectAll' },\n                'cmd+z': { command: 'tw.history.undo', preventDefault: true },\n                'shift+cmd+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n            windows: {\n                'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                home: { command: 'tw.cursor.moveToLineStart' },\n                end: { command: 'tw.cursor.moveToLineEnd' },\n                'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'ctrl+a': { command: 'tw.cursor.selectAll' },\n                'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n            linux: {\n                'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                home: { command: 'tw.cursor.moveToLineStart' },\n                end: { command: 'tw.cursor.moveToLineEnd' },\n                'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'ctrl+a': { command: 'tw.cursor.selectAll' },\n                'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n        },\n        page: {\n            width: 816,\n            height: 1056,\n            paddingTop: 40,\n            paddingBottom: 40,\n            paddingLeft: 40,\n            paddingRight: 40,\n        },\n    };\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { EventEmitter } from '../event/emitter';\nvar CursorState = /** @class */ (function () {\n    function CursorState(configService, renderService, modelService) {\n        this.renderService = renderService;\n        this.modelService = modelService;\n        this.internalCursor = null;\n        this.didUpdateEventEmitter = new EventEmitter();\n        if (!configService.getConfig().cursor.disable) {\n            this.internalCursor = {\n                anchor: 0,\n                head: 0,\n                leftLock: 0,\n            };\n        }\n    }\n    Object.defineProperty(CursorState.prototype, \"hasCursor\", {\n        get: function () {\n            return !!this.internalCursor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CursorState.prototype, \"cursor\", {\n        get: function () {\n            this.assertCursor();\n            return __assign({}, this.internalCursor);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CursorState.prototype.set = function (anchor, head) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: anchor,\n            head: head,\n            leftLock: this.internalCursor.leftLock,\n        };\n        this.didUpdateEventEmitter.emit({});\n    };\n    CursorState.prototype.setLeftLock = function (leftLock) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: this.internalCursor.anchor,\n            head: this.internalCursor.head,\n            leftLock: leftLock,\n        };\n    };\n    CursorState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    CursorState.prototype.assertCursor = function () {\n        if (!this.internalCursor) {\n            throw new Error('Cursor is disabled.');\n        }\n    };\n    return CursorState;\n}());\nexport { CursorState };\n","import { CursorState } from './state';\nvar CursorService = /** @class */ (function () {\n    function CursorService(configService, renderService, modelService) {\n        this.state = new CursorState(configService, renderService, modelService);\n    }\n    CursorService.prototype.hasCursor = function () {\n        return this.state.hasCursor;\n    };\n    CursorService.prototype.getCursor = function () {\n        return this.state.cursor;\n    };\n    CursorService.prototype.setCursor = function (anchor, head) {\n        this.state.set(anchor, head);\n    };\n    CursorService.prototype.setLeftLock = function (leftLock) {\n        this.state.setLeftLock(leftLock);\n    };\n    CursorService.prototype.onDidUpdate = function (listener) {\n        return this.state.onDidUpdate(listener);\n    };\n    return CursorService;\n}());\nexport { CursorService };\n","var DOMService = /** @class */ (function () {\n    function DOMService() {\n    }\n    DOMService.prototype.getWindow = function () {\n        return window;\n    };\n    DOMService.prototype.getDocument = function () {\n        return document;\n    };\n    DOMService.prototype.getBody = function () {\n        return document.body;\n    };\n    DOMService.prototype.createElement = function (tagName) {\n        return document.createElement(tagName);\n    };\n    DOMService.prototype.createContainer = function () {\n        var container = this.createElement('div');\n        container.setAttribute('data-tw-role', 'container');\n        return container;\n    };\n    DOMService.prototype.createHiddenIframe = function () {\n        var iframe = this.createElement('iframe');\n        iframe.scrolling = 'no';\n        iframe.src = 'about:blank';\n        iframe.style.width = '0';\n        iframe.style.height = '0';\n        iframe.style.border = 'none';\n        iframe.style.position = 'fixed';\n        iframe.style.zIndex = '-1';\n        iframe.style.opacity = '0';\n        iframe.style.overflow = 'hidden';\n        iframe.style.left = '-1000000px';\n        iframe.style.top = '-1000000px';\n        return iframe;\n    };\n    DOMService.prototype.createMutationObserver = function (callback) {\n        return new MutationObserver(callback);\n    };\n    return DOMService;\n}());\nexport { DOMService };\n","var HistoryAction = /** @class */ (function () {\n    function HistoryAction() {\n        this.internalTransformationResults = [];\n        this.beganAt = Date.now();\n        this.internalEndedAt = this.beganAt;\n    }\n    Object.defineProperty(HistoryAction.prototype, \"endedAt\", {\n        get: function () {\n            return this.internalEndedAt;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HistoryAction.prototype, \"transformationResults\", {\n        get: function () {\n            return this.internalTransformationResults;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    HistoryAction.prototype.recordTransformationResult = function (transformationResult) {\n        this.transformationResults.push(transformationResult);\n        this.internalEndedAt = Date.now();\n    };\n    return HistoryAction;\n}());\nexport { HistoryAction };\n","import { HistoryAction } from './action';\nvar HistoryState = /** @class */ (function () {\n    function HistoryState(configService, transformService) {\n        var _this = this;\n        this.configService = configService;\n        this.transformService = transformService;\n        this.actions = [];\n        this.offset = -1;\n        this.handleDidApplyTransformation = function (event) {\n            var result = event.result;\n            // Do not record undo\n            if (_this.offset + 1 < _this.actions.length &&\n                _this.actions[_this.offset + 1].transformationResults.some(function (tnResult) { return tnResult.reverseTransformation === result.transformation; })) {\n                return;\n            }\n            // Do not record redo\n            if (_this.offset >= 0 &&\n                _this.actions[_this.offset].transformationResults.some(function (tnResult) { return tnResult.transformation === result.transformation; })) {\n                return;\n            }\n            if (_this.offset < 0) {\n                _this.recordToNewAction(result);\n                return;\n            }\n            var currentItem = _this.actions[_this.offset];\n            var now = Date.now();\n            if (now - currentItem.beganAt < _this.maxCollapseDuration &&\n                now - currentItem.endedAt < _this.collapseThreshold) {\n                _this.recordToLastAction(result);\n            }\n            else {\n                _this.recordToNewAction(result);\n            }\n        };\n        var config = configService.getConfig();\n        this.maxCollapseDuration = config.history.maxCollapseDuration;\n        this.collapseThreshold = config.history.collapseThreshold;\n        transformService.onDidApplyTransformation(this.handleDidApplyTransformation);\n    }\n    HistoryState.prototype.undo = function () {\n        var action = this.consumeNextUndoableAction();\n        if (!action) {\n            return;\n        }\n        var results = action.transformationResults;\n        if (results.length === 0) {\n            return;\n        }\n        for (var n = results.length - 1; n >= 0; n--) {\n            var result = results[n];\n            this.transformService.applyTransformation(result.reverseTransformation);\n        }\n    };\n    HistoryState.prototype.redo = function () {\n        var _this = this;\n        var action = this.consumeNextRedoableAction();\n        if (!action) {\n            return;\n        }\n        action.transformationResults.forEach(function (result) {\n            return _this.transformService.applyTransformation(result.transformation);\n        });\n    };\n    HistoryState.prototype.consumeNextUndoableAction = function () {\n        if (this.offset < 0) {\n            return undefined;\n        }\n        var action = this.actions[this.offset];\n        this.offset--;\n        return action;\n    };\n    HistoryState.prototype.consumeNextRedoableAction = function () {\n        if (this.offset >= this.actions.length - 1) {\n            return undefined;\n        }\n        this.offset++;\n        return this.actions[this.offset];\n    };\n    HistoryState.prototype.recordToNewAction = function (result) {\n        if (result.changeResults.length === 0) {\n            return;\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        var action = new HistoryAction();\n        action.recordTransformationResult(result);\n        this.actions.push(action);\n        this.offset++;\n    };\n    HistoryState.prototype.recordToLastAction = function (result) {\n        var action = this.actions[this.offset];\n        if (!action) {\n            throw new Error('Error recording applied transformation, history is empty.');\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        action.recordTransformationResult(result);\n    };\n    return HistoryState;\n}());\nexport { HistoryState };\n","import { HistoryState } from './state';\nvar HistoryService = /** @class */ (function () {\n    function HistoryService(configService, transformService) {\n        this.state = new HistoryState(configService, transformService);\n    }\n    HistoryService.prototype.undo = function () {\n        this.state.undo();\n    };\n    HistoryService.prototype.redo = function () {\n        this.state.redo();\n    };\n    return HistoryService;\n}());\nexport { HistoryService };\n","export function detectPlatform() {\n    if (navigator.platform.startsWith('Linux')) {\n        return 'Linux';\n    }\n    if (['Windows', 'Win16', 'Win32'].includes(navigator.platform)) {\n        return 'Windows';\n    }\n    if (['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'].includes(navigator.platform)) {\n        return 'macOS';\n    }\n    return 'Unknown';\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { detectPlatform } from '../util/platform';\nvar KeyBindingService = /** @class */ (function () {\n    function KeyBindingService(configService, commandService, viewService) {\n        var _this = this;\n        this.configService = configService;\n        this.commandService = commandService;\n        this.viewService = viewService;\n        this.keyBindings = new Map();\n        this.handleDidPressKey = function (event) {\n            var _a;\n            var keyBinding = _this.keyBindings.get(event.key);\n            if (!keyBinding) {\n                return;\n            }\n            if (keyBinding.preventDefault) {\n                event.originalKeyboardEvent.preventDefault();\n            }\n            (_a = _this.commandService).executeCommand.apply(_a, __spreadArrays([keyBinding.command], keyBinding.args));\n        };\n        var keyBindingsConfig = this.configService.getConfig().keyBindings;\n        this.bindKeys(keyBindingsConfig.common);\n        switch (detectPlatform()) {\n            case 'macOS':\n                if (keyBindingsConfig.macos) {\n                    this.bindKeys(keyBindingsConfig.macos);\n                }\n                break;\n            case 'Windows':\n                if (keyBindingsConfig.windows) {\n                    this.bindKeys(keyBindingsConfig.windows);\n                }\n                break;\n            case 'Linux':\n                if (keyBindingsConfig.linux) {\n                    this.bindKeys(keyBindingsConfig.linux);\n                }\n                break;\n        }\n        viewService.onDidPressKey(this.handleDidPressKey);\n    }\n    KeyBindingService.prototype.bindKeys = function (config) {\n        for (var key in config) {\n            var binding = config[key];\n            this.keyBindings.set(key, {\n                command: binding.command,\n                args: binding.args || [],\n                preventDefault: binding.preventDefault || false,\n            });\n        }\n    };\n    return KeyBindingService;\n}());\nexport { KeyBindingService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar LayoutNode = /** @class */ (function (_super) {\n    __extends(LayoutNode, _super);\n    function LayoutNode(id, renderId, text, children, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, id) || this;\n        _this.renderId = renderId;\n        _this.text = text;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.internalNeedView = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(LayoutNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingVertical\", {\n        get: function () {\n            return this.paddingTop + this.paddingBottom;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingHorizontal\", {\n        get: function () {\n            return this.paddingLeft + this.paddingRight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerWidth\", {\n        get: function () {\n            return this.width - this.paddingHorizontal;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerHeight\", {\n        get: function () {\n            return this.height - this.paddingVertical;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"needView\", {\n        get: function () {\n            return this.internalNeedView;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutNode.prototype.clearNeedView = function () {\n        this.internalNeedView = false;\n    };\n    LayoutNode.prototype.resolvePosition = function (position) {\n        if (position < 0 || position >= this.size) {\n            throw new Error(\"Offset \" + position + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return [{ node: this, offset: position, position: position }];\n        }\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedSize + childSize > position) {\n                return __spreadArrays([{ node: this, offset: n, position: position }], child.resolvePosition(position - cumulatedSize));\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    return LayoutNode;\n}(Node));\nexport { LayoutNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutAtom = /** @class */ (function (_super) {\n    __extends(LayoutAtom, _super);\n    function LayoutAtom(renderId, width, height) {\n        var _this = _super.call(this, renderId, renderId, ' ', [], 0, 0, 0, 0) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutAtom.prototype, \"type\", {\n        get: function () {\n            return 'atom';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutAtom.prototype.convertCoordinatesToPosition = function (x, y) {\n        if (x < this.innerWidth / 2) {\n            return 0;\n        }\n        return 1;\n    };\n    LayoutAtom.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: from === to ? 0 : this.innerWidth,\n                    height: this.innerHeight,\n                    left: from === 0 ? this.paddingLeft : this.paddingLeft + this.innerWidth,\n                    right: to === 1 ? this.paddingRight : this.paddingRight + this.innerWidth,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    return LayoutAtom;\n}(LayoutNode));\nexport { LayoutAtom };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutBlock = /** @class */ (function (_super) {\n    __extends(LayoutBlock, _super);\n    function LayoutBlock(id, renderId, children, width, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, id, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.internalNeedReflow = true;\n        return _this;\n    }\n    Object.defineProperty(LayoutBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight = this.children.reduce(function (height, child) { return height + child.height; }, this.paddingVertical);\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"needReflow\", {\n        get: function () {\n            return this.internalNeedReflow;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutBlock.prototype.clearNeedReflow = function () {\n        this.internalNeedReflow = false;\n    };\n    LayoutBlock.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (y >= cumulatedHeight && y <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToPosition(x, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToPosition(x, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutBlock.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                resolvedChildren.push(childResult);\n                childResult.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left,\n                        right: boundingBox.right,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: resolvedChildren,\n        };\n    };\n    return LayoutBlock;\n}(LayoutNode));\nexport { LayoutBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutDoc = /** @class */ (function (_super) {\n    __extends(LayoutDoc, _super);\n    function LayoutDoc(renderId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, renderId, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutDoc.prototype.convertCoordinatesToPosition = function (x, y) {\n        throw new Error('Use page to convert coordinates to position.');\n    };\n    LayoutDoc.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n            }\n            cumulatedOffset += child.size;\n        });\n        return {\n            node: this,\n            boundingBoxes: [],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutDoc;\n}(LayoutNode));\nexport { LayoutDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutLine = /** @class */ (function (_super) {\n    __extends(LayoutLine, _super);\n    function LayoutLine(id, children, width) {\n        var _this = _super.call(this, id, null, '', children, 0, 8, 0, 0) || this;\n        _this.width = width;\n        return _this;\n    }\n    Object.defineProperty(LayoutLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"contentWidth\", {\n        get: function () {\n            if (this.internalContentWidth === undefined) {\n                this.internalContentWidth = this.children.reduce(function (contentWidth, child) { return contentWidth + child.width; }, 0);\n            }\n            return this.internalContentWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutLine.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (x >= cumulatedWidth && x <= cumulatedWidth + childWidth) {\n                offset += child.convertCoordinatesToPosition(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild && lastChild.type === 'text') {\n                var lastWord = lastChild.lastChild;\n                if (lastWord && lastWord.whitespaceSize > 0) {\n                    offset--;\n                }\n            }\n        }\n        return offset;\n    };\n    LayoutLine.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n                if (left1 === null) {\n                    left1 = left2 + resolvedChild.boundingBoxes[0].left;\n                }\n                left2 += resolvedChild.boundingBoxes\n                    .slice(0, resolvedChild.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += resolvedChild.boundingBoxes[0].left + resolvedChild.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: from === to ? this.innerHeight : this.height,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: from === to ? this.paddingTop : 0,\n                    bottom: from === to ? this.paddingBottom : 0,\n                },\n            ],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutLine;\n}(LayoutNode));\nexport { LayoutLine };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutPage = /** @class */ (function (_super) {\n    __extends(LayoutPage, _super);\n    function LayoutPage(id, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, id, null, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"contentHeight\", {\n        get: function () {\n            if (this.internalContentHeight === undefined) {\n                this.internalContentHeight = this.children.reduce(function (contentHeight, child) { return contentHeight + child.height; }, 0);\n            }\n            return this.internalContentHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutPage.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        var contentX = Math.min(Math.max(x - this.paddingLeft, 0), this.innerWidth);\n        var contentY = Math.min(Math.max(y - this.paddingTop, 0), this.innerHeight);\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (contentY >= cumulatedHeight && contentY <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToPosition(contentX, contentY - cumulatedHeight);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToPosition(contentX, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutPage.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                resolvedChildren.push(resolvedChild);\n                resolvedChild.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left + _this.paddingLeft,\n                        right: boundingBox.right + _this.paddingRight,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: resolvedChildren,\n        };\n    };\n    return LayoutPage;\n}(LayoutNode));\nexport { LayoutPage };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutText = /** @class */ (function (_super) {\n    __extends(LayoutText, _super);\n    function LayoutText(id, renderId, children, paddingTop, paddingBottom, paddingLeft, paddingRight, font) {\n        var _this = _super.call(this, id, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.font = font;\n        return _this;\n    }\n    Object.defineProperty(LayoutText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"width\", {\n        get: function () {\n            if (this.internalWidth === undefined) {\n                this.internalWidth = this.children.reduce(function (width, child) { return width + child.width; }, this.paddingHorizontal);\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var lastChild = this.lastChild;\n                if (!lastChild) {\n                    this.internalTrimmedWidth = 0;\n                }\n                else {\n                    this.internalTrimmedWidth = this.width - lastChild.width + lastChild.trimmedWidth;\n                }\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutText.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (cumulatedWidth + childWidth >= x) {\n                offset += child.convertCoordinatesToPosition(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        return offset;\n    };\n    LayoutText.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n                if (left1 === null) {\n                    left1 = left2 + resolvedChild.boundingBoxes[0].left;\n                }\n                left2 += resolvedChild.boundingBoxes\n                    .slice(0, resolvedChild.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += resolvedChild.boundingBoxes[0].left + resolvedChild.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutText;\n}(LayoutNode));\nexport { LayoutText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutWord = /** @class */ (function (_super) {\n    __extends(LayoutWord, _super);\n    function LayoutWord(id, renderId, text, whitespaceSize, font, textService) {\n        var _this = _super.call(this, id, renderId, text, [], 0, 0, 0, 0) || this;\n        _this.whitespaceSize = whitespaceSize;\n        _this.font = font;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(LayoutWord.prototype, \"type\", {\n        get: function () {\n            return 'word';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"width\", {\n        get: function () {\n            var _a;\n            if (this.internalWidth === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"height\", {\n        get: function () {\n            var _a;\n            if (this.internalHeight === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var trimmedText = this.text.substring(0, this.text.length - this.whitespaceSize);\n                this.internalTrimmedWidth = this.textService.measure(trimmedText, this.font).width;\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutWord.prototype.convertCoordinatesToPosition = function (x, y) {\n        var lastWidth = 0;\n        var text = this.text;\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var measurement = this.textService.measure(text.substring(0, n), this.font);\n            var width_1 = measurement.width;\n            if (width_1 < x) {\n                lastWidth = width_1;\n                continue;\n            }\n            if (x - lastWidth < width_1 - x) {\n                return n - 1;\n            }\n            return n;\n        }\n        var width = this.width;\n        if (x - lastWidth < width - x) {\n            return text.length - 1;\n        }\n        return text.length;\n    };\n    LayoutWord.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        if (from === 0 && to === this.size) {\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: this.innerWidth,\n                        height: this.innerHeight,\n                        left: this.paddingLeft,\n                        right: this.paddingRight,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        if (from === to) {\n            var left = this.textService.measure(this.text.slice(0, from), this.font).width;\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: 0,\n                        height: this.innerHeight,\n                        left: this.paddingLeft + left,\n                        right: this.width - this.paddingLeft - left,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        var left1 = this.textService.measure(this.text.slice(0, from), this.font).width;\n        var left2 = this.textService.measure(this.text.slice(0, to), this.font).width;\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.innerWidth - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    LayoutWord.prototype.breakAt = function (offset) {\n        return [\n            new LayoutWord(this.id, this.renderId, this.text.substring(0, offset), 0, this.font, this.textService),\n            new LayoutWord(this.id + \"=\", this.renderId, this.text.substring(offset), this.whitespaceSize, this.font, this.textService),\n        ];\n    };\n    LayoutWord.prototype.measure = function () {\n        var measurement = this.textService.measure(this.text, this.font);\n        return [measurement.width, measurement.height];\n    };\n    return LayoutWord;\n}(LayoutNode));\nexport { LayoutWord };\n","import { LayoutAtom } from './atom';\nimport { LayoutBlock } from './block';\nimport { LayoutDoc } from './doc';\nimport { LayoutLine } from './line';\nimport { LayoutPage } from './page';\nimport { LayoutText } from './text';\nimport { LayoutWord } from './word';\nvar LayoutEngine = /** @class */ (function () {\n    function LayoutEngine(textService) {\n        this.textService = textService;\n    }\n    LayoutEngine.prototype.updateDoc = function (doc, renderDoc) {\n        var _this = this;\n        if (!renderDoc.needLayout && doc) {\n            return doc;\n        }\n        var pages = [];\n        var childrenMap = {};\n        if (doc) {\n            doc.children.forEach(function (page) {\n                pages.push(page);\n                page.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderDoc.children.forEach(function (child) {\n            switch (child.type) {\n                case 'block':\n                    newChildren.push.apply(newChildren, _this.updateBlock(childrenMap[child.id] || [], child, renderDoc.width - renderDoc.paddingLeft - renderDoc.paddingRight));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + child.type + \" is invalid.\");\n            }\n        });\n        renderDoc.clearNeedLayout();\n        return this.buildDoc(renderDoc, this.reflowPages(pages, newChildren, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight));\n    };\n    LayoutEngine.prototype.updateBlock = function (blocks, renderBlock, width) {\n        var _this = this;\n        if (!renderBlock.needLayout && blocks.length > 0) {\n            return blocks;\n        }\n        var lines = [];\n        var childrenMap = {};\n        for (var _i = 0, blocks_1 = blocks; _i < blocks_1.length; _i++) {\n            var block = blocks_1[_i];\n            block.children.forEach(function (line) {\n                lines.push(line);\n                line.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderBlock.children.forEach(function (renderChild) {\n            switch (renderChild.type) {\n                case 'text':\n                    newChildren.push.apply(newChildren, _this.updateText(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                case 'atom':\n                    newChildren.push.apply(newChildren, _this.updateAtom(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + renderChild.type + \" is invalid.\");\n            }\n        });\n        renderBlock.clearNeedLayout();\n        return [\n            this.buildBlock(renderBlock, this.reflowLines(renderBlock.id, lines, newChildren, width - renderBlock.paddingLeft - renderBlock.paddingRight), width),\n        ];\n    };\n    LayoutEngine.prototype.updateText = function (texts, renderText) {\n        var _this = this;\n        if (!renderText.needLayout && texts.length > 0) {\n            return texts;\n        }\n        var newChildren = [];\n        this.textService.breakIntoWords(renderText.text).forEach(function (word) {\n            newChildren.push(_this.buildWord(getNextId(newChildren.length > 0 ? newChildren[newChildren.length - 1].id : null, renderText.id + \".word\"), renderText, word.text, word.whitespaceSize));\n        });\n        renderText.clearNeedLayout();\n        return [this.buildText(renderText, newChildren)];\n    };\n    LayoutEngine.prototype.updateAtom = function (atoms, renderAtom) {\n        if (!renderAtom.needLayout && atoms.length > 0) {\n            return atoms;\n        }\n        renderAtom.clearNeedLayout();\n        return [this.buildAtom(renderAtom)];\n    };\n    LayoutEngine.prototype.buildDoc = function (renderDoc, children) {\n        return new LayoutDoc(renderDoc.id, children, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight);\n    };\n    LayoutEngine.prototype.buildBlock = function (renderBlock, children, width) {\n        if (renderBlock.type !== 'block') {\n            throw new Error('Expected block.');\n        }\n        return new LayoutBlock(getNextId(null, renderBlock.id), renderBlock.id, children, width, renderBlock.paddingTop, renderBlock.paddingBottom, renderBlock.paddingLeft, renderBlock.paddingRight);\n    };\n    LayoutEngine.prototype.buildText = function (renderText, children) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutText(getNextId(null, renderText.id), renderText.id, children, renderText.paddingTop, renderText.paddingBottom, renderText.paddingLeft, renderText.paddingRight, renderText.font);\n    };\n    LayoutEngine.prototype.buildWord = function (id, renderText, text, whitespaceSize) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutWord(id, renderText.id, text, whitespaceSize, renderText.font, this.textService);\n    };\n    LayoutEngine.prototype.buildAtom = function (renderAtom) {\n        if (renderAtom.type !== 'atom') {\n            throw new Error('Expected atom.');\n        }\n        return new LayoutAtom(renderAtom.id, renderAtom.width, renderAtom.height);\n    };\n    LayoutEngine.prototype.reflowPages = function (pages, nodes, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var innerHeight = height - paddingTop - paddingBottom;\n        nodes = nodes.slice();\n        var newPages = [];\n        while (nodes.length > 0) {\n            if (newPages.length < pages.length) {\n                var page = pages[newPages.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = page.children.length; n < nn; n++) {\n                    var child = page.children.at(n);\n                    if (child.id !== nodes[n].id || checkNeedsReflow(nodes[n])) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newPages.push(page);\n                    nodes.splice(0, page.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentHeight = 0;\n            // Push whole nodes to page until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentHeight + node.height <= innerHeight) {\n                clearNeedReflow(node);\n                newChildren.push(node);\n                currentHeight += node.height;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to page\n            if (node) {\n                var nodeChildren = [];\n                for (var m = 0, mm = node.children.length; m < mm; m++) {\n                    var nodeChild = node.children.at(m);\n                    if (currentHeight + nodeChild.height + node.paddingVertical > innerHeight) {\n                        break;\n                    }\n                    nodeChildren.push(nodeChild);\n                    currentHeight += nodeChild.height;\n                }\n                if (nodeChildren.length > 0) {\n                    clearNeedReflow(node);\n                    switch (node.type) {\n                        case 'block':\n                            // Split block to two, one to push to this page, other goes back\n                            // to list of nodes to process\n                            var node1 = new LayoutBlock(node.id, node.renderId, nodeChildren, width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            newChildren.push(node1);\n                            currentHeight += node1.height;\n                            var node2 = new LayoutBlock(getNextId(node.id, node.renderId), node.renderId, node.children.slice(nodeChildren.length), width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            nodes.unshift(node2);\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newPage = new LayoutPage(getNextId(newPages.length > 0 ? newPages[newPages.length - 1].id : null, 'page'), newChildren, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight);\n            newPages.push(newPage);\n        }\n        return newPages;\n    };\n    LayoutEngine.prototype.reflowLines = function (parentId, lines, nodes, width) {\n        nodes = nodes.slice();\n        var newLines = [];\n        while (nodes.length > 0) {\n            if (newLines.length < newLines.length) {\n                var line = lines[newLines.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = line.children.length; n < nn; n++) {\n                    var child = line.children.at(n);\n                    if (child.id !== nodes[n].id) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newLines.push(line);\n                    nodes.splice(0, line.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentWidth = 0;\n            // Push whole nodes to line until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentWidth + node.width <= width) {\n                newChildren.push(node);\n                currentWidth += node.width;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to line\n            if (node) {\n                var nodeChildren = node.children.slice();\n                var newNodeChildren = [];\n                for (var m = 0; m < nodeChildren.length; m++) {\n                    var nodeChild = nodeChildren[m];\n                    if (nodeChild.type === 'word' && nodeChild.width > width) {\n                        var breakAt = nodeChild.convertCoordinatesToPosition(width, 0);\n                        if (nodeChild.resolveBoundingBoxes(breakAt, breakAt).boundingBoxes[0].left > width) {\n                            breakAt--;\n                        }\n                        var _a = nodeChild.breakAt(breakAt), brokenNodeChild1 = _a[0], brokenNodeChild2 = _a[1];\n                        nodeChild = brokenNodeChild1;\n                        nodeChildren.splice(m, 1, brokenNodeChild1, brokenNodeChild2);\n                    }\n                    if (currentWidth + nodeChild.width > width) {\n                        break;\n                    }\n                    newNodeChildren.push(nodeChild);\n                    currentWidth += nodeChild.width;\n                }\n                if (newNodeChildren.length > 0) {\n                    switch (node.type) {\n                        case 'text':\n                            // Split text to two, one to push to this line, other goes back\n                            // to list of nodes to process\n                            var text = node;\n                            var node1 = new LayoutText(text.id, text.renderId, newNodeChildren, text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            newChildren.push(node1);\n                            currentWidth += node1.width;\n                            var node2 = new LayoutText(getNextId(text.id, text.renderId), text.renderId, nodeChildren.slice(newNodeChildren.length), text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            nodes.unshift(node2);\n                            break;\n                        case 'atom':\n                            // If atom is wider than line and line is empty, push atom to line\n                            // and let it clip\n                            if (node.width > width && newChildren.length === 0) {\n                                newChildren.push(node);\n                            }\n                            else {\n                                // Atom cannot be split, goes back to list of nodes to process\n                                nodes.unshift(node);\n                            }\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newLine = new LayoutLine(getNextId(newLines.length > 0 ? newLines[newLines.length - 1].id : null, parentId + \".line\"), newChildren, width);\n            newLines.push(newLine);\n        }\n        return newLines;\n    };\n    return LayoutEngine;\n}());\nexport { LayoutEngine };\nfunction getNextId(previousId, prefix) {\n    if (!previousId) {\n        return prefix + \".0\";\n    }\n    var segments = previousId.split('.');\n    var counter = parseInt(segments[segments.length - 1], 36);\n    return prefix + \".\" + (counter + 1).toString(36);\n}\nfunction checkNeedsReflow(node) {\n    switch (node.type) {\n        case 'block':\n            return node.needReflow;\n        default:\n            return false;\n    }\n}\nfunction clearNeedReflow(node) {\n    switch (node.type) {\n        case 'block':\n            node.clearNeedReflow();\n            break;\n    }\n}\n","import { EventEmitter } from '../event/emitter';\nimport { LayoutEngine } from './engine';\nvar LayoutState = /** @class */ (function () {\n    function LayoutState(renderService, textService) {\n        var _this = this;\n        this.renderService = renderService;\n        this.textService = textService;\n        this.didUpdateLayoutStateEventEmitter = new EventEmitter();\n        this.engine = new LayoutEngine(textService);\n        this.internalDoc = this.engine.updateDoc(null, renderService.getDoc());\n        renderService.onDidUpdateRenderState(function (event) { return _this.handleDidUpdateRenderStateEvent(event); });\n    }\n    Object.defineProperty(LayoutState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutState.prototype.onDidUpdateLayoutState = function (listener) {\n        return this.didUpdateLayoutStateEventEmitter.on(listener);\n    };\n    LayoutState.prototype.handleDidUpdateRenderStateEvent = function (event) {\n        this.update();\n    };\n    LayoutState.prototype.update = function () {\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.engine.updateDoc(this.doc, renderDoc);\n        this.didUpdateLayoutStateEventEmitter.emit({});\n    };\n    return LayoutState;\n}());\nexport { LayoutState };\n","import { LayoutState } from './state';\nvar LayoutService = /** @class */ (function () {\n    function LayoutService(renderService, textService) {\n        this.state = new LayoutState(renderService, textService);\n    }\n    LayoutService.prototype.onDidUpdateLayoutState = function (listener) {\n        this.state.onDidUpdateLayoutState(listener);\n    };\n    LayoutService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    LayoutService.prototype.resolvePosition = function (position) {\n        return this.state.doc.resolvePosition(position);\n    };\n    LayoutService.prototype.resolveBoundingBoxes = function (from, to) {\n        return this.state.doc.resolveBoundingBoxes(from, to);\n    };\n    return LayoutService;\n}());\nexport { LayoutService };\n","import { EventEmitter } from '../event/emitter';\nvar ModelState = /** @class */ (function () {\n    function ModelState(root, componentService) {\n        this.root = root;\n        this.componentService = componentService;\n        this.didUpdateEventEmitter = new EventEmitter();\n    }\n    ModelState.prototype.applyChange = function (change) {\n        var changeResult = change.apply(this.root, this.componentService);\n        this.didUpdateEventEmitter.emit({ changeResult: changeResult });\n        return changeResult;\n    };\n    ModelState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelState;\n}());\nexport { ModelState };\n","import { ModelState } from './state';\nvar ModelService = /** @class */ (function () {\n    function ModelService(root, componentService) {\n        this.state = new ModelState(root, componentService);\n    }\n    ModelService.prototype.getRoot = function () {\n        return this.state.root;\n    };\n    ModelService.prototype.getRootSize = function () {\n        return this.state.root.size;\n    };\n    ModelService.prototype.applyChange = function (change) {\n        return this.state.applyChange(change);\n    };\n    ModelService.prototype.resolvePosition = function (position) {\n        return this.state.root.resolvePosition(position);\n    };\n    ModelService.prototype.onDidUpdateModelState = function (listener) {\n        this.state.onDidUpdate(listener);\n    };\n    return ModelService;\n}());\nexport { ModelService };\n","import { EventEmitter } from '../event/emitter';\nvar RenderState = /** @class */ (function () {\n    function RenderState(componentService, modelService) {\n        var _this = this;\n        this.componentService = componentService;\n        this.modelService = modelService;\n        this.didUpdateRenderStateEventEmitter = new EventEmitter();\n        var modelRoot = modelService.getRoot();\n        this.internalDoc = this.updateNode(null, modelRoot);\n        modelService.onDidUpdateModelState(function (event) { return _this.handleDidUpdateModelState(event); });\n    }\n    RenderState.prototype.onDidUpdateRenderState = function (listener) {\n        return this.didUpdateRenderStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(RenderState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderState.prototype.handleDidUpdateModelState = function (event) {\n        this.update();\n    };\n    RenderState.prototype.update = function () {\n        var modelRoot = this.modelService.getRoot();\n        this.internalDoc = this.updateNode(this.doc, modelRoot);\n        this.didUpdateRenderStateEventEmitter.emit({});\n    };\n    RenderState.prototype.updateNode = function (node, modelNode) {\n        var _this = this;\n        if (!modelNode.needRender && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.modelId) {\n                    return;\n                }\n                childrenMap[child.modelId] = child;\n            });\n        }\n        var newChildren = [];\n        modelNode.children.forEach(function (modelChild) {\n            newChildren.push(_this.updateNode(childrenMap[modelChild.id] || null, modelChild));\n        });\n        modelNode.clearNeedRender();\n        return this.buildNode(modelNode, newChildren);\n    };\n    RenderState.prototype.buildNode = function (modelNode, children) {\n        var component = this.componentService.getComponent(modelNode.componentId);\n        var node = component.buildRenderNode(modelNode.partId, modelNode.id, modelNode.text, modelNode.attributes, children);\n        if (!node) {\n            throw new Error(\"Error building render node from model node \" + modelNode.id + \".\");\n        }\n        return node;\n    };\n    return RenderState;\n}());\nexport { RenderState };\n","import { RenderState } from './state';\nvar RenderService = /** @class */ (function () {\n    function RenderService(componentService, modelService) {\n        this.state = new RenderState(componentService, modelService);\n    }\n    RenderService.prototype.onDidUpdateRenderState = function (listener) {\n        this.state.onDidUpdateRenderState(listener);\n    };\n    RenderService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    RenderService.prototype.getDocSize = function () {\n        return this.state.doc.size;\n    };\n    RenderService.prototype.resolvePosition = function (position) {\n        return this.state.doc.resolvePosition(position);\n    };\n    RenderService.prototype.resolveFont = function (from, to) {\n        var _a, _b, _c, _d, _e, _f, _g, _h;\n        var resolvedFont = {};\n        var nodeQueue = [[this.state.doc, 0]];\n        var _loop_1 = function () {\n            var _a = nodeQueue.shift(), node = _a[0], nodeFrom = _a[1];\n            if (node.text) {\n                var nodeFont = node.font;\n                var fontProp = void 0;\n                for (fontProp in nodeFont) {\n                    if (!(fontProp in resolvedFont)) {\n                        resolvedFont[fontProp] = nodeFont[fontProp];\n                    }\n                    else if (resolvedFont[fontProp] !== nodeFont[fontProp]) {\n                        resolvedFont[fontProp] = null;\n                    }\n                }\n            }\n            else {\n                var childOffset_1 = 0;\n                node.children.forEach(function (child, childIndex) {\n                    var childSize = child.size;\n                    var childFrom = nodeFrom + childOffset_1;\n                    var childTo = childFrom + childSize;\n                    var intersect;\n                    if (from === to) {\n                        intersect = childFrom <= to && childTo > from;\n                    }\n                    else {\n                        intersect = childFrom < to && childTo > from;\n                    }\n                    if (intersect) {\n                        nodeQueue.push([child, childFrom]);\n                    }\n                    childOffset_1 += childSize;\n                });\n            }\n        };\n        while (nodeQueue.length > 0) {\n            _loop_1();\n        }\n        return {\n            weight: (_a = resolvedFont.weight) !== null && _a !== void 0 ? _a : null,\n            size: (_b = resolvedFont.size) !== null && _b !== void 0 ? _b : null,\n            family: (_c = resolvedFont.family) !== null && _c !== void 0 ? _c : null,\n            letterSpacing: (_d = resolvedFont.letterSpacing) !== null && _d !== void 0 ? _d : null,\n            underline: (_e = resolvedFont.underline) !== null && _e !== void 0 ? _e : null,\n            italic: (_f = resolvedFont.italic) !== null && _f !== void 0 ? _f : null,\n            strikethrough: (_g = resolvedFont.strikethrough) !== null && _g !== void 0 ? _g : null,\n            color: (_h = resolvedFont.color) !== null && _h !== void 0 ? _h : null,\n        };\n    };\n    RenderService.prototype.convertModelToRenderPosition = function (modelPosition) {\n        return this.state.doc.convertModelToRenderPosition(modelPosition);\n    };\n    RenderService.prototype.convertRenderToModelPosition = function (renderPosition) {\n        return this.state.doc.convertRenderToModelPosition(renderPosition);\n    };\n    return RenderService;\n}());\nexport { RenderService };\n","var ServiceRegistry = /** @class */ (function () {\n    function ServiceRegistry() {\n        this.services = {};\n    }\n    ServiceRegistry.prototype.registerService = function (key, service) {\n        this.services[key] = service;\n    };\n    ServiceRegistry.prototype.getService = function (key) {\n        var service = this.services[key];\n        if (!service) {\n            throw new Error(\"Service \" + key + \" is not registered.\");\n        }\n        return service;\n    };\n    return ServiceRegistry;\n}());\nexport { ServiceRegistry };\n","import { EventEmitter } from '../event/emitter';\nvar TransformService = /** @class */ (function () {\n    function TransformService(modelService, componentService, cursorService, renderService, layoutService) {\n        this.modelService = modelService;\n        this.componentService = componentService;\n        this.cursorService = cursorService;\n        this.renderService = renderService;\n        this.layoutService = layoutService;\n        this.didApplyTransformationEventEmitter = new EventEmitter();\n    }\n    TransformService.prototype.applyTransformation = function (tn) {\n        var result = tn.apply(this.modelService, this.cursorService, this.renderService, this.layoutService);\n        this.didApplyTransformationEventEmitter.emit({ result: result });\n        return result;\n    };\n    TransformService.prototype.onDidApplyTransformation = function (listener) {\n        return this.didApplyTransformationEventEmitter.on(listener);\n    };\n    return TransformService;\n}());\nexport { TransformService };\n","var CursorView = /** @class */ (function () {\n    function CursorView(instanceId, configService, domService, cursorService, layoutService, viewService, transformService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.configService = configService;\n        this.domService = domService;\n        this.cursorService = cursorService;\n        this.layoutService = layoutService;\n        this.viewService = viewService;\n        this.transformService = transformService;\n        this.blinkInterval = null;\n        this.blinkState = true;\n        this.domSelections = [];\n        this.attached = false;\n        var cursorConfig = configService.getConfig().cursor;\n        this.caretColor = cursorConfig.caretColor;\n        this.caretInactiveColor = cursorConfig.caretInactiveColor;\n        this.selectionColor = cursorConfig.selectionColor;\n        this.selectionInactiveColor = cursorConfig.selectionInactiveColor;\n        this.domCaret = domService.createElement('div');\n        this.domCaret.className = 'tw--cursor--caret';\n        this.domCaret.setAttribute('data-tw-instance', this.instanceId);\n        this.domCaret.style.position = 'absolute';\n        this.domCaret.style.userSelect = 'none';\n        this.domCaret.style.pointerEvents = 'none';\n        this.domCaret.style.width = '2px';\n        this.domCaret.style.marginLeft = '-1px';\n        transformService.onDidApplyTransformation(function (event) { return _this.handleDidApplyTransformation(event); });\n        viewService.onDidFocus(function (event) { return _this.handleDidFocus(event); });\n        viewService.onDidBlur(function (event) { return _this.handleDidBlur(event); });\n    }\n    CursorView.prototype.attach = function () {\n        if (this.attached) {\n            throw new Error('Already attached to the DOM.');\n        }\n        this.attached = true;\n        this.updateView();\n    };\n    CursorView.prototype.updateView = function () {\n        var _this = this;\n        if (!this.attached) {\n            return;\n        }\n        this.clearDOMSelections();\n        var _a = this.cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        var from = Math.min(anchor, head);\n        var to = Math.max(anchor, head);\n        var docBoxResult = this.layoutService.resolveBoundingBoxes(from, to);\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var focused = this.viewService.isFocused();\n        var firstPageId = '';\n        var firstBoxOffset = -1;\n        var lastPageId = '';\n        var lastBoxOffset = -1;\n        docBoxResult.children.forEach(function (pageBoxResult) {\n            var pageOffset = layoutDoc.children.indexOf(pageBoxResult.node);\n            var viewPage = viewDoc.children.at(pageOffset);\n            var domContentContainer = viewPage.domContentContainer;\n            pageBoxResult.boundingBoxes.forEach(function (box, boxOffset) {\n                if (!firstPageId) {\n                    firstPageId = pageBoxResult.node.id;\n                    firstBoxOffset = boxOffset;\n                }\n                lastPageId = pageBoxResult.node.id;\n                lastBoxOffset = boxOffset;\n                if (box.width === 0) {\n                    return;\n                }\n                var domSelection = _this.buildDOMSelection(box);\n                if (focused) {\n                    domSelection.style.background = _this.selectionColor;\n                }\n                else {\n                    domSelection.style.background = _this.selectionInactiveColor;\n                }\n                domContentContainer.appendChild(domSelection);\n                _this.domSelections.push(domSelection);\n            });\n        });\n        var headPageId;\n        var headLeft;\n        var headTop;\n        var headHeight;\n        if (head < anchor) {\n            headPageId = firstPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === firstPageId; }).boundingBoxes[firstBoxOffset];\n            headLeft = rect.left;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        else {\n            headPageId = lastPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === lastPageId; }).boundingBoxes[lastBoxOffset];\n            headLeft = rect.left + rect.width;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        if (head === anchor) {\n            this.domCaret.style.display = 'block';\n            this.domCaret.style.top = headTop + \"px\";\n            this.domCaret.style.left = headLeft + \"px\";\n            this.domCaret.style.height = headHeight + \"px\";\n            if (focused) {\n                this.domCaret.style.background = this.caretColor;\n            }\n            else {\n                this.domCaret.style.background = this.caretInactiveColor;\n            }\n            var pageDOMContentContainer = viewDoc.children.find(function (child) { return child.id === headPageId; })\n                .domContentContainer;\n            if (this.domCaret.parentElement && this.domCaret.parentElement !== pageDOMContentContainer) {\n                this.domCaret.parentElement.removeChild(this.domCaret);\n            }\n            if (!this.domCaret.parentElement) {\n                pageDOMContentContainer.appendChild(this.domCaret);\n            }\n            this.blinkStop();\n            if (focused) {\n                this.blinkStart();\n            }\n        }\n        else {\n            this.domCaret.style.display = 'none';\n            this.blinkStop();\n        }\n    };\n    CursorView.prototype.blinkStart = function () {\n        var _this = this;\n        if (this.blinkInterval !== null) {\n            return;\n        }\n        this.blinkState = true;\n        this.blinkInterval = window.setInterval(function () {\n            _this.blinkState = !_this.blinkState;\n            _this.updateDOMBlink();\n        }, 500);\n    };\n    CursorView.prototype.blinkStop = function () {\n        if (this.blinkInterval === null) {\n            return;\n        }\n        this.domCaret.style.visibility = 'visible';\n        clearInterval(this.blinkInterval);\n        this.blinkInterval = null;\n    };\n    CursorView.prototype.updateDOMBlink = function () {\n        if (this.blinkState) {\n            this.domCaret.style.visibility = 'visible';\n        }\n        else {\n            this.domCaret.style.visibility = 'hidden';\n        }\n    };\n    CursorView.prototype.clearDOMSelections = function () {\n        this.domSelections.forEach(function (domSelection) {\n            if (domSelection.parentElement) {\n                domSelection.parentElement.removeChild(domSelection);\n            }\n        });\n        this.domSelections = [];\n    };\n    CursorView.prototype.buildDOMSelection = function (box) {\n        var domSelection = document.createElement('div');\n        domSelection.className = 'tw--cursor--selection';\n        domSelection.setAttribute('data-tw-instance', this.instanceId);\n        domSelection.style.position = 'absolute';\n        domSelection.style.top = box.top + \"px\";\n        domSelection.style.left = box.left + \"px\";\n        domSelection.style.width = box.width + \"px\";\n        domSelection.style.height = box.height + \"px\";\n        domSelection.style.userSelect = 'none';\n        domSelection.style.pointerEvents = 'none';\n        return domSelection;\n    };\n    CursorView.prototype.handleDidApplyTransformation = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidFocus = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidBlur = function (event) {\n        this.updateView();\n    };\n    return CursorView;\n}());\nexport { CursorView };\n","import { EventEmitter } from '../event/emitter';\nvar ClipboardObserver = /** @class */ (function () {\n    function ClipboardObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didCopyEventEmitter = new EventEmitter();\n        this.didPasteEventEmitter = new EventEmitter();\n        this.handleCopy = function (event) {\n            event.preventDefault();\n            _this.didCopyEventEmitter.emit({});\n        };\n        this.handlePaste = function (event) {\n            event.preventDefault();\n            var data = event.clipboardData;\n            if (!data) {\n                return;\n            }\n            _this.didPasteEventEmitter.emit({ data: data });\n        };\n        $contentEditable.addEventListener('copy', this.handleCopy);\n        $contentEditable.addEventListener('paste', this.handlePaste);\n    }\n    ClipboardObserver.prototype.onDidCopy = function (listener) {\n        return this.didCopyEventEmitter.on(listener);\n    };\n    ClipboardObserver.prototype.onDidPaste = function (listener) {\n        return this.didPasteEventEmitter.on(listener);\n    };\n    return ClipboardObserver;\n}());\nexport { ClipboardObserver };\n","import { EventEmitter } from '../event/emitter';\nvar FocusObserver = /** @class */ (function () {\n    function FocusObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didFocusEventEmitter = new EventEmitter();\n        this.didBlurEventEmitter = new EventEmitter();\n        this.handleFocus = function () {\n            _this.didFocusEventEmitter.emit({});\n        };\n        this.handleBlur = function () {\n            _this.didBlurEventEmitter.emit({});\n        };\n        $contentEditable.addEventListener('focus', this.handleFocus);\n        $contentEditable.addEventListener('blur', this.handleBlur);\n    }\n    FocusObserver.prototype.onDidFocus = function (listener) {\n        return this.didFocusEventEmitter.on(listener);\n    };\n    FocusObserver.prototype.onDidBlur = function (listener) {\n        return this.didBlurEventEmitter.on(listener);\n    };\n    return FocusObserver;\n}());\nexport { FocusObserver };\n","import { EventEmitter } from '../event/emitter';\nimport { detectPlatform } from '../util/platform';\nvar KeyboardObserver = /** @class */ (function () {\n    function KeyboardObserver($contentEditable, domService) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.domService = domService;\n        this.composing = false;\n        this.didInsertEventEmitter = new EventEmitter();\n        this.didPressKeyEventEmitter = new EventEmitter();\n        this.compositionDidStartEventEmitter = new EventEmitter();\n        this.compositionDidEndEventEmitter = new EventEmitter();\n        this.keyInterpreter = new KeyInterpreter();\n        this.handleDidMutate = function () {\n            setTimeout(function () {\n                if (_this.composing) {\n                    return;\n                }\n                var content = _this.$contentEditable.innerText;\n                _this.$contentEditable.innerHTML = '';\n                if (content.length === 0) {\n                    return;\n                }\n                _this.didInsertEventEmitter.emit({ content: content });\n            });\n        };\n        this.handleKeyDown = function (event) {\n            var key = _this.keyInterpreter.interpretFromKeyboardEvent(event);\n            if (!key) {\n                return;\n            }\n            _this.didPressKeyEventEmitter.emit({ key: key, originalKeyboardEvent: event });\n        };\n        this.handleCompositionStart = function () {\n            _this.composing = true;\n        };\n        this.handleCompositionEnd = function () {\n            _this.composing = true;\n        };\n        this.mutationObserver = domService.createMutationObserver(this.handleDidMutate);\n        $contentEditable.addEventListener('keydown', this.handleKeyDown);\n        $contentEditable.addEventListener('compositionstart', this.handleCompositionStart);\n        $contentEditable.addEventListener('compositionend', this.handleCompositionEnd);\n        this.mutationObserver.observe($contentEditable, {\n            subtree: true,\n            characterData: true,\n            childList: true,\n        });\n    }\n    KeyboardObserver.prototype.onDidInsert = function (listener) {\n        return this.didInsertEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onDidPressKey = function (listener) {\n        return this.didPressKeyEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidStart = function (listener) {\n        return this.compositionDidStartEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidEnd = function (listener) {\n        return this.compositionDidEndEventEmitter.on(listener);\n    };\n    return KeyboardObserver;\n}());\nexport { KeyboardObserver };\nvar KeyInterpreter = /** @class */ (function () {\n    function KeyInterpreter() {\n    }\n    KeyInterpreter.prototype.interpretFromKeyboardEvent = function (event) {\n        var key;\n        switch (event.key) {\n            case 'Control':\n            case 'Shift':\n            case 'Alt':\n            case 'Meta':\n                return undefined;\n            case 'ArrowLeft':\n                key = 'left';\n                break;\n            case 'ArrowRight':\n                key = 'right';\n                break;\n            case 'ArrowUp':\n                key = 'up';\n                break;\n            case 'ArrowDown':\n                key = 'down';\n                break;\n            default:\n                key = event.key.toLowerCase();\n        }\n        if (event.metaKey) {\n            switch (detectPlatform()) {\n                case 'macOS':\n                    key = \"cmd+\" + key;\n                    break;\n                case 'Windows':\n                    key = \"win+\" + key;\n                    break;\n                case 'Linux':\n                default:\n                    key = \"meta+\" + key;\n            }\n        }\n        if (event.altKey) {\n            key = \"alt+\" + key;\n        }\n        if (event.shiftKey) {\n            key = \"shift+\" + key;\n        }\n        if (event.ctrlKey) {\n            key = \"ctrl+\" + key;\n        }\n        return key;\n    };\n    return KeyInterpreter;\n}());\n","import { EventEmitter } from '../event/emitter';\nvar PointerObserver = /** @class */ (function () {\n    function PointerObserver(instanceId, viewService, domService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.viewService = viewService;\n        this.domService = domService;\n        this.layoutService = layoutService;\n        this.clickThreshold = 250;\n        this.consecutiveClickThreshold = 250;\n        this.lastPointerDown = null;\n        this.lastClick = null;\n        this.consecutiveClickCount = 0;\n        this.pointerDidDownEventEmitter = new EventEmitter();\n        this.pointerDidMoveEventEmitter = new EventEmitter();\n        this.pointerDidUpEventEmitter = new EventEmitter();\n        this.pointerDidClickEventEmitter = new EventEmitter();\n        this.handleMouseDown = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            // Bypass browser selection\n            event.preventDefault();\n            _this.lastPointerDown = {\n                timestamp: Date.now(),\n                offset: offset,\n            };\n            var consecutive = _this.lastClick !== null && Date.now() - _this.lastClick.timestamp < _this.consecutiveClickThreshold;\n            _this.pointerDidDownEventEmitter.emit({ offset: offset, consecutive: consecutive });\n        };\n        this.handleMouseMove = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            _this.pointerDidMoveEventEmitter.emit({\n                pointerDown: _this.lastPointerDown !== null,\n                offset: offset,\n            });\n        };\n        this.handleMouseUp = function (event) {\n            if (_this.lastPointerDown === null) {\n                return;\n            }\n            var lastPointerDown = _this.lastPointerDown;\n            _this.lastPointerDown = null;\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            var now = Date.now();\n            var clicked = lastPointerDown.offset === offset && now - lastPointerDown.timestamp < _this.clickThreshold;\n            _this.pointerDidUpEventEmitter.emit({});\n            if (clicked) {\n                if (_this.lastClick !== null) {\n                    var delta = now - _this.lastClick.timestamp;\n                    if (delta > _this.consecutiveClickThreshold) {\n                        _this.consecutiveClickCount = 0;\n                    }\n                }\n                _this.consecutiveClickCount++;\n                _this.lastClick = {\n                    timestamp: Date.now(),\n                    offset: offset,\n                };\n                _this.pointerDidClickEventEmitter.emit({\n                    offset: offset,\n                    consecutiveCount: _this.consecutiveClickCount,\n                });\n            }\n        };\n        var window = domService.getWindow();\n        window.addEventListener('mousedown', this.handleMouseDown);\n        window.addEventListener('mousemove', this.handleMouseMove);\n        window.addEventListener('mouseup', this.handleMouseUp);\n    }\n    PointerObserver.prototype.onPointerDidDown = function (listener) {\n        return this.pointerDidDownEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidMove = function (listener) {\n        return this.pointerDidMoveEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidUp = function (listener) {\n        return this.pointerDidUpEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidClick = function (listener) {\n        return this.pointerDidClickEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.resolveOffset = function (x, y) {\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var cumulatedOffset = 0;\n        for (var n = 0, nn = viewDoc.children.length; n < nn; n++) {\n            var viewPage = viewDoc.children.at(n);\n            var layoutPage = layoutDoc.children.at(n);\n            var pageBoundingClientRect = viewPage.domContainer.getBoundingClientRect();\n            if (pageBoundingClientRect.left <= x &&\n                pageBoundingClientRect.right >= x &&\n                pageBoundingClientRect.top <= y &&\n                pageBoundingClientRect.bottom >= y) {\n                var pageX = x - pageBoundingClientRect.left;\n                var pageY = y - pageBoundingClientRect.top;\n                return cumulatedOffset + layoutPage.convertCoordinatesToPosition(pageX, pageY);\n            }\n            cumulatedOffset += layoutPage.size;\n        }\n        return null;\n    };\n    return PointerObserver;\n}());\nexport { PointerObserver };\n","import { ClipboardObserver } from './clipboard-observer';\nimport { FocusObserver } from './focus-observer';\nimport { KeyboardObserver, } from './keyboard-observer';\nimport { PointerObserver, } from './pointer-observer';\nvar DOMController = /** @class */ (function () {\n    function DOMController(instanceId, domService, commandService, modelService, viewService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.domService = domService;\n        this.commandService = commandService;\n        this.modelService = modelService;\n        this.viewService = viewService;\n        this.layoutService = layoutService;\n        this.focused = false;\n        this.composing = false;\n        this.mouseDown = false;\n        this.handleDidInsert = function (event) {\n            _this.commandService.executeCommand('tw.state.insert', event.content);\n        };\n        this.handleCompositionDidStart = function (event) {\n            _this.composing = true;\n        };\n        this.handleCompositionDidEnd = function (event) {\n            _this.composing = false;\n        };\n        this.handlePointerDidDown = function (event) {\n            if (!_this.focused) {\n                _this.commandService.executeCommand('tw.view.focus');\n            }\n            if (!event.consecutive) {\n                _this.commandService.executeCommand('tw.cursor.move', event.offset);\n            }\n        };\n        this.handlePointerDidMove = function (event) {\n            if (event.pointerDown) {\n                _this.commandService.executeCommand('tw.cursor.moveHead', event.offset);\n            }\n        };\n        this.handlePointerDidClick = function (event) {\n            switch (event.consecutiveCount) {\n                case 1:\n                    break;\n                case 2:\n                    _this.commandService.executeCommand('tw.cursor.selectWord', event.offset);\n                    break;\n                case 3:\n                    _this.commandService.executeCommand('tw.cursor.selectBlock', event.offset);\n                    break;\n                case 4:\n                default:\n                    _this.commandService.executeCommand('tw.cursor.selectAll');\n            }\n        };\n        this.handleDidFocus = function (event) {\n            _this.focused = true;\n        };\n        this.handleDidBlur = function (event) {\n            _this.focused = false;\n        };\n        this.handleCopy = function (event) {\n            _this.commandService.executeCommand('tw.clipboard.copy');\n        };\n        this.handlePaste = function (event) {\n            var html = event.data.getData('text/html');\n            var $container = _this.domService.createElement('html');\n            $container.innerHTML = html;\n            var $body = $container.querySelector('body');\n            if (!$body) {\n                return;\n            }\n            var domNodes = Array.prototype.slice.call($body.children);\n            console.log(domNodes);\n            // TODO\n        };\n        this.iframe = domService.createHiddenIframe();\n        this.$contentEditable = this.createContentEditable();\n        this.keyboardObserver = new KeyboardObserver(this.$contentEditable, domService);\n        this.keyboardObserver.onDidInsert(this.handleDidInsert);\n        this.keyboardObserver.onCompositionDidStart(this.handleCompositionDidStart);\n        this.keyboardObserver.onCompositionDidEnd(this.handleCompositionDidEnd);\n        this.pointerObserver = new PointerObserver(instanceId, viewService, domService, layoutService);\n        this.pointerObserver.onPointerDidDown(this.handlePointerDidDown);\n        this.pointerObserver.onPointerDidMove(this.handlePointerDidMove);\n        this.pointerObserver.onPointerDidClick(this.handlePointerDidClick);\n        this.focusObserver = new FocusObserver(this.$contentEditable);\n        this.focusObserver.onDidFocus(this.handleDidFocus);\n        this.focusObserver.onDidBlur(this.handleDidBlur);\n        this.clipboardObserver = new ClipboardObserver(this.$contentEditable);\n        this.clipboardObserver.onDidCopy(this.handleCopy);\n        this.clipboardObserver.onDidPaste(this.handlePaste);\n    }\n    DOMController.prototype.onDidPressKey = function (listener) {\n        this.keyboardObserver.onDidPressKey(listener);\n    };\n    DOMController.prototype.onDidFocus = function (listener) {\n        this.focusObserver.onDidFocus(listener);\n    };\n    DOMController.prototype.onDidBlur = function (listener) {\n        this.focusObserver.onDidBlur(listener);\n    };\n    DOMController.prototype.attach = function () {\n        var _this = this;\n        this.domService.getBody().appendChild(this.iframe);\n        setTimeout(function () {\n            _this.iframe.contentDocument.body.appendChild(_this.$contentEditable);\n        });\n    };\n    DOMController.prototype.requestFocus = function () {\n        this.$contentEditable.focus();\n    };\n    DOMController.prototype.requestBlur = function () {\n        this.$contentEditable.blur();\n    };\n    DOMController.prototype.isFocused = function () {\n        return this.focused;\n    };\n    DOMController.prototype.isComposing = function () {\n        return this.composing;\n    };\n    DOMController.prototype.createContentEditable = function () {\n        var $contentEditable = this.domService.createElement('div');\n        $contentEditable.contentEditable = 'true';\n        $contentEditable.style.whiteSpace = 'pre';\n        return $contentEditable;\n    };\n    return DOMController;\n}());\nexport { DOMController };\n","import { EventEmitter } from '../event/emitter';\nvar ViewState = /** @class */ (function () {\n    function ViewState(instanceId, componentService, layoutService, renderService, domService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.componentService = componentService;\n        this.layoutService = layoutService;\n        this.renderService = renderService;\n        this.domService = domService;\n        this.didUpdateViewStateEventEmitter = new EventEmitter();\n        this.domContainer = null;\n        var layoutDoc = layoutService.getDoc();\n        var renderDoc = renderService.getDoc();\n        this.internalDoc = this.updateNode(null, layoutDoc, renderDoc);\n        layoutService.onDidUpdateLayoutState(function (event) { return _this.handleDidUpdateLayoutStateEvent(event); });\n    }\n    ViewState.prototype.onDidUpdateViewState = function (listener) {\n        return this.didUpdateViewStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(ViewState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewState.prototype.attach = function (domContainer) {\n        this.domContainer = domContainer;\n        this.reattachDoc();\n    };\n    ViewState.prototype.handleDidUpdateLayoutStateEvent = function (event) {\n        this.update();\n    };\n    ViewState.prototype.update = function () {\n        var layoutDoc = this.layoutService.getDoc();\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.updateNode(this.doc, layoutDoc, renderDoc);\n        this.reattachDoc();\n        this.didUpdateViewStateEventEmitter.emit({});\n    };\n    ViewState.prototype.reattachDoc = function () {\n        if (!this.domContainer) {\n            return;\n        }\n        this.domContainer.innerHTML = '';\n        this.domContainer.appendChild(this.doc.domContainer);\n    };\n    ViewState.prototype.updateNode = function (node, layoutNode, renderNode) {\n        var _this = this;\n        if (!layoutNode.needView && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.layoutId) {\n                    return;\n                }\n                childrenMap[child.layoutId] = child;\n            });\n        }\n        var renderChildrenMap = {};\n        if (renderNode) {\n            renderNode.children.forEach(function (renderChild) {\n                renderChildrenMap[renderChild.id] = renderChild;\n            });\n        }\n        var newChildren = [];\n        if (layoutNode.type !== 'text') {\n            layoutNode.children.forEach(function (layoutChild) {\n                var child = childrenMap[layoutChild.id] || null;\n                var renderChild = null;\n                if (layoutChild.renderId) {\n                    renderChild = renderChildrenMap[layoutChild.renderId] || null;\n                    if (!renderChild) {\n                        throw new Error('Render node not found.');\n                    }\n                }\n                newChildren.push(_this.updateNode(child, layoutChild, renderChild || renderNode));\n            });\n        }\n        layoutNode.clearNeedView();\n        var domContainer = node ? node.domContainer : this.domService.createContainer();\n        var newNode = this.buildNode(domContainer, layoutNode, renderNode, newChildren);\n        return newNode;\n    };\n    ViewState.prototype.buildNode = function (domContainer, layoutNode, renderNode, children) {\n        switch (layoutNode.type) {\n            case 'page':\n                return this.buildPageNode(domContainer, layoutNode, children);\n            case 'line':\n                return this.buildLineNode(domContainer, layoutNode, children);\n        }\n        var component = this.componentService.getComponent(renderNode.componentId);\n        var text = layoutNode.type === 'text' ? layoutNode.children.map(function (child) { return child.text; }).join('') : layoutNode.text;\n        var node = component.buildViewNode(domContainer, renderNode.partId, renderNode.id, layoutNode.id, text, renderNode.style, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        if (!node) {\n            throw new Error(\"Error building view node from render node \" + renderNode.id + \".\");\n        }\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildPageNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getPageComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildLineNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getLineComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.applyMetadataToDOMContainer = function (viewNode) {\n        var domContainer = viewNode.domContainer;\n        var componentId = viewNode.componentId;\n        var partId = viewNode.partId;\n        var id = viewNode.id;\n        domContainer.className = \"tw--\" + componentId + \"--\" + partId;\n        domContainer.setAttribute('data-tw-instance', this.instanceId);\n        if (componentId) {\n            domContainer.setAttribute('data-tw-component', componentId);\n        }\n        if (partId) {\n            domContainer.setAttribute('data-tw-part', partId);\n        }\n        domContainer.setAttribute('data-tw-id', id);\n    };\n    return ViewState;\n}());\nexport { ViewState };\n","import { CursorView } from './cursor';\nimport { DOMController } from './dom-controller';\nimport { ViewState } from './state';\nvar ViewService = /** @class */ (function () {\n    function ViewService(instanceId, configService, domService, componentService, modelService, layoutService, cursorService, renderService, commandService, transformService) {\n        this.state = new ViewState(instanceId, componentService, layoutService, renderService, domService);\n        this.domController = new DOMController(instanceId, domService, commandService, modelService, this, layoutService);\n        this.cursor = new CursorView(instanceId, configService, domService, cursorService, layoutService, this, transformService);\n    }\n    ViewService.prototype.onDidUpdateViewState = function (listener) {\n        this.state.onDidUpdateViewState(listener);\n    };\n    ViewService.prototype.onDidFocus = function (listener) {\n        this.domController.onDidFocus(listener);\n    };\n    ViewService.prototype.onDidBlur = function (listener) {\n        this.domController.onDidBlur(listener);\n    };\n    ViewService.prototype.onDidPressKey = function (listener) {\n        this.domController.onDidPressKey(listener);\n    };\n    ViewService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    ViewService.prototype.isFocused = function () {\n        return this.domController.isFocused();\n    };\n    ViewService.prototype.attach = function (domContainer) {\n        this.state.attach(domContainer);\n        this.cursor.attach();\n        this.domController.attach();\n    };\n    ViewService.prototype.requestFocus = function () {\n        this.domController.requestFocus();\n    };\n    ViewService.prototype.requestBlur = function () {\n        this.domController.requestBlur();\n    };\n    return ViewService;\n}());\nexport { ViewService };\n","import { CommandService } from './command/service';\nimport { ComponentService } from './component/service';\nimport { ConfigService } from './config/service';\nimport { buildBaseConfig } from './config/util';\nimport { CursorService } from './cursor/service';\nimport { DOMService } from './dom/service';\nimport { HistoryService } from './history/service';\nimport { KeyBindingService } from './key-binding/service';\nimport { LayoutService } from './layout/service';\nimport { ModelService } from './model/service';\nimport { RenderService } from './render/service';\nimport { ServiceRegistry } from './service/registry';\nimport { TextService } from './text/service';\nimport { TransformService } from './transform/service';\nimport { generateId } from './util/id';\nimport { ViewService } from './view/service';\nvar Taleweaver = /** @class */ (function () {\n    function Taleweaver(root, config) {\n        this.instanceId = generateId();\n        this.serviceRegistry = new ServiceRegistry();\n        this.configService = new ConfigService(buildBaseConfig(), config);\n        this.serviceRegistry.registerService('config', this.configService);\n        this.domService = new DOMService();\n        this.serviceRegistry.registerService('dom', this.domService);\n        this.textService = new TextService(this.domService);\n        this.serviceRegistry.registerService('text', this.textService);\n        this.commandService = new CommandService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('command', this.commandService);\n        this.componentService = new ComponentService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('component', this.componentService);\n        this.modelService = new ModelService(root, this.componentService);\n        this.serviceRegistry.registerService('model', this.modelService);\n        this.renderService = new RenderService(this.componentService, this.modelService);\n        this.serviceRegistry.registerService('render', this.renderService);\n        this.cursorService = new CursorService(this.configService, this.renderService, this.modelService);\n        this.serviceRegistry.registerService('cursor', this.cursorService);\n        this.layoutService = new LayoutService(this.renderService, this.textService);\n        this.serviceRegistry.registerService('layout', this.layoutService);\n        this.transformService = new TransformService(this.modelService, this.componentService, this.cursorService, this.renderService, this.layoutService);\n        this.serviceRegistry.registerService('transform', this.transformService);\n        this.viewService = new ViewService(this.instanceId, this.configService, this.domService, this.componentService, this.modelService, this.layoutService, this.cursorService, this.renderService, this.commandService, this.transformService);\n        this.serviceRegistry.registerService('view', this.viewService);\n        this.historyService = new HistoryService(this.configService, this.transformService);\n        this.serviceRegistry.registerService('history', this.historyService);\n        this.keyBindingService = new KeyBindingService(this.configService, this.commandService, this.viewService);\n        this.serviceRegistry.registerService('keyBinding', this.keyBindingService);\n    }\n    Taleweaver.prototype.attach = function (domContainer) {\n        this.viewService.attach(domContainer);\n    };\n    Taleweaver.prototype.getServiceRegistry = function () {\n        return this.serviceRegistry;\n    };\n    return Taleweaver;\n}());\nexport { Taleweaver };\n","import { Taleweaver } from '@taleweaver/core';\nimport { IResolvedFont } from '@taleweaver/core/dist/tw/render/service';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n    position: sticky;\n    top: 0;\n    padding: 3px 24px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.09);\n    z-index: 10;\n`;\n\nconst Container = styled.div`\n    display: flex;\n    margin: 0 auto;\n    width: 816px;\n`;\n\nconst Group = styled.div`\n    flex: 0 0 auto;\n    display: flex;\n    border-radius: 4px;\n    padding: 0 6px;\n    position: relative;\n    &::before {\n        content: '';\n        position: absolute;\n        top: 9px;\n        bottom: 9px;\n        left: 0;\n        width: 1px;\n        background: rgba(0, 0, 0, 0.15);\n    }\n    &:last-child {\n        &::after {\n            content: '';\n            position: absolute;\n            top: 9px;\n            bottom: 9px;\n            right: 0;\n            width: 1px;\n            background: rgba(0, 0, 0, 0.15);\n        }\n    }\n`;\n\ninterface ItemProps {\n    disabled: boolean;\n    active: boolean;\n}\n\nconst Item = styled.button<ItemProps>`\n    flex: 0 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    position: relative;\n    color: rgba(0, 0, 0, 0.85);\n    background: transparent;\n    padding: 0;\n    border: none;\n    border-radius: 3px;\n    outline: none;\n    &:after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 3px;\n        right: 3px;\n        height: 3px;\n    }\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n    ${({ active }) =>\n        active &&\n        `\n        color: rgba(255, 0, 0, 1);\n        &:after {\n            background: rgba(255, 0, 0, 1);\n        }\n    `}\n`;\n\ninterface SelectItemProps {\n    disabled: boolean;\n    width: number;\n}\n\nconst SelectItem = styled.select<SelectItemProps>`\n    -webkit-appearance: none;\n    border: none;\n    font-size: 12px;\n    font-weight: 500;\n    width: ${({ width }) => width}px;\n    background: white;\n    border-radius: 3px;\n    padding: 0 9px;\n    outline: none;\n    position: relative;\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    option {\n        color: rgba(0, 0, 0, 0.85);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n`;\n\ninterface ItemColorLineProps {\n    color: string;\n}\n\nconst ItemColorLine = styled.div<ItemColorLineProps>`\n    position: absolute;\n    bottom: 8px;\n    left: 9px;\n    right: 9px;\n    height: 3px;\n    background: ${({ color }) => color};\n`;\n\ninterface Props {\n    taleweaver: Taleweaver | null;\n}\n\nfunction resolveFont(taleweaver: Taleweaver) {\n    const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n    const renderService = taleweaver.getServiceRegistry().getService('render');\n    const { anchor, head } = cursorService.getCursor();\n    return renderService.resolveFont(Math.min(anchor, head), Math.max(anchor, head));\n}\n\nexport default function ToolBar({ taleweaver }: Props) {\n    const [font, setFont] = useState<IResolvedFont | null>(null);\n    const refreshFront = useCallback((taleweaver: Taleweaver) => {\n        setFont(resolveFont(taleweaver));\n    }, []);\n    useEffect(() => {\n        if (!taleweaver) {\n            return;\n        }\n        const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n        const renderService = taleweaver.getServiceRegistry().getService('render');\n        cursorService.onDidUpdate((event) => refreshFront(taleweaver));\n        renderService.onDidUpdateRenderState((event) => refreshFront(taleweaver));\n        refreshFront(taleweaver);\n    }, [taleweaver, refreshFront]);\n    const commandService = taleweaver?.getServiceRegistry().getService('command');\n    if (!font) {\n        return null;\n    }\n    return (\n        <Wrapper>\n            <Container>\n                <Group>\n                    <SelectItem width={120} value={'Normal'} disabled={false} onChange={(event) => null}>\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"Normal\">Normal text</option>\n                        <option value=\"Title\">Title</option>\n                        <option value=\"Subtitle\">Subtitle</option>\n                        <option value=\"Heading 1\">Heading 1</option>\n                        <option value=\"Heading 2\">Heading 2</option>\n                        <option value=\"Heading 3\">Heading 3</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem\n                        width={120}\n                        value={font.family || ''}\n                        disabled={font.family === null}\n                        onChange={(event) => null}\n                    >\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"sans-serif\">sans-serif</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem\n                        width={60}\n                        value={font.size ? font.size.toString() : ''}\n                        disabled={font.size === null}\n                        onChange={(event) => null}\n                    >\n                        <option value=\"\" style={{ display: 'hidden' }} />\n                        <option value=\"10\">10</option>\n                        <option value=\"12\">12</option>\n                        <option value=\"14\">14</option>\n                        <option value=\"16\">16</option>\n                        <option value=\"18\">18</option>\n                        <option value=\"24\">24</option>\n                        <option value=\"30\">30</option>\n                        <option value=\"36\">36</option>\n                        <option value=\"42\">42</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <Item\n                        active={!!font.weight && font.weight > 400}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'weight',\n                                font.weight && font.weight > 400 ? 400 : 700,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-bold\" />\n                    </Item>\n                    <Item\n                        active={!!font.italic}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'italic',\n                                !font.italic,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-italic\" />\n                    </Item>\n                    <Item\n                        active={!!font.underline}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'underline',\n                                !font.underline,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-underline\" />\n                    </Item>\n                    <Item\n                        active={!!font.strikethrough}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'strikethrough',\n                                !font.strikethrough,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-strikethrough-variant\" />\n                    </Item>\n                    <Item active={false} disabled={font.color === null} onClick={() => null}>\n                        <i className=\"mdi mdi-format-color-text\" style={{ position: 'relative', top: '-2px' }} />\n                        <ItemColorLine color={font.color || 'transparent'} />\n                    </Item>\n                </Group>\n            </Container>\n        </Wrapper>\n    );\n}\n","import { IConfig, Taleweaver } from '@taleweaver/core';\nimport { INode, parse } from '@taleweaver/core/dist/tw/util/serialize';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport ToolBar from './ToolBar';\n\nconst Wrapper = styled.div``;\n\nconst EditorWrapper = styled.div`\n    text-align: center;\n    .tw--doc--doc {\n        font-family: 'Source Sans Pro', sans-serif;\n        display: inline-block;\n        padding-bottom: 9px;\n        counter-reset: page-counter;\n    }\n    .tw--page--page {\n        background: rgba(255, 255, 255, 1);\n        margin: 9px auto 0;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);\n        position: relative;\n        &::after {\n            counter-increment: page-counter;\n            content: 'Page ' counter(page-counter) '';\n            position: absolute;\n            top: 12px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px;\n            font-family: 'Quicksand', sans-serif;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.45);\n            pointer-events: none;\n        }\n        *::selection {\n            background: rgba(255, 255, 255, 1);\n        }\n    }\n`;\n\ninterface IProps {\n    initialDoc: INode;\n    config?: IConfig['tw.core'];\n}\n\nexport default function Editor({ initialDoc, config }: IProps) {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const container = containerRef.current;\n    const [taleweaver, setTaleweaver] = useState<Taleweaver | null>(null);\n    useEffect(() => {\n        const mergedConfig: IConfig = {};\n        if (config) {\n            mergedConfig['tw.core'] = config;\n        }\n        const doc = parse(initialDoc, mergedConfig);\n        setTaleweaver(new Taleweaver(doc, mergedConfig));\n    }, [config, initialDoc]);\n    useEffect(() => {\n        if (taleweaver && container) {\n            taleweaver.attach(container);\n        }\n    }, [taleweaver, container, initialDoc]);\n    return (\n        <Wrapper>\n            <ToolBar taleweaver={taleweaver} />\n            <EditorWrapper ref={containerRef} />\n        </Wrapper>\n    );\n}\n","import Taleweaver from \"./Editor\";\n\nexport default Taleweaver;\n","import { ComponentService } from '../component/service';\nimport { ConfigService } from '../config/service';\nimport { buildBaseConfig } from '../config/util';\nimport { ServiceRegistry } from '../service/registry';\nexport function parse(node, config) {\n    var serviceRegistry = new ServiceRegistry();\n    var configService = new ConfigService(buildBaseConfig(), config);\n    var componentService = new ComponentService(configService, serviceRegistry);\n    function internalParse(node) {\n        return componentService.getComponent(node.componentId).buildModelNode(node.partId, node.id, node.text, node.attributes, node.children.map(function (child) { return internalParse(child); }));\n    }\n    return internalParse(node);\n}\n","import { generateId } from '@taleweaver/core/dist/tw/util/id';\nimport { INode } from '@taleweaver/core/dist/tw/util/serialize';\n\nconst doc: INode = {\n    componentId: 'doc',\n    partId: 'doc',\n    id: generateId(),\n    text: '',\n    attributes: {},\n    children: [\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Once upon a time there lived in a certain village a little country girl, the prettiest creature was ever seen. Her mother was excessively fond of her; and her grandmother doted on her still more. This good woman had made for her a little red riding-hood; which became the girl so extremely well that everybody called her Little Red Riding-Hood.',\n                    attributes: { weight: 700 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'One day her mother, having made some custards, said to her:',\n                    attributes: { italic: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Go, my dear, and see how thy grandmamma does, for I hear she has been very ill; carry her a custard, and this little pot of butter.\"',\n                    attributes: { color: 'rgba(255, 0, 0, 1)' },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood set out immediately to go to her grandmother, who lived in another village.',\n                    attributes: { size: 24 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'As she was going through the wood, she met with Gaffer Wolf, who had a very great mind to eat her up, but he dared not, because of some faggot-makers hard by in the forest. He asked her whither she was going. The poor child, who did not know that it was dangerous to stay and hear a wolf talk, said to him:',\n                    attributes: { strikethrough: true, underline: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"I am going to see my grandmamma and carry her a custard and a little pot of butter from my mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Does she live far off?\" said the Wolf.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Oh! ay,\" answered Little Red Riding-Hood; \"it is beyond that mill you see there, at the first house in the village.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Well,\" said the Wolf, \"and I\\'ll go and see her too. I\\'ll go this way and you go that, and we shall see who will be there soonest.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf began to run as fast as he could, taking the nearest way, and the little girl went by that farthest about, diverting herself in gathering nuts, running after butterflies, and making nosegays of such little flowers as she met with. The Wolf was not long before he got to the old woman's house. He knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Your grandchild, Little Red Riding-Hood,\" replied the Wolf, counterfeiting her voice; \"who has brought you a custard and a little pot of butter sent you by mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The good grandmother, who was in bed, because she was somewhat ill, cried out',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf pulled the bobbin, and the door opened, and then presently he fell upon the good woman and ate her up in a moment, for it was above three days that he had not touched a bit. He then shut the door and went into the grandmother's bed, expecting Little Red Riding- Hood, who came some time afterward and knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Who\\'s there?\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood, hearing the big voice of the Wolf, was at first afraid; but believing her grandmother had got a cold and was hoarse, answered:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\" \\'Tis your grandchild, Little Red Riding-Hood, who has brought you a custard and a little pot of butter mamma sends you.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf cried out to her, softening his voice as much as he could:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'Little Red Riding-Hood pulled the bobbin, and the door opened.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf, seeing her come in, said to her, hiding himself under the bed-clothes:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Put the custard and the little pot of butter upon the stool, and come and lie down with me.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood undressed herself and went into bed, where, being greatly amazed to see how her grandmother looked in her night-clothes, she said to her:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great arms you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is the better to hug thee, my dear.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great legs you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to run the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great ears you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to hear the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great eyes you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"It is to see the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great teeth you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to eat thee up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'And, saying these words, this wicked wolf fell upon Little Red Riding-Hood, and ate her all up.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n    ],\n};\n\nexport default doc;\n","import React from 'react';\nimport styled from 'styled-components';\nimport './App.css';\nimport Taleweaver from './Editor';\nimport sample from './samples/littleRedRidingHood';\n\nconst Wrapper = styled.div``;\n\nconst Hero = styled.div`\n    text-align: center;\n    padding: 90px 60px 30px;\n`;\n\nconst BrandWrapper = styled.div``;\n\nconst Brand = styled.span`\n    color: rgba(0, 0, 0, 0.65);\n    font-size: 42px;\n    letter-spacing: 0.02em;\n    padding-bottom: 10px;\n    border-bottom: 2px solid rgba(0, 0, 0, 0.65);\n`;\n\nconst Tagline = styled.h1`\n    font-size: 30px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 90px 0 0;\n`;\n\nconst SupportingTagline = styled.h2`\n    font-size: 20px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 30px 0 0;\n`;\n\nconst Links = styled.div`\n    margin-top: 90px;\n`;\n\nconst Link = styled.a`\n    display: inline-block;\n    padding: 15px 60px;\n    outline: none;\n    color: rgba(0, 0, 0, 0.85);\n    text-decoration: none;\n    font-size: 20px;\n    background: transparent;\n    border-radius: 3px;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    &:hover {\n        color: rgba(0, 0, 0, 1);\n        background: rgba(0, 0, 0, 0.04);\n        border-color: rgba(0, 0, 0, 0.25);\n    }\n`;\n\nconst DemoHintWrapper = styled.div`\n    text-align: center;\n    margin-top: 90px;\n`;\n\nconst DemoHint = styled.span`\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    color: rgba(0, 0, 0, 0.65);\n    border-top: 1px solid rgba(0, 0, 0, 0.45);\n    padding-top: 10px;\n    cursor: default;\n`;\n\nclass App extends React.Component {\n    render() {\n        return (\n            <Wrapper>\n                <Hero>\n                    <BrandWrapper>\n                        <Brand>Taleweaver</Brand>\n                    </BrandWrapper>\n                    <Tagline>Word processing in your browser.</Tagline>\n                    <SupportingTagline>\n                        Open source editor delivering true word processing experience.\n                    </SupportingTagline>\n                    <Links>\n                        <Link href=\"https://github.com/yuzhenmi/taleweaver\">GitHub</Link>\n                    </Links>\n                    <DemoHintWrapper>\n                        <DemoHint>&darr; Check it out &darr;</DemoHint>\n                    </DemoHintWrapper>\n                </Hero>\n                <Taleweaver\n                    initialDoc={sample}\n                    config={{\n                        page: {\n                            width: 816,\n                            height: 1056,\n                            paddingTop: 60,\n                            paddingBottom: 60,\n                            paddingLeft: 60,\n                            paddingRight: 60,\n                        },\n                    }}\n                />\n            </Wrapper>\n        );\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}