(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(t,e){},102:function(t,e){},12:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return a});var r=n(85),o=n.n(r),i=new Uint8Array(16);function a(){return t.from(String.fromCharCode.apply(String,Array.from(o.a.randomFillSync(i)))).toString("base64")}}).call(this,n(6).Buffer)},137:function(t,e){},138:function(t,e){},188:function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),i=n(28),a=n.n(i),s=(n(96),n(82)),c=n(83),u=n(88),d=n(84),f=n(89),h=n(3),l=n(4),p=(n(97),n(29));var v,g=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},m=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};"undefined"!==typeof window&&(v=function(){var t=document.createElement("iframe");return t.scrolling="no",t.src="about:blank",t.style.width="0",t.style.height="0",t.style.border="none",t.style.position="fixed",t.style.zIndex="-1",t.style.opacity="0",t.style.overflow="hidden",t.style.left="-1000000px",t.style.top="-1000000px",t}(),document.body.appendChild(v));var y=function(t){return g(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return m(this,function(u){return v?(e=t.getService("cursor"),n=t.getService("render"),r=t.getService("model"),e.hasCursor()?(o=e.getCursor(),i=o.anchor,a=o.head,i===a?[2]:(s=r.toDOM(n.convertOffsetToModelOffset(Math.min(i,a)),n.convertOffsetToModelOffset(Math.max(i,a))).outerHTML,(c=v.contentDocument)?(c.body.innerHTML=s,c.execCommand("selectAll"),c.execCommand("copy"),c.body.innerHTML="",[2]):[2])):[2]):[2]})})},b=function(t){return g(void 0,void 0,void 0,function(){return m(this,function(t){return[2]})})},w=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},O=function(){function t(t,e,n,r){void 0===r&&(r=!1),this.changes=t,this.modelCursorHead=e,this.modelCursorAnchor=n,this.keepLeftLock=r}return t.prototype.apply=function(e,n,r,o){var i=void 0,a=void 0;if(n.hasCursor()){var s=n.getCursor(),c=s.anchor,u=s.head;i=r.convertOffsetToModelOffset(c),a=r.convertOffsetToModelOffset(u)}var d=this.applyChanges(e);if(n.hasCursor()){if(void 0!==this.modelCursorHead){var f=r.convertModelOffsetToOffset(this.boundModelOffset(this.modelCursorHead,e)),h=f;void 0!==this.modelCursorAnchor&&(h=r.convertModelOffsetToOffset(this.boundModelOffset(this.modelCursorAnchor,e))),n.setCursor(h,f)}if(!this.keepLeftLock){var l=o.resolvePosition(n.getCursor().head).atLineDepth(),p=l.node,v=l.offset;n.setLeftLock(p.resolveBoundingBoxes(v,v).boundingBoxes[0].left)}}for(var g=[],m=[],y=d.length-1;y>=0;y--){var b=d[y];g.push(m.reduce(function(t,e){return t.map(e)},b.reverseChange)),m.push(b.mapping.reverse())}return new S(this,d,new t(g,a,i,this.keepLeftLock))},t.prototype.applyChanges=function(t){for(var e=[],n=[],r=w(this.changes),o=function(){var o=r.shift(),i=t.applyChange(o),a=i.mapping;n.push(a),r=r.map(function(t){return t.map(a)}),e.push(i)};r.length>0;)o();return e},t.prototype.boundModelOffset=function(t,e){return Math.max(0,Math.min(e.getRootSize()-1,t))},t}(),S=function(){return function(t,e,n){this.transformation=t,this.changeResults=e,this.reverseTransformation=n}}(),x=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},C=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function E(t,e,n){var r=n.resolvePosition(t).atLineDepth(),o=r.node,i=r.offset,a=o.previousCrossParentSibling;return a?t-i-a.size+a.convertCoordinatesToOffset(e,0):t-i}function D(t,e,n){var r=n.resolvePosition(t).atLineDepth(),o=r.node,i=r.offset,a=o.nextCrossParentSibling;return a?t-i+o.size+a.convertCoordinatesToOffset(e,0):t-i+o.size-1}function P(t,e){var n=e.resolvePosition(t).atReverseDepth(0),r=n.node,o=n.offset;if(o>0)return t-o;var i=r.previousCrossParentSibling;return i?t-i.size:t}function T(t,e){var n=e.resolvePosition(t).atReverseDepth(0),r=n.node,o=n.offset;if(o<r.size-1)return t-o+r.size-r.whitespaceSize;var i=r.nextCrossParentSibling;return i?t-o+r.size+i.size-i.whitespaceSize:t}function j(t,e){var n=e.resolvePosition(t).atLineDepth().offset;return 0===n?t:t-n}function k(t,e){var n=e.resolvePosition(t).atLineDepth(),r=n.node,o=n.offset;return o>=r.size-1?t:t-o+r.size-1}var _=function(t,e){return x(void 0,void 0,void 0,function(){var n,r,o;return C(this,function(i){return n=t.getService("transform"),r=t.getService("render"),o=r.convertOffsetToModelOffset(e),n.applyTransformation(new O([],o)),[2]})})},M=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return C(this,function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,i===a?s=r.convertOffsetToModelOffset(i)-1:(c=Math.min(i,a),s=r.convertOffsetToModelOffset(c)),e.applyTransformation(new O([],s)),[2]})})},z=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return C(this,function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,i===a?s=r.convertOffsetToModelOffset(i)+1:(c=Math.max(i,a),s=r.convertOffsetToModelOffset(c)),e.applyTransformation(new O([],s)),[2]})})},B=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d,f;return C(this,function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=o.leftLock,c=Math.min(i,a),u=E(c,s,r),d=t.getService("render"),f=d.convertOffsetToModelOffset(u),e.applyTransformation(new O([],f,f,!0)),[2]):[2]})})},L=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d,f;return C(this,function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=o.leftLock,c=Math.max(i,a),u=D(c,s,r),d=t.getService("render"),f=d.convertOffsetToModelOffset(u),e.applyTransformation(new O([],f,f,!0)),[2]):[2]})})},R=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=Math.min(i,a),c=P(s,r),u=t.getService("render"),d=u.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d)),[2]):[2]})})},I=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=Math.max(i,a),c=T(s,r),u=t.getService("render"),d=u.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d)),[2]):[2]})})},N=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=Math.min(i,a),c=j(s,r),u=t.getService("render"),d=u.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d)),[2]):[2]})})},H=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=Math.max(i,a),c=k(s,r),u=t.getService("render"),d=u.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d)),[2]):[2]})})},A=function(t){return x(void 0,void 0,void 0,function(){var e,n,r;return C(this,function(o){return e=t.getService("transform"),n=t.getService("render"),0,r=n.convertOffsetToModelOffset(0),e.applyTransformation(new O([],r)),[2]})})},F=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o;return C(this,function(i){return e=t.getService("transform"),n=t.getService("render"),r=n.getDocSize()-1,o=n.convertOffsetToModelOffset(r),e.applyTransformation(new O([],o)),[2]})})},W=function(t,e){return x(void 0,void 0,void 0,function(){var n,r,o,i,a,s;return C(this,function(c){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=r.getCursor().anchor,a=o.convertOffsetToModelOffset(i),s=o.convertOffsetToModelOffset(e),n.applyTransformation(new O([],s,a)),[2]})})},U=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return C(this,function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,s=r.convertOffsetToModelOffset(i),c=r.convertOffsetToModelOffset(a-1),e.applyTransformation(new O([],c,s)),[2]})})},V=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c;return C(this,function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,s=r.convertOffsetToModelOffset(i),c=r.convertOffsetToModelOffset(a+1),e.applyTransformation(new O([],c,s)),[2]})})},K=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d,f;return C(this,function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=i.leftLock,u=E(s,c,o),d=r.convertOffsetToModelOffset(a),f=r.convertOffsetToModelOffset(u),e.applyTransformation(new O([],f,d)),[2]):[2]})})},$=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d,f;return C(this,function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=i.leftLock,u=D(s,c,o),d=r.convertOffsetToModelOffset(a),f=r.convertOffsetToModelOffset(u),e.applyTransformation(new O([],f,d)),[2]):[2]})})},G=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=P(s,o),u=r.convertOffsetToModelOffset(a),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d,u)),[2]):[2]})})},q=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=T(s,o),u=r.convertOffsetToModelOffset(a),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d,u)),[2]):[2]})})},J=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=j(s,o),u=r.convertOffsetToModelOffset(a),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d,u)),[2]):[2]})})},X=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return C(this,function(f){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,s=i.head,c=k(s,o),u=r.convertOffsetToModelOffset(a),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([],d,u)),[2]):[2]})})},Y=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a;return C(this,function(s){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor().anchor,0,i=r.convertOffsetToModelOffset(o),a=r.convertOffsetToModelOffset(0),e.applyTransformation(new O([],a,i)),[2]})})},Q=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s;return C(this,function(c){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor().anchor,i=r.getDocSize()-1,a=r.convertOffsetToModelOffset(o),s=r.convertOffsetToModelOffset(i),e.applyTransformation(new O([],s,a)),[2]})})},Z=function(t){return x(void 0,void 0,void 0,function(){var e,n,r,o,i,a;return C(this,function(s){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),n.hasCursor()?(0,o=r.getDocSize()-1,i=r.convertOffsetToModelOffset(0),a=r.convertOffsetToModelOffset(o),e.applyTransformation(new O([],a,i)),[2]):[2]})})},tt=function(t,e){return x(void 0,void 0,void 0,function(){var n,r,o,i,a,s,c,u,d,f,h,l;return C(this,function(p){if(n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=t.getService("layout"),!r.hasCursor())return[2];if(a=i.resolvePosition(e).atReverseDepth(0),s=a.node,c=a.offset,s.size-s.whitespaceSize===0){if(!(u=s.previousCrossParentSibling))return[2];c+=(s=u).size}return d=e-c+s.size-s.whitespaceSize,f=e-c,h=o.convertOffsetToModelOffset(d),l=o.convertOffsetToModelOffset(f),n.applyTransformation(new O([],h,l)),[2]})})},et=function(t,e){return x(void 0,void 0,void 0,function(){var n,r,o,i,a,s,c,u,d,f,h;return C(this,function(l){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=t.getService("layout"),r.hasCursor()?(a=i.resolvePosition(e).atBlockDepth(),s=a.node,c=a.offset,u=e-c+s.size-1,d=e-c,f=o.convertOffsetToModelOffset(u),h=o.convertOffsetToModelOffset(d),n.applyTransformation(new O([],f,h)),[2]):[2]})})},nt=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},rt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ot=function(t){return nt(void 0,void 0,void 0,function(){return rt(this,function(e){return t.getService("history").undo(),[2]})})},it=function(t){return nt(void 0,void 0,void 0,function(){return rt(this,function(e){return t.getService("history").redo(),[2]})})},at=function(){return function(){}}(),st=n(12),ct=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},ut=function(){function t(){this.ran=!1,this.inProgress=!1}return t.prototype.run=function(){if(this.ran)throw new Error("Already ran.");for(this.inProgress=!0;this.inProgress;)this.next();this.ran=!0},t.prototype.joinNodes=function(t,e){t.leaf?t.replace(0,t.text.length,t.text+e.text):t.replace(0,t.children.length,ct(t.children.slice(),e.children.slice()));var n=t.parent;n.replace(0,n.children.length,n.children.filter(function(t){return t!==e}))},t}(),dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ft=function(t){function e(e,n,r,o){var i=t.call(this)||this;return i.root=e,i.fragments=r,i.componentService=o,i.internalInsertedSize=0,i.depth=e.resolvePosition(n).depth,i.current={offset:n,index:0},i}return dt(e,t),Object.defineProperty(e.prototype,"insertedSize",{get:function(){return this.internalInsertedSize},enumerable:!1,configurable:!0}),e.prototype.next=function(){switch(this.state){case"text":this.handleText();break;case"split":this.handleSplit();break;case"leave":this.handleLeave();break;case"node":this.handleNode();break;case"end":this.handleEnd()}},e.prototype.handleText=function(){var t=this.root.resolvePosition(this.current.offset).atReverseDepth(0),e=t.node,n=t.index,r=this.currentFragment,o=r.content;e.replace(n,n,o),this.current={offset:this.current.offset+r.size,index:this.current.index+1},this.internalInsertedSize+=r.size},e.prototype.handleSplit=function(){var t=this.root.resolvePosition(this.current.offset).atReverseDepth(this.currentFragment.depth-1),e=t.node,n=t.offset,r=this.splitNode(e,n);this.current={offset:this.current.offset+r/2,index:this.current.index},this.internalInsertedSize+=r},e.prototype.handleLeave=function(){this.current={offset:this.current.offset+1,index:this.current.index}},e.prototype.handleNode=function(){var t=this.root.resolvePosition(this.current.offset).atReverseDepth(0),e=t.node,n=t.index,r=this.currentFragment,o=r.content;e.replace(n,n,o),o.length>0&&(this.joinNodeWithNextSibling(o[o.length-1]),this.joinNodeWithPreviousSibling(o[0])),this.current={offset:this.current.offset+r.size,index:this.current.index+1},this.internalInsertedSize+=r.size},e.prototype.handleEnd=function(){this.inProgress=!1},Object.defineProperty(e.prototype,"state",{get:function(){if(!this.currentFragment)return"end";var t=this.root.resolvePosition(this.current.offset);return t.depth>this.depth-this.currentFragment.depth?"split":t.depth<this.depth-this.currentFragment.depth?"leave":0===this.currentFragment.depth?"text":"node"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFragment",{get:function(){return this.current.index>=this.fragments.length?null:this.fragments[this.current.index]},enumerable:!1,configurable:!0}),e.prototype.splitNode=function(t,e){var n,r,o=0,i=this.componentService.getComponent(t.componentId),a=t.resolvePosition(e);1===a.depth?(n=i.buildModelNode(t.partId,t.id,t.text.substring(0,e-1),t.attributes,[]),r=i.buildModelNode(t.partId,Object(st.a)(),t.text.substring(e-1),t.attributes,[])):(0!==a.atDepth(1).offset&&(o+=this.splitNode(a.atDepth(1).node,a.atDepth(1).offset)),a=t.resolvePosition(e+o/2),n=i.buildModelNode(t.partId,t.id,"",t.attributes,t.children.slice(0,a.atDepth(0).index)),r=i.buildModelNode(t.partId,Object(st.a)(),"",t.attributes,t.children.slice(a.atDepth(0).index)));var s=t.parent,c=s.children.indexOf(t);return s.replace(c,c+1,[n,r]),o+=2},e.prototype.joinNodeWithNextSibling=function(t){var e=t.nextSibling;e&&t.canJoin(e)&&this.joinNodes(t,e)},e.prototype.joinNodeWithPreviousSibling=function(t){var e=t.previousSibling;e&&e.canJoin(t)&&this.joinNodes(e,t)},e}(ut),ht=function(){function t(t,e,n){this.from=t,this.oldSize=e,this.newSize=n}return t.prototype.map=function(t){if(t<=this.from)return t;if(t>=this.from+this.oldSize)return t-this.oldSize+this.newSize;throw new Error("Offset no longer exists.")},t.prototype.mapRender=function(t,e){var n=e.convertOffsetToModelOffset(t),r=this.map(n);return e.convertModelOffsetToOffset(r)},t.prototype.reverse=function(){return new t(this.from,this.newSize,this.oldSize)},t}(),lt=function(){return function(t,e){if(this.content=t,this.depth=e,Array.isArray(t)){if(e<=0)throw new Error("Fragment of nodes must have depth greater than zero.");this.contentType="nodes",this.size=t.reduce(function(t,e){return t+e.size},0)}else{if(0!==e)throw new Error("Fragment of text must have depth of zero.");this.contentType="text",this.size=t.length}}}(),pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vt=function(t){function e(e,n,r){var o=t.call(this)||this;o.root=e,o.from=n,o.to=r,o.removedFragments=[];var i=e.resolvePosition(n).atReverseDepth(0).node;return o.current={offset:n,node:i,nodeFrom:-1,nodeTo:-1},o.updateCurrentNode(i),o}return pt(e,t),e.prototype.next=function(){switch(this.state){case"fullNode":this.handleFullNode();break;case"partialNode":this.handlePartialNode();break;case"text":this.handleText();break;case"forward":this.handleForward();break;case"enter":this.handleEnter();break;case"end":this.handleEnd()}},e.prototype.handleFullNode=function(){this.stepUp()},e.prototype.handlePartialNode=function(){var t=this.current.node.resolvePosition(this.current.offset-this.current.nodeFrom);if(1===t.depth){for(var e=t.atDepth(0).index,n=[],r=Math.min(this.to-this.current.nodeFrom,this.current.node.size),o=t.atDepth(0).offset,i=this.current.node.children.at(e);i&&o+i.size<=r;)n.push(i),o+=i.size,i=i.nextSibling;var a=e+n.length;this.recordRemovedNodes(n,t.depth),this.current.node.replace(e,a,[]),i&&this.joinNodeWithPreviousSibling(i)}this.stepDown()},e.prototype.handleText=function(){var t=this.current.offset-this.current.nodeFrom-1,e=Math.min(this.to-this.current.nodeFrom-1,this.current.node.size-2),n=this.current.node.replace(t,e,"");this.recordRemovedText(n)},e.prototype.handleForward=function(){this.stepForward()},e.prototype.handleEnter=function(){this.current.offset++},e.prototype.handleEnd=function(){this.inProgress=!1},e.prototype.stepUp=function(){var t=this.current.node.parent;this.updateCurrentNode(t)},e.prototype.stepDown=function(){var t=this.current.offset-this.current.nodeFrom,e=this.current.node.resolvePosition(t),n=this.current.node.children.at(e.atDepth(0).index);this.updateCurrentNode(n)},e.prototype.stepForward=function(){var t=this.current.node.nextSibling;if(t)this.updateCurrentNode(t),this.current.offset=this.current.nodeFrom;else{var e=this.current.node.parent;this.current.offset=this.current.nodeTo,this.updateCurrentNode(e)}},Object.defineProperty(e.prototype,"state",{get:function(){return this.current.offset>=this.to?"end":this.current.nodeTo-this.current.offset===1?"forward":this.current.offset===this.current.nodeFrom&&this.current.nodeTo<=this.to?"fullNode":this.current.offset===this.current.nodeFrom?"enter":this.current.node.leaf?"text":"partialNode"},enumerable:!1,configurable:!0}),e.prototype.recordRemovedNodes=function(t,e){this.removedFragments.push(new lt(t,e));var n=t.reduce(function(t,e){return t+e.size},0);this.current.nodeTo-=n,this.to-=n},e.prototype.recordRemovedText=function(t){this.removedFragments.push(new lt(t,0)),this.current.nodeTo-=t.length,this.to-=t.length},e.prototype.joinNodeWithPreviousSibling=function(t){var e=t.previousSibling;if(e){var n=this.getOffsetToRoot(t);this.current.offset>=n-1&&(this.current.offset>n&&this.current.offset--,this.current.offset--),this.to-=2;var r=t.firstChild;this.joinNodes(e,t),r&&this.joinNodeWithPreviousSibling(r),this.current.node===t&&this.updateCurrentNode(e)}else t.parent&&this.joinNodeWithPreviousSibling(t.parent)},e.prototype.updateCurrentNode=function(t){this.current.node=t,this.current.nodeFrom=this.getOffsetToRoot(t),this.current.nodeTo=this.current.nodeFrom+t.size},e.prototype.getOffsetToRoot=function(t){for(var e=0,n=t;n.parent;)e+=this.getOffsetToParent(n),n=n.parent;return e},e.prototype.getOffsetToParent=function(t){for(var e=1,n=t.previousSibling;n;)e+=n.size,n=n.previousSibling;return e},e}(ut),gt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mt=function(t){function e(e,n,r){var o=t.call(this)||this;return o.from=e,o.to=n,o.fragments=r,o.validateInput(),o}return gt(e,t),e.prototype.map=function(t){return new e(t.map(this.from),t.map(this.to),this.fragments)},e.prototype.apply=function(t,n){this.validateFit(t);var r=new vt(t,this.from,this.to);r.run();var o=new ft(t,this.from,this.fragments,n);return o.run(),{change:this,reverseChange:new e(this.from,this.from+o.insertedSize,r.removedFragments),mapping:new ht(this.from,this.to-this.from,o.insertedSize)}},e.prototype.validateInput=function(){if(this.from>this.to)throw new Error("Range is invalid.");if(this.fragments.length>0)for(var t=!0,e=!1,n=this.fragments[0].depth,r=1,o=this.fragments.length;r<o;r++){var i=this.fragments[r];if(i.depth>n){if(!t)throw new Error("Fragments have invalid depths.")}else if(i.depth<n&&(t&&(t=!1,e=!0),!e))throw new Error("Fragments have invalid depths.");n=i.depth}},e.prototype.validateFit=function(t){var e=t.resolvePosition(this.from);if(Math.max.apply(Math,this.fragments.map(function(t){return t.depth}))>=e.depth)throw new Error("Fragments do not fit in range.")},e}(at),yt=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},bt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},wt=function(t,e){return yt(void 0,void 0,void 0,function(){var n,r,o,i,a,s,c,u,d,f,h;return bt(this,function(l){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),r.hasCursor()?(i=r.getCursor(),a=i.anchor,s=i.head,c=Math.min(a,s),u=Math.max(a,s),d=o.convertOffsetToModelOffset(c),f=o.convertOffsetToModelOffset(u),h=d+e.length,n.applyTransformation(new O([new mt(d,f,[new lt(e,0)])],h)),[2]):[2]})})},Ot=function(t){return yt(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return bt(this,function(f){if(e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),!n.hasCursor())return[2];if(o=n.getCursor(),i=o.anchor,a=o.head,i===a){if(0===a)return[2];s=a-1,c=a}else s=Math.min(i,a),c=Math.max(i,a);return u=r.convertOffsetToModelOffset(s),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([new mt(u,d,[])],u)),[2]})})},St=function(t){return yt(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d;return bt(this,function(f){if(e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),!n.hasCursor())return[2];if(o=n.getCursor(),i=o.anchor,a=o.head,i===a){if(a>=r.getDocSize()-1)return[2];s=a,c=a+1}else s=Math.min(i,a),c=Math.max(i,a);return u=r.convertOffsetToModelOffset(s),d=r.convertOffsetToModelOffset(c),e.applyTransformation(new O([new mt(u,d,[])],u)),[2]})})},xt=function(t){return yt(void 0,void 0,void 0,function(){var e,n,r,o,i,a,s,c,u,d,f;return bt(this,function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,s=Math.min(i,a),c=Math.max(i,a),u=r.convertOffsetToModelOffset(s),d=r.convertOffsetToModelOffset(c),f=u+4,e.applyTransformation(new O([new mt(u,d,[new lt([],2)])],f)),[2]):[2]})})},Ct=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},Et=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Dt=function(t){return Ct(void 0,void 0,void 0,function(){return Et(this,function(e){return t.getService("view").requestFocus(),[2]})})},Pt=function(t){return Ct(void 0,void 0,void 0,function(){return Et(this,function(e){return t.getService("view").requestBlur(),[2]})})},Tt=function(){function t(){this.listeners=[]}return t.prototype.on=function(t){var e=this;return this.listeners.push(t),{dispose:function(){var n=e.listeners.indexOf(t);n<0||e.listeners.splice(n,1)}}},t.prototype.emit=function(t){this.listeners.forEach(function(e){return e(t)})},t}(),jt=function(){function t(){this.commandsMap=new Map}return t.prototype.registerCommand=function(t,e){this.commandsMap.set(t,e)},t.prototype.getCommandHandler=function(t){return this.commandsMap.get(t)},t}(),kt=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(e){i(e)}}function s(t){try{c(r.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})},_t=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Mt=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},zt=function(){function t(t,e){this.serviceRegistry=e,this.willExecuteCommandEventEmitter=new Tt,this.didExecuteCommandEventEmitter=new Tt,this.registry=new jt;for(var n=0,r=Object.entries(t.getConfig().commands);n<r.length;n++){var o=r[n],i=o[0],a=o[1];this.registry.registerCommand(i,a)}}return t.prototype.onWillExecuteCommand=function(t){return this.willExecuteCommandEventEmitter.on(t)},t.prototype.onDidExecuteCommand=function(t){return this.didExecuteCommandEventEmitter.on(t)},t.prototype.executeCommand=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return kt(this,void 0,void 0,function(){var n;return _t(this,function(r){switch(r.label){case 0:return(n=this.registry.getCommandHandler(t))?(this.willExecuteCommandEventEmitter.emit({commandId:t,args:e}),[4,n.apply(void 0,Mt([this.serviceRegistry],e))]):[2];case 1:return r.sent(),this.didExecuteCommandEventEmitter.emit({commandId:t,args:e}),[2]}})})},t}(),Bt=function(){function t(t){void 0===t&&(t=[]),this.nodes=t}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length},enumerable:!1,configurable:!0}),t.prototype.at=function(t){if(t<0||t>=this.nodes.length)throw new Error("Index "+t+" is out of range.");return this.nodes[t]},t.prototype.indexOf=function(t){return this.nodes.findIndex(function(e){return e.id===t.id})},t.prototype.forEach=function(t){return this.nodes.forEach(t)},t.prototype.map=function(t){return this.nodes.map(t)},t.prototype.reduce=function(t,e){return this.nodes.reduce(t,e)},t.prototype.filter=function(t){return this.nodes.filter(t)},t.prototype.slice=function(t,e){return this.nodes.slice(t,e)},t.prototype.find=function(t){return this.nodes.find(t)},t}(),Lt=function(){function t(t){this.id=t,this.parent=null,this.internalChildren=new Bt}return Object.defineProperty(t.prototype,"children",{get:function(){return this.internalChildren},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return 0===this.children.length?null:this.children.at(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return 0===this.children.length?null:this.children.at(this.children.length-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){if(!this.parent)return null;var t=this.parent.children,e=t.indexOf(this);if(e<0)throw new Error("Node is not a child of parent.");return 0===e?null:t.at(e-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){if(!this.parent)return null;var t=this.parent.children,e=t.indexOf(this);if(e<0)throw new Error("Node is not a child of parent.");return e===t.length-1?null:t.at(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousCrossParentSibling",{get:function(){var t=this.previousSibling;if(t)return t;var e=this.parent;if(!e||e.root)return null;var n=e.previousCrossParentSibling;return n?n.lastChild:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextCrossParentSibling",{get:function(){var t=this.nextSibling;if(t)return t;var e=this.parent;if(!e||e.root)return null;var n=e.nextCrossParentSibling;return n?n.firstChild:null},enumerable:!1,configurable:!0}),t.prototype.findDescendant=function(t){if(this.id===t)return this;if(this.leaf)return null;for(var e=0,n=this.children.length;e<n;e++){var r=this.children.at(e).findDescendant(t);if(r)return r}return null},t}(),Rt=function(){function t(t){this.depths=t}return Object.defineProperty(t.prototype,"depth",{get:function(){return this.depths.length},enumerable:!1,configurable:!0}),t.prototype.atDepth=function(t){if(t<0||t>=this.depths.length)throw new Error("Depth out of range.");return this.depths[t]},t.prototype.atReverseDepth=function(t){if(t<0||t>=this.depths.length)throw new Error("Reverse depth out of range.");return this.depths[this.depth-t-1]},t}(),It=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nt=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Ht=function(t){function e(e,n,r,o,i){var a=t.call(this,n)||this;return a.componentId=e,a.attributes=o,a.internalNeedRender=!0,a.childDidUpdateDisposableMap=new Map,a.didUpdateEventEmitter=new Tt,a.handleChildDidUpdate=function(){a.didUpdateEventEmitter.emit({})},a.internalText=r,a.internalChildren=new Bt(i),i.forEach(function(t){t.parent=a,a.childDidUpdateDisposableMap.set(t.id,t.onDidUpdate(a.handleChildDidUpdate))}),a.onDidUpdate(function(){a.internalSize=void 0,a.internalNeedRender=!0}),a}return It(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this.internalText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=2+this.text.length:this.internalSize=this.children.reduce(function(t,e){return t+e.size},2)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needRender",{get:function(){return this.internalNeedRender},enumerable:!1,configurable:!0}),e.prototype.canJoin=function(t){return!1},e.prototype.clearNeedRender=function(){this.internalNeedRender=!1},e.prototype.replace=function(t,e,n){var r,o=this;if(t>e)throw new Error("Range is invalid.");if(this.leaf){if("string"!==typeof n)throw new Error("Leaf node content must be string.");if(t<0||e>this.text.length)throw new Error("Range is invalid.")}else{if("string"===typeof n)throw new Error("Non-leaf node content must not be string.");if(t<0||e>this.children.length)throw new Error("Range is invalid.")}"string"===typeof n?(r=this.internalText.substring(t,e),this.internalText=this.internalText.slice(0,t)+n+this.internalText.slice(e)):(r=this.children.slice(t,e),this.internalChildren=new Bt(Nt(this.children.slice(0,t),n,this.children.slice(e))),this.children.slice(t,e).forEach(function(t){var e;return null===(e=o.childDidUpdateDisposableMap.get(t.id))||void 0===e?void 0:e.dispose()}),n.forEach(function(t){t.parent=o,o.childDidUpdateDisposableMap.set(t.id,t.onDidUpdate(o.handleChildDidUpdate))}));return this.didUpdateEventEmitter.emit({}),r},e.prototype.resolvePosition=function(t){if(t<0||t>=this.size)throw new Error("Offset "+t+" is out of range.");if(0===t)return new At([{node:this,offset:t,index:-1}]);if(this.leaf)return new At([{node:this,offset:t,index:t-1}]);for(var e=1,n=0,r=this.children.length;n<r;n++){if(e===t)return new At([{node:this,offset:t,index:n}]);var o=this.children.at(n),i=o.size;if(e+i>t){for(var a=o.resolvePosition(t-e),s=[{node:this,offset:t,index:n}],c=0;c<a.depth;c++)s.push(a.atDepth(c));return new At(s)}e+=i}return new At([{node:this,offset:t,index:this.children.length}])},e.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},e}(Lt),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return It(e,t),e}(Rt),Ft=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wt=function(t){function e(e,n,r,o){var i=t.call(this,e,n,"",r,o)||this;if(0===o.length)throw new Error("Doc node must have children.");return i}return Ft(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Ht),Ut=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vt=function(t){function e(e,n,r,o,i){var a=t.call(this,Object(st.a)())||this;return a.componentId=e,a.modelId=n,a.text=r,a.attributes=o,a.internalNeedLayout=!0,a.internalChildren=new Bt(i),i.forEach(function(t){t.parent=a}),a}return Ut(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.text.length:this.internalSize=this.children.reduce(function(t,e){return t+e.size},0)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modelSize",{get:function(){return this.pseudo?0:(void 0===this.internalChildrenModelSize&&(this.internalChildrenModelSize=this.children.reduce(function(t,e){return t+e.modelSize},0)),this.internalChildrenModelSize+2+this.text.length)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needLayout",{get:function(){return this.internalNeedLayout},enumerable:!1,configurable:!0}),e.prototype.clearNeedLayout=function(){this.internalNeedLayout=!1},e.prototype.resolvePosition=function(t){if(t<0||t>=this.size)throw new Error("Offset "+t+" is out of range.");if(this.leaf)return new Kt([{node:this,offset:t,index:t}]);for(var e=0,n=0,r=this.children.length;n<r;n++){var o=this.children.at(n),i=o.size;if(e+i>t){for(var a=o.resolvePosition(t-e),s=[{node:this,offset:t,index:n}],c=0;c<a.depth;c++)s.push(a.atDepth(c));return new Kt(s)}e+=i}throw new Error("Offset cannot be resolved.")},e.prototype.convertOffsetToModelOffset=function(t){if(t<0||t>=this.size)throw new Error("Offset is out of range.");var e=0,n=this.pseudo?0:1;if(this.leaf)return n+t;for(var r=0,o=this.children.length;r<o;r++){var i=this.children.at(r),a=i.size;if(e+a>t)return n+i.convertOffsetToModelOffset(t-e);e+=a,n+=i.modelSize}throw new Error("Offset "+t+" is out of range.")},e.prototype.convertModelOffsetToOffset=function(t){if(t<0||t>=this.modelSize)throw new Error("Model offset is out of range.");var e=this.pseudo?0:1,n=0;if(t<=e)return 0;if(this.leaf)return t-e;for(var r=0,o=this.children.length;r<o;r++){var i=this.children.at(r),a=i.modelSize;if(e+a>t)return n+i.convertModelOffsetToOffset(t-e);e+=a,n+=i.size}throw new Error("Model offset "+t+" is out of range.")},e}(Lt),Kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ut(e,t),e}(Rt),$t=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gt=function(t){function e(e,n,r,o){return t.call(this,e,n,"",r,o)||this}return $t(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Vt),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jt=function(t){function e(e,n,r,o,i,a,s,c){var u=t.call(this,o)||this;return u.domContainer=e,u.componentId=n,u.renderId=r,u.layoutId=o,u.text=i,u.style=a,u.domService=c,u.internalChildren=new Bt(s),s.forEach(function(t){t.parent=u}),u}return qt(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.text.length:this.internalSize=this.children.reduce(function(t,e){return t+e.size},0)),this.internalSize},enumerable:!1,configurable:!0}),e}(Lt),Xt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yt=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,e,n,r,o,"",i,a,s)||this;return c.attached=!1,c}return Xt(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Jt),Qt=function(){return function(t,e){this.id=t,this.serviceRegistry=e}}(),Zt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),te=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Zt(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),e.prototype.toDOM=function(t,e){for(var n=document.createElement("div"),r=1,o=this.children,i=0,a=o.length;i<a&&r<e;i++){var s=o.at(i),c=s.size,u=Math.max(0,t-r),d=Math.min(u+c,e-r);if(r+=c,!(u>c||d<0)){var f=s.toDOM(u,d);n.appendChild(f)}}return n},e}(Wt),ee=function(t){function e(e,n,r,o,i,a,s,c,u,d){var f=t.call(this,e,n,r,o)||this;return f.width=i,f.height=a,f.paddingTop=s,f.paddingBottom=c,f.paddingLeft=u,f.paddingRight=d,f}return Zt(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return{}},enumerable:!1,configurable:!0}),e}(Gt),ne=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,e,n,r,o,i,a,s)||this;c.domContainer.style.textAlign="left",c.domContainer.style.cursor="text",c.domContainer.style.userSelect="none",c.domContainer.innerHTML="";var u=s.createElement("div");return u.setAttribute("data-tw-role","content-container"),a.map(function(t){return u.appendChild(t.domContainer)}),c.domContainer.appendChild(u),c}return Zt(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),e}(Yt),re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Zt(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new te(this.id,e,r,o)},e.prototype.buildRenderNode=function(t,e,n,r,o){var i=this.serviceRegistry.getService("config");switch(t){case"doc":var a=i.getConfig().page;return new ee(this.id,e,r,o,a.width,a.height,a.paddingTop,a.paddingBottom,a.paddingLeft,a.paddingRight);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,s,c,u,d,f,h){var l=this.serviceRegistry.getService("dom");switch(e){case"doc":return new ne(t,this.id,n,r,i,a,l);default:throw new Error("Invalid part ID.")}},e}(Qt),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ie=function(t){function e(e,n,r,o){var i=t.call(this,e,n,"",r,o)||this;if(0===o.length)throw new Error("Branch node must have children.");return i}return oe(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Ht),ae=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),se=function(t){function e(e,n,r,o){return t.call(this,e,n,"",r,o)||this}return ae(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Vt),ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ue=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o,[])||this}return ce(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(Vt),de={weight:400,size:16,family:"sans-serif",letterSpacing:0,underline:!1,italic:!1,strikethrough:!1,color:"black"},fe=[" ","\n","\t"],he=function(){function t(t){this.$canvas=t.createElement("canvas")}return t.prototype.measure=function(t,e){var n=this.applyDefaultFont(e),r=this.$canvas.getContext("2d"),o=n.weight,i=n.size,a=this.fixFontFamily(n.family),s=n.letterSpacing;r.font=o+" "+i+"px "+a;var c=r.measureText(t);return{width:0===s||t.length<=1?c.width:c.width+(t.length-1)*s,height:i}},t.prototype.breakIntoWords=function(t){for(var e=[],n="",r=0,o=t.length;r<o;r++){var i=t[r];n+=i,fe.includes(i)&&(e.push({text:n,whitespaceSize:1}),n="")}return n.length>0&&e.push({text:n,whitespaceSize:0}),e},t.prototype.applyDefaultFont=function(t){var e={};for(var n in de)n in t&&void 0!==t[n]?e[n]=t[n]:e[n]=de[n];return e},t.prototype.fixFontFamily=function(t){return t.indexOf(" ")>=0?"'"+t+"'":t},t}(),le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(t){function e(e,n,r,o,i,a,s){return t.call(this,e,n,r,o,"",i,a,s)||this}return le(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Jt),ve=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ge=function(t){function e(e,n,r,o,i,a,s){return t.call(this,e,n,r,o,i,a,[],s)||this}return ve(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(Jt),me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ye=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},be=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return me(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),e.prototype.toDOM=function(t,e){for(var n=document.createElement("p"),r=1,o=this.children,i=0,a=o.length;i<a&&r<e;i++){var s=o.at(i),c=s.size,u=Math.max(0,t-r),d=Math.min(u+c,e-r);if(r+=c,!(u>c||d<0)){var f=s.toDOM(u,d);n.appendChild(f)}}return n},e}(ie),we=function(t){function e(e,n,r,o){return t.call(this,e,n,r,ye(o,[new Oe(e,n)]))||this}return me(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return{}},enumerable:!1,configurable:!0}),e.prototype.convertOffsetToModelOffset=function(e){return 1===this.size?this.resolvePosition(0).depth:e===this.size-1?t.prototype.convertOffsetToModelOffset.call(this,e-1)+1:t.prototype.convertOffsetToModelOffset.call(this,e)},e.prototype.convertModelOffsetToOffset=function(e){return e<=this.resolvePosition(0).depth?0:t.prototype.convertModelOffsetToOffset.call(this,e-1)+1>=this.size-1?this.size-1:t.prototype.convertModelOffsetToOffset.call(this,e)},e}(se),Oe=function(t){function e(e,n){var r=t.call(this,e,n+".line-break"," ",null)||this;return r.componentId=e,r.paragraphModelId=n,r}return me(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line-break"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){for(var t=this.previousSibling;t;){if("text"===t.type)return t.font;t=t.previousSibling}return de},enumerable:!1,configurable:!0}),e}(ue),Se=function(t){function e(e,n,r,o,i,a,s,c,u,d,f,h,l){var p=t.call(this,e,n,r,o,i,a,l)||this;return p.domContainer.style.width=s+"px",p.domContainer.style.height=c+"px",p.domContainer.style.paddingTop=u+"px",p.domContainer.style.paddingBottom=d+"px",p.domContainer.style.paddingLeft=f+"px",p.domContainer.style.paddingRight=h+"px",p.domContainer.style.lineHeight="1em",p.domContainer.innerHTML="",a.map(function(t){return p.domContainer.appendChild(t.domContainer)}),p}return me(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(pe),xe=function(t){function e(e,n,r,o,i){return t.call(this,e,n,r,o," ",null,i)||this}return me(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line-break"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(ge),Ce=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return me(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new be(this.id,e,r,o)},e.prototype.buildRenderNode=function(t,e,n,r,o){switch(t){case"paragraph":return new we(this.id,e,r,o);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,s,c,u,d,f,h){var l=this.serviceRegistry.getService("dom");switch(e){case"paragraph":return new Se(t,this.id,n,r,i,a,s,c,u,d,f,h,l);case"line-break":return new xe(t,this.id,n,r,l);default:throw new Error("Invalid part ID.")}},e}(Qt),Ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),De=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o,[])||this}return Ee(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(Ht),Pe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Te=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),e.prototype.canJoin=function(t){return this.componentId===t.componentId&&(this.partId===t.partId&&JSON.stringify(this.attributes)===JSON.stringify(t.attributes))},e.prototype.toDOM=function(t,e){var n=document.createElement("span");return n.innerText=this.text.substring(t-1,e-1),n},e}(De),je=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,o,i)||this;return a.textService=r,a}return Pe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.textService.applyDefaultFont(this.attributes)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this.style},enumerable:!1,configurable:!0}),e}(ue),ke=function(t){function e(e,n,r,o,i,a,s,c,u,d,f,h,l){var p=t.call(this,e,n,r,o,i,a,l)||this;p.domContainer.style.display="inline-block",p.domContainer.style.whiteSpace="pre",p.domContainer.style.lineHeight="1em",p.domContainer.style.width=s+"px",p.domContainer.style.height=c+"px",p.domContainer.style.paddingTop=u+"px",p.domContainer.style.paddingBottom=d+"px",p.domContainer.style.paddingLeft=f+"px",p.domContainer.style.paddingRight=h+"px",p.domContainer.style.fontFamily=a.family,p.domContainer.style.fontSize=a.size+"px",p.domContainer.style.letterSpacing=a.letterSpacing+"px",p.domContainer.style.fontWeight=""+a.weight,p.domContainer.style.color=a.color,p.domContainer.style.textDecoration=a.underline?"underline":"",p.domContainer.style.fontStyle=a.italic?"italic":"",p.domContainer.innerHTML="";var v=p.findOrCreateDOMContentContainer();return v.setAttribute("data-tw-role","content-container"),v.style.textDecoration=a.strikethrough?"line-through":"",v.innerHTML=i,p.domContainer.appendChild(v),p}return Pe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),e.prototype.findOrCreateDOMContentContainer=function(){for(var t=0,e=this.domContainer.children.length;t<e;t++){var n=this.domContainer.children[t];if("content-container"===n.getAttribute("data-tw-role"))return n}return this.domService.createElement("span")},e}(ge),_e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pe(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new Te(this.id,e,n,r)},e.prototype.buildRenderNode=function(t,e,n,r,o){var i=this.serviceRegistry.getService("text");switch(t){case"text":return new je(this.id,e,i,n,r);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,s,c,u,d,f,h){var l=this.serviceRegistry.getService("dom");switch(e){case"text":return new ke(t,this.id,n,r,o,i,s,c,u,d,f,h,l);default:throw new Error("Invalid part ID.")}},e}(Qt),Me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ze=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,null,r,"",null,o,i)||this;return a.layoutId=r,a}return Me(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Jt),Be=function(){return function(t,e){this.id=t,this.serviceRegistry=e}}(),Le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Re=function(t){function e(e,n,r,o,i,a,s,c,u,d,f){var h=t.call(this,e,n,r,o,f)||this;return h.width=i,h.height=a,h.paddingTop=s,h.paddingBottom=c,h.paddingLeft=u,h.paddingRight=d,h.domContainer.style.width=i+"px",h.domContainer.style.height=a+"px",h.domContainer.style.paddingTop=s+"px",h.domContainer.style.paddingBottom=c+"px",h.domContainer.style.paddingLeft=u+"px",h.domContainer.style.paddingRight=d+"px",h.domContainer.innerHTML="",o.map(function(t){return h.domContainer.appendChild(t.domContainer)}),h}return Le(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(ze),Ie=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Le(e,t),e.prototype.buildViewNode=function(t,e,n,r,o,i,a,s,c){var u=this.serviceRegistry.getService("dom");return new Re(t,this.id,e,n,r,o,i,a,s,c,u)},e}(Be),Ne=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),He=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,null,r,"",null,o,i)||this;return a.layoutId=r,a}return Ne(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"page"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(Jt),Ae=function(){return function(t,e){this.id=t,this.serviceRegistry=e}}(),Fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),We=function(t){function e(e,n,r,o,i,a,s,c,u,d,f){var h=t.call(this,e,n,r,o,f)||this;return h.domContainer.style.position="relative",h.domContainer.style.marginLeft="auto",h.domContainer.style.marginRight="auto",h.domContainer.style.width=i+"px",h.domContainer.style.height=a+"px",h.domContainer.style.paddingTop=s+"px",h.domContainer.style.paddingBottom=c+"px",h.domContainer.style.paddingLeft=u+"px",h.domContainer.style.paddingRight=d+"px",h.domContainer.innerHTML="",h.domContentContainer=h.findOrCreateDOMContentContainer(),h.domContentContainer.setAttribute("data-tw-role","content-container"),o.map(function(t){return h.domContentContainer.appendChild(t.domContainer)}),h.domContainer.appendChild(h.domContentContainer),h}return Fe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"page"},enumerable:!1,configurable:!0}),e.prototype.findOrCreateDOMContentContainer=function(){for(var t=0,e=this.domContainer.children.length;t<e;t++){var n=this.domContainer.children[t];if("content-container"===n.getAttribute("data-tw-role"))return n}return this.domService.createElement("div")},e}(He),Ue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Fe(e,t),e.prototype.buildViewNode=function(t,e,n,r,o,i,a,s,c){var u=this.serviceRegistry.getService("dom");return new We(t,this.id,e,n,r,o,i,a,s,c,u)},e}(Ae),Ve=function(){function t(){this.componentsMap=new Map}return t.prototype.registerComponent=function(t,e){this.componentsMap.set(t,e)},t.prototype.registerPageComponent=function(t){this.pageComponent=t},t.prototype.registerLineComponent=function(t){this.lineComponent=t},t.prototype.getComponent=function(t){var e=this.componentsMap.get(t);if(!e)throw new Error("Component "+t+" is not registered.");return e},t.prototype.getPageComponent=function(){if(!this.pageComponent)throw new Error("Page component is not registered.");return this.pageComponent},t.prototype.getLineComponent=function(){if(!this.lineComponent)throw new Error("Line component is not registered.");return this.lineComponent},t}(),Ke=function(){function t(t,e){this.configService=t,this.serviceRegistry=e,this.registry=new Ve;for(var n=0,r=Object.entries(t.getConfig().components);n<r.length;n++){var o=r[n],i=o[0],a=o[1];this.registry.registerComponent(i,new a(i,e))}this.registry.registerPageComponent(new Ue("page",e)),this.registry.registerLineComponent(new Ie("line",e))}return t.prototype.getComponent=function(t){return this.registry.getComponent(t)},t.prototype.getPageComponent=function(){return this.registry.getPageComponent()},t.prototype.getLineComponent=function(){return this.registry.getLineComponent()},t}(),$e=function(){function t(t,e){this.config=t,this.applyExternalConfig(e)}return t.prototype.getConfig=function(){return this.config},t.prototype.applyExternalConfig=function(t){var e=t["tw.core"];e&&e.page&&(this.config.page=e.page)},t}(),Ge=function(){return(Ge=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},qe=function(){function t(t,e,n){this.renderService=e,this.modelService=n,this.internalCursor=null,this.didUpdateEventEmitter=new Tt,t.getConfig().cursor.disable||(this.internalCursor={anchor:0,head:0,leftLock:0})}return Object.defineProperty(t.prototype,"hasCursor",{get:function(){return!!this.internalCursor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{get:function(){return this.assertCursor(),Ge({},this.internalCursor)},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e){this.assertCursor(),this.internalCursor={anchor:t,head:e,leftLock:this.internalCursor.leftLock},this.didUpdateEventEmitter.emit({})},t.prototype.setLeftLock=function(t){this.assertCursor(),this.internalCursor={anchor:this.internalCursor.anchor,head:this.internalCursor.head,leftLock:t}},t.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},t.prototype.assertCursor=function(){if(!this.internalCursor)throw new Error("Cursor is disabled.")},t}(),Je=function(){function t(t,e,n){this.state=new qe(t,e,n)}return t.prototype.hasCursor=function(){return this.state.hasCursor},t.prototype.getCursor=function(){return this.state.cursor},t.prototype.setCursor=function(t,e){this.state.set(t,e)},t.prototype.setLeftLock=function(t){this.state.setLeftLock(t)},t.prototype.onDidUpdate=function(t){return this.state.onDidUpdate(t)},t}(),Xe=function(){function t(){}return t.prototype.getWindow=function(){return window},t.prototype.getDocument=function(){return document},t.prototype.getBody=function(){return document.body},t.prototype.createElement=function(t){return document.createElement(t)},t.prototype.createContainer=function(){var t=this.createElement("div");return t.setAttribute("data-tw-role","container"),t},t.prototype.createHiddenIframe=function(){var t=this.createElement("iframe");return t.scrolling="no",t.src="about:blank",t.style.width="0",t.style.height="0",t.style.border="none",t.style.position="fixed",t.style.zIndex="-1",t.style.opacity="0",t.style.overflow="hidden",t.style.left="-1000000px",t.style.top="-1000000px",t},t.prototype.createMutationObserver=function(t){return new MutationObserver(t)},t}(),Ye=function(){function t(){this.internalTransformationResults=[],this.beganAt=Date.now(),this.internalEndedAt=this.beganAt}return Object.defineProperty(t.prototype,"endedAt",{get:function(){return this.internalEndedAt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformationResults",{get:function(){return this.internalTransformationResults},enumerable:!1,configurable:!0}),t.prototype.recordTransformationResult=function(t){this.transformationResults.push(t),this.internalEndedAt=Date.now()},t}(),Qe=function(){function t(t,e){var n=this;this.configService=t,this.transformService=e,this.actions=[],this.offset=-1,this.handleDidApplyTransformation=function(t){var e=t.result;if(!(n.offset+1<n.actions.length&&n.actions[n.offset+1].transformationResults.some(function(t){return t.reverseTransformation===e.transformation}))&&!(n.offset>=0&&n.actions[n.offset].transformationResults.some(function(t){return t.transformation===e.transformation})))if(n.offset<0)n.recordToNewAction(e);else{var r=n.actions[n.offset],o=Date.now();o-r.beganAt<n.maxCollapseDuration&&o-r.endedAt<n.collapseThreshold?n.recordToLastAction(e):n.recordToNewAction(e)}};var r=t.getConfig();this.maxCollapseDuration=r.history.maxCollapseDuration,this.collapseThreshold=r.history.collapseThreshold,e.onDidApplyTransformation(this.handleDidApplyTransformation)}return t.prototype.undo=function(){var t=this.consumeNextUndoableAction();if(t){var e=t.transformationResults;if(0!==e.length)for(var n=e.length-1;n>=0;n--){var r=e[n];this.transformService.applyTransformation(r.reverseTransformation)}}},t.prototype.redo=function(){var t=this,e=this.consumeNextRedoableAction();e&&e.transformationResults.forEach(function(e){return t.transformService.applyTransformation(e.transformation)})},t.prototype.consumeNextUndoableAction=function(){if(!(this.offset<0)){var t=this.actions[this.offset];return this.offset--,t}},t.prototype.consumeNextRedoableAction=function(){if(!(this.offset>=this.actions.length-1))return this.offset++,this.actions[this.offset]},t.prototype.recordToNewAction=function(t){if(0!==t.changeResults.length){this.offset<this.actions.length-1&&this.actions.splice(this.offset+1,this.actions.length-1-this.offset);var e=new Ye;e.recordTransformationResult(t),this.actions.push(e),this.offset++}},t.prototype.recordToLastAction=function(t){var e=this.actions[this.offset];if(!e)throw new Error("Error recording applied transformation, history is empty.");this.offset<this.actions.length-1&&this.actions.splice(this.offset+1,this.actions.length-1-this.offset),e.recordTransformationResult(t)},t}(),Ze=function(){function t(t,e){this.state=new Qe(t,e)}return t.prototype.undo=function(){this.state.undo()},t.prototype.redo=function(){this.state.redo()},t}();function tn(){return navigator.platform.startsWith("Linux")?"Linux":["Windows","Win16","Win32"].includes(navigator.platform)?"Windows":["Macintosh","MacIntel","MacPPC","Mac68K"].includes(navigator.platform)?"macOS":"Unknown"}var en=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},nn=function(){function t(t,e,n){var r=this;this.configService=t,this.commandService=e,this.viewService=n,this.keyBindings=new Map,this.handleDidPressKey=function(t){var e,n=r.keyBindings.get(t.key);n&&(n.preventDefault&&t.originalKeyboardEvent.preventDefault(),(e=r.commandService).executeCommand.apply(e,en([n.command],n.args)))};var o=this.configService.getConfig().keyBindings;switch(this.bindKeys(o.common),tn()){case"macOS":o.macos&&this.bindKeys(o.macos);break;case"Windows":o.windows&&this.bindKeys(o.windows);break;case"Linux":o.linux&&this.bindKeys(o.linux)}n.onDidPressKey(this.handleDidPressKey)}return t.prototype.bindKeys=function(t){for(var e in t){var n=t[e];this.keyBindings.set(e,{command:n.command,args:n.args||[],preventDefault:n.preventDefault||!1})}},t}(),rn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),on=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,Object(st.a)())||this;return c.renderId=e,c.text=n,c.paddingTop=o,c.paddingBottom=i,c.paddingLeft=a,c.paddingRight=s,c.internalNeedView=!0,c.internalChildren=new Bt(r),r.forEach(function(t){t.parent=c}),c}return rn(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.text.length:this.internalSize=this.children.reduce(function(t,e){return t+e.size},0)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingVertical",{get:function(){return this.paddingTop+this.paddingBottom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingHorizontal",{get:function(){return this.paddingLeft+this.paddingRight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this.width-this.paddingHorizontal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerHeight",{get:function(){return this.height-this.paddingVertical},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needView",{get:function(){return this.internalNeedView},enumerable:!1,configurable:!0}),e.prototype.clearNeedView=function(){this.internalNeedView=!1},e.prototype.resolvePosition=function(t){if(t<0||t>=this.size)throw new Error("Offset "+t+" is out of range.");if(this.leaf)return new an([{node:this,offset:t,index:t}]);for(var e=0,n=0,r=this.children.length;n<r;n++){var o=this.children.at(n),i=o.size;if(e+i>t){for(var a=o.resolvePosition(t-e),s=[{node:this,offset:t,index:n}],c=0;c<a.depth;c++)s.push(a.atDepth(c));return new an(s)}e+=i}throw new Error("Offset cannot be resolved.")},e}(Lt),an=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.prototype.atLineDepth=function(){for(var t=this.depth-1;t>=0;t--){var e=this.atDepth(t);if("line"===e.node.type)return e}throw new Error("Line depth not found.")},e.prototype.atBlockDepth=function(){for(var t=this.depth-1;t>=0;t--){var e=this.atDepth(t);if("block"===e.node.type)return e}throw new Error("Block depth not found.")},e}(Rt),sn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cn=function(t){function e(e,n,r){var o=t.call(this,e," ",[],0,0,0,0)||this;return o.width=n,o.height=r,o}return sn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"atom"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){return t<this.innerWidth/2?0:1},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");return{node:this,boundingBoxes:[{from:t,to:e,width:t===e?0:this.innerWidth,height:this.innerHeight,left:0===t?this.paddingLeft:this.paddingLeft+this.innerWidth,right:1===e?this.paddingRight:this.paddingRight+this.innerWidth,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}},e}(on),un=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dn=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,e,"",n,o,i,a,s)||this;return c.width=r,c}return un(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce(function(t,e){return t+e.height},this.paddingVertical)),this.internalHeight},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),s=a.height;if(e>=r&&e<=r+s){n+=a.convertCoordinatesToOffset(t,0);break}n+=a.size,r+=s}if(n===this.size){var c=this.lastChild;c&&(n-=c.size,n+=c.convertCoordinatesToOffset(t,c.height))}return n},e.prototype.resolveBoundingBoxes=function(t,e){var n=this;if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var r=[],o=[],i=0,a=0;return this.children.forEach(function(s){if(i+s.size>t&&i<=e){var c=Math.max(0,t-i),u=Math.min(s.size,e-i),d=s.resolveBoundingBoxes(c,u);r.push(d),d.boundingBoxes.forEach(function(t){o.push({from:i+c,to:i+u,width:t.width,height:t.height,top:a+n.paddingTop+t.top,bottom:n.height-n.paddingTop-a-s.height+t.bottom,left:t.left,right:t.right})})}i+=s.size,a+=s.height}),{node:this,boundingBoxes:o,children:r}},e}(on),fn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),hn=function(t){function e(e,n,r,o,i,a,s,c){var u=t.call(this,e,"",n,i,a,s,c)||this;return u.width=r,u.height=o,u}return fn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){throw new Error("Use page to convert coordinates to offset.")},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var n=[],r=0;return this.children.forEach(function(o){if(r+o.size>t&&r<=e){var i=Math.max(0,t-r),a=Math.min(o.size,e-r),s=o.resolveBoundingBoxes(i,a);n.push(s)}r+=o.size}),{node:this,boundingBoxes:[],children:n}},e}(on),ln=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t){function e(e,n){var r=t.call(this,null,"",e,0,8,0,0)||this;return r.width=n,r}return ln(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce(function(t,e){return Math.max(t,e.height)},0)+this.paddingVertical),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentWidth",{get:function(){return void 0===this.internalContentWidth&&(this.internalContentWidth=this.children.reduce(function(t,e){return t+e.width},0)),this.internalContentWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),s=a.width;if(t>=r&&t<=r+s){n+=a.convertCoordinatesToOffset(t-r,0);break}n+=a.size,r+=s}if(n===this.size){var c=this.lastChild;if(c&&"text"===c.type){var u=c.lastChild;u&&u.whitespaceSize>0&&n--}}return n},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");for(var n=[],r=0,o=null,i=0,a=0,s=this.children.length;a<s&&!(r>e);a++){var c=this.children.at(a);if(r+c.size>t){var u=Math.max(0,t-r),d=Math.min(c.size,e-r),f=c.resolveBoundingBoxes(u,d);n.push(f),null===o&&(o=i+f.boundingBoxes[0].left),i+=f.boundingBoxes.slice(0,f.boundingBoxes.length-1).reduce(function(t,e){return t+e.left+e.width+e.right},0),i+=f.boundingBoxes[0].left+f.boundingBoxes[0].width}else i+=c.width;r+=c.size}return{node:this,boundingBoxes:[{from:t,to:e,width:i-o,height:t===e?this.innerHeight:this.height,left:this.paddingLeft+o,right:this.width-this.paddingLeft-i,top:t===e?this.paddingTop:0,bottom:t===e?this.paddingBottom:0}],children:n}},e}(on),vn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gn=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,null,"",e,o,i,a,s)||this;return c.width=n,c.height=r,c}return vn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"page"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentHeight",{get:function(){return void 0===this.internalContentHeight&&(this.internalContentHeight=this.children.reduce(function(t,e){return t+e.height},0)),this.internalContentHeight},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){for(var n=0,r=0,o=Math.min(Math.max(t-this.paddingLeft,0),this.innerWidth),i=Math.min(Math.max(e-this.paddingTop,0),this.innerHeight),a=0,s=this.children.length;a<s;a++){var c=this.children.at(a),u=c.height;if(i>=r&&i<=r+u){n+=c.convertCoordinatesToOffset(o,i-r);break}n+=c.size,r+=u}if(n===this.size){var d=this.lastChild;d&&(n-=d.size,n+=d.convertCoordinatesToOffset(o,d.height))}return n},e.prototype.resolveBoundingBoxes=function(t,e){var n=this;if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var r=[],o=[],i=0,a=0;return this.children.forEach(function(s){if(i+s.size>t&&i<=e){var c=Math.max(0,t-i),u=Math.min(s.size,e-i),d=s.resolveBoundingBoxes(c,u);r.push(d),d.boundingBoxes.forEach(function(t){o.push({from:i+c,to:i+u,width:t.width,height:t.height,top:a+n.paddingTop+t.top,bottom:n.height-n.paddingTop-a-s.height+t.bottom,left:t.left+n.paddingLeft,right:t.right+n.paddingRight})})}i+=s.size,a+=s.height}),{node:this,boundingBoxes:o,children:r}},e}(on),mn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yn=function(t){function e(e,n,r,o,i,a,s){var c=t.call(this,e,"",n,r,o,i,a)||this;return c.font=s,c}return mn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return void 0===this.internalWidth&&(this.internalWidth=this.children.reduce(function(t,e){return t+e.width},this.paddingHorizontal)),this.internalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce(function(t,e){return Math.max(t,e.height)},0)+this.paddingVertical),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trimmedWidth",{get:function(){if(void 0===this.internalTrimmedWidth){var t=this.lastChild;this.internalTrimmedWidth=t?this.width-t.width+t.trimmedWidth:0}return this.internalTrimmedWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),s=a.width;if(r+s>=t){n+=a.convertCoordinatesToOffset(t-r,0);break}n+=a.size,r+=s}return n},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");for(var n=[],r=0,o=null,i=0,a=0,s=this.children.length;a<s&&!(r>e);a++){var c=this.children.at(a);if(r+c.size>t){var u=Math.max(0,t-r),d=Math.min(c.size,e-r),f=c.resolveBoundingBoxes(u,d);n.push(f),null===o&&(o=i+f.boundingBoxes[0].left),i+=f.boundingBoxes.slice(0,f.boundingBoxes.length-1).reduce(function(t,e){return t+e.left+e.width+e.right},0),i+=f.boundingBoxes[0].left+f.boundingBoxes[0].width}else i+=c.width;r+=c.size}return{node:this,boundingBoxes:[{from:t,to:e,width:i-o,height:this.innerHeight,left:this.paddingLeft+o,right:this.width-this.paddingLeft-i,top:this.paddingTop,bottom:this.paddingBottom}],children:n}},e}(on),bn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wn=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,[],0,0,0,0)||this;return a.whitespaceSize=r,a.font=o,a.textService=i,a}return bn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"word"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t;return void 0===this.internalWidth&&(t=this.measure(),this.internalWidth=t[0],this.internalHeight=t[1]),this.internalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t;return void 0===this.internalHeight&&(t=this.measure(),this.internalWidth=t[0],this.internalHeight=t[1]),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trimmedWidth",{get:function(){if(void 0===this.internalTrimmedWidth){var t=this.text.substring(0,this.text.length-this.whitespaceSize);this.internalTrimmedWidth=this.textService.measure(t,this.font).width}return this.internalTrimmedWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToOffset=function(t,e){for(var n=0,r=this.text,o=0,i=r.length;o<i;o++){var a=this.textService.measure(r.substring(0,o),this.font).width;if(!(a<t))return t-n<a-t?o-1:o;n=a}return t-n<this.width-t?r.length-1:r.length},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");if(0===t&&e===this.size)return{node:this,boundingBoxes:[{from:t,to:e,width:this.innerWidth,height:this.innerHeight,left:this.paddingLeft,right:this.paddingRight,top:this.paddingTop,bottom:this.paddingBottom}],children:[]};if(t===e){var n=this.textService.measure(this.text.slice(0,t),this.font).width;return{node:this,boundingBoxes:[{from:t,to:e,width:0,height:this.innerHeight,left:this.paddingLeft+n,right:this.width-this.paddingLeft-n,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}}var r=this.textService.measure(this.text.slice(0,t),this.font).width,o=this.textService.measure(this.text.slice(0,e),this.font).width;return{node:this,boundingBoxes:[{from:t,to:e,width:o-r,height:this.innerHeight,left:this.paddingLeft+r,right:this.innerWidth-this.paddingLeft-o,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}},e.prototype.breakAt=function(t){return[new e(this.renderId,this.text.substring(0,t),0,this.font,this.textService),new e(this.renderId,this.text.substring(t),this.whitespaceSize,this.font,this.textService)]},e.prototype.measure=function(){var t=this.textService.measure(this.text,this.font);return[t.width,t.height]},e}(on),On=function(){function t(t){this.textService=t}return t.prototype.updateDoc=function(t,e){var n=this;if(!e.needLayout&&t)return t;var r=[],o={};t&&t.children.forEach(function(t){r.push(t),t.children.forEach(function(t){if(!t.renderId)throw new Error("Render ID missing on layout node.");o[t.renderId]=o[t.renderId]||[],o[t.renderId].push(t)})});var i=[];return e.children.forEach(function(t){switch(t.type){case"block":i.push.apply(i,n.updateBlock(o[t.id]||[],t,e.width-e.paddingLeft-e.paddingRight));break;default:throw new Error("Child type "+t.type+" is invalid.")}}),e.clearNeedLayout(),this.buildDoc(e,this.reflowPages(r,i,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight))},t.prototype.updateBlock=function(t,e,n){var r=this;if(!e.needLayout&&t.length>0)return t;for(var o=[],i={},a=0,s=t;a<s.length;a++){s[a].children.forEach(function(t){o.push(t),t.children.forEach(function(t){if(!t.renderId)throw new Error("Render ID missing on layout node.");i[t.renderId]=i[t.renderId]||[],i[t.renderId].push(t)})})}var c=[];return e.children.forEach(function(t){switch(t.type){case"text":c.push.apply(c,r.updateText(i[t.id]||[],t));break;case"atom":c.push.apply(c,r.updateAtom(i[t.id]||[],t));break;default:throw new Error("Child type "+t.type+" is invalid.")}}),e.clearNeedLayout(),[this.buildBlock(e,this.reflowLines(o,c,n-e.paddingLeft-e.paddingRight),n)]},t.prototype.updateText=function(t,e){var n=this;if(!e.needLayout&&t.length>0)return t;var r=[];return this.textService.breakIntoWords(e.text).forEach(function(t){r.push(n.buildWord(e,t.text,t.whitespaceSize))}),e.clearNeedLayout(),[this.buildText(e,r)]},t.prototype.updateAtom=function(t,e){return!e.needLayout&&t.length>0?t:(e.clearNeedLayout(),[this.buildAtom(e)])},t.prototype.buildDoc=function(t,e){return new hn(t.id,e,t.width,t.height,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight)},t.prototype.buildBlock=function(t,e,n){if("block"!==t.type)throw new Error("Expected block.");return new dn(t.id,e,n,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight)},t.prototype.buildText=function(t,e){if("text"!==t.type)throw new Error("Expected text.");return new yn(t.id,e,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight,t.font)},t.prototype.buildWord=function(t,e,n){if("text"!==t.type)throw new Error("Expected text.");return new wn(t.id,e,n,t.font,this.textService)},t.prototype.buildAtom=function(t){if("atom"!==t.type)throw new Error("Expected atom.");return new cn(t.id,t.width,t.height)},t.prototype.reflowPages=function(t,e,n,r,o,i,a,s){var c=r-o-i;e=e.slice();for(var u=[];e.length>0;){if(u.length<t.length){for(var d=t[u.length],f=!1,h=0,l=d.children.length;h<l;h++){if(d.children.at(h).id!==e[h].id){f=!0;break}}if(!f){u.push(d),e.splice(0,d.children.length);continue}}for(var p=[],v=0,g=e.shift();g&&v+g.height<=c;)p.push(g),v+=g.height,g=e.shift();if(g){for(var m=[],y=0,b=g.children.length;y<b;y++){var w=g.children.at(y);if(v+w.height+g.paddingVertical>c)break;m.push(w),v+=w.height}if(m.length>0)switch(g.type){case"block":var O=new dn(g.renderId,m,n,g.paddingTop,g.paddingBottom,g.paddingLeft,g.paddingRight);p.push(O),v+=O.height;var S=new dn(g.renderId,g.children.slice(m.length),n,g.paddingTop,g.paddingBottom,g.paddingLeft,g.paddingRight);e.unshift(S);break;default:throw new Error("Invalid node type encountered while reflowing page.")}else e.unshift(g)}var x=new gn(p,n,r,o,i,a,s);u.push(x)}return u},t.prototype.reflowLines=function(t,e,n){e=e.slice();for(var r=[];e.length>0;){if(r.length<r.length){for(var o=t[r.length],i=!1,a=0,s=o.children.length;a<s;a++){if(o.children.at(a).id!==e[a].id){i=!0;break}}if(!i){r.push(o),e.splice(0,o.children.length);continue}}for(var c=[],u=0,d=e.shift();d&&u+d.width<=n;)c.push(d),u+=d.width,d=e.shift();if(d){for(var f=d.children.slice(),h=[],l=0;l<f.length;l++){var p=f[l];if("word"===p.type&&p.width>n){var v=p.convertCoordinatesToOffset(n,0);p.resolveBoundingBoxes(v,v).boundingBoxes[0].left>n&&v--;var g=p.breakAt(v),m=g[0],y=g[1];p=m,f.splice(l,1,m,y)}if(u+p.width>n)break;h.push(p),u+=p.width}if(h.length>0)switch(d.type){case"text":var b=d,w=new yn(b.renderId,h,b.paddingTop,b.paddingBottom,b.paddingLeft,b.paddingRight,b.font);c.push(w),u+=w.width;var O=new yn(b.renderId,f.slice(h.length),b.paddingTop,b.paddingBottom,b.paddingLeft,b.paddingRight,b.font);e.unshift(O);break;case"atom":d.width>n&&0===c.length?c.push(d):e.unshift(d);break;default:throw new Error("Invalid node type encountered while reflowing page.")}else e.unshift(d)}var S=new pn(c,n);r.push(S)}return r},t}(),Sn=function(){function t(t,e){var n=this;this.renderService=t,this.textService=e,this.didUpdateLayoutStateEventEmitter=new Tt,this.engine=new On(e),this.internalDoc=this.engine.updateDoc(null,t.getDoc()),t.onDidUpdateRenderState(function(t){return n.handleDidUpdateRenderStateEvent(t)})}return Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.onDidUpdateLayoutState=function(t){return this.didUpdateLayoutStateEventEmitter.on(t)},t.prototype.handleDidUpdateRenderStateEvent=function(t){this.update()},t.prototype.update=function(){var t=this.renderService.getDoc();this.internalDoc=this.engine.updateDoc(this.doc,t),this.didUpdateLayoutStateEventEmitter.emit({})},t}(),xn=function(){function t(t,e){this.state=new Sn(t,e)}return t.prototype.onDidUpdateLayoutState=function(t){this.state.onDidUpdateLayoutState(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.resolvePosition=function(t){return this.state.doc.resolvePosition(t)},t.prototype.resolveBoundingBoxes=function(t,e){return this.state.doc.resolveBoundingBoxes(t,e)},t}(),Cn=function(){function t(t,e){this.root=t,this.componentService=e,this.didUpdateEventEmitter=new Tt}return t.prototype.applyChange=function(t){var e=t.apply(this.root,this.componentService);return this.didUpdateEventEmitter.emit({changeResult:e}),e},t.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},t}(),En=function(){function t(t,e){this.state=new Cn(t,e)}return t.prototype.getRoot=function(){return this.state.root},t.prototype.getRootSize=function(){return this.state.root.size},t.prototype.applyChange=function(t){return this.state.applyChange(t)},t.prototype.resolvePosition=function(t){return this.state.root.resolvePosition(t)},t.prototype.toDOM=function(t,e){return this.state.root.toDOM(t,e)},t.prototype.fromDOM=function(t){return[this.getRoot()]},t.prototype.onDidUpdateModelState=function(t){this.state.onDidUpdate(t)},t}(),Dn=function(){function t(t,e){var n=this;this.componentService=t,this.modelService=e,this.didUpdateRenderStateEventEmitter=new Tt;var r=e.getRoot();this.internalDoc=this.updateNode(null,r),e.onDidUpdateModelState(function(t){return n.handleDidUpdateModelState(t)})}return t.prototype.onDidUpdateRenderState=function(t){return this.didUpdateRenderStateEventEmitter.on(t)},Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.handleDidUpdateModelState=function(t){this.update()},t.prototype.update=function(){var t=this.modelService.getRoot();this.internalDoc=this.updateNode(this.doc,t),this.didUpdateRenderStateEventEmitter.emit({})},t.prototype.updateNode=function(t,e){var n=this;if(!e.needRender&&t)return t;var r={};t&&t.children.forEach(function(t){t.modelId&&(r[t.modelId]=t)});var o=[];return e.children.forEach(function(t){o.push(n.updateNode(r[t.id]||null,t))}),e.clearNeedRender(),this.buildNode(e,o)},t.prototype.buildNode=function(t,e){var n=this.componentService.getComponent(t.componentId).buildRenderNode(t.partId,t.id,t.text,t.attributes,e);if(!n)throw new Error("Error building render node from model node "+t.id+".");return n},t}(),Pn=function(){function t(t,e){this.state=new Dn(t,e)}return t.prototype.onDidUpdateRenderState=function(t){this.state.onDidUpdateRenderState(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.getDocSize=function(){return this.state.doc.size},t.prototype.convertOffsetToModelOffset=function(t){return this.state.doc.convertOffsetToModelOffset(t)},t.prototype.convertModelOffsetToOffset=function(t){return this.state.doc.convertModelOffsetToOffset(t)},t.prototype.resolvePosition=function(t){return this.state.doc.resolvePosition(t)},t.prototype.getStylesBetween=function(t,e){var n={},r=this.state.doc;return this.extractStyle(n,r,t,e),n},t.prototype.extractStyle=function(t,e,n,r){var o=this;if(!(n>r)){var i=t[e.componentId]=t[e.componentId]||{};(i[e.partId||""]=i[e.partId||""]||[]).push(e.style);var a=0;e.children.forEach(function(e){var i=e.size;if(r-a>=0&&n-a<i){var s=Math.max(0,Math.min(i,n-a)),c=Math.max(0,Math.min(i,r-a));o.extractStyle(t,e,s,c)}a+=i})}},t}(),Tn=function(){function t(){this.services={}}return t.prototype.registerService=function(t,e){this.services[t]=e},t.prototype.getService=function(t){var e=this.services[t];if(!e)throw new Error("Service "+t+" is not registered.");return e},t}(),jn=function(){function t(t,e,n,r,o){this.modelService=t,this.componentService=e,this.cursorService=n,this.renderService=r,this.layoutService=o,this.didApplyTransformationEventEmitter=new Tt}return t.prototype.applyTransformation=function(t){var e=t.apply(this.modelService,this.cursorService,this.renderService,this.layoutService);return this.didApplyTransformationEventEmitter.emit({result:e}),e},t.prototype.onDidApplyTransformation=function(t){return this.didApplyTransformationEventEmitter.on(t)},t}(),kn=function(){function t(t,e,n,r,o,i,a){var s=this;this.instanceId=t,this.configService=e,this.domService=n,this.cursorService=r,this.layoutService=o,this.viewService=i,this.transformService=a,this.blinkInterval=null,this.blinkState=!0,this.domSelections=[],this.attached=!1;var c=e.getConfig().cursor;this.caretColor=c.caretColor,this.caretInactiveColor=c.caretInactiveColor,this.selectionColor=c.selectionColor,this.selectionInactiveColor=c.selectionInactiveColor,this.domCaret=n.createElement("div"),this.domCaret.className="tw--cursor--caret",this.domCaret.setAttribute("data-tw-instance",this.instanceId),this.domCaret.style.position="absolute",this.domCaret.style.userSelect="none",this.domCaret.style.pointerEvents="none",this.domCaret.style.width="2px",this.domCaret.style.marginLeft="-1px",a.onDidApplyTransformation(function(t){return s.handleDidApplyTransformation(t)}),i.onDidFocus(function(t){return s.handleDidFocus(t)}),i.onDidBlur(function(t){return s.handleDidBlur(t)})}return t.prototype.attach=function(){if(this.attached)throw new Error("Already attached to the DOM.");this.attached=!0,this.updateView()},t.prototype.updateView=function(){var t=this;if(this.attached){this.clearDOMSelections();var e,n,r,o,i,a=this.cursorService.getCursor(),s=a.anchor,c=a.head,u=Math.min(s,c),d=Math.max(s,c),f=this.layoutService.resolveBoundingBoxes(u,d),h=this.viewService.getDoc(),l=this.layoutService.getDoc(),p=this.viewService.isFocused(),v="",g=-1,m="",y=-1;if(f.children.forEach(function(e){var n=l.children.indexOf(e.node),r=h.children.at(n).domContentContainer;e.boundingBoxes.forEach(function(n,o){if(v||(v=e.node.id,g=o),m=e.node.id,y=o,0!==n.width){var i=t.buildDOMSelection(n);i.style.background=p?t.selectionColor:t.selectionInactiveColor,r.appendChild(i),t.domSelections.push(i)}})}),c<s)e=v,n=(i=f.children.find(function(t){return t.node.id===v}).boundingBoxes[g]).left,r=i.top,o=i.height;else e=m,n=(i=f.children.find(function(t){return t.node.id===m}).boundingBoxes[y]).left+i.width,r=i.top,o=i.height;if(c===s){this.domCaret.style.display="block",this.domCaret.style.top=r+"px",this.domCaret.style.left=n+"px",this.domCaret.style.height=o+"px",this.domCaret.style.background=p?this.caretColor:this.caretInactiveColor;var b=h.children.find(function(t){return t.id===e}).domContentContainer;this.domCaret.parentElement&&this.domCaret.parentElement!==b&&this.domCaret.parentElement.removeChild(this.domCaret),this.domCaret.parentElement||b.appendChild(this.domCaret),this.blinkStop(),p&&this.blinkStart()}else this.domCaret.style.display="none",this.blinkStop()}},t.prototype.blinkStart=function(){var t=this;null===this.blinkInterval&&(this.blinkState=!0,this.blinkInterval=window.setInterval(function(){t.blinkState=!t.blinkState,t.updateDOMBlink()},500))},t.prototype.blinkStop=function(){null!==this.blinkInterval&&(this.domCaret.style.visibility="visible",clearInterval(this.blinkInterval),this.blinkInterval=null)},t.prototype.updateDOMBlink=function(){this.blinkState?this.domCaret.style.visibility="visible":this.domCaret.style.visibility="hidden"},t.prototype.clearDOMSelections=function(){this.domSelections.forEach(function(t){t.parentElement&&t.parentElement.removeChild(t)}),this.domSelections=[]},t.prototype.buildDOMSelection=function(t){var e=document.createElement("div");return e.className="tw--cursor--selection",e.setAttribute("data-tw-instance",this.instanceId),e.style.position="absolute",e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.userSelect="none",e.style.pointerEvents="none",e},t.prototype.handleDidApplyTransformation=function(t){this.updateView()},t.prototype.handleDidFocus=function(t){this.updateView()},t.prototype.handleDidBlur=function(t){this.updateView()},t}(),_n=function(){function t(t){var e=this;this.$contentEditable=t,this.didCopyEventEmitter=new Tt,this.didPasteEventEmitter=new Tt,this.handleCopy=function(t){t.preventDefault(),e.didCopyEventEmitter.emit({})},this.handlePaste=function(t){t.preventDefault();var n=t.clipboardData;n&&e.didPasteEventEmitter.emit({data:n})},t.addEventListener("copy",this.handleCopy),t.addEventListener("paste",this.handlePaste)}return t.prototype.onDidCopy=function(t){return this.didCopyEventEmitter.on(t)},t.prototype.onDidPaste=function(t){return this.didPasteEventEmitter.on(t)},t}(),Mn=function(){function t(t){var e=this;this.$contentEditable=t,this.didFocusEventEmitter=new Tt,this.didBlurEventEmitter=new Tt,this.handleFocus=function(){e.didFocusEventEmitter.emit({})},this.handleBlur=function(){e.didBlurEventEmitter.emit({})},t.addEventListener("focus",this.handleFocus),t.addEventListener("blur",this.handleBlur)}return t.prototype.onDidFocus=function(t){return this.didFocusEventEmitter.on(t)},t.prototype.onDidBlur=function(t){return this.didBlurEventEmitter.on(t)},t}(),zn=function(){function t(t,e){var n=this;this.$contentEditable=t,this.domService=e,this.composing=!1,this.didInsertEventEmitter=new Tt,this.didPressKeyEventEmitter=new Tt,this.compositionDidStartEventEmitter=new Tt,this.compositionDidEndEventEmitter=new Tt,this.keyInterpreter=new Bn,this.handleDidMutate=function(){setTimeout(function(){if(!n.composing){var t=n.$contentEditable.innerText;n.$contentEditable.innerHTML="",0!==t.length&&n.didInsertEventEmitter.emit({content:t})}})},this.handleKeyDown=function(t){var e=n.keyInterpreter.interpretFromKeyboardEvent(t);e&&n.didPressKeyEventEmitter.emit({key:e,originalKeyboardEvent:t})},this.handleCompositionStart=function(){n.composing=!0},this.handleCompositionEnd=function(){n.composing=!0},this.mutationObserver=e.createMutationObserver(this.handleDidMutate),t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("compositionstart",this.handleCompositionStart),t.addEventListener("compositionend",this.handleCompositionEnd),this.mutationObserver.observe(t,{subtree:!0,characterData:!0,childList:!0})}return t.prototype.onDidInsert=function(t){return this.didInsertEventEmitter.on(t)},t.prototype.onDidPressKey=function(t){return this.didPressKeyEventEmitter.on(t)},t.prototype.onCompositionDidStart=function(t){return this.compositionDidStartEventEmitter.on(t)},t.prototype.onCompositionDidEnd=function(t){return this.compositionDidEndEventEmitter.on(t)},t}(),Bn=function(){function t(){}return t.prototype.interpretFromKeyboardEvent=function(t){var e;switch(t.key){case"Control":case"Shift":case"Alt":case"Meta":return;case"ArrowLeft":e="left";break;case"ArrowRight":e="right";break;case"ArrowUp":e="up";break;case"ArrowDown":e="down";break;default:e=t.key.toLowerCase()}if(t.metaKey)switch(tn()){case"macOS":e="cmd+"+e;break;case"Windows":e="win+"+e;break;case"Linux":default:e="meta+"+e}return t.altKey&&(e="alt+"+e),t.shiftKey&&(e="shift+"+e),t.ctrlKey&&(e="ctrl+"+e),e},t}(),Ln=function(){function t(t,e,n,r){var o=this;this.instanceId=t,this.viewService=e,this.domService=n,this.layoutService=r,this.clickThreshold=250,this.consecutiveClickThreshold=250,this.lastPointerDown=null,this.lastClick=null,this.consecutiveClickCount=0,this.pointerDidDownEventEmitter=new Tt,this.pointerDidMoveEventEmitter=new Tt,this.pointerDidUpEventEmitter=new Tt,this.pointerDidClickEventEmitter=new Tt,this.handleMouseDown=function(t){var e=o.resolveOffset(t.clientX,t.clientY);if(null!==e){t.preventDefault(),o.lastPointerDown={timestamp:Date.now(),offset:e};var n=null!==o.lastClick&&Date.now()-o.lastClick.timestamp<o.consecutiveClickThreshold;o.pointerDidDownEventEmitter.emit({offset:e,consecutive:n})}},this.handleMouseMove=function(t){var e=o.resolveOffset(t.clientX,t.clientY);null!==e&&o.pointerDidMoveEventEmitter.emit({pointerDown:null!==o.lastPointerDown,offset:e})},this.handleMouseUp=function(t){if(null!==o.lastPointerDown){var e=o.lastPointerDown;o.lastPointerDown=null;var n=o.resolveOffset(t.clientX,t.clientY);if(null!==n){var r=Date.now(),i=e.offset===n&&r-e.timestamp<o.clickThreshold;if(o.pointerDidUpEventEmitter.emit({}),i){if(null!==o.lastClick)r-o.lastClick.timestamp>o.consecutiveClickThreshold&&(o.consecutiveClickCount=0);o.consecutiveClickCount++,o.lastClick={timestamp:Date.now(),offset:n},o.pointerDidClickEventEmitter.emit({offset:n,consecutiveCount:o.consecutiveClickCount})}}}};var i=n.getWindow();i.addEventListener("mousedown",this.handleMouseDown),i.addEventListener("mousemove",this.handleMouseMove),i.addEventListener("mouseup",this.handleMouseUp)}return t.prototype.onPointerDidDown=function(t){return this.pointerDidDownEventEmitter.on(t)},t.prototype.onPointerDidMove=function(t){return this.pointerDidMoveEventEmitter.on(t)},t.prototype.onPointerDidUp=function(t){return this.pointerDidUpEventEmitter.on(t)},t.prototype.onPointerDidClick=function(t){return this.pointerDidClickEventEmitter.on(t)},t.prototype.resolveOffset=function(t,e){for(var n=this.viewService.getDoc(),r=this.layoutService.getDoc(),o=0,i=0,a=n.children.length;i<a;i++){var s=n.children.at(i),c=r.children.at(i),u=s.domContainer.getBoundingClientRect();if(u.left<=t&&u.right>=t&&u.top<=e&&u.bottom>=e){var d=t-u.left,f=e-u.top;return o+c.convertCoordinatesToOffset(d,f)}o+=c.size}return null},t}(),Rn=function(){function t(t,e,n,r,o,i){var a=this;this.instanceId=t,this.domService=e,this.commandService=n,this.modelService=r,this.viewService=o,this.layoutService=i,this.focused=!1,this.composing=!1,this.mouseDown=!1,this.handleDidInsert=function(t){a.commandService.executeCommand("tw.state.insert",t.content)},this.handleCompositionDidStart=function(t){a.composing=!0},this.handleCompositionDidEnd=function(t){a.composing=!1},this.handlePointerDidDown=function(t){a.focused||a.commandService.executeCommand("tw.view.focus"),t.consecutive||a.commandService.executeCommand("tw.cursor.move",t.offset)},this.handlePointerDidMove=function(t){t.pointerDown&&a.commandService.executeCommand("tw.cursor.moveHead",t.offset)},this.handlePointerDidClick=function(t){switch(t.consecutiveCount){case 1:break;case 2:a.commandService.executeCommand("tw.cursor.selectWord",t.offset);break;case 3:default:a.commandService.executeCommand("tw.cursor.selectBlock",t.offset)}},this.handleDidFocus=function(t){a.focused=!0},this.handleDidBlur=function(t){a.focused=!1},this.handleCopy=function(t){a.commandService.executeCommand("tw.clipboard.copy")},this.handlePaste=function(t){var e=t.data.getData("text/html"),n=a.domService.createElement("html");n.innerHTML=e;var r=n.querySelector("body");if(r){var o=Array.prototype.slice.call(r.children),i=a.modelService.fromDOM(o);console.log(i)}},this.iframe=e.createHiddenIframe(),this.$contentEditable=this.createContentEditable(),this.keyboardObserver=new zn(this.$contentEditable,e),this.keyboardObserver.onDidInsert(this.handleDidInsert),this.keyboardObserver.onCompositionDidStart(this.handleCompositionDidStart),this.keyboardObserver.onCompositionDidEnd(this.handleCompositionDidEnd),this.pointerObserver=new Ln(t,o,e,i),this.pointerObserver.onPointerDidDown(this.handlePointerDidDown),this.pointerObserver.onPointerDidMove(this.handlePointerDidMove),this.pointerObserver.onPointerDidClick(this.handlePointerDidClick),this.focusObserver=new Mn(this.$contentEditable),this.focusObserver.onDidFocus(this.handleDidFocus),this.focusObserver.onDidBlur(this.handleDidBlur),this.clipboardObserver=new _n(this.$contentEditable),this.clipboardObserver.onDidCopy(this.handleCopy),this.clipboardObserver.onDidPaste(this.handlePaste)}return t.prototype.onDidPressKey=function(t){this.keyboardObserver.onDidPressKey(t)},t.prototype.onDidFocus=function(t){this.focusObserver.onDidFocus(t)},t.prototype.onDidBlur=function(t){this.focusObserver.onDidBlur(t)},t.prototype.attach=function(){var t=this;this.domService.getBody().appendChild(this.iframe),setTimeout(function(){t.iframe.contentDocument.body.appendChild(t.$contentEditable)})},t.prototype.requestFocus=function(){this.$contentEditable.focus()},t.prototype.requestBlur=function(){this.$contentEditable.blur()},t.prototype.isFocused=function(){return this.focused},t.prototype.isComposing=function(){return this.composing},t.prototype.createContentEditable=function(){var t=this.domService.createElement("div");return t.contentEditable="true",t.style.whiteSpace="pre",t},t}(),In=function(){function t(t,e,n,r,o){var i=this;this.instanceId=t,this.componentService=e,this.layoutService=n,this.renderService=r,this.domService=o,this.didUpdateViewStateEventEmitter=new Tt,this.domContainer=null;var a=n.getDoc(),s=r.getDoc();this.internalDoc=this.updateNode(null,a,s),n.onDidUpdateLayoutState(function(t){return i.handleDidUpdateLayoutStateEvent(t)})}return t.prototype.onDidUpdateViewState=function(t){return this.didUpdateViewStateEventEmitter.on(t)},Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.attach=function(t){this.domContainer=t,this.reattachDoc()},t.prototype.handleDidUpdateLayoutStateEvent=function(t){this.update()},t.prototype.update=function(){var t=this.layoutService.getDoc(),e=this.renderService.getDoc();this.internalDoc=this.updateNode(this.doc,t,e),this.reattachDoc(),this.didUpdateViewStateEventEmitter.emit({})},t.prototype.reattachDoc=function(){this.domContainer&&(this.domContainer.innerHTML="",this.domContainer.appendChild(this.doc.domContainer))},t.prototype.updateNode=function(t,e,n){var r=this;if(!e.needView&&t)return t;var o={};t&&t.children.forEach(function(t){t.layoutId&&(o[t.layoutId]=t)});var i={};n&&n.children.forEach(function(t){i[t.id]=t});var a=[];"text"!==e.type&&e.children.forEach(function(t){var e=o[t.id]||null,s=null;if(t.renderId&&!(s=i[t.renderId]||null))throw new Error("Render node not found.");a.push(r.updateNode(e,t,s||n))}),e.clearNeedView();var s=t?t.domContainer:this.domService.createContainer();return this.buildNode(s,e,n,a)},t.prototype.buildNode=function(t,e,n,r){switch(e.type){case"page":return this.buildPageNode(t,e,r);case"line":return this.buildLineNode(t,e,r)}var o=this.componentService.getComponent(n.componentId),i="text"===e.type?e.children.map(function(t){return t.text}).join(""):e.text,a=o.buildViewNode(t,n.partId,n.id,e.id,i,n.style,r,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);if(!a)throw new Error("Error building view node from render node "+n.id+".");return this.applyMetadataToDOMContainer(a),a},t.prototype.buildPageNode=function(t,e,n){var r=this.componentService.getPageComponent().buildViewNode(t,e.id,n,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);return this.applyMetadataToDOMContainer(r),r},t.prototype.buildLineNode=function(t,e,n){var r=this.componentService.getLineComponent().buildViewNode(t,e.id,n,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);return this.applyMetadataToDOMContainer(r),r},t.prototype.applyMetadataToDOMContainer=function(t){var e=t.domContainer,n=t.componentId,r=t.partId,o=t.id;e.className="tw--"+n+"--"+r,e.setAttribute("data-tw-instance",this.instanceId),n&&e.setAttribute("data-tw-component",n),r&&e.setAttribute("data-tw-part",r),e.setAttribute("data-tw-id",o)},t}(),Nn=function(){function t(t,e,n,r,o,i,a,s,c,u){this.state=new In(t,r,i,s,n),this.domController=new Rn(t,n,c,o,this,i),this.cursor=new kn(t,e,n,a,i,this,u)}return t.prototype.onDidUpdateViewState=function(t){this.state.onDidUpdateViewState(t)},t.prototype.onDidFocus=function(t){this.domController.onDidFocus(t)},t.prototype.onDidBlur=function(t){this.domController.onDidBlur(t)},t.prototype.onDidPressKey=function(t){this.domController.onDidPressKey(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.isFocused=function(){return this.domController.isFocused()},t.prototype.attach=function(t){this.state.attach(t),this.cursor.attach(),this.domController.attach()},t.prototype.requestFocus=function(){this.domController.requestFocus()},t.prototype.requestBlur=function(){this.domController.requestBlur()},t}(),Hn=function(){function t(t,e){this.instanceId=Object(st.a)(),this.serviceRegistry=new Tn,this.configService=new $e(this.buildBaseConfig(),e),this.serviceRegistry.registerService("config",this.configService),this.domService=new Xe,this.serviceRegistry.registerService("dom",this.domService),this.textService=new he(this.domService),this.serviceRegistry.registerService("text",this.textService),this.commandService=new zt(this.configService,this.serviceRegistry),this.serviceRegistry.registerService("command",this.commandService),this.componentService=new Ke(this.configService,this.serviceRegistry),this.serviceRegistry.registerService("component",this.componentService),this.modelService=new En(t,this.componentService),this.serviceRegistry.registerService("model",this.modelService),this.renderService=new Pn(this.componentService,this.modelService),this.serviceRegistry.registerService("render",this.renderService),this.cursorService=new Je(this.configService,this.renderService,this.modelService),this.serviceRegistry.registerService("cursor",this.cursorService),this.layoutService=new xn(this.renderService,this.textService),this.serviceRegistry.registerService("layout",this.layoutService),this.transformService=new jn(this.modelService,this.componentService,this.cursorService,this.renderService,this.layoutService),this.serviceRegistry.registerService("transform",this.transformService),this.viewService=new Nn(this.instanceId,this.configService,this.domService,this.componentService,this.modelService,this.layoutService,this.cursorService,this.renderService,this.commandService,this.transformService),this.serviceRegistry.registerService("view",this.viewService),this.historyService=new Ze(this.configService,this.transformService),this.serviceRegistry.registerService("history",this.historyService),this.keyBindingService=new nn(this.configService,this.commandService,this.viewService),this.serviceRegistry.registerService("keyBinding",this.keyBindingService)}return t.prototype.attach=function(t){this.viewService.attach(t)},t.prototype.getServiceRegistry=function(){return this.serviceRegistry},t.prototype.buildBaseConfig=function(){return{commands:{"tw.clipboard.copy":y,"tw.clipboard.paste":b,"tw.cursor.move":_,"tw.cursor.moveBackwardByLine":B,"tw.cursor.moveForwardByLine":L,"tw.cursor.moveBackward":M,"tw.cursor.moveForward":z,"tw.cursor.moveBackwardByWord":R,"tw.cursor.moveForwardByWord":I,"tw.cursor.moveToLineStart":N,"tw.cursor.moveToLineEnd":H,"tw.cursor.moveToDocStart":A,"tw.cursor.moveToDocEnd":F,"tw.cursor.moveHead":W,"tw.cursor.moveHeadBackwardByLine":K,"tw.cursor.moveHeadForwardByLine":$,"tw.cursor.moveHeadBackward":U,"tw.cursor.moveHeadForward":V,"tw.cursor.moveHeadBackwardByWord":G,"tw.cursor.moveHeadForwardByWord":q,"tw.cursor.moveHeadToLineStart":J,"tw.cursor.moveHeadToLineEnd":X,"tw.cursor.moveHeadToDocStart":Y,"tw.cursor.moveHeadToDocEnd":Q,"tw.cursor.selectAll":Z,"tw.cursor.selectWord":tt,"tw.cursor.selectBlock":et,"tw.history.undo":ot,"tw.history.redo":it,"tw.state.insert":wt,"tw.state.deleteBackward":Ot,"tw.state.deleteForward":St,"tw.state.breakLine":xt,"tw.view.focus":Dt,"tw.view.blur":Pt},components:{doc:re,paragraph:Ce,text:_e},cursor:{disable:!1,caretColor:"hsla(213, 100%, 50%, 1)",caretInactiveColor:"hsla(0, 0%, 0%, 0.5)",selectionColor:"hsla(213, 100%, 50%, 0.2)",selectionInactiveColor:"hsla(0, 0%, 0%, 0.08)"},history:{collapseThreshold:500,maxCollapseDuration:2e3},keyBindings:{common:{left:{command:"tw.cursor.moveBackward",preventDefault:!0},right:{command:"tw.cursor.moveForward",preventDefault:!0},up:{command:"tw.cursor.moveBackwardByLine",preventDefault:!0},down:{command:"tw.cursor.moveForwardByLine",preventDefault:!0},"shift+left":{command:"tw.cursor.moveHeadBackward",preventDefault:!0},"shift+right":{command:"tw.cursor.moveHeadForward",preventDefault:!0},"shift+up":{command:"tw.cursor.moveHeadBackwardByLine",preventDefault:!0},"shift+down":{command:"tw.cursor.moveHeadForwardByLine",preventDefault:!0},backspace:{command:"tw.state.deleteBackward",preventDefault:!0},delete:{command:"tw.state.deleteForward",preventDefault:!0},enter:{command:"tw.state.breakLine",preventDefault:!0}},macos:{"alt+left":{command:"tw.cursor.moveBackwardByWord"},"alt+right":{command:"tw.cursor.moveForwardByWord"},"shift+alt+left":{command:"tw.cursor.moveHeadBackwardByWord"},"shift+alt+right":{command:"tw.cursor.moveHeadForwardByWord"},"cmd+left":{command:"tw.cursor.moveToLineStart"},"cmd+right":{command:"tw.cursor.moveToLineEnd"},"cmd+up":{command:"tw.cursor.moveToDocStart"},"cmd+down":{command:"tw.cursor.moveToDocEnd"},"shift+cmd+left":{command:"tw.cursor.moveHeadToLineStart"},"shift+cmd+right":{command:"tw.cursor.moveHeadToLineEnd"},"shift+cmd+up":{command:"tw.cursor.moveHeadToDocStart"},"shift+cmd+down":{command:"tw.cursor.moveHeadToDocEnd"},"cmd+a":{command:"tw.cursor.selectAll"},"cmd+z":{command:"tw.history.undo",preventDefault:!0},"shift+cmd+z":{command:"tw.history.redo",preventDefault:!0}},windows:{"ctrl+left":{command:"tw.cursor.moveBackwardByWord"},"ctrl+right":{command:"tw.cursor.moveForwardByWord"},"ctrl+shift+left":{command:"tw.cursor.moveHeadBackwardByWord"},"ctrl+shift+right":{command:"tw.cursor.moveHeadForwardByWord"},home:{command:"tw.cursor.moveToLineStart"},end:{command:"tw.cursor.moveToLineEnd"},"ctrl+home":{command:"tw.cursor.moveToDocStart"},"ctrl+end":{command:"tw.cursor.moveToDocEnd"},"shift+home":{command:"tw.cursor.moveHeadToLineStart"},"shift+end":{command:"tw.cursor.moveHeadToLineEnd"},"ctrl+shift+home":{command:"tw.cursor.moveHeadToDocStart"},"ctrl+shift+end":{command:"tw.cursor.moveHeadToDocEnd"},"ctrl+a":{command:"tw.cursor.selectAll"},"ctrl+z":{command:"tw.history.undo",preventDefault:!0},"ctrl+shift+z":{command:"tw.history.redo",preventDefault:!0}},linux:{"ctrl+left":{command:"tw.cursor.moveBackwardByWord"},"ctrl+right":{command:"tw.cursor.moveForwardByWord"},"ctrl+shift+left":{command:"tw.cursor.moveHeadBackwardByWord"},"ctrl+shift+right":{command:"tw.cursor.moveHeadForwardByWord"},home:{command:"tw.cursor.moveToLineStart"},end:{command:"tw.cursor.moveToLineEnd"},"ctrl+home":{command:"tw.cursor.moveToDocStart"},"ctrl+end":{command:"tw.cursor.moveToDocEnd"},"shift+home":{command:"tw.cursor.moveHeadToLineStart"},"shift+end":{command:"tw.cursor.moveHeadToLineEnd"},"ctrl+shift+home":{command:"tw.cursor.moveHeadToDocStart"},"ctrl+shift+end":{command:"tw.cursor.moveHeadToDocEnd"},"ctrl+a":{command:"tw.cursor.selectAll"},"ctrl+z":{command:"tw.history.undo",preventDefault:!0},"ctrl+shift+z":{command:"tw.history.redo",preventDefault:!0}}},page:{width:816,height:1056,paddingTop:40,paddingBottom:40,paddingLeft:40,paddingRight:40}}},t}();function An(){var t=Object(h.a)(["\n    position: absolute;\n    bottom: 8px;\n    left: 9px;\n    right: 9px;\n    height: 3px;\n    background: ",";\n"]);return An=function(){return t},t}function Fn(){var t=Object(h.a)(["\n    -webkit-appearance: none;\n    border: none;\n    font-size: 12px;\n    font-weight: 500;\n    width: ","px;\n    background: white;\n    border-radius: 3px;\n    padding: 0 9px;\n    outline: none;\n    position: relative;\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    option {\n        color: rgba(0, 0, 0, 0.85);\n    }\n    ","\n"]);return Fn=function(){return t},t}function Wn(){var t=Object(h.a)(["\n    flex: 0 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    position: relative;\n    color: rgba(0, 0, 0, 0.85);\n    background: transparent;\n    padding: 0;\n    border: none;\n    border-radius: 3px;\n    outline: none;\n    &:after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 3px;\n        right: 3px;\n        height: 3px;\n    }\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    ","\n    ","\n"]);return Wn=function(){return t},t}function Un(){var t=Object(h.a)(["\n    flex: 0 0 auto;\n    display: flex;\n    border-radius: 4px;\n    padding: 0 6px;\n    position: relative;\n    &::before {\n        content: '';\n        position: absolute;\n        top: 9px;\n        bottom: 9px;\n        left: 0;\n        width: 1px;\n        background: rgba(0, 0, 0, 0.15);\n    }\n    &:last-child {\n        &::after {\n            content: '';\n            position: absolute;\n            top: 9px;\n            bottom: 9px;\n            right: 0;\n            width: 1px;\n            background: rgba(0, 0, 0, 0.15);\n        }\n    }\n"]);return Un=function(){return t},t}function Vn(){var t=Object(h.a)(["\n    display: flex;\n    margin: 0 auto;\n    width: 816px;\n"]);return Vn=function(){return t},t}function Kn(){var t=Object(h.a)(["\n    position: sticky;\n    top: 0;\n    padding: 3px 24px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.09);\n    z-index: 10;\n"]);return Kn=function(){return t},t}var $n=l.a.div(Kn()),Gn=l.a.div(Vn()),qn=l.a.div(Un()),Jn=l.a.button(Wn(),function(t){return t.disabled&&"\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    "},function(t){return t.active&&"\n        color: rgba(255, 0, 0, 1);\n        &:after {\n            background: rgba(255, 0, 0, 1);\n        }\n    "}),Xn=l.a.select(Fn(),function(t){return t.width},function(t){return t.disabled&&"\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    "}),Yn=l.a.div(An(),function(t){return t.color});function Qn(t){var e=t.getServiceRegistry().getService("cursor").getCursor(),n=e.anchor,r=e.head;return function t(e,n,r){var o=e.getServiceRegistry().getService("render").getStylesBetween(n,r);return o.text&&o.text.text?o.text.text:o.paragraph&&o.paragraph["line-break"]&&n===r?t(e,n-1,r-1):[]}(t,Math.min(n,r),Math.max(n,r))}function Zn(t){var e=t.taleweaver,n=Object(r.useState)([]),i=Object(p.a)(n,2),a=i[0],s=i[1],c=Object(r.useMemo)(function(){return function(t){s(Qn(t))}},[]);Object(r.useEffect)(function(){if(e){var t=e.getServiceRegistry().getService("cursor"),n=e.getServiceRegistry().getService("render");t.onDidUpdate(function(t){return c(e)}),n.onDidUpdateRenderState(function(t){return c(e)}),c(e)}},[e]);var u=1===new Set(a.map(function(t){return t.family})).size?a[0].family:null,d=1===new Set(a.map(function(t){return t.size})).size?a[0].size:null,f=1===new Set(a.map(function(t){return t.weight>400})).size&&a[0].weight>400,h=1===new Set(a.map(function(t){return t.italic})).size&&a[0].italic,l=1===new Set(a.map(function(t){return t.underline})).size&&a[0].underline,v=1===new Set(a.map(function(t){return t.strikethrough})).size&&a[0].strikethrough,g=1===new Set(a.map(function(t){return t.color})).size?a[0].color:null;return o.a.createElement($n,null,o.a.createElement(Gn,null,o.a.createElement(qn,null,o.a.createElement(Xn,{width:120,value:"Normal",disabled:!1,onChange:function(t){return null}},o.a.createElement("option",{value:"",style:{display:"none"}}),o.a.createElement("option",{value:"Normal"},"Normal text"),o.a.createElement("option",{value:"Title"},"Title"),o.a.createElement("option",{value:"Subtitle"},"Subtitle"),o.a.createElement("option",{value:"Heading 1"},"Heading 1"),o.a.createElement("option",{value:"Heading 2"},"Heading 2"),o.a.createElement("option",{value:"Heading 3"},"Heading 3"))),o.a.createElement(qn,null,o.a.createElement(Xn,{width:120,value:u||"",disabled:null===u,onChange:function(t){return null}},o.a.createElement("option",{value:"",style:{display:"none"}}),o.a.createElement("option",{value:"sans-serif"},"sans-serif"))),o.a.createElement(qn,null,o.a.createElement(Xn,{width:60,value:d?d.toString():"",disabled:null===d,onChange:function(t){return null}},o.a.createElement("option",{value:"",style:{display:"hidden"}}),o.a.createElement("option",{value:"10"},"10"),o.a.createElement("option",{value:"12"},"12"),o.a.createElement("option",{value:"14"},"14"),o.a.createElement("option",{value:"16"},"16"),o.a.createElement("option",{value:"18"},"18"),o.a.createElement("option",{value:"24"},"24"),o.a.createElement("option",{value:"30"},"30"),o.a.createElement("option",{value:"36"},"36"),o.a.createElement("option",{value:"42"},"42"))),o.a.createElement(qn,null,o.a.createElement(Jn,{active:f,disabled:!1,onClick:function(){return null}},o.a.createElement("i",{className:"mdi mdi-format-bold"})),o.a.createElement(Jn,{active:h,disabled:!1,onClick:function(){return null}},o.a.createElement("i",{className:"mdi mdi-format-italic"})),o.a.createElement(Jn,{active:l,disabled:!1,onClick:function(){return null}},o.a.createElement("i",{className:"mdi mdi-format-underline"})),o.a.createElement(Jn,{active:v,disabled:!1,onClick:function(){return null}},o.a.createElement("i",{className:"mdi mdi-format-strikethrough-variant"})),o.a.createElement(Jn,{active:!1,disabled:null===g,onClick:function(){return null}},o.a.createElement("i",{className:"mdi mdi-format-color-text",style:{position:"relative",top:"-2px"}}),o.a.createElement(Yn,{color:g||"transparent"})))))}function tr(){var t=Object(h.a)(["\n    text-align: center;\n    .tw--doc--doc {\n        font-family: 'Source Sans Pro', sans-serif;\n        display: inline-block;\n        padding-bottom: 9px;\n        counter-reset: page-counter;\n    }\n    .tw--page--page {\n        background: rgba(255, 255, 255, 1);\n        margin: 9px auto 0;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);\n        position: relative;\n        &::after {\n            counter-increment: page-counter;\n            content: 'Page ' counter(page-counter) '';\n            position: absolute;\n            top: 12px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px;\n            font-family: 'Quicksand', sans-serif;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.45);\n            pointer-events: none;\n        }\n        *::selection {\n            background: rgba(255, 255, 255, 1);\n        }\n    }\n"]);return tr=function(){return t},t}function er(){var t=Object(h.a)([""]);return er=function(){return t},t}var nr=l.a.div(er()),rr=l.a.div(tr());var or=function(t){t.initialMarkup;var e=t.config,n=Object(r.useRef)(null),i=Object(r.useState)(null),a=Object(p.a)(i,2),s=a[0],c=a[1];return Object(r.useEffect)(function(){var t={};e&&(t["tw.core"]=e);var n=new te("doc","doc",{},[new be("paragraph","p1",{},[new Te("text","t1","Hello world",{})])]);c(new Hn(n,t))},[]),Object(r.useEffect)(function(){s&&n.current&&s.attach(n.current)},[s,n.current]),o.a.createElement(nr,null,o.a.createElement(Zn,{taleweaver:s}),o.a.createElement(rr,{ref:n}))},ir='\n<doc {"id": "doc"}>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}", "weight": 700}>\n      Once upon a time there lived in a certain village a little country girl, the prettiest creature was ever seen. Her mother was excessively fond of her; and her grandmother doted on her still more. This good woman had made for her a little red riding-hood; which became the girl so extremely well that everybody called her Little Red Riding-Hood.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}", "italic": true}>\n      One day her mother, having made some custards, said to her:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}", "color": "rgba(255, 0, 0, 1)"}>\n      "Go, my dear, and see how thy grandmamma does, for I hear she has been very ill; carry her a custard, and this little pot of butter."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}", "size": 24}>\n      Little Red Riding-Hood set out immediately to go to her grandmother, who lived in another village.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}", "strikethrough": true, "underline": true}>\n      As she was going through the wood, she met with Gaffer Wolf, who had a very great mind to eat her up, but he dared not, because of some faggot-makers hard by in the forest. He asked her whither she was going. The poor child, who did not know that it was dangerous to stay and hear a wolf talk, said to him:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "I am going to see my grandmamma and carry her a custard and a little pot of butter from my mamma."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Does she live far off?" said the Wolf.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Oh! ay," answered Little Red Riding-Hood; "it is beyond that mill you see there, at the first house in the village."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Well," said the Wolf, "and I\'ll go and see her too. I\'ll go this way and you go that, and we shall see who will be there soonest."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      The Wolf began to run as fast as he could, taking the nearest way, and the little girl went by that farthest about, diverting herself in gathering nuts, running after butterflies, and making nosegays of such little flowers as she met with. The Wolf was not long before he got to the old woman\'s house. He knocked at the door--tap, tap.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Who\'s there?"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Your grandchild, Little Red Riding-Hood," replied the Wolf, counterfeiting her voice; "who has brought you a custard and a little pot of butter sent you by mamma."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      The good grandmother, who was in bed, because she was somewhat ill, cried out\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Pull the bobbin, and the latch will go up."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      The Wolf pulled the bobbin, and the door opened, and then presently he fell upon the good woman and ate her up in a moment, for it was above three days that he had not touched a bit. He then shut the door and went into the grandmother\'s bed, expecting Little Red Riding- Hood, who came some time afterward and knocked at the door--tap, tap.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Who\'s there?"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      Little Red Riding-Hood, hearing the big voice of the Wolf, was at first afraid; but believing her grandmother had got a cold and was hoarse, answered:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      " \'Tis your grandchild, Little Red Riding-Hood, who has brought you a custard and a little pot of butter mamma sends you."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      The Wolf cried out to her, softening his voice as much as he could:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Pull the bobbin, and the latch will go up."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      Little Red Riding-Hood pulled the bobbin, and the door opened.\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      The Wolf, seeing her come in, said to her, hiding himself under the bed-clothes:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Put the custard and the little pot of butter upon the stool, and come and lie down with me."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      Little Red Riding-Hood undressed herself and went into bed, where, being greatly amazed to see how her grandmother looked in her night-clothes, she said to her:\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Grandmamma, what great arms you have got!"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "That is the better to hug thee, my dear."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Grandmamma, what great legs you have got!"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "That is to run the better, my child."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Grandmamma, what great ears you have got!"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "That is to hear the better, my child."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Grandmamma, what great eyes you have got!"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "It is to see the better, my child."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "Grandmamma, what great teeth you have got!"\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      "That is to eat thee up."\n    </>\n  </>\n  <paragraph {"id": "{{id}}"}>\n    <text {"id": "{{id}}"}>\n      And, saying these words, this wicked wolf fell upon Little Red Riding-Hood, and ate her all up.\n    </>\n  </>\n</>\n'.split("\n").map(function(t){return t.trim()}).join("").replace(/{{id}}/g,function(){return"".concat(Math.random().toString(36).substring(2))});function ar(){var t=Object(h.a)(["\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    color: rgba(0, 0, 0, 0.65);\n    border-top: 1px solid rgba(0, 0, 0, 0.45);\n    padding-top: 10px;\n    cursor: default;\n"]);return ar=function(){return t},t}function sr(){var t=Object(h.a)(["\n    text-align: center;\n    margin-top: 90px;\n"]);return sr=function(){return t},t}function cr(){var t=Object(h.a)(["\n    display: inline-block;\n    padding: 15px 60px;\n    outline: none;\n    color: rgba(0, 0, 0, 0.85);\n    text-decoration: none;\n    font-size: 20px;\n    background: transparent;\n    border-radius: 3px;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    &:hover {\n        color: rgba(0, 0, 0, 1);\n        background: rgba(0, 0, 0, 0.04);\n        border-color: rgba(0, 0, 0, 0.25);\n    }\n"]);return cr=function(){return t},t}function ur(){var t=Object(h.a)(["\n    margin-top: 90px;\n"]);return ur=function(){return t},t}function dr(){var t=Object(h.a)(["\n    font-size: 20px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 30px 0 0;\n"]);return dr=function(){return t},t}function fr(){var t=Object(h.a)(["\n    font-size: 30px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 90px 0 0;\n"]);return fr=function(){return t},t}function hr(){var t=Object(h.a)(["\n    color: rgba(0, 0, 0, 0.65);\n    font-size: 42px;\n    letter-spacing: 0.02em;\n    padding-bottom: 10px;\n    border-bottom: 2px solid rgba(0, 0, 0, 0.65);\n"]);return hr=function(){return t},t}function lr(){var t=Object(h.a)([""]);return lr=function(){return t},t}function pr(){var t=Object(h.a)(["\n    text-align: center;\n    padding: 90px 60px 30px;\n"]);return pr=function(){return t},t}function vr(){var t=Object(h.a)([""]);return vr=function(){return t},t}var gr=l.a.div(vr()),mr=l.a.div(pr()),yr=l.a.div(lr()),br=l.a.span(hr()),wr=l.a.h1(fr()),Or=l.a.h2(dr()),Sr=l.a.div(ur()),xr=l.a.a(cr()),Cr=l.a.div(sr()),Er=l.a.span(ar()),Dr=function(t){function e(){return Object(s.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return o.a.createElement(gr,null,o.a.createElement(mr,null,o.a.createElement(yr,null,o.a.createElement(br,null,"Taleweaver")),o.a.createElement(wr,null,"Word processing in your browser."),o.a.createElement(Or,null,"Open source editor delivering true word processing experience."),o.a.createElement(Sr,null,o.a.createElement(xr,{href:"https://github.com/yuzhenmi/taleweaver"},"GitHub")),o.a.createElement(Cr,null,o.a.createElement(Er,null,"\u2193 Check it out \u2193"))),o.a.createElement(or,{initialMarkup:ir,config:{page:{width:816,height:1056,paddingTop:60,paddingBottom:60,paddingLeft:60,paddingRight:60}}}))}}]),e}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(Dr,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},91:function(t,e,n){t.exports=n(188)},96:function(t,e,n){},97:function(t,e,n){}},[[91,1,2]]]);
//# sourceMappingURL=main.0f57b13a.chunk.js.map