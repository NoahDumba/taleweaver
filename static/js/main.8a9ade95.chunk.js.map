{"version":3,"sources":["../../../packages/core/dist/tw/util/id.js","../../../packages/core/dist/tw/command/handlers/clipboard.js","../../../packages/core/dist/tw/util/dom.js","../../../packages/core/dist/tw/transform/transformation.js","../../../packages/core/dist/tw/command/handlers/cursor.js","../../../packages/core/dist/tw/command/handlers/history.js","../../../packages/core/dist/tw/model/change/change.js","../../../packages/core/dist/tw/model/change/mapping.js","../../../packages/core/dist/tw/model/change/applyAttribute.js","../../../packages/core/dist/tw/model/change/mutator.js","../../../packages/core/dist/tw/model/change/inserter.js","../../../packages/core/dist/tw/model/fragment.js","../../../packages/core/dist/tw/model/change/remover.js","../../../packages/core/dist/tw/model/change/replace.js","../../../packages/core/dist/tw/command/handlers/state.js","../../../packages/core/dist/tw/command/handlers/view.js","../../../packages/core/dist/tw/event/emitter.js","../../../packages/core/dist/tw/command/registry.js","../../../packages/core/dist/tw/command/service.js","../../../packages/core/dist/tw/tree/node-list.js","../../../packages/core/dist/tw/tree/node.js","../../../packages/core/dist/tw/tree/position.js","../../../packages/core/dist/tw/model/node.js","../../../packages/core/dist/tw/model/root.js","../../../packages/core/dist/tw/render/node.js","../../../packages/core/dist/tw/render/doc.js","../../../packages/core/dist/tw/view/node.js","../../../packages/core/dist/tw/view/doc.js","../../../packages/core/dist/tw/component/component.js","../../../packages/core/dist/tw/component/components/doc.js","../../../packages/core/dist/tw/model/branch.js","../../../packages/core/dist/tw/render/block.js","../../../packages/core/dist/tw/render/text.js","../../../packages/core/dist/tw/text/service.js","../../../packages/core/dist/tw/view/block.js","../../../packages/core/dist/tw/view/text.js","../../../packages/core/dist/tw/component/components/paragraph.js","../../../packages/core/dist/tw/model/leaf.js","../../../packages/core/dist/tw/component/components/text.js","../../../packages/core/dist/tw/view/line.js","../../../packages/core/dist/tw/component/line-component.js","../../../packages/core/dist/tw/component/components/line.js","../../../packages/core/dist/tw/view/page.js","../../../packages/core/dist/tw/component/page-component.js","../../../packages/core/dist/tw/component/components/page.js","../../../packages/core/dist/tw/component/registry.js","../../../packages/core/dist/tw/component/service.js","../../../packages/core/dist/tw/config/service.js","../../../packages/core/dist/tw/cursor/state.js","../../../packages/core/dist/tw/cursor/service.js","../../../packages/core/dist/tw/dom/service.js","../../../packages/core/dist/tw/history/action.js","../../../packages/core/dist/tw/history/state.js","../../../packages/core/dist/tw/history/service.js","../../../packages/core/dist/tw/util/platform.js","../../../packages/core/dist/tw/key-binding/service.js","../../../packages/core/dist/tw/layout/node.js","../../../packages/core/dist/tw/layout/atom.js","../../../packages/core/dist/tw/layout/block.js","../../../packages/core/dist/tw/layout/doc.js","../../../packages/core/dist/tw/layout/line.js","../../../packages/core/dist/tw/layout/page.js","../../../packages/core/dist/tw/layout/text.js","../../../packages/core/dist/tw/layout/word.js","../../../packages/core/dist/tw/layout/engine.js","../../../packages/core/dist/tw/layout/state.js","../../../packages/core/dist/tw/layout/service.js","../../../packages/core/dist/tw/model/state.js","../../../packages/core/dist/tw/model/service.js","../../../packages/core/dist/tw/render/state.js","../../../packages/core/dist/tw/render/service.js","../../../packages/core/dist/tw/service/registry.js","../../../packages/core/dist/tw/transform/service.js","../../../packages/core/dist/tw/view/cursor.js","../../../packages/core/dist/tw/view/clipboard-observer.js","../../../packages/core/dist/tw/view/focus-observer.js","../../../packages/core/dist/tw/view/keyboard-observer.js","../../../packages/core/dist/tw/view/pointer-observer.js","../../../packages/core/dist/tw/view/dom-controller.js","../../../packages/core/dist/tw/view/state.js","../../../packages/core/dist/tw/view/service.js","../../../packages/core/dist/tw/taleweaver.js","Editor/ToolBar.tsx","Editor/Editor.tsx","Editor/index.ts","../../../packages/core/dist/tw/util/serialize.js","samples/littleRedRidingHood.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["bytes16","Uint8Array","generateId","Buffer","from","String","fromCharCode","apply","Array","crypto","randomFillSync","toString","iframe","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","window","document","createElement","scrolling","src","style","width","height","border","position","zIndex","opacity","overflow","left","top","createHiddenIframe","appendChild","copy","serviceRegistry","cursorService","renderService","modelService","_a","anchor","head","html","iframeDocument","_b","getService","hasCursor","getCursor","toDOM","convertOffsetToModelOffset","Math","min","max","outerHTML","contentDocument","innerHTML","execCommand","paste","__spreadArrays","s","i","il","arguments","r","k","a","j","jl","Transformation","changes","modelCursorHead","modelCursorAnchor","keepLeftLock","prototype","layoutService","originalCursorModelAnchor","undefined","originalCursorModelHead","changeResults","applyChanges","cursorAnchor","cursorHead","convertModelOffsetToOffset","boundModelOffset","boundOffset","setCursor","_c","resolvePosition","atLineDepth","line","node","lineOffset","offset","setLeftLock","resolveBoundingBoxes","boundingBoxes","reverseChanges","reverseMappings","changeResult","reduce","reverseChange","reverseMapping","map","mapping","reverse","TransformationResult","mappings","_loop_1","change","shift","applyChange","c","getRootSize","getDocSize","transformation","reverseTransformation","atPreviousLine","leftLock","previousLine","previousCrossParentSibling","size","convertCoordinatesToOffset","atNextLine","nextLine","nextCrossParentSibling","atPreviousWord","atReverseDepth","word","wordOffset","previousWord","atNextWord","whitespaceSize","nextWord","atLineStart","atLineEnd","move","transformService","modelOffset","applyTransformation","moveBackward","newModelOffset","newOffset","moveForward","moveBackwardByLine","moveForwardByLine","moveBackwardByWord","moveForwardByWord","moveToLineStart","moveToLineEnd","moveToDocStart","moveToDocEnd","moveHead","modelAnchor","newModelHead","moveHeadBackward","moveHeadForward","moveHeadBackwardByLine","newHead","moveHeadForwardByLine","moveHeadBackwardByWord","moveHeadForwardByWord","moveHeadToLineStart","moveHeadToLineEnd","moveHeadToDocStart","moveHeadToDocEnd","selectAll","newModelAnchor","selectWord","newAnchor","selectBlock","block","blockOffset","atBlockDepth","undo","redo","ModelChange","Mapping","oldSize","newSize","Error","mapRender","identity","__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","p","hasOwnProperty","__","constructor","create","ApplyAttribute","_super","path","key","_this","root","componentService","slice","id","childNode","children","find","child","originalValue","applyAttribute","Mutator","ran","inProgress","run","joinNodes","node1","node2","leaf","replace","text","parent","filter","Inserter","fragments","internalInsertedSize","depth","current","index","defineProperty","get","enumerable","configurable","state","handleText","handleSplit","handleLeave","handleNode","handleEnd","currentFragment","content","insertedSize","splitNode","joinNodeWithNextSibling","joinNodeWithPreviousSibling","component","getComponent","componentId","buildModelNode","partId","substring","attributes","atDepth","indexOf","nextSibling","canJoin","previousSibling","Fragment","isArray","contentType","Remover","to","removedFragments","nodeFrom","nodeTo","updateCurrentNode","handleFullNode","handlePartialNode","handleForward","handleEnter","stepUp","removeFrom","nodesToRemove","removeToOffset","at","removeTo","recordRemovedNodes","stepDown","removedText","recordRemovedText","stepForward","parentNode","nodeOffset","nextNode","nodes","getOffsetToRoot","childNodeToJoin","firstChild","getOffsetToParent","ReplaceChange","validateInput","validateFit","remover","inserter","ascending","descending","nn","fragment","fromPosition","insert","modelFrom","modelTo","deleteBackward","deleteForward","breakLine","attributeKey","attributeValue","findNodesByComponentIdAndPartId","searchFrom","searchTo","cumulatedOffset","forEach","searchChildFrom","searchChildTo","getRoot","currentNode","unshift","buildPath","focus","requestFocus","blur","requestBlur","EventEmitter","listeners","on","listener","dispose","splice","emit","event","CommandRegistry","commandsMap","Map","registerCommand","commandId","commandHandler","set","getCommandHandler","CommandService","configService","willExecuteCommandEventEmitter","didExecuteCommandEventEmitter","registry","_i","entries","getConfig","commands","onWillExecuteCommand","onDidExecuteCommand","executeCommand","args","NodeList","findIndex","callbackFn","initialValue","callbackfn","start","end","Node","internalChildren","siblings","ownIndex","parentPreviousSibling","lastChild","parentNextSibling","findDescendant","Position","depths","reverseDepth","ModelNode","internalNeedRender","childDidUpdateDisposableMap","didUpdateEventEmitter","handleChildDidUpdate","internalText","onDidUpdate","internalSize","clearNeedRender","replacedContent","ModelPosition","childSize","childPosition","m","ModelRoot","RenderNode","modelId","internalNeedLayout","pseudo","internalChildrenModelSize","modelSize","clearNeedLayout","RenderPosition","cumulatedSize","cumulatedModelSize","childModelSize","RenderDoc","ViewNode","domContainer","renderId","layoutId","domService","ViewDoc","attached","Component","ModelDoc","$element","childFrom","childTo","$childElement","paddingTop","paddingBottom","paddingLeft","paddingRight","AbstractRenderDoc","textAlign","cursor","userSelect","domContentContainer","setAttribute","AbstractViewDoc","DocComponent","buildRenderNode","pageConfig","page","buildViewNode","ModelBranch","RenderBlock","RenderText","DEFAULT_FONT","weight","family","letterSpacing","underline","italic","strikethrough","color","BREAKABLE_CHARS","TextService","$canvas","measure","font","fontWithDefault","applyDefaultFont","ctx","getContext","fixFontFamily","measurement","measureText","breakIntoWords","words","char","includes","fontConfigWithDefault","fontFamily","ViewBlock","ViewText","ModelParagraph","RenderParagraph","RenderParagraphLineBreak","paragraphModelId","type","ViewParagraph","lineHeight","ViewParagraphLineBreak","ParagraphComponent","ModelLeaf","ModelText","JSON","stringify","$component","innerText","textService","AbstractRenderText","display","whiteSpace","fontSize","fontWeight","textDecoration","fontStyle","findOrCreateDOMContentContainer","getAttribute","AbstractViewText","TextComponent","ViewLine","LineComponent","AbstractViewLine","AbstractLineComponent","ViewPage","PageComponent","marginLeft","marginRight","AbstractViewPage","AbstractPageComponent","ComponentRegistry","componentsMap","registerComponent","registerPageComponent","pageComponent","registerLineComponent","lineComponent","getPageComponent","getLineComponent","ComponentService","components","ConfigService","config","externalConfig","applyExternalConfig","coreConfig","__assign","assign","CursorState","internalCursor","disable","assertCursor","CursorService","DOMService","getWindow","getDocument","getBody","tagName","createContainer","container","createMutationObserver","callback","MutationObserver","HistoryAction","internalTransformationResults","beganAt","Date","now","internalEndedAt","recordTransformationResult","transformationResult","transformationResults","HistoryState","actions","handleDidApplyTransformation","some","tnResult","recordToNewAction","currentItem","maxCollapseDuration","endedAt","collapseThreshold","recordToLastAction","history","onDidApplyTransformation","action","consumeNextUndoableAction","results","consumeNextRedoableAction","HistoryService","detectPlatform","navigator","platform","startsWith","KeyBindingService","commandService","viewService","keyBindings","handleDidPressKey","keyBinding","preventDefault","originalKeyboardEvent","command","keyBindingsConfig","bindKeys","common","macos","windows","linux","onDidPressKey","binding","LayoutNode","internalNeedView","paddingHorizontal","paddingVertical","clearNeedView","LayoutPosition","LayoutAtom","x","innerWidth","innerHeight","right","bottom","LayoutBlock","internalHeight","cumulatedHeight","childHeight","childResults","childFrom_1","childTo_1","childResult","boundingBox","LayoutDoc","LayoutLine","internalContentWidth","contentWidth","cumulatedWidth","childWidth","lastWord","left1","left2","box","LayoutPage","internalContentHeight","contentHeight","contentX","contentY","LayoutText","internalWidth","internalTrimmedWidth","trimmedWidth","LayoutWord","trimmedText","lastWidth","width_1","breakAt","LayoutEngine","updateDoc","doc","renderDoc","needLayout","pages","childrenMap","newChildren","updateBlock","buildDoc","reflowPages","blocks","renderBlock","lines","blocks_1","renderChild","updateText","updateAtom","buildBlock","reflowLines","texts","renderText","buildWord","buildText","atoms","renderAtom","buildAtom","newPages","reflowNeeded","currentHeight","nodeChildren","mm","nodeChild","newPage","newLines","currentWidth","newNodeChildren","brokenNodeChild1","brokenNodeChild2","newLine","LayoutState","didUpdateLayoutStateEventEmitter","engine","internalDoc","getDoc","onDidUpdateRenderState","handleDidUpdateRenderStateEvent","onDidUpdateLayoutState","update","LayoutService","ModelState","ModelService","fromDOM","domNodes","onDidUpdateModelState","RenderState","didUpdateRenderStateEventEmitter","modelRoot","updateNode","handleDidUpdateModelState","modelNode","needRender","modelChild","buildNode","RenderService","getStylesBetween","styles","extractStyle","componentStyles","ServiceRegistry","services","registerService","service","TransformService","didApplyTransformationEventEmitter","tn","CursorView","instanceId","blinkInterval","blinkState","domSelections","cursorConfig","caretColor","caretInactiveColor","selectionColor","selectionInactiveColor","domCaret","className","pointerEvents","onDidFocus","handleDidFocus","onDidBlur","handleDidBlur","attach","updateView","clearDOMSelections","headPageId","headLeft","headTop","headHeight","rect","docBoxResult","viewDoc","layoutDoc","focused","isFocused","firstPageId","firstBoxOffset","lastPageId","lastBoxOffset","pageBoxResult","pageOffset","boxOffset","domSelection","buildDOMSelection","background","pageDOMContentContainer","parentElement","removeChild","blinkStop","blinkStart","setInterval","updateDOMBlink","visibility","clearInterval","ClipboardObserver","$contentEditable","didCopyEventEmitter","didPasteEventEmitter","handleCopy","handlePaste","data","clipboardData","addEventListener","onDidCopy","onDidPaste","FocusObserver","didFocusEventEmitter","didBlurEventEmitter","handleFocus","handleBlur","KeyboardObserver","composing","didInsertEventEmitter","didPressKeyEventEmitter","compositionDidStartEventEmitter","compositionDidEndEventEmitter","keyInterpreter","KeyInterpreter","handleDidMutate","setTimeout","handleKeyDown","interpretFromKeyboardEvent","handleCompositionStart","handleCompositionEnd","mutationObserver","observe","subtree","characterData","childList","onDidInsert","onCompositionDidStart","onCompositionDidEnd","toLowerCase","metaKey","altKey","shiftKey","ctrlKey","PointerObserver","clickThreshold","consecutiveClickThreshold","lastPointerDown","lastClick","consecutiveClickCount","pointerDidDownEventEmitter","pointerDidMoveEventEmitter","pointerDidUpEventEmitter","pointerDidClickEventEmitter","handleMouseDown","resolveOffset","clientX","clientY","timestamp","consecutive","handleMouseMove","pointerDown","handleMouseUp","clicked","consecutiveCount","onPointerDidDown","onPointerDidMove","onPointerDidUp","onPointerDidClick","viewPage","layoutPage","pageBoundingClientRect","getBoundingClientRect","pageX","pageY","DOMController","mouseDown","handleDidInsert","handleCompositionDidStart","handleCompositionDidEnd","handlePointerDidDown","handlePointerDidMove","handlePointerDidClick","getData","$container","$body","querySelector","modelNodes","console","log","createContentEditable","keyboardObserver","pointerObserver","focusObserver","clipboardObserver","isComposing","contentEditable","ViewState","didUpdateViewStateEventEmitter","handleDidUpdateLayoutStateEvent","onDidUpdateViewState","reattachDoc","layoutNode","renderNode","needView","renderChildrenMap","layoutChild","buildPageNode","buildLineNode","join","applyMetadataToDOMContainer","viewNode","ViewService","domController","Taleweaver","buildBaseConfig","historyService","keyBindingService","setContent","getServiceRegistry","clipboardCommandHandlers","cursorCommandHandlers","historyCommandHandlers","stateCommandHandlers","viewCommandHandlers","paragraph","up","down","backspace","delete","enter","home","Wrapper","styled","div","Container","Group","Item","button","disabled","active","SelectItem","select","ItemColorLine","getTextStyles","taleweaver","getTextStylesByRange","ToolBar","useState","textStyles","setTextStyles","updateTextStyle","useCallback","useEffect","Set","bold","onChange","onClick","EditorWrapper","initialDoc","containerRef","useRef","setTaleweaver","mergedConfig","parse","ref","Hero","BrandWrapper","Brand","span","Tagline","h1","SupportingTagline","h2","Links","Link","DemoHintWrapper","DemoHint","App","React","render","href","sample","Boolean","location","hostname","match","ReactDOM","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.8a9ade95.chunk.js","sourcesContent":["import crypto from 'crypto';\nvar bytes16 = new Uint8Array(16);\nfunction generateRandomBytes16() {\n    return crypto.randomFillSync(bytes16);\n}\nexport function generateId() {\n    return Buffer.from(String.fromCharCode.apply(String, Array.from(generateRandomBytes16()))).toString('base64');\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { createHiddenIframe, isDOMAvailable } from '../../util/dom';\nvar iframe;\nif (isDOMAvailable()) {\n    iframe = createHiddenIframe();\n    document.body.appendChild(iframe);\n}\nexport var copy = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var cursorService, renderService, modelService, _a, anchor, head, html, iframeDocument;\n    return __generator(this, function (_b) {\n        if (!iframe) {\n            return [2 /*return*/];\n        }\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        modelService = serviceRegistry.getService('model');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            return [2 /*return*/];\n        }\n        html = modelService.toDOM(renderService.convertOffsetToModelOffset(Math.min(anchor, head)), renderService.convertOffsetToModelOffset(Math.max(anchor, head))).outerHTML;\n        iframeDocument = iframe.contentDocument;\n        if (!iframeDocument) {\n            return [2 /*return*/];\n        }\n        iframeDocument.body.innerHTML = html;\n        iframeDocument.execCommand('selectAll');\n        iframeDocument.execCommand('copy');\n        iframeDocument.body.innerHTML = '';\n        return [2 /*return*/];\n    });\n}); };\nexport var paste = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        return [2 /*return*/];\n    });\n}); };\n","export function isDOMAvailable() {\n    return typeof window !== 'undefined';\n}\nexport function createHiddenIframe() {\n    var iframe = document.createElement('iframe');\n    iframe.scrolling = 'no';\n    iframe.src = 'about:blank';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = 'none';\n    iframe.style.position = 'fixed';\n    iframe.style.zIndex = '-1';\n    iframe.style.opacity = '0';\n    iframe.style.overflow = 'hidden';\n    iframe.style.left = '-1000000px';\n    iframe.style.top = '-1000000px';\n    return iframe;\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar Transformation = /** @class */ (function () {\n    function Transformation(changes, modelCursorHead, modelCursorAnchor, keepLeftLock) {\n        if (keepLeftLock === void 0) { keepLeftLock = false; }\n        this.changes = changes;\n        this.modelCursorHead = modelCursorHead;\n        this.modelCursorAnchor = modelCursorAnchor;\n        this.keepLeftLock = keepLeftLock;\n    }\n    Transformation.prototype.apply = function (modelService, cursorService, renderService, layoutService) {\n        var originalCursorModelAnchor = undefined;\n        var originalCursorModelHead = undefined;\n        if (cursorService.hasCursor()) {\n            var _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n            originalCursorModelAnchor = renderService.convertOffsetToModelOffset(anchor);\n            originalCursorModelHead = renderService.convertOffsetToModelOffset(head);\n        }\n        var changeResults = this.applyChanges(modelService);\n        if (cursorService.hasCursor()) {\n            var _b = cursorService.getCursor(), cursorAnchor = _b.anchor, cursorHead = _b.head;\n            if (this.modelCursorHead !== undefined) {\n                cursorHead = renderService.convertModelOffsetToOffset(this.boundModelOffset(this.modelCursorHead, modelService));\n                cursorAnchor = cursorHead;\n                if (this.modelCursorAnchor !== undefined) {\n                    cursorAnchor = renderService.convertModelOffsetToOffset(this.boundModelOffset(this.modelCursorAnchor, modelService));\n                }\n            }\n            cursorAnchor = this.boundOffset(cursorAnchor, renderService);\n            cursorHead = this.boundOffset(cursorHead, renderService);\n            cursorService.setCursor(cursorAnchor, cursorHead);\n            if (!this.keepLeftLock) {\n                var _c = layoutService\n                    .resolvePosition(cursorService.getCursor().head)\n                    .atLineDepth(), line = _c.node, lineOffset = _c.offset;\n                cursorService.setLeftLock(line.resolveBoundingBoxes(lineOffset, lineOffset).boundingBoxes[0].left);\n            }\n        }\n        var reverseChanges = [];\n        var reverseMappings = [];\n        for (var n = changeResults.length - 1; n >= 0; n--) {\n            var changeResult = changeResults[n];\n            reverseChanges.push(reverseMappings.reduce(function (reverseChange, reverseMapping) { return reverseChange.map(reverseMapping); }, changeResult.reverseChange));\n            reverseMappings.push(changeResult.mapping.reverse());\n        }\n        return new TransformationResult(this, changeResults, new Transformation(reverseChanges, originalCursorModelHead, originalCursorModelAnchor, this.keepLeftLock));\n    };\n    Transformation.prototype.applyChanges = function (modelService) {\n        var changeResults = [];\n        var mappings = [];\n        var changes = __spreadArrays(this.changes);\n        var _loop_1 = function () {\n            var change = changes.shift();\n            var changeResult = modelService.applyChange(change);\n            var mapping = changeResult.mapping;\n            mappings.push(mapping);\n            changes = changes.map(function (c) { return c.map(mapping); });\n            changeResults.push(changeResult);\n        };\n        while (changes.length > 0) {\n            _loop_1();\n        }\n        return changeResults;\n    };\n    Transformation.prototype.boundModelOffset = function (offset, modelService) {\n        return Math.max(0, Math.min(modelService.getRootSize() - 1, offset));\n    };\n    Transformation.prototype.boundOffset = function (offset, renderService) {\n        return Math.max(0, Math.min(renderService.getDocSize() - 1, offset));\n    };\n    return Transformation;\n}());\nexport { Transformation };\nvar TransformationResult = /** @class */ (function () {\n    function TransformationResult(transformation, changeResults, reverseTransformation) {\n        this.transformation = transformation;\n        this.changeResults = changeResults;\n        this.reverseTransformation = reverseTransformation;\n    }\n    return TransformationResult;\n}());\nexport { TransformationResult };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Transformation } from '../../transform/transformation';\nfunction atPreviousLine(offset, leftLock, layoutService) {\n    var _a = layoutService.resolvePosition(offset).atLineDepth(), line = _a.node, lineOffset = _a.offset;\n    var previousLine = line.previousCrossParentSibling;\n    if (!previousLine) {\n        return offset - lineOffset;\n    }\n    return offset - lineOffset - previousLine.size + previousLine.convertCoordinatesToOffset(leftLock, 0);\n}\nfunction atNextLine(offset, leftLock, layoutService) {\n    var _a = layoutService.resolvePosition(offset).atLineDepth(), line = _a.node, lineOffset = _a.offset;\n    var nextLine = line.nextCrossParentSibling;\n    if (!nextLine) {\n        return offset - lineOffset + line.size - 1;\n    }\n    return offset - lineOffset + line.size + nextLine.convertCoordinatesToOffset(leftLock, 0);\n}\nfunction atPreviousWord(offset, layoutService) {\n    var _a = layoutService.resolvePosition(offset).atReverseDepth(0), word = _a.node, wordOffset = _a.offset;\n    if (wordOffset > 0) {\n        return offset - wordOffset;\n    }\n    var previousWord = word.previousCrossParentSibling;\n    if (!previousWord) {\n        return offset;\n    }\n    return offset - previousWord.size;\n}\nfunction atNextWord(offset, layoutService) {\n    var _a = layoutService.resolvePosition(offset).atReverseDepth(0), word = _a.node, wordOffset = _a.offset;\n    if (wordOffset < word.size - 1) {\n        return offset - wordOffset + word.size - word.whitespaceSize;\n    }\n    var nextWord = word.nextCrossParentSibling;\n    if (!nextWord) {\n        return offset;\n    }\n    return offset - wordOffset + word.size + nextWord.size - nextWord.whitespaceSize;\n}\nfunction atLineStart(offset, layoutService) {\n    var lineOffset = layoutService.resolvePosition(offset).atLineDepth().offset;\n    if (lineOffset === 0) {\n        return offset;\n    }\n    return offset - lineOffset;\n}\nfunction atLineEnd(offset, layoutService) {\n    var _a = layoutService.resolvePosition(offset).atLineDepth(), line = _a.node, lineOffset = _a.offset;\n    if (lineOffset >= line.size - 1) {\n        return offset;\n    }\n    return offset - lineOffset + line.size - 1;\n}\nexport var move = function (serviceRegistry, offset) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, modelOffset;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        modelOffset = renderService.convertOffsetToModelOffset(offset);\n        transformService.applyTransformation(new Transformation([], modelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelOffset, newOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelOffset = renderService.convertOffsetToModelOffset(anchor - 1);\n        }\n        else {\n            newOffset = Math.min(anchor, head);\n            newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        }\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelOffset, newOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelOffset = renderService.convertOffsetToModelOffset(anchor + 1);\n        }\n        else {\n            newOffset = Math.max(anchor, head);\n            newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        }\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        offset = Math.min(anchor, head);\n        newOffset = atPreviousLine(offset, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset, newModelOffset, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        offset = Math.max(anchor, head);\n        newOffset = atNextLine(offset, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset, newModelOffset, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        offset = Math.min(anchor, head);\n        newOffset = atPreviousWord(offset, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        offset = Math.max(anchor, head);\n        newOffset = atNextWord(offset, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        offset = Math.min(anchor, head);\n        newOffset = atLineStart(offset, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, offset, newOffset, renderService, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        offset = Math.max(anchor, head);\n        newOffset = atLineEnd(offset, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newOffset, newModelOffset;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newOffset = 0;\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newOffset, newModelOffset;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newOffset = renderService.getDocSize() - 1;\n        newModelOffset = renderService.convertOffsetToModelOffset(newOffset);\n        transformService.applyTransformation(new Transformation([], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHead = function (serviceRegistry, offset) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(offset);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(head - 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(head + 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atPreviousLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atNextLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atPreviousWord(head, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atNextWord(head, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineStart(head, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineEnd(head, layoutService);\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = 0;\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = renderService.getDocSize() - 1;\n        modelAnchor = renderService.convertOffsetToModelOffset(anchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectAll = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, newAnchor, newHead, newModelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        newAnchor = 0;\n        newHead = renderService.getDocSize() - 1;\n        newModelAnchor = renderService.convertOffsetToModelOffset(newAnchor);\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectWord = function (serviceRegistry, offset) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, word, wordOffset, previousWord, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = layoutService.resolvePosition(offset).atReverseDepth(0), word = _a.node, wordOffset = _a.offset;\n        if (word.size - word.whitespaceSize === 0) {\n            previousWord = word.previousCrossParentSibling;\n            if (!previousWord) {\n                return [2 /*return*/];\n            }\n            word = previousWord;\n            wordOffset += word.size;\n        }\n        newHead = offset - wordOffset + word.size - word.whitespaceSize;\n        newAnchor = offset - wordOffset;\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        newModelAnchor = renderService.convertOffsetToModelOffset(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectBlock = function (serviceRegistry, offset) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, block, blockOffset, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = layoutService.resolvePosition(offset).atBlockDepth(), block = _a.node, blockOffset = _a.offset;\n        newHead = offset - blockOffset + block.size - 1;\n        newAnchor = offset - blockOffset;\n        newModelHead = renderService.convertOffsetToModelOffset(newHead);\n        newModelAnchor = renderService.convertOffsetToModelOffset(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var undo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').undo();\n        return [2 /*return*/];\n    });\n}); };\nexport var redo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').redo();\n        return [2 /*return*/];\n    });\n}); };\n","var ModelChange = /** @class */ (function () {\n    function ModelChange() {\n    }\n    return ModelChange;\n}());\nexport { ModelChange };\n","var Mapping = /** @class */ (function () {\n    function Mapping(from, oldSize, newSize) {\n        this.from = from;\n        this.oldSize = oldSize;\n        this.newSize = newSize;\n    }\n    Mapping.prototype.map = function (offset) {\n        if (offset <= this.from) {\n            return offset;\n        }\n        if (offset >= this.from + this.oldSize) {\n            return offset - this.oldSize + this.newSize;\n        }\n        throw new Error('Offset no longer exists.');\n    };\n    Mapping.prototype.mapRender = function (offset, renderService) {\n        var modelOffset = renderService.convertOffsetToModelOffset(offset);\n        var newModelOffset = this.map(modelOffset);\n        return renderService.convertModelOffsetToOffset(newModelOffset);\n    };\n    Mapping.prototype.reverse = function () {\n        return new Mapping(this.from, this.newSize, this.oldSize);\n    };\n    return Mapping;\n}());\nexport { Mapping };\nexport var identity = {\n    map: function (offset) { return offset; },\n    mapRender: function (offset, renderService) { return offset; },\n    reverse: function () { return identity; },\n};\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelChange } from './change';\nimport { identity } from './mapping';\nvar ApplyAttribute = /** @class */ (function (_super) {\n    __extends(ApplyAttribute, _super);\n    function ApplyAttribute(path, key, value) {\n        var _this = _super.call(this) || this;\n        _this.path = path;\n        _this.key = key;\n        _this.value = value;\n        return _this;\n    }\n    ApplyAttribute.prototype.map = function (mapping) {\n        return this;\n    };\n    ApplyAttribute.prototype.apply = function (root, componentService) {\n        var node = root;\n        var path = this.path.slice();\n        var id = path.shift();\n        if (id !== node.id) {\n            throw new Error('Path cannot be resolved.');\n        }\n        while ((id = path.shift())) {\n            var childNode = node.children.find(function (child) { return child.id === id; });\n            if (!childNode) {\n                throw new Error('Path cannot be resolved.');\n            }\n            node = childNode;\n        }\n        var originalValue = node.applyAttribute(this.key, this.value);\n        return {\n            change: this,\n            reverseChange: new ApplyAttribute(this.path, this.key, originalValue),\n            mapping: identity,\n        };\n    };\n    return ApplyAttribute;\n}(ModelChange));\nexport { ApplyAttribute };\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar Mutator = /** @class */ (function () {\n    function Mutator() {\n        this.ran = false;\n        this.inProgress = false;\n    }\n    Mutator.prototype.run = function () {\n        if (this.ran) {\n            throw new Error('Already ran.');\n        }\n        this.inProgress = true;\n        while (this.inProgress) {\n            this.next();\n        }\n        this.ran = true;\n    };\n    Mutator.prototype.joinNodes = function (node1, node2) {\n        if (node1.leaf) {\n            node1.replace(0, node1.text.length, node1.text + node2.text);\n        }\n        else {\n            node1.replace(0, node1.children.length, __spreadArrays(node1.children.slice(), node2.children.slice()));\n        }\n        var parent = node1.parent;\n        parent.replace(0, parent.children.length, parent.children.filter(function (child) { return child !== node2; }));\n    };\n    return Mutator;\n}());\nexport { Mutator };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { generateId } from '../../util/id';\nimport { Mutator } from './mutator';\nvar Inserter = /** @class */ (function (_super) {\n    __extends(Inserter, _super);\n    function Inserter(root, offset, fragments, componentService) {\n        var _this = _super.call(this) || this;\n        _this.root = root;\n        _this.fragments = fragments;\n        _this.componentService = componentService;\n        _this.internalInsertedSize = 0;\n        _this.depth = root.resolvePosition(offset).depth;\n        _this.current = { offset: offset, index: 0 };\n        return _this;\n    }\n    Object.defineProperty(Inserter.prototype, \"insertedSize\", {\n        get: function () {\n            return this.internalInsertedSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Inserter.prototype.next = function () {\n        switch (this.state) {\n            case 'text':\n                this.handleText();\n                break;\n            case 'split':\n                this.handleSplit();\n                break;\n            case 'leave':\n                this.handleLeave();\n                break;\n            case 'node':\n                this.handleNode();\n                break;\n            case 'end':\n                this.handleEnd();\n                break;\n        }\n    };\n    Inserter.prototype.handleText = function () {\n        var position = this.root.resolvePosition(this.current.offset);\n        var _a = position.atReverseDepth(0), node = _a.node, index = _a.index;\n        var currentFragment = this.currentFragment;\n        var content = currentFragment.content;\n        node.replace(index, index, content);\n        this.current = {\n            offset: this.current.offset + currentFragment.size,\n            index: this.current.index + 1,\n        };\n        this.internalInsertedSize += currentFragment.size;\n    };\n    Inserter.prototype.handleSplit = function () {\n        var position = this.root.resolvePosition(this.current.offset);\n        var _a = position.atReverseDepth(this.currentFragment.depth - 1), node = _a.node, offset = _a.offset;\n        var insertedSize = this.splitNode(node, offset);\n        this.current = {\n            offset: this.current.offset + insertedSize / 2,\n            index: this.current.index,\n        };\n        this.internalInsertedSize += insertedSize;\n    };\n    Inserter.prototype.handleLeave = function () {\n        this.current = {\n            offset: this.current.offset + 1,\n            index: this.current.index,\n        };\n    };\n    Inserter.prototype.handleNode = function () {\n        var position = this.root.resolvePosition(this.current.offset);\n        var _a = position.atReverseDepth(0), node = _a.node, index = _a.index;\n        var currentFragment = this.currentFragment;\n        var content = currentFragment.content;\n        node.replace(index, index, content);\n        if (content.length > 0) {\n            this.joinNodeWithNextSibling(content[content.length - 1]);\n            this.joinNodeWithPreviousSibling(content[0]);\n        }\n        this.current = {\n            offset: this.current.offset + currentFragment.size,\n            index: this.current.index + 1,\n        };\n        this.internalInsertedSize += currentFragment.size;\n    };\n    Inserter.prototype.handleEnd = function () {\n        this.inProgress = false;\n    };\n    Object.defineProperty(Inserter.prototype, \"state\", {\n        get: function () {\n            if (!this.currentFragment) {\n                return 'end';\n            }\n            var position = this.root.resolvePosition(this.current.offset);\n            if (position.depth > this.depth - this.currentFragment.depth) {\n                return 'split';\n            }\n            if (position.depth < this.depth - this.currentFragment.depth) {\n                return 'leave';\n            }\n            if (this.currentFragment.depth === 0) {\n                return 'text';\n            }\n            return 'node';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Inserter.prototype, \"currentFragment\", {\n        get: function () {\n            if (this.current.index >= this.fragments.length) {\n                return null;\n            }\n            return this.fragments[this.current.index];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Inserter.prototype.splitNode = function (node, offset) {\n        var insertedSize = 0;\n        var component = this.componentService.getComponent(node.componentId);\n        var position = node.resolvePosition(offset);\n        var node1;\n        var node2;\n        if (position.depth === 1) {\n            node1 = component.buildModelNode(node.partId, node.id, node.text.substring(0, offset - 1), node.attributes, []);\n            node2 = component.buildModelNode(node.partId, generateId(), node.text.substring(offset - 1), node.attributes, []);\n        }\n        else {\n            if (position.atDepth(1).offset !== 0) {\n                insertedSize += this.splitNode(position.atDepth(1).node, position.atDepth(1).offset);\n            }\n            position = node.resolvePosition(offset + insertedSize / 2);\n            node1 = component.buildModelNode(node.partId, node.id, '', node.attributes, node.children.slice(0, position.atDepth(0).index));\n            node2 = component.buildModelNode(node.partId, generateId(), '', node.attributes, node.children.slice(position.atDepth(0).index));\n        }\n        var parent = node.parent;\n        var index = parent.children.indexOf(node);\n        parent.replace(index, index + 1, [node1, node2]);\n        insertedSize += 2;\n        return insertedSize;\n    };\n    Inserter.prototype.joinNodeWithNextSibling = function (node) {\n        var nextSibling = node.nextSibling;\n        if (!nextSibling) {\n            return;\n        }\n        if (!node.canJoin(nextSibling)) {\n            return;\n        }\n        this.joinNodes(node, nextSibling);\n    };\n    Inserter.prototype.joinNodeWithPreviousSibling = function (node) {\n        var previousSibling = node.previousSibling;\n        if (!previousSibling) {\n            return;\n        }\n        if (!previousSibling.canJoin(node)) {\n            return;\n        }\n        this.joinNodes(previousSibling, node);\n    };\n    return Inserter;\n}(Mutator));\nexport { Inserter };\n","var Fragment = /** @class */ (function () {\n    function Fragment(content, depth) {\n        this.content = content;\n        this.depth = depth;\n        if (Array.isArray(content)) {\n            this.contentType = 'nodes';\n            this.size = content.reduce(function (size, node) { return size + node.size; }, 0);\n        }\n        else {\n            this.contentType = 'text';\n            this.size = content.length;\n        }\n    }\n    return Fragment;\n}());\nexport { Fragment };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Fragment } from '../fragment';\nimport { Mutator } from './mutator';\nvar Remover = /** @class */ (function (_super) {\n    __extends(Remover, _super);\n    function Remover(root, from, to) {\n        var _this = _super.call(this) || this;\n        _this.root = root;\n        _this.from = from;\n        _this.to = to;\n        _this.removedFragments = [];\n        var position = root.resolvePosition(from);\n        var node = position.atReverseDepth(0).node;\n        _this.current = {\n            offset: from,\n            node: node,\n            nodeFrom: -1,\n            nodeTo: -1,\n        };\n        _this.updateCurrentNode(node);\n        return _this;\n    }\n    Remover.prototype.next = function () {\n        switch (this.state) {\n            case 'fullNode':\n                this.handleFullNode();\n                break;\n            case 'partialNode':\n                this.handlePartialNode();\n                break;\n            case 'text':\n                this.handleText();\n                break;\n            case 'forward':\n                this.handleForward();\n                break;\n            case 'enter':\n                this.handleEnter();\n                break;\n            case 'end':\n                this.handleEnd();\n                break;\n        }\n    };\n    Remover.prototype.handleFullNode = function () {\n        this.stepUp();\n    };\n    Remover.prototype.handlePartialNode = function () {\n        var position = this.current.node.resolvePosition(this.current.offset - this.current.nodeFrom);\n        if (position.depth === 1) {\n            var removeFrom = position.atDepth(0).index;\n            var nodesToRemove = [];\n            var removeToOffset = Math.min(this.to - this.current.nodeFrom, this.current.node.size);\n            var offset = position.atDepth(0).offset;\n            var node = this.current.node.children.at(removeFrom);\n            while (node && offset + node.size <= removeToOffset) {\n                nodesToRemove.push(node);\n                offset += node.size;\n                node = node.nextSibling;\n            }\n            var removeTo = removeFrom + nodesToRemove.length;\n            this.recordRemovedNodes(nodesToRemove, position.depth);\n            this.current.node.replace(removeFrom, removeTo, []);\n            if (node) {\n                this.joinNodeWithPreviousSibling(node);\n            }\n        }\n        this.stepDown();\n    };\n    Remover.prototype.handleText = function () {\n        var removeFrom = this.current.offset - this.current.nodeFrom - 1;\n        var removeTo = Math.min(this.to - this.current.nodeFrom - 1, this.current.node.size - 2);\n        var removedText = this.current.node.replace(removeFrom, removeTo, '');\n        this.recordRemovedText(removedText);\n    };\n    Remover.prototype.handleForward = function () {\n        this.stepForward();\n    };\n    Remover.prototype.handleEnter = function () {\n        this.current.offset++;\n    };\n    Remover.prototype.handleEnd = function () {\n        this.inProgress = false;\n    };\n    Remover.prototype.stepUp = function () {\n        var parentNode = this.current.node.parent;\n        this.updateCurrentNode(parentNode);\n    };\n    Remover.prototype.stepDown = function () {\n        if (this.current.node.children.length === 0) {\n            return;\n        }\n        var nodeOffset = this.current.offset - this.current.nodeFrom;\n        var position = this.current.node.resolvePosition(nodeOffset);\n        var childNode = this.current.node.children.at(position.atDepth(0).index);\n        this.updateCurrentNode(childNode);\n    };\n    Remover.prototype.stepForward = function () {\n        var nextNode = this.current.node.nextSibling;\n        if (nextNode) {\n            this.updateCurrentNode(nextNode);\n            this.current.offset = this.current.nodeFrom;\n        }\n        else {\n            var parentNode = this.current.node.parent;\n            this.current.offset = this.current.nodeTo;\n            this.updateCurrentNode(parentNode);\n        }\n    };\n    Object.defineProperty(Remover.prototype, \"state\", {\n        get: function () {\n            if (this.current.offset >= this.to) {\n                return 'end';\n            }\n            if (this.current.nodeTo - this.current.offset === 1) {\n                return 'forward';\n            }\n            if (this.current.offset === this.current.nodeFrom && this.current.nodeTo <= this.to) {\n                return 'fullNode';\n            }\n            if (this.current.offset === this.current.nodeFrom) {\n                return 'enter';\n            }\n            if (this.current.node.leaf) {\n                return 'text';\n            }\n            return 'partialNode';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Remover.prototype.recordRemovedNodes = function (nodes, depth) {\n        this.removedFragments.push(new Fragment(nodes, depth));\n        var size = nodes.reduce(function (size, node) { return size + node.size; }, 0);\n        this.current.nodeTo -= size;\n        this.to -= size;\n    };\n    Remover.prototype.recordRemovedText = function (text) {\n        this.removedFragments.push(new Fragment(text, 0));\n        this.current.nodeTo -= text.length;\n        this.to -= text.length;\n    };\n    Remover.prototype.joinNodeWithPreviousSibling = function (node) {\n        var previousSibling = node.previousSibling;\n        if (!previousSibling) {\n            if (node.parent) {\n                this.joinNodeWithPreviousSibling(node.parent);\n            }\n            return;\n        }\n        var nodeOffset = this.getOffsetToRoot(node);\n        if (this.current.offset >= nodeOffset - 1) {\n            if (this.current.offset > nodeOffset) {\n                this.current.offset--;\n            }\n            this.current.offset--;\n        }\n        this.to -= 2;\n        var childNodeToJoin = node.firstChild;\n        this.joinNodes(previousSibling, node);\n        if (childNodeToJoin) {\n            this.joinNodeWithPreviousSibling(childNodeToJoin);\n        }\n        if (this.current.node === node) {\n            this.updateCurrentNode(previousSibling);\n        }\n    };\n    Remover.prototype.updateCurrentNode = function (node) {\n        this.current.node = node;\n        this.current.nodeFrom = this.getOffsetToRoot(node);\n        this.current.nodeTo = this.current.nodeFrom + node.size;\n    };\n    Remover.prototype.getOffsetToRoot = function (node) {\n        var offset = 0;\n        var n = node;\n        while (n.parent) {\n            offset += this.getOffsetToParent(n);\n            n = n.parent;\n        }\n        return offset;\n    };\n    Remover.prototype.getOffsetToParent = function (node) {\n        var offset = 1;\n        var previousSibling = node.previousSibling;\n        while (previousSibling) {\n            offset += previousSibling.size;\n            previousSibling = previousSibling.previousSibling;\n        }\n        return offset;\n    };\n    return Remover;\n}(Mutator));\nexport { Remover };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelChange } from './change';\nimport { Inserter } from './inserter';\nimport { Mapping } from './mapping';\nimport { Remover } from './remover';\nvar ReplaceChange = /** @class */ (function (_super) {\n    __extends(ReplaceChange, _super);\n    function ReplaceChange(from, to, fragments) {\n        var _this = _super.call(this) || this;\n        _this.from = from;\n        _this.to = to;\n        _this.fragments = fragments;\n        _this.validateInput();\n        return _this;\n    }\n    ReplaceChange.prototype.map = function (mapping) {\n        var from = mapping.map(this.from);\n        var to = mapping.map(this.to);\n        return new ReplaceChange(from, to, this.fragments);\n    };\n    ReplaceChange.prototype.apply = function (root, componentService) {\n        this.validateFit(root);\n        var remover = new Remover(root, this.from, this.to);\n        remover.run();\n        var inserter = new Inserter(root, this.from, this.fragments, componentService);\n        inserter.run();\n        return {\n            change: this,\n            reverseChange: new ReplaceChange(this.from, this.from + inserter.insertedSize, remover.removedFragments),\n            mapping: new Mapping(this.from, this.to - this.from, inserter.insertedSize),\n        };\n    };\n    ReplaceChange.prototype.validateInput = function () {\n        // Validate range is valid\n        if (this.from > this.to) {\n            throw new Error('Range is invalid.');\n        }\n        // Validate fragments depths are valid\n        if (this.fragments.length > 0) {\n            var ascending = true;\n            var descending = false;\n            var depth = this.fragments[0].depth;\n            for (var n = 1, nn = this.fragments.length; n < nn; n++) {\n                var fragment = this.fragments[n];\n                if (fragment.depth > depth) {\n                    if (!ascending) {\n                        throw new Error('Fragments have invalid depths.');\n                    }\n                }\n                else if (fragment.depth < depth) {\n                    if (ascending) {\n                        ascending = false;\n                        descending = true;\n                    }\n                    if (!descending) {\n                        throw new Error('Fragments have invalid depths.');\n                    }\n                }\n                depth = fragment.depth;\n            }\n        }\n    };\n    ReplaceChange.prototype.validateFit = function (root) {\n        // Fragments depths must be less than depth at from position\n        var fromPosition = root.resolvePosition(this.from);\n        var maxFragmentDepth = Math.max.apply(Math, this.fragments.map(function (fragment) { return fragment.depth; }));\n        if (maxFragmentDepth >= fromPosition.depth) {\n            throw new Error('Fragments do not fit in range.');\n        }\n    };\n    return ReplaceChange;\n}(ModelChange));\nexport { ReplaceChange };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { ApplyAttribute } from '../../model/change/applyAttribute';\nimport { ReplaceChange } from '../../model/change/replace';\nimport { Fragment } from '../../model/fragment';\nimport { Transformation } from '../../transform/transformation';\nfunction findNodesByComponentIdAndPartId(node, componentId, partId, searchFrom, searchTo) {\n    var nodes = [];\n    if (node.componentId === componentId && node.partId === partId) {\n        nodes.push(node);\n    }\n    var cumulatedOffset = 1;\n    node.children.forEach(function (child) {\n        if (cumulatedOffset <= searchTo && searchFrom <= cumulatedOffset + child.size) {\n            var searchChildFrom = Math.max(0, searchFrom - cumulatedOffset);\n            var searchChildTo = Math.min(child.size, searchTo - cumulatedOffset);\n            nodes.push.apply(nodes, findNodesByComponentIdAndPartId(child, componentId, partId, searchChildFrom, searchChildTo));\n        }\n        cumulatedOffset += child.size;\n    });\n    return nodes;\n}\nfunction buildPath(node) {\n    var path = [];\n    var currentNode = node;\n    while (currentNode) {\n        path.unshift(currentNode.id);\n        currentNode = currentNode.parent;\n    }\n    return path;\n}\nexport var insert = function (serviceRegistry, content) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertOffsetToModelOffset(from);\n        modelTo = renderService.convertOffsetToModelOffset(to);\n        newModelOffset = modelFrom + content.length;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [new Fragment(content, 0)])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head === 0) {\n                return [2 /*return*/];\n            }\n            from = head - 1;\n            to = head;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertOffsetToModelOffset(from);\n        modelTo = renderService.convertOffsetToModelOffset(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head >= renderService.getDocSize() - 1) {\n                return [2 /*return*/];\n            }\n            from = head;\n            to = head + 1;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertOffsetToModelOffset(from);\n        modelTo = renderService.convertOffsetToModelOffset(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var breakLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertOffsetToModelOffset(from);\n        modelTo = renderService.convertOffsetToModelOffset(to);\n        newModelOffset = modelFrom + 4;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [new Fragment([], 2)])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var applyAttribute = function (serviceRegistry, componentId, partId, attributeKey, attributeValue) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, modelService, _a, anchor, head, from, to, modelFrom, modelTo, nodes;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        modelService = serviceRegistry.getService('model');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertOffsetToModelOffset(from);\n        modelTo = renderService.convertOffsetToModelOffset(to);\n        nodes = findNodesByComponentIdAndPartId(modelService.getRoot(), componentId, partId, modelFrom, modelTo);\n        transformService.applyTransformation(new Transformation(nodes.map(function (node) { return new ApplyAttribute(buildPath(node), attributeKey, attributeValue); })));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var focus = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestFocus();\n        return [2 /*return*/];\n    });\n}); };\nexport var blur = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestBlur();\n        return [2 /*return*/];\n    });\n}); };\n","var EventEmitter = /** @class */ (function () {\n    function EventEmitter() {\n        this.listeners = [];\n    }\n    EventEmitter.prototype.on = function (listener) {\n        var _this = this;\n        this.listeners.push(listener);\n        return {\n            dispose: function () {\n                var index = _this.listeners.indexOf(listener);\n                if (index < 0) {\n                    return;\n                }\n                _this.listeners.splice(index, 1);\n            },\n        };\n    };\n    EventEmitter.prototype.emit = function (event) {\n        this.listeners.forEach(function (listener) { return listener(event); });\n    };\n    return EventEmitter;\n}());\nexport { EventEmitter };\n","var CommandRegistry = /** @class */ (function () {\n    function CommandRegistry() {\n        this.commandsMap = new Map();\n    }\n    CommandRegistry.prototype.registerCommand = function (commandId, commandHandler) {\n        this.commandsMap.set(commandId, commandHandler);\n    };\n    CommandRegistry.prototype.getCommandHandler = function (commandId) {\n        return this.commandsMap.get(commandId);\n    };\n    return CommandRegistry;\n}());\nexport { CommandRegistry };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { CommandRegistry } from './registry';\nvar CommandService = /** @class */ (function () {\n    function CommandService(configService, serviceRegistry) {\n        this.serviceRegistry = serviceRegistry;\n        this.willExecuteCommandEventEmitter = new EventEmitter();\n        this.didExecuteCommandEventEmitter = new EventEmitter();\n        this.registry = new CommandRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().commands); _i < _a.length; _i++) {\n            var _b = _a[_i], commandId = _b[0], commandHandler = _b[1];\n            this.registry.registerCommand(commandId, commandHandler);\n        }\n    }\n    CommandService.prototype.onWillExecuteCommand = function (listener) {\n        return this.willExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.onDidExecuteCommand = function (listener) {\n        return this.didExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.executeCommand = function (commandId) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var commandHandler;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        commandHandler = this.registry.getCommandHandler(commandId);\n                        if (!commandHandler) {\n                            return [2 /*return*/];\n                        }\n                        this.willExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [4 /*yield*/, commandHandler.apply(void 0, __spreadArrays([this.serviceRegistry], args))];\n                    case 1:\n                        _a.sent();\n                        this.didExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return CommandService;\n}());\nexport { CommandService };\n","var NodeList = /** @class */ (function () {\n    function NodeList(nodes) {\n        if (nodes === void 0) { nodes = []; }\n        this.nodes = nodes;\n    }\n    Object.defineProperty(NodeList.prototype, \"length\", {\n        get: function () {\n            return this.nodes.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    NodeList.prototype.at = function (index) {\n        if (index < 0 || index >= this.nodes.length) {\n            throw new Error(\"Index \" + index + \" is out of range.\");\n        }\n        return this.nodes[index];\n    };\n    NodeList.prototype.indexOf = function (node) {\n        return this.nodes.findIndex(function (n) { return n.id === node.id; });\n    };\n    NodeList.prototype.forEach = function (callbackFn) {\n        return this.nodes.forEach(callbackFn);\n    };\n    NodeList.prototype.map = function (callbackFn) {\n        return this.nodes.map(callbackFn);\n    };\n    NodeList.prototype.reduce = function (callbackFn, initialValue) {\n        return this.nodes.reduce(callbackFn, initialValue);\n    };\n    NodeList.prototype.filter = function (callbackfn) {\n        return this.nodes.filter(callbackfn);\n    };\n    NodeList.prototype.slice = function (start, end) {\n        return this.nodes.slice(start, end);\n    };\n    NodeList.prototype.find = function (callbackFn) {\n        return this.nodes.find(callbackFn);\n    };\n    return NodeList;\n}());\nexport { NodeList };\n","import { NodeList } from './node-list';\nvar Node = /** @class */ (function () {\n    function Node(id) {\n        this.id = id;\n        this.parent = null;\n        this.internalChildren = new NodeList();\n    }\n    Object.defineProperty(Node.prototype, \"children\", {\n        get: function () {\n            return this.internalChildren;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"firstChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(0);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"lastChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(this.children.length - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === 0) {\n                return null;\n            }\n            return siblings.at(ownIndex - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === siblings.length - 1) {\n                return null;\n            }\n            return siblings.at(ownIndex + 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousCrossParentSibling\", {\n        get: function () {\n            var previousSibling = this.previousSibling;\n            if (previousSibling) {\n                return previousSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentPreviousSibling = parent.previousCrossParentSibling;\n            if (!parentPreviousSibling) {\n                return null;\n            }\n            return parentPreviousSibling.lastChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextCrossParentSibling\", {\n        get: function () {\n            var nextSibling = this.nextSibling;\n            if (nextSibling) {\n                return nextSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentNextSibling = parent.nextCrossParentSibling;\n            if (!parentNextSibling) {\n                return null;\n            }\n            return parentNextSibling.firstChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Node.prototype.findDescendant = function (id) {\n        if (this.id === id) {\n            return this;\n        }\n        if (this.leaf) {\n            return null;\n        }\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var result = child.findDescendant(id);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    };\n    return Node;\n}());\nexport { Node };\n","var Position = /** @class */ (function () {\n    function Position(depths) {\n        this.depths = depths;\n    }\n    Object.defineProperty(Position.prototype, \"depth\", {\n        get: function () {\n            return this.depths.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Position.prototype.atDepth = function (depth) {\n        if (depth < 0 || depth >= this.depths.length) {\n            throw new Error('Depth out of range.');\n        }\n        return this.depths[depth];\n    };\n    Position.prototype.atReverseDepth = function (reverseDepth) {\n        if (reverseDepth < 0 || reverseDepth >= this.depths.length) {\n            throw new Error('Reverse depth out of range.');\n        }\n        return this.depths[this.depth - reverseDepth - 1];\n    };\n    return Position;\n}());\nexport { Position };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { Position } from '../tree/position';\nvar ModelNode = /** @class */ (function (_super) {\n    __extends(ModelNode, _super);\n    function ModelNode(componentId, id, text, attributes, children) {\n        var _this = _super.call(this, id) || this;\n        _this.componentId = componentId;\n        _this.attributes = attributes;\n        _this.internalNeedRender = true;\n        _this.childDidUpdateDisposableMap = new Map();\n        _this.didUpdateEventEmitter = new EventEmitter();\n        _this.handleChildDidUpdate = function () {\n            _this.didUpdateEventEmitter.emit({});\n        };\n        _this.internalText = text;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n            _this.childDidUpdateDisposableMap.set(child.id, child.onDidUpdate(_this.handleChildDidUpdate));\n        });\n        _this.onDidUpdate(function () {\n            _this.internalSize = undefined;\n            _this.internalNeedRender = true;\n        });\n        return _this;\n    }\n    Object.defineProperty(ModelNode.prototype, \"text\", {\n        get: function () {\n            return this.internalText;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = 2 + this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 2);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"needRender\", {\n        get: function () {\n            return this.internalNeedRender;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelNode.prototype.canJoin = function (node) {\n        return false;\n    };\n    ModelNode.prototype.clearNeedRender = function () {\n        this.internalNeedRender = false;\n    };\n    ModelNode.prototype.applyAttribute = function (key, value) {\n        // @ts-ignore\n        var originalValue = this.attributes[key];\n        // @ts-ignore\n        this.attributes[key] = value;\n        this.didUpdateEventEmitter.emit({});\n        return originalValue;\n    };\n    ModelNode.prototype.replace = function (from, to, content) {\n        var _this = this;\n        if (from > to) {\n            throw new Error('Range is invalid.');\n        }\n        if (this.leaf) {\n            if (typeof content !== 'string') {\n                throw new Error('Leaf node content must be string.');\n            }\n            if (from < 0 || to > this.text.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        else {\n            if (typeof content === 'string') {\n                throw new Error('Non-leaf node content must not be string.');\n            }\n            if (from < 0 || to > this.children.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        var replacedContent;\n        if (typeof content === 'string') {\n            replacedContent = this.internalText.substring(from, to);\n            this.internalText = this.internalText.slice(0, from) + content + this.internalText.slice(to);\n        }\n        else {\n            replacedContent = this.children.slice(from, to);\n            this.internalChildren = new NodeList(__spreadArrays(this.children.slice(0, from), content, this.children.slice(to)));\n            var removedNodes = this.children.slice(from, to);\n            removedNodes.forEach(function (node) { var _a; return (_a = _this.childDidUpdateDisposableMap.get(node.id)) === null || _a === void 0 ? void 0 : _a.dispose(); });\n            content.forEach(function (node) {\n                node.parent = _this;\n                _this.childDidUpdateDisposableMap.set(node.id, node.onDidUpdate(_this.handleChildDidUpdate));\n            });\n        }\n        this.didUpdateEventEmitter.emit({});\n        return replacedContent;\n    };\n    ModelNode.prototype.resolvePosition = function (offset) {\n        if (offset < 0 || offset >= this.size) {\n            throw new Error(\"Offset \" + offset + \" is out of range.\");\n        }\n        if (offset === 0) {\n            return new ModelPosition([{ node: this, offset: offset, index: -1 }]);\n        }\n        if (this.leaf) {\n            return new ModelPosition([{ node: this, offset: offset, index: offset - 1 }]);\n        }\n        var cumulatedOffset = 1;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset === offset) {\n                return new ModelPosition([{ node: this, offset: offset, index: n }]);\n            }\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedOffset + childSize > offset) {\n                var childPosition = child.resolvePosition(offset - cumulatedOffset);\n                var depths = [{ node: this, offset: offset, index: n }];\n                for (var m = 0; m < childPosition.depth; m++) {\n                    depths.push(childPosition.atDepth(m));\n                }\n                return new ModelPosition(depths);\n            }\n            cumulatedOffset += childSize;\n        }\n        return new ModelPosition([{ node: this, offset: offset, index: this.children.length }]);\n    };\n    ModelNode.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelNode;\n}(Node));\nexport { ModelNode };\nvar ModelPosition = /** @class */ (function (_super) {\n    __extends(ModelPosition, _super);\n    function ModelPosition() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return ModelPosition;\n}(Position));\nexport { ModelPosition };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelRoot = /** @class */ (function (_super) {\n    __extends(ModelRoot, _super);\n    function ModelRoot(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Doc node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelRoot.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelRoot.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelRoot;\n}(ModelNode));\nexport { ModelRoot };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { Position } from '../tree/position';\nimport { generateId } from '../util/id';\nvar RenderNode = /** @class */ (function (_super) {\n    __extends(RenderNode, _super);\n    function RenderNode(componentId, modelId, text, attributes, children) {\n        var _this = _super.call(this, generateId()) || this;\n        _this.componentId = componentId;\n        _this.modelId = modelId;\n        _this.text = text;\n        _this.attributes = attributes;\n        _this.internalNeedLayout = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(RenderNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"modelSize\", {\n        get: function () {\n            if (this.pseudo) {\n                return 0;\n            }\n            if (this.internalChildrenModelSize === undefined) {\n                this.internalChildrenModelSize = this.children.reduce(function (size, childNode) { return size + childNode.modelSize; }, 0);\n            }\n            return this.internalChildrenModelSize + 2 + this.text.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"needLayout\", {\n        get: function () {\n            return this.internalNeedLayout;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderNode.prototype.clearNeedLayout = function () {\n        this.internalNeedLayout = false;\n    };\n    RenderNode.prototype.resolvePosition = function (offset) {\n        if (offset < 0 || offset >= this.size) {\n            throw new Error(\"Offset \" + offset + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return new RenderPosition([{ node: this, offset: offset, index: offset }]);\n        }\n        var cumulatedOffset = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedOffset + childSize > offset) {\n                var childPosition = child.resolvePosition(offset - cumulatedOffset);\n                var depths = [{ node: this, offset: offset, index: n }];\n                for (var m = 0; m < childPosition.depth; m++) {\n                    depths.push(childPosition.atDepth(m));\n                }\n                return new RenderPosition(depths);\n            }\n            cumulatedOffset += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    RenderNode.prototype.convertOffsetToModelOffset = function (offset) {\n        if (offset < 0 || offset >= this.size) {\n            throw new Error('Offset is out of range.');\n        }\n        var cumulatedSize = 0;\n        var cumulatedModelSize = this.pseudo ? 0 : 1;\n        if (this.leaf) {\n            return cumulatedModelSize + offset;\n        }\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedSize + childSize > offset) {\n                return cumulatedModelSize + child.convertOffsetToModelOffset(offset - cumulatedSize);\n            }\n            cumulatedSize += childSize;\n            cumulatedModelSize += child.modelSize;\n        }\n        throw new Error(\"Offset \" + offset + \" is out of range.\");\n    };\n    RenderNode.prototype.convertModelOffsetToOffset = function (modelOffset) {\n        if (modelOffset < 0 || modelOffset >= this.modelSize) {\n            throw new Error('Model offset is out of range.');\n        }\n        var cumulatedModelSize = this.pseudo ? 0 : 1;\n        var cumulatedSize = 0;\n        if (modelOffset <= cumulatedModelSize) {\n            return 0;\n        }\n        if (this.leaf) {\n            return modelOffset - cumulatedModelSize;\n        }\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childModelSize = child.modelSize;\n            if (cumulatedModelSize + childModelSize > modelOffset) {\n                return cumulatedSize + child.convertModelOffsetToOffset(modelOffset - cumulatedModelSize);\n            }\n            cumulatedModelSize += childModelSize;\n            cumulatedSize += child.size;\n        }\n        throw new Error(\"Model offset \" + modelOffset + \" is out of range.\");\n    };\n    return RenderNode;\n}(Node));\nexport { RenderNode };\nvar RenderPosition = /** @class */ (function (_super) {\n    __extends(RenderPosition, _super);\n    function RenderPosition() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return RenderPosition;\n}(Position));\nexport { RenderPosition };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(RenderNode));\nexport { RenderDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar ViewNode = /** @class */ (function (_super) {\n    __extends(ViewNode, _super);\n    function ViewNode(domContainer, componentId, renderId, layoutId, text, style, children, domService) {\n        var _this = _super.call(this, layoutId) || this;\n        _this.domContainer = domContainer;\n        _this.componentId = componentId;\n        _this.renderId = renderId;\n        _this.layoutId = layoutId;\n        _this.text = text;\n        _this.style = style;\n        _this.domService = domService;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(ViewNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewNode;\n}(Node));\nexport { ViewNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n        _this.attached = false;\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(ViewNode));\nexport { ViewDoc };\n","var Component = /** @class */ (function () {\n    function Component(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return Component;\n}());\nexport { Component };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelRoot } from '../../model/root';\nimport { RenderDoc as AbstractRenderDoc } from '../../render/doc';\nimport { ViewDoc as AbstractViewDoc } from '../../view/doc';\nimport { Component } from '../component';\nvar ModelDoc = /** @class */ (function (_super) {\n    __extends(ModelDoc, _super);\n    function ModelDoc() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelDoc.prototype.toDOM = function (from, to) {\n        var $element = document.createElement('div');\n        var offset = 1;\n        var children = this.children;\n        for (var n = 0, nn = children.length; n < nn && offset < to; n++) {\n            var child = children.at(n);\n            var childSize = child.size;\n            var childFrom = Math.max(0, from - offset);\n            var childTo = Math.min(childFrom + childSize, to - offset);\n            offset += childSize;\n            if (childFrom > childSize || childTo < 0) {\n                continue;\n            }\n            var $childElement = child.toDOM(childFrom, childTo);\n            $element.appendChild($childElement);\n        }\n        return $element;\n    };\n    return ModelDoc;\n}(ModelRoot));\nexport { ModelDoc };\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, componentId, modelId, attributes, children) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        return _this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(AbstractRenderDoc));\nexport { RenderDoc };\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.textAlign = 'left';\n        _this.domContainer.style.cursor = 'text';\n        _this.domContainer.style.userSelect = 'none';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = domService.createElement('div');\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(AbstractViewDoc));\nexport { ViewDoc };\nvar DocComponent = /** @class */ (function (_super) {\n    __extends(DocComponent, _super);\n    function DocComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DocComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelDoc(this.id, id, attributes, children);\n    };\n    DocComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var configService = this.serviceRegistry.getService('config');\n        switch (partId) {\n            case 'doc':\n                var pageConfig = configService.getConfig().page;\n                return new RenderDoc(this.id, modelId, attributes, children, pageConfig.width, pageConfig.height, pageConfig.paddingTop, pageConfig.paddingBottom, pageConfig.paddingLeft, pageConfig.paddingRight);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    DocComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'doc':\n                return new ViewDoc(domContainer, this.id, renderId, layoutId, style, children, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return DocComponent;\n}(Component));\nexport { DocComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelBranch = /** @class */ (function (_super) {\n    __extends(ModelBranch, _super);\n    function ModelBranch(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Branch node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelBranch.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelBranch.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelBranch;\n}(ModelNode));\nexport { ModelBranch };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderBlock = /** @class */ (function (_super) {\n    __extends(RenderBlock, _super);\n    function RenderBlock(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderBlock;\n}(RenderNode));\nexport { RenderBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, text, attributes) {\n        return _super.call(this, componentId, modelId, text, attributes, []) || this;\n    }\n    Object.defineProperty(RenderText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(RenderNode));\nexport { RenderText };\n","export var DEFAULT_FONT = {\n    weight: 400,\n    size: 16,\n    family: 'sans-serif',\n    letterSpacing: 0,\n    underline: false,\n    italic: false,\n    strikethrough: false,\n    color: 'black',\n};\nexport var BREAKABLE_CHARS = [' ', '\\n', '\\t'];\nvar TextService = /** @class */ (function () {\n    function TextService(domService) {\n        this.$canvas = domService.createElement('canvas');\n    }\n    TextService.prototype.measure = function (text, font) {\n        var fontWithDefault = this.applyDefaultFont(font);\n        var ctx = this.$canvas.getContext('2d');\n        var weight = fontWithDefault.weight;\n        var size = fontWithDefault.size;\n        var family = this.fixFontFamily(fontWithDefault.family);\n        var letterSpacing = fontWithDefault.letterSpacing;\n        ctx.font = weight + \" \" + size + \"px \" + family;\n        var measurement = ctx.measureText(text);\n        var width = letterSpacing === 0 || text.length <= 1\n            ? measurement.width\n            : measurement.width + (text.length - 1) * letterSpacing;\n        return {\n            width: width,\n            height: size,\n        };\n    };\n    TextService.prototype.breakIntoWords = function (text) {\n        var words = [];\n        var word = '';\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var char = text[n];\n            word += char;\n            if (BREAKABLE_CHARS.includes(char)) {\n                words.push({\n                    text: word,\n                    whitespaceSize: 1,\n                });\n                word = '';\n            }\n        }\n        if (word.length > 0) {\n            words.push({\n                text: word,\n                whitespaceSize: 0,\n            });\n        }\n        return words;\n    };\n    TextService.prototype.applyDefaultFont = function (font) {\n        var fontConfigWithDefault = {};\n        for (var key in DEFAULT_FONT) {\n            if (key in font && font[key] !== undefined) {\n                fontConfigWithDefault[key] = font[key];\n            }\n            else {\n                fontConfigWithDefault[key] = DEFAULT_FONT[key];\n            }\n        }\n        return fontConfigWithDefault;\n    };\n    TextService.prototype.fixFontFamily = function (fontFamily) {\n        if (fontFamily.indexOf(' ') >= 0) {\n            return \"'\" + fontFamily + \"'\";\n        }\n        return fontFamily;\n    };\n    return TextService;\n}());\nexport { TextService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewBlock = /** @class */ (function (_super) {\n    __extends(ViewBlock, _super);\n    function ViewBlock(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n    }\n    Object.defineProperty(ViewBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewBlock;\n}(ViewNode));\nexport { ViewBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, text, style, [], domService) || this;\n    }\n    Object.defineProperty(ViewText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewText;\n}(ViewNode));\nexport { ViewText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { ModelBranch } from '../../model/branch';\nimport { RenderBlock } from '../../render/block';\nimport { RenderText } from '../../render/text';\nimport { DEFAULT_FONT } from '../../text/service';\nimport { ViewBlock } from '../../view/block';\nimport { ViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelParagraph = /** @class */ (function (_super) {\n    __extends(ModelParagraph, _super);\n    function ModelParagraph() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelParagraph.prototype.toDOM = function (from, to) {\n        var $element = document.createElement('p');\n        var offset = 1;\n        var children = this.children;\n        for (var n = 0, nn = children.length; n < nn && offset < to; n++) {\n            var childNode = children.at(n);\n            var childSize = childNode.size;\n            var childFrom = Math.max(0, from - offset);\n            var childTo = Math.min(childFrom + childSize, to - offset);\n            offset += childSize;\n            if (childFrom > childSize || childTo < 0) {\n                continue;\n            }\n            var $childElement = childNode.toDOM(childFrom, childTo);\n            $element.appendChild($childElement);\n        }\n        return $element;\n    };\n    return ModelParagraph;\n}(ModelBranch));\nexport { ModelParagraph };\nvar RenderParagraph = /** @class */ (function (_super) {\n    __extends(RenderParagraph, _super);\n    function RenderParagraph(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, attributes, __spreadArrays(children, [new RenderParagraphLineBreak(componentId, modelId)])) || this;\n    }\n    Object.defineProperty(RenderParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingBottom\", {\n        get: function () {\n            return 12;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderParagraph.prototype.convertOffsetToModelOffset = function (offset) {\n        if (this.size === 1) {\n            return this.resolvePosition(0).depth;\n        }\n        if (offset === this.size - 1) {\n            return _super.prototype.convertOffsetToModelOffset.call(this, offset - 1) + 1;\n        }\n        return _super.prototype.convertOffsetToModelOffset.call(this, offset);\n    };\n    RenderParagraph.prototype.convertModelOffsetToOffset = function (modelOffset) {\n        if (modelOffset <= this.resolvePosition(0).depth) {\n            return 0;\n        }\n        if (_super.prototype.convertModelOffsetToOffset.call(this, modelOffset - 1) + 1 >= this.size - 1) {\n            return this.size - 1;\n        }\n        return _super.prototype.convertModelOffsetToOffset.call(this, modelOffset);\n    };\n    return RenderParagraph;\n}(RenderBlock));\nexport { RenderParagraph };\nvar RenderParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(RenderParagraphLineBreak, _super);\n    function RenderParagraphLineBreak(componentId, paragraphModelId) {\n        var _this = _super.call(this, componentId, paragraphModelId + \".line-break\", ' ', null) || this;\n        _this.componentId = componentId;\n        _this.paragraphModelId = paragraphModelId;\n        return _this;\n    }\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"pseudo\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"style\", {\n        get: function () {\n            return null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"font\", {\n        get: function () {\n            var node = this.previousSibling;\n            while (node) {\n                if (node.type === 'text') {\n                    return node.font;\n                }\n                node = node.previousSibling;\n            }\n            return DEFAULT_FONT;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderParagraphLineBreak;\n}(RenderText));\nexport { RenderParagraphLineBreak };\nvar ViewParagraph = /** @class */ (function (_super) {\n    __extends(ViewParagraph, _super);\n    function ViewParagraph(domContainer, componentId, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraph.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraph;\n}(ViewBlock));\nexport { ViewParagraph };\nvar ViewParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(ViewParagraphLineBreak, _super);\n    function ViewParagraphLineBreak(domContainer, componentId, renderId, layoutId, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, ' ', null, domService) || this;\n    }\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraphLineBreak;\n}(ViewText));\nexport { ViewParagraphLineBreak };\nvar ParagraphComponent = /** @class */ (function (_super) {\n    __extends(ParagraphComponent, _super);\n    function ParagraphComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ParagraphComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelParagraph(this.id, id, attributes, children);\n    };\n    ParagraphComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        switch (partId) {\n            case 'paragraph':\n                return new RenderParagraph(this.id, modelId, attributes, children);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    ParagraphComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'paragraph':\n                return new ViewParagraph(domContainer, this.id, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            case 'line-break':\n                return new ViewParagraphLineBreak(domContainer, this.id, renderId, layoutId, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return ParagraphComponent;\n}(Component));\nexport { ParagraphComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelLeaf = /** @class */ (function (_super) {\n    __extends(ModelLeaf, _super);\n    function ModelLeaf(componentId, id, text, attributes) {\n        return _super.call(this, componentId, id, text, attributes, []) || this;\n    }\n    Object.defineProperty(ModelLeaf.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelLeaf.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelLeaf;\n}(ModelNode));\nexport { ModelLeaf };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelLeaf } from '../../model/leaf';\nimport { RenderText as AbstractRenderText } from '../../render/text';\nimport { ViewText as AbstractViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelText = /** @class */ (function (_super) {\n    __extends(ModelText, _super);\n    function ModelText() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelText.prototype.canJoin = function (node) {\n        if (this.componentId !== node.componentId) {\n            return false;\n        }\n        if (this.partId !== node.partId) {\n            return false;\n        }\n        if (JSON.stringify(this.attributes) !== JSON.stringify(node.attributes)) {\n            return false;\n        }\n        return true;\n    };\n    ModelText.prototype.toDOM = function (from, to) {\n        var $component = document.createElement('span');\n        $component.innerText = this.text.substring(from - 1, to - 1);\n        return $component;\n    };\n    return ModelText;\n}(ModelLeaf));\nexport { ModelText };\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, textService, text, attributes) {\n        var _this = _super.call(this, componentId, modelId, text, attributes) || this;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(RenderText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"style\", {\n        get: function () {\n            return this.textService.applyDefaultFont(this.attributes);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"font\", {\n        get: function () {\n            return this.style;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(AbstractRenderText));\nexport { RenderText };\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, text, style, domService) || this;\n        _this.domContainer.style.display = 'inline-block';\n        _this.domContainer.style.whiteSpace = 'pre';\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.fontFamily = style.family;\n        _this.domContainer.style.fontSize = style.size + \"px\";\n        _this.domContainer.style.letterSpacing = style.letterSpacing + \"px\";\n        _this.domContainer.style.fontWeight = \"\" + style.weight;\n        _this.domContainer.style.color = style.color;\n        _this.domContainer.style.textDecoration = style.underline ? 'underline' : '';\n        _this.domContainer.style.fontStyle = style.italic ? 'italic' : '';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = _this.findOrCreateDOMContentContainer();\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        domContentContainer.style.textDecoration = style.strikethrough ? 'line-through' : '';\n        domContentContainer.innerHTML = text;\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewText.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('span');\n    };\n    return ViewText;\n}(AbstractViewText));\nexport { ViewText };\nvar TextComponent = /** @class */ (function (_super) {\n    __extends(TextComponent, _super);\n    function TextComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TextComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelText(this.id, id, text, attributes);\n    };\n    TextComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var textService = this.serviceRegistry.getService('text');\n        switch (partId) {\n            case 'text':\n                return new RenderText(this.id, modelId, textService, text, attributes);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    TextComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'text':\n                return new ViewText(domContainer, this.id, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return TextComponent;\n}(Component));\nexport { TextComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(ViewNode));\nexport { ViewLine };\n","var LineComponent = /** @class */ (function () {\n    function LineComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return LineComponent;\n}());\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewLine as AbstractViewLine } from '../../view/line';\nimport { LineComponent as AbstractLineComponent } from '../line-component';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"partId\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(AbstractViewLine));\nexport { ViewLine };\nvar LineComponent = /** @class */ (function (_super) {\n    __extends(LineComponent, _super);\n    function LineComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    LineComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewLine(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return LineComponent;\n}(AbstractLineComponent));\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewPage;\n}(ViewNode));\nexport { ViewPage };\n","var PageComponent = /** @class */ (function () {\n    function PageComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return PageComponent;\n}());\nexport { PageComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewPage as AbstractViewPage } from '../../view/page';\nimport { PageComponent as AbstractPageComponent } from '../page-component';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.domContainer.style.position = 'relative';\n        _this.domContainer.style.marginLeft = 'auto';\n        _this.domContainer.style.marginRight = 'auto';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        _this.domContentContainer = _this.findOrCreateDOMContentContainer();\n        _this.domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return _this.domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(_this.domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"partId\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewPage.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('div');\n    };\n    return ViewPage;\n}(AbstractViewPage));\nexport { ViewPage };\nvar PageComponent = /** @class */ (function (_super) {\n    __extends(PageComponent, _super);\n    function PageComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PageComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewPage(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return PageComponent;\n}(AbstractPageComponent));\nexport { PageComponent };\n","var ComponentRegistry = /** @class */ (function () {\n    function ComponentRegistry() {\n        this.componentsMap = new Map();\n    }\n    ComponentRegistry.prototype.registerComponent = function (componentId, component) {\n        this.componentsMap.set(componentId, component);\n    };\n    ComponentRegistry.prototype.registerPageComponent = function (pageComponent) {\n        this.pageComponent = pageComponent;\n    };\n    ComponentRegistry.prototype.registerLineComponent = function (lineComponent) {\n        this.lineComponent = lineComponent;\n    };\n    ComponentRegistry.prototype.getComponent = function (componentId) {\n        var component = this.componentsMap.get(componentId);\n        if (!component) {\n            throw new Error(\"Component \" + componentId + \" is not registered.\");\n        }\n        return component;\n    };\n    ComponentRegistry.prototype.getPageComponent = function () {\n        if (!this.pageComponent) {\n            throw new Error('Page component is not registered.');\n        }\n        return this.pageComponent;\n    };\n    ComponentRegistry.prototype.getLineComponent = function () {\n        if (!this.lineComponent) {\n            throw new Error('Line component is not registered.');\n        }\n        return this.lineComponent;\n    };\n    return ComponentRegistry;\n}());\nexport { ComponentRegistry };\n","import { LineComponent } from './components/line';\nimport { PageComponent } from './components/page';\nimport { ComponentRegistry } from './registry';\nvar ComponentService = /** @class */ (function () {\n    function ComponentService(configService, serviceRegistry) {\n        this.configService = configService;\n        this.serviceRegistry = serviceRegistry;\n        this.registry = new ComponentRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().components); _i < _a.length; _i++) {\n            var _b = _a[_i], componentId = _b[0], Component = _b[1];\n            this.registry.registerComponent(componentId, new Component(componentId, serviceRegistry));\n        }\n        this.registry.registerPageComponent(new PageComponent('page', serviceRegistry));\n        this.registry.registerLineComponent(new LineComponent('line', serviceRegistry));\n    }\n    ComponentService.prototype.getComponent = function (componentId) {\n        return this.registry.getComponent(componentId);\n    };\n    ComponentService.prototype.getPageComponent = function () {\n        return this.registry.getPageComponent();\n    };\n    ComponentService.prototype.getLineComponent = function () {\n        return this.registry.getLineComponent();\n    };\n    return ComponentService;\n}());\nexport { ComponentService };\n","var ConfigService = /** @class */ (function () {\n    function ConfigService(config, externalConfig) {\n        this.config = config;\n        this.applyExternalConfig(externalConfig);\n    }\n    ConfigService.prototype.getConfig = function () {\n        return this.config;\n    };\n    ConfigService.prototype.applyExternalConfig = function (externalConfig) {\n        var coreConfig = externalConfig['tw.core'];\n        if (coreConfig) {\n            if (coreConfig.page) {\n                this.config.page = coreConfig.page;\n            }\n        }\n    };\n    return ConfigService;\n}());\nexport { ConfigService };\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { EventEmitter } from '../event/emitter';\nvar CursorState = /** @class */ (function () {\n    function CursorState(configService, renderService, modelService) {\n        this.renderService = renderService;\n        this.modelService = modelService;\n        this.internalCursor = null;\n        this.didUpdateEventEmitter = new EventEmitter();\n        if (!configService.getConfig().cursor.disable) {\n            this.internalCursor = {\n                anchor: 0,\n                head: 0,\n                leftLock: 0,\n            };\n        }\n    }\n    Object.defineProperty(CursorState.prototype, \"hasCursor\", {\n        get: function () {\n            return !!this.internalCursor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CursorState.prototype, \"cursor\", {\n        get: function () {\n            this.assertCursor();\n            return __assign({}, this.internalCursor);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CursorState.prototype.set = function (anchor, head) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: anchor,\n            head: head,\n            leftLock: this.internalCursor.leftLock,\n        };\n        this.didUpdateEventEmitter.emit({});\n    };\n    CursorState.prototype.setLeftLock = function (leftLock) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: this.internalCursor.anchor,\n            head: this.internalCursor.head,\n            leftLock: leftLock,\n        };\n    };\n    CursorState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    CursorState.prototype.assertCursor = function () {\n        if (!this.internalCursor) {\n            throw new Error('Cursor is disabled.');\n        }\n    };\n    return CursorState;\n}());\nexport { CursorState };\n","import { CursorState } from './state';\nvar CursorService = /** @class */ (function () {\n    function CursorService(configService, renderService, modelService) {\n        this.state = new CursorState(configService, renderService, modelService);\n    }\n    CursorService.prototype.hasCursor = function () {\n        return this.state.hasCursor;\n    };\n    CursorService.prototype.getCursor = function () {\n        return this.state.cursor;\n    };\n    CursorService.prototype.setCursor = function (anchor, head) {\n        this.state.set(anchor, head);\n    };\n    CursorService.prototype.setLeftLock = function (leftLock) {\n        this.state.setLeftLock(leftLock);\n    };\n    CursorService.prototype.onDidUpdate = function (listener) {\n        return this.state.onDidUpdate(listener);\n    };\n    return CursorService;\n}());\nexport { CursorService };\n","var DOMService = /** @class */ (function () {\n    function DOMService() {\n    }\n    DOMService.prototype.getWindow = function () {\n        return window;\n    };\n    DOMService.prototype.getDocument = function () {\n        return document;\n    };\n    DOMService.prototype.getBody = function () {\n        return document.body;\n    };\n    DOMService.prototype.createElement = function (tagName) {\n        return document.createElement(tagName);\n    };\n    DOMService.prototype.createContainer = function () {\n        var container = this.createElement('div');\n        container.setAttribute('data-tw-role', 'container');\n        return container;\n    };\n    DOMService.prototype.createHiddenIframe = function () {\n        var iframe = this.createElement('iframe');\n        iframe.scrolling = 'no';\n        iframe.src = 'about:blank';\n        iframe.style.width = '0';\n        iframe.style.height = '0';\n        iframe.style.border = 'none';\n        iframe.style.position = 'fixed';\n        iframe.style.zIndex = '-1';\n        iframe.style.opacity = '0';\n        iframe.style.overflow = 'hidden';\n        iframe.style.left = '-1000000px';\n        iframe.style.top = '-1000000px';\n        return iframe;\n    };\n    DOMService.prototype.createMutationObserver = function (callback) {\n        return new MutationObserver(callback);\n    };\n    return DOMService;\n}());\nexport { DOMService };\n","var HistoryAction = /** @class */ (function () {\n    function HistoryAction() {\n        this.internalTransformationResults = [];\n        this.beganAt = Date.now();\n        this.internalEndedAt = this.beganAt;\n    }\n    Object.defineProperty(HistoryAction.prototype, \"endedAt\", {\n        get: function () {\n            return this.internalEndedAt;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HistoryAction.prototype, \"transformationResults\", {\n        get: function () {\n            return this.internalTransformationResults;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    HistoryAction.prototype.recordTransformationResult = function (transformationResult) {\n        this.transformationResults.push(transformationResult);\n        this.internalEndedAt = Date.now();\n    };\n    return HistoryAction;\n}());\nexport { HistoryAction };\n","import { HistoryAction } from './action';\nvar HistoryState = /** @class */ (function () {\n    function HistoryState(configService, transformService) {\n        var _this = this;\n        this.configService = configService;\n        this.transformService = transformService;\n        this.actions = [];\n        this.offset = -1;\n        this.handleDidApplyTransformation = function (event) {\n            var result = event.result;\n            // Do not record undo\n            if (_this.offset + 1 < _this.actions.length &&\n                _this.actions[_this.offset + 1].transformationResults.some(function (tnResult) { return tnResult.reverseTransformation === result.transformation; })) {\n                return;\n            }\n            // Do not record redo\n            if (_this.offset >= 0 &&\n                _this.actions[_this.offset].transformationResults.some(function (tnResult) { return tnResult.transformation === result.transformation; })) {\n                return;\n            }\n            if (_this.offset < 0) {\n                _this.recordToNewAction(result);\n                return;\n            }\n            var currentItem = _this.actions[_this.offset];\n            var now = Date.now();\n            if (now - currentItem.beganAt < _this.maxCollapseDuration &&\n                now - currentItem.endedAt < _this.collapseThreshold) {\n                _this.recordToLastAction(result);\n            }\n            else {\n                _this.recordToNewAction(result);\n            }\n        };\n        var config = configService.getConfig();\n        this.maxCollapseDuration = config.history.maxCollapseDuration;\n        this.collapseThreshold = config.history.collapseThreshold;\n        transformService.onDidApplyTransformation(this.handleDidApplyTransformation);\n    }\n    HistoryState.prototype.undo = function () {\n        var action = this.consumeNextUndoableAction();\n        if (!action) {\n            return;\n        }\n        var results = action.transformationResults;\n        if (results.length === 0) {\n            return;\n        }\n        for (var n = results.length - 1; n >= 0; n--) {\n            var result = results[n];\n            this.transformService.applyTransformation(result.reverseTransformation);\n        }\n    };\n    HistoryState.prototype.redo = function () {\n        var _this = this;\n        var action = this.consumeNextRedoableAction();\n        if (!action) {\n            return;\n        }\n        action.transformationResults.forEach(function (result) {\n            return _this.transformService.applyTransformation(result.transformation);\n        });\n    };\n    HistoryState.prototype.consumeNextUndoableAction = function () {\n        if (this.offset < 0) {\n            return undefined;\n        }\n        var action = this.actions[this.offset];\n        this.offset--;\n        return action;\n    };\n    HistoryState.prototype.consumeNextRedoableAction = function () {\n        if (this.offset >= this.actions.length - 1) {\n            return undefined;\n        }\n        this.offset++;\n        return this.actions[this.offset];\n    };\n    HistoryState.prototype.recordToNewAction = function (result) {\n        if (result.changeResults.length === 0) {\n            return;\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        var action = new HistoryAction();\n        action.recordTransformationResult(result);\n        this.actions.push(action);\n        this.offset++;\n    };\n    HistoryState.prototype.recordToLastAction = function (result) {\n        var action = this.actions[this.offset];\n        if (!action) {\n            throw new Error('Error recording applied transformation, history is empty.');\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        action.recordTransformationResult(result);\n    };\n    return HistoryState;\n}());\nexport { HistoryState };\n","import { HistoryState } from './state';\nvar HistoryService = /** @class */ (function () {\n    function HistoryService(configService, transformService) {\n        this.state = new HistoryState(configService, transformService);\n    }\n    HistoryService.prototype.undo = function () {\n        this.state.undo();\n    };\n    HistoryService.prototype.redo = function () {\n        this.state.redo();\n    };\n    return HistoryService;\n}());\nexport { HistoryService };\n","export function detectPlatform() {\n    if (navigator.platform.startsWith('Linux')) {\n        return 'Linux';\n    }\n    if (['Windows', 'Win16', 'Win32'].includes(navigator.platform)) {\n        return 'Windows';\n    }\n    if (['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'].includes(navigator.platform)) {\n        return 'macOS';\n    }\n    return 'Unknown';\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { detectPlatform } from '../util/platform';\nvar KeyBindingService = /** @class */ (function () {\n    function KeyBindingService(configService, commandService, viewService) {\n        var _this = this;\n        this.configService = configService;\n        this.commandService = commandService;\n        this.viewService = viewService;\n        this.keyBindings = new Map();\n        this.handleDidPressKey = function (event) {\n            var _a;\n            var keyBinding = _this.keyBindings.get(event.key);\n            if (!keyBinding) {\n                return;\n            }\n            if (keyBinding.preventDefault) {\n                event.originalKeyboardEvent.preventDefault();\n            }\n            (_a = _this.commandService).executeCommand.apply(_a, __spreadArrays([keyBinding.command], keyBinding.args));\n        };\n        var keyBindingsConfig = this.configService.getConfig().keyBindings;\n        this.bindKeys(keyBindingsConfig.common);\n        switch (detectPlatform()) {\n            case 'macOS':\n                if (keyBindingsConfig.macos) {\n                    this.bindKeys(keyBindingsConfig.macos);\n                }\n                break;\n            case 'Windows':\n                if (keyBindingsConfig.windows) {\n                    this.bindKeys(keyBindingsConfig.windows);\n                }\n                break;\n            case 'Linux':\n                if (keyBindingsConfig.linux) {\n                    this.bindKeys(keyBindingsConfig.linux);\n                }\n                break;\n        }\n        viewService.onDidPressKey(this.handleDidPressKey);\n    }\n    KeyBindingService.prototype.bindKeys = function (config) {\n        for (var key in config) {\n            var binding = config[key];\n            this.keyBindings.set(key, {\n                command: binding.command,\n                args: binding.args || [],\n                preventDefault: binding.preventDefault || false,\n            });\n        }\n    };\n    return KeyBindingService;\n}());\nexport { KeyBindingService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { Position } from '../tree/position';\nimport { generateId } from '../util/id';\nvar LayoutNode = /** @class */ (function (_super) {\n    __extends(LayoutNode, _super);\n    function LayoutNode(renderId, text, children, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, generateId()) || this;\n        _this.renderId = renderId;\n        _this.text = text;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.internalNeedView = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(LayoutNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingVertical\", {\n        get: function () {\n            return this.paddingTop + this.paddingBottom;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingHorizontal\", {\n        get: function () {\n            return this.paddingLeft + this.paddingRight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerWidth\", {\n        get: function () {\n            return this.width - this.paddingHorizontal;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerHeight\", {\n        get: function () {\n            return this.height - this.paddingVertical;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"needView\", {\n        get: function () {\n            return this.internalNeedView;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutNode.prototype.clearNeedView = function () {\n        this.internalNeedView = false;\n    };\n    LayoutNode.prototype.resolvePosition = function (offset) {\n        if (offset < 0 || offset >= this.size) {\n            throw new Error(\"Offset \" + offset + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return new LayoutPosition([{ node: this, offset: offset, index: offset }]);\n        }\n        var cumulatedOffset = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedOffset + childSize > offset) {\n                var childPosition = child.resolvePosition(offset - cumulatedOffset);\n                var depths = [{ node: this, offset: offset, index: n }];\n                for (var m = 0; m < childPosition.depth; m++) {\n                    depths.push(childPosition.atDepth(m));\n                }\n                return new LayoutPosition(depths);\n            }\n            cumulatedOffset += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    return LayoutNode;\n}(Node));\nexport { LayoutNode };\nvar LayoutPosition = /** @class */ (function (_super) {\n    __extends(LayoutPosition, _super);\n    function LayoutPosition() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    LayoutPosition.prototype.atLineDepth = function () {\n        for (var n = this.depth - 1; n >= 0; n--) {\n            var depth = this.atDepth(n);\n            if (depth.node.type === 'line') {\n                return depth;\n            }\n        }\n        throw new Error('Line depth not found.');\n    };\n    LayoutPosition.prototype.atBlockDepth = function () {\n        for (var n = this.depth - 1; n >= 0; n--) {\n            var depth = this.atDepth(n);\n            if (depth.node.type === 'block') {\n                return depth;\n            }\n        }\n        throw new Error('Block depth not found.');\n    };\n    return LayoutPosition;\n}(Position));\nexport { LayoutPosition };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutAtom = /** @class */ (function (_super) {\n    __extends(LayoutAtom, _super);\n    function LayoutAtom(renderId, width, height) {\n        var _this = _super.call(this, renderId, ' ', [], 0, 0, 0, 0) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutAtom.prototype, \"type\", {\n        get: function () {\n            return 'atom';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutAtom.prototype.convertCoordinatesToOffset = function (x, y) {\n        if (x < this.innerWidth / 2) {\n            return 0;\n        }\n        return 1;\n    };\n    LayoutAtom.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: from === to ? 0 : this.innerWidth,\n                    height: this.innerHeight,\n                    left: from === 0 ? this.paddingLeft : this.paddingLeft + this.innerWidth,\n                    right: to === 1 ? this.paddingRight : this.paddingRight + this.innerWidth,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    return LayoutAtom;\n}(LayoutNode));\nexport { LayoutAtom };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutBlock = /** @class */ (function (_super) {\n    __extends(LayoutBlock, _super);\n    function LayoutBlock(renderId, children, width, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        return _this;\n    }\n    Object.defineProperty(LayoutBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight = this.children.reduce(function (height, child) { return height + child.height; }, this.paddingVertical);\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutBlock.prototype.convertCoordinatesToOffset = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (y >= cumulatedHeight && y <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToOffset(x, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToOffset(x, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutBlock.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var childResults = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                childResults.push(childResult);\n                childResult.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left,\n                        right: boundingBox.right,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: childResults,\n        };\n    };\n    return LayoutBlock;\n}(LayoutNode));\nexport { LayoutBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutDoc = /** @class */ (function (_super) {\n    __extends(LayoutDoc, _super);\n    function LayoutDoc(renderId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutDoc.prototype.convertCoordinatesToOffset = function (x, y) {\n        throw new Error('Use page to convert coordinates to offset.');\n    };\n    LayoutDoc.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var childResults = [];\n        var cumulatedOffset = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom, childTo);\n                childResults.push(childResult);\n            }\n            cumulatedOffset += child.size;\n        });\n        return {\n            node: this,\n            boundingBoxes: [],\n            children: childResults,\n        };\n    };\n    return LayoutDoc;\n}(LayoutNode));\nexport { LayoutDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutLine = /** @class */ (function (_super) {\n    __extends(LayoutLine, _super);\n    function LayoutLine(children, width) {\n        var _this = _super.call(this, null, '', children, 0, 8, 0, 0) || this;\n        _this.width = width;\n        return _this;\n    }\n    Object.defineProperty(LayoutLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"contentWidth\", {\n        get: function () {\n            if (this.internalContentWidth === undefined) {\n                this.internalContentWidth = this.children.reduce(function (contentWidth, child) { return contentWidth + child.width; }, 0);\n            }\n            return this.internalContentWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutLine.prototype.convertCoordinatesToOffset = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (x >= cumulatedWidth && x <= cumulatedWidth + childWidth) {\n                offset += child.convertCoordinatesToOffset(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild && lastChild.type === 'text') {\n                var lastWord = lastChild.lastChild;\n                if (lastWord && lastWord.whitespaceSize > 0) {\n                    offset--;\n                }\n            }\n        }\n        return offset;\n    };\n    LayoutLine.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var childResults = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom, childTo);\n                childResults.push(childResult);\n                if (left1 === null) {\n                    left1 = left2 + childResult.boundingBoxes[0].left;\n                }\n                left2 += childResult.boundingBoxes\n                    .slice(0, childResult.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += childResult.boundingBoxes[0].left + childResult.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: from === to ? this.innerHeight : this.height,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: from === to ? this.paddingTop : 0,\n                    bottom: from === to ? this.paddingBottom : 0,\n                },\n            ],\n            children: childResults,\n        };\n    };\n    return LayoutLine;\n}(LayoutNode));\nexport { LayoutLine };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutPage = /** @class */ (function (_super) {\n    __extends(LayoutPage, _super);\n    function LayoutPage(children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, null, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"contentHeight\", {\n        get: function () {\n            if (this.internalContentHeight === undefined) {\n                this.internalContentHeight = this.children.reduce(function (contentHeight, child) { return contentHeight + child.height; }, 0);\n            }\n            return this.internalContentHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutPage.prototype.convertCoordinatesToOffset = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        var contentX = Math.min(Math.max(x - this.paddingLeft, 0), this.innerWidth);\n        var contentY = Math.min(Math.max(y - this.paddingTop, 0), this.innerHeight);\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (contentY >= cumulatedHeight && contentY <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToOffset(contentX, contentY - cumulatedHeight);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToOffset(contentX, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutPage.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var childResults = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                childResults.push(childResult);\n                childResult.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left + _this.paddingLeft,\n                        right: boundingBox.right + _this.paddingRight,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: childResults,\n        };\n    };\n    return LayoutPage;\n}(LayoutNode));\nexport { LayoutPage };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutText = /** @class */ (function (_super) {\n    __extends(LayoutText, _super);\n    function LayoutText(renderId, children, paddingTop, paddingBottom, paddingLeft, paddingRight, font) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.font = font;\n        return _this;\n    }\n    Object.defineProperty(LayoutText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"width\", {\n        get: function () {\n            if (this.internalWidth === undefined) {\n                this.internalWidth = this.children.reduce(function (width, child) { return width + child.width; }, this.paddingHorizontal);\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var lastChild = this.lastChild;\n                if (!lastChild) {\n                    this.internalTrimmedWidth = 0;\n                }\n                else {\n                    this.internalTrimmedWidth = this.width - lastChild.width + lastChild.trimmedWidth;\n                }\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutText.prototype.convertCoordinatesToOffset = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (cumulatedWidth + childWidth >= x) {\n                offset += child.convertCoordinatesToOffset(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        return offset;\n    };\n    LayoutText.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var childResults = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom, childTo);\n                childResults.push(childResult);\n                if (left1 === null) {\n                    left1 = left2 + childResult.boundingBoxes[0].left;\n                }\n                left2 += childResult.boundingBoxes\n                    .slice(0, childResult.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += childResult.boundingBoxes[0].left + childResult.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: childResults,\n        };\n    };\n    return LayoutText;\n}(LayoutNode));\nexport { LayoutText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutWord = /** @class */ (function (_super) {\n    __extends(LayoutWord, _super);\n    function LayoutWord(renderId, text, whitespaceSize, font, textService) {\n        var _this = _super.call(this, renderId, text, [], 0, 0, 0, 0) || this;\n        _this.whitespaceSize = whitespaceSize;\n        _this.font = font;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(LayoutWord.prototype, \"type\", {\n        get: function () {\n            return 'word';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"width\", {\n        get: function () {\n            var _a;\n            if (this.internalWidth === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"height\", {\n        get: function () {\n            var _a;\n            if (this.internalHeight === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var trimmedText = this.text.substring(0, this.text.length - this.whitespaceSize);\n                this.internalTrimmedWidth = this.textService.measure(trimmedText, this.font).width;\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutWord.prototype.convertCoordinatesToOffset = function (x, y) {\n        var lastWidth = 0;\n        var text = this.text;\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var measurement = this.textService.measure(text.substring(0, n), this.font);\n            var width_1 = measurement.width;\n            if (width_1 < x) {\n                lastWidth = width_1;\n                continue;\n            }\n            if (x - lastWidth < width_1 - x) {\n                return n - 1;\n            }\n            return n;\n        }\n        var width = this.width;\n        if (x - lastWidth < width - x) {\n            return text.length - 1;\n        }\n        return text.length;\n    };\n    LayoutWord.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        if (from === 0 && to === this.size) {\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: this.innerWidth,\n                        height: this.innerHeight,\n                        left: this.paddingLeft,\n                        right: this.paddingRight,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        if (from === to) {\n            var left = this.textService.measure(this.text.slice(0, from), this.font).width;\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: 0,\n                        height: this.innerHeight,\n                        left: this.paddingLeft + left,\n                        right: this.width - this.paddingLeft - left,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        var left1 = this.textService.measure(this.text.slice(0, from), this.font).width;\n        var left2 = this.textService.measure(this.text.slice(0, to), this.font).width;\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.innerWidth - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    LayoutWord.prototype.breakAt = function (offset) {\n        return [\n            new LayoutWord(this.renderId, this.text.substring(0, offset), 0, this.font, this.textService),\n            new LayoutWord(this.renderId, this.text.substring(offset), this.whitespaceSize, this.font, this.textService),\n        ];\n    };\n    LayoutWord.prototype.measure = function () {\n        var measurement = this.textService.measure(this.text, this.font);\n        return [measurement.width, measurement.height];\n    };\n    return LayoutWord;\n}(LayoutNode));\nexport { LayoutWord };\n","import { LayoutAtom } from './atom';\nimport { LayoutBlock } from './block';\nimport { LayoutDoc } from './doc';\nimport { LayoutLine } from './line';\nimport { LayoutPage } from './page';\nimport { LayoutText } from './text';\nimport { LayoutWord } from './word';\nvar LayoutEngine = /** @class */ (function () {\n    function LayoutEngine(textService) {\n        this.textService = textService;\n    }\n    LayoutEngine.prototype.updateDoc = function (doc, renderDoc) {\n        var _this = this;\n        if (!renderDoc.needLayout && doc) {\n            return doc;\n        }\n        var pages = [];\n        var childrenMap = {};\n        if (doc) {\n            doc.children.forEach(function (page) {\n                pages.push(page);\n                page.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderDoc.children.forEach(function (child) {\n            switch (child.type) {\n                case 'block':\n                    newChildren.push.apply(newChildren, _this.updateBlock(childrenMap[child.id] || [], child, renderDoc.width - renderDoc.paddingLeft - renderDoc.paddingRight));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + child.type + \" is invalid.\");\n            }\n        });\n        renderDoc.clearNeedLayout();\n        return this.buildDoc(renderDoc, this.reflowPages(pages, newChildren, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight));\n    };\n    LayoutEngine.prototype.updateBlock = function (blocks, renderBlock, width) {\n        var _this = this;\n        if (!renderBlock.needLayout && blocks.length > 0) {\n            return blocks;\n        }\n        var lines = [];\n        var childrenMap = {};\n        for (var _i = 0, blocks_1 = blocks; _i < blocks_1.length; _i++) {\n            var block = blocks_1[_i];\n            block.children.forEach(function (line) {\n                lines.push(line);\n                line.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderBlock.children.forEach(function (renderChild) {\n            switch (renderChild.type) {\n                case 'text':\n                    newChildren.push.apply(newChildren, _this.updateText(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                case 'atom':\n                    newChildren.push.apply(newChildren, _this.updateAtom(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + renderChild.type + \" is invalid.\");\n            }\n        });\n        renderBlock.clearNeedLayout();\n        return [\n            this.buildBlock(renderBlock, this.reflowLines(lines, newChildren, width - renderBlock.paddingLeft - renderBlock.paddingRight), width),\n        ];\n    };\n    LayoutEngine.prototype.updateText = function (texts, renderText) {\n        var _this = this;\n        if (!renderText.needLayout && texts.length > 0) {\n            return texts;\n        }\n        var newChildren = [];\n        this.textService.breakIntoWords(renderText.text).forEach(function (word) {\n            newChildren.push(_this.buildWord(renderText, word.text, word.whitespaceSize));\n        });\n        renderText.clearNeedLayout();\n        return [this.buildText(renderText, newChildren)];\n    };\n    LayoutEngine.prototype.updateAtom = function (atoms, renderAtom) {\n        if (!renderAtom.needLayout && atoms.length > 0) {\n            return atoms;\n        }\n        renderAtom.clearNeedLayout();\n        return [this.buildAtom(renderAtom)];\n    };\n    LayoutEngine.prototype.buildDoc = function (renderDoc, children) {\n        return new LayoutDoc(renderDoc.id, children, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight);\n    };\n    LayoutEngine.prototype.buildBlock = function (renderBlock, children, width) {\n        if (renderBlock.type !== 'block') {\n            throw new Error('Expected block.');\n        }\n        return new LayoutBlock(renderBlock.id, children, width, renderBlock.paddingTop, renderBlock.paddingBottom, renderBlock.paddingLeft, renderBlock.paddingRight);\n    };\n    LayoutEngine.prototype.buildText = function (renderText, children) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutText(renderText.id, children, renderText.paddingTop, renderText.paddingBottom, renderText.paddingLeft, renderText.paddingRight, renderText.font);\n    };\n    LayoutEngine.prototype.buildWord = function (renderText, text, whitespaceSize) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutWord(renderText.id, text, whitespaceSize, renderText.font, this.textService);\n    };\n    LayoutEngine.prototype.buildAtom = function (renderAtom) {\n        if (renderAtom.type !== 'atom') {\n            throw new Error('Expected atom.');\n        }\n        return new LayoutAtom(renderAtom.id, renderAtom.width, renderAtom.height);\n    };\n    LayoutEngine.prototype.reflowPages = function (pages, nodes, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var innerHeight = height - paddingTop - paddingBottom;\n        nodes = nodes.slice();\n        var newPages = [];\n        while (nodes.length > 0) {\n            if (newPages.length < pages.length) {\n                var page = pages[newPages.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = page.children.length; n < nn; n++) {\n                    var child = page.children.at(n);\n                    if (child.id !== nodes[n].id) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newPages.push(page);\n                    nodes.splice(0, page.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentHeight = 0;\n            // Push whole nodes to page until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentHeight + node.height <= innerHeight) {\n                newChildren.push(node);\n                currentHeight += node.height;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to page\n            if (node) {\n                var nodeChildren = [];\n                for (var m = 0, mm = node.children.length; m < mm; m++) {\n                    var nodeChild = node.children.at(m);\n                    if (currentHeight + nodeChild.height + node.paddingVertical > innerHeight) {\n                        break;\n                    }\n                    nodeChildren.push(nodeChild);\n                    currentHeight += nodeChild.height;\n                }\n                if (nodeChildren.length > 0) {\n                    switch (node.type) {\n                        case 'block':\n                            // Split block to two, one to push to this page, other goes back\n                            // to list of nodes to process\n                            var node1 = new LayoutBlock(node.renderId, nodeChildren, width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            newChildren.push(node1);\n                            currentHeight += node1.height;\n                            var node2 = new LayoutBlock(node.renderId, node.children.slice(nodeChildren.length), width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            nodes.unshift(node2);\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newPage = new LayoutPage(newChildren, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight);\n            newPages.push(newPage);\n        }\n        return newPages;\n    };\n    LayoutEngine.prototype.reflowLines = function (lines, nodes, width) {\n        nodes = nodes.slice();\n        var newLines = [];\n        while (nodes.length > 0) {\n            if (newLines.length < newLines.length) {\n                var line = lines[newLines.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = line.children.length; n < nn; n++) {\n                    var child = line.children.at(n);\n                    if (child.id !== nodes[n].id) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newLines.push(line);\n                    nodes.splice(0, line.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentWidth = 0;\n            // Push whole nodes to line until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentWidth + node.width <= width) {\n                newChildren.push(node);\n                currentWidth += node.width;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to line\n            if (node) {\n                var nodeChildren = node.children.slice();\n                var newNodeChildren = [];\n                for (var m = 0; m < nodeChildren.length; m++) {\n                    var nodeChild = nodeChildren[m];\n                    if (nodeChild.type === 'word' && nodeChild.width > width) {\n                        var breakAt = nodeChild.convertCoordinatesToOffset(width, 0);\n                        if (nodeChild.resolveBoundingBoxes(breakAt, breakAt).boundingBoxes[0].left > width) {\n                            breakAt--;\n                        }\n                        var _a = nodeChild.breakAt(breakAt), brokenNodeChild1 = _a[0], brokenNodeChild2 = _a[1];\n                        nodeChild = brokenNodeChild1;\n                        nodeChildren.splice(m, 1, brokenNodeChild1, brokenNodeChild2);\n                    }\n                    if (currentWidth + nodeChild.width > width) {\n                        break;\n                    }\n                    newNodeChildren.push(nodeChild);\n                    currentWidth += nodeChild.width;\n                }\n                if (newNodeChildren.length > 0) {\n                    switch (node.type) {\n                        case 'text':\n                            // Split text to two, one to push to this line, other goes back\n                            // to list of nodes to process\n                            var text = node;\n                            var node1 = new LayoutText(text.renderId, newNodeChildren, text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            newChildren.push(node1);\n                            currentWidth += node1.width;\n                            var node2 = new LayoutText(text.renderId, nodeChildren.slice(newNodeChildren.length), text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            nodes.unshift(node2);\n                            break;\n                        case 'atom':\n                            // If atom is wider than line and line is empty, push atom to line\n                            // and let it clip\n                            if (node.width > width && newChildren.length === 0) {\n                                newChildren.push(node);\n                            }\n                            else {\n                                // Atom cannot be split, goes back to list of nodes to process\n                                nodes.unshift(node);\n                            }\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newLine = new LayoutLine(newChildren, width);\n            newLines.push(newLine);\n        }\n        return newLines;\n    };\n    return LayoutEngine;\n}());\nexport { LayoutEngine };\n","import { EventEmitter } from '../event/emitter';\nimport { LayoutEngine } from './engine';\nvar LayoutState = /** @class */ (function () {\n    function LayoutState(renderService, textService) {\n        var _this = this;\n        this.renderService = renderService;\n        this.textService = textService;\n        this.didUpdateLayoutStateEventEmitter = new EventEmitter();\n        this.engine = new LayoutEngine(textService);\n        this.internalDoc = this.engine.updateDoc(null, renderService.getDoc());\n        renderService.onDidUpdateRenderState(function (event) { return _this.handleDidUpdateRenderStateEvent(event); });\n    }\n    Object.defineProperty(LayoutState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutState.prototype.onDidUpdateLayoutState = function (listener) {\n        return this.didUpdateLayoutStateEventEmitter.on(listener);\n    };\n    LayoutState.prototype.handleDidUpdateRenderStateEvent = function (event) {\n        this.update();\n    };\n    LayoutState.prototype.update = function () {\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.engine.updateDoc(this.doc, renderDoc);\n        this.didUpdateLayoutStateEventEmitter.emit({});\n    };\n    return LayoutState;\n}());\nexport { LayoutState };\n","import { LayoutState } from './state';\nvar LayoutService = /** @class */ (function () {\n    function LayoutService(renderService, textService) {\n        this.state = new LayoutState(renderService, textService);\n    }\n    LayoutService.prototype.onDidUpdateLayoutState = function (listener) {\n        this.state.onDidUpdateLayoutState(listener);\n    };\n    LayoutService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    LayoutService.prototype.resolvePosition = function (offset) {\n        return this.state.doc.resolvePosition(offset);\n    };\n    LayoutService.prototype.resolveBoundingBoxes = function (from, to) {\n        return this.state.doc.resolveBoundingBoxes(from, to);\n    };\n    return LayoutService;\n}());\nexport { LayoutService };\n","import { EventEmitter } from '../event/emitter';\nvar ModelState = /** @class */ (function () {\n    function ModelState(root, componentService) {\n        this.root = root;\n        this.componentService = componentService;\n        this.didUpdateEventEmitter = new EventEmitter();\n    }\n    ModelState.prototype.applyChange = function (change) {\n        var changeResult = change.apply(this.root, this.componentService);\n        this.didUpdateEventEmitter.emit({ changeResult: changeResult });\n        return changeResult;\n    };\n    ModelState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelState;\n}());\nexport { ModelState };\n","import { ModelState } from './state';\nvar ModelService = /** @class */ (function () {\n    function ModelService(root, componentService) {\n        this.state = new ModelState(root, componentService);\n    }\n    ModelService.prototype.getRoot = function () {\n        return this.state.root;\n    };\n    ModelService.prototype.getRootSize = function () {\n        return this.state.root.size;\n    };\n    ModelService.prototype.applyChange = function (change) {\n        return this.state.applyChange(change);\n    };\n    ModelService.prototype.resolvePosition = function (offset) {\n        return this.state.root.resolvePosition(offset);\n    };\n    ModelService.prototype.toDOM = function (from, to) {\n        return this.state.root.toDOM(from, to);\n    };\n    ModelService.prototype.fromDOM = function (domNodes) {\n        return [this.getRoot()];\n    };\n    ModelService.prototype.onDidUpdateModelState = function (listener) {\n        this.state.onDidUpdate(listener);\n    };\n    return ModelService;\n}());\nexport { ModelService };\n","import { EventEmitter } from '../event/emitter';\nvar RenderState = /** @class */ (function () {\n    function RenderState(componentService, modelService) {\n        var _this = this;\n        this.componentService = componentService;\n        this.modelService = modelService;\n        this.didUpdateRenderStateEventEmitter = new EventEmitter();\n        var modelRoot = modelService.getRoot();\n        this.internalDoc = this.updateNode(null, modelRoot);\n        modelService.onDidUpdateModelState(function (event) { return _this.handleDidUpdateModelState(event); });\n    }\n    RenderState.prototype.onDidUpdateRenderState = function (listener) {\n        return this.didUpdateRenderStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(RenderState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderState.prototype.handleDidUpdateModelState = function (event) {\n        this.update();\n    };\n    RenderState.prototype.update = function () {\n        var modelRoot = this.modelService.getRoot();\n        this.internalDoc = this.updateNode(this.doc, modelRoot);\n        this.didUpdateRenderStateEventEmitter.emit({});\n    };\n    RenderState.prototype.updateNode = function (node, modelNode) {\n        var _this = this;\n        if (!modelNode.needRender && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.modelId) {\n                    return;\n                }\n                childrenMap[child.modelId] = child;\n            });\n        }\n        var newChildren = [];\n        modelNode.children.forEach(function (modelChild) {\n            newChildren.push(_this.updateNode(childrenMap[modelChild.id] || null, modelChild));\n        });\n        modelNode.clearNeedRender();\n        return this.buildNode(modelNode, newChildren);\n    };\n    RenderState.prototype.buildNode = function (modelNode, children) {\n        var component = this.componentService.getComponent(modelNode.componentId);\n        var node = component.buildRenderNode(modelNode.partId, modelNode.id, modelNode.text, modelNode.attributes, children);\n        if (!node) {\n            throw new Error(\"Error building render node from model node \" + modelNode.id + \".\");\n        }\n        return node;\n    };\n    return RenderState;\n}());\nexport { RenderState };\n","import { RenderState } from './state';\nvar RenderService = /** @class */ (function () {\n    function RenderService(componentService, modelService) {\n        this.state = new RenderState(componentService, modelService);\n    }\n    RenderService.prototype.onDidUpdateRenderState = function (listener) {\n        this.state.onDidUpdateRenderState(listener);\n    };\n    RenderService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    RenderService.prototype.getDocSize = function () {\n        return this.state.doc.size;\n    };\n    RenderService.prototype.convertOffsetToModelOffset = function (offset) {\n        return this.state.doc.convertOffsetToModelOffset(offset);\n    };\n    RenderService.prototype.convertModelOffsetToOffset = function (modelOffset) {\n        return this.state.doc.convertModelOffsetToOffset(modelOffset);\n    };\n    RenderService.prototype.resolvePosition = function (offset) {\n        return this.state.doc.resolvePosition(offset);\n    };\n    RenderService.prototype.getStylesBetween = function (from, to) {\n        var styles = {};\n        var doc = this.state.doc;\n        this.extractStyle(styles, doc, from, to);\n        return styles;\n    };\n    RenderService.prototype.extractStyle = function (styles, node, from, to) {\n        var _this = this;\n        if (from > to) {\n            return;\n        }\n        var componentStyles = (styles[node.componentId] = styles[node.componentId] || {});\n        var partStyles = (componentStyles[node.partId || ''] = componentStyles[node.partId || ''] || []);\n        partStyles.push(node.style);\n        var position = 0;\n        node.children.forEach(function (child) {\n            var childSize = child.size;\n            if (to - position >= 0 && from - position < childSize) {\n                var childFrom = Math.max(0, Math.min(childSize, from - position));\n                var childTo = Math.max(0, Math.min(childSize, to - position));\n                _this.extractStyle(styles, child, childFrom, childTo);\n            }\n            position += childSize;\n        });\n    };\n    return RenderService;\n}());\nexport { RenderService };\n","var ServiceRegistry = /** @class */ (function () {\n    function ServiceRegistry() {\n        this.services = {};\n    }\n    ServiceRegistry.prototype.registerService = function (key, service) {\n        this.services[key] = service;\n    };\n    ServiceRegistry.prototype.getService = function (key) {\n        var service = this.services[key];\n        if (!service) {\n            throw new Error(\"Service \" + key + \" is not registered.\");\n        }\n        return service;\n    };\n    return ServiceRegistry;\n}());\nexport { ServiceRegistry };\n","import { EventEmitter } from '../event/emitter';\nvar TransformService = /** @class */ (function () {\n    function TransformService(modelService, componentService, cursorService, renderService, layoutService) {\n        this.modelService = modelService;\n        this.componentService = componentService;\n        this.cursorService = cursorService;\n        this.renderService = renderService;\n        this.layoutService = layoutService;\n        this.didApplyTransformationEventEmitter = new EventEmitter();\n    }\n    TransformService.prototype.applyTransformation = function (tn) {\n        var result = tn.apply(this.modelService, this.cursorService, this.renderService, this.layoutService);\n        this.didApplyTransformationEventEmitter.emit({ result: result });\n        return result;\n    };\n    TransformService.prototype.onDidApplyTransformation = function (listener) {\n        return this.didApplyTransformationEventEmitter.on(listener);\n    };\n    return TransformService;\n}());\nexport { TransformService };\n","var CursorView = /** @class */ (function () {\n    function CursorView(instanceId, configService, domService, cursorService, layoutService, viewService, transformService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.configService = configService;\n        this.domService = domService;\n        this.cursorService = cursorService;\n        this.layoutService = layoutService;\n        this.viewService = viewService;\n        this.transformService = transformService;\n        this.blinkInterval = null;\n        this.blinkState = true;\n        this.domSelections = [];\n        this.attached = false;\n        var cursorConfig = configService.getConfig().cursor;\n        this.caretColor = cursorConfig.caretColor;\n        this.caretInactiveColor = cursorConfig.caretInactiveColor;\n        this.selectionColor = cursorConfig.selectionColor;\n        this.selectionInactiveColor = cursorConfig.selectionInactiveColor;\n        this.domCaret = domService.createElement('div');\n        this.domCaret.className = 'tw--cursor--caret';\n        this.domCaret.setAttribute('data-tw-instance', this.instanceId);\n        this.domCaret.style.position = 'absolute';\n        this.domCaret.style.userSelect = 'none';\n        this.domCaret.style.pointerEvents = 'none';\n        this.domCaret.style.width = '2px';\n        this.domCaret.style.marginLeft = '-1px';\n        transformService.onDidApplyTransformation(function (event) { return _this.handleDidApplyTransformation(event); });\n        viewService.onDidFocus(function (event) { return _this.handleDidFocus(event); });\n        viewService.onDidBlur(function (event) { return _this.handleDidBlur(event); });\n    }\n    CursorView.prototype.attach = function () {\n        if (this.attached) {\n            throw new Error('Already attached to the DOM.');\n        }\n        this.attached = true;\n        this.updateView();\n    };\n    CursorView.prototype.updateView = function () {\n        var _this = this;\n        if (!this.attached) {\n            return;\n        }\n        this.clearDOMSelections();\n        var _a = this.cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        var from = Math.min(anchor, head);\n        var to = Math.max(anchor, head);\n        var docBoxResult = this.layoutService.resolveBoundingBoxes(from, to);\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var focused = this.viewService.isFocused();\n        var firstPageId = '';\n        var firstBoxOffset = -1;\n        var lastPageId = '';\n        var lastBoxOffset = -1;\n        docBoxResult.children.forEach(function (pageBoxResult) {\n            var pageOffset = layoutDoc.children.indexOf(pageBoxResult.node);\n            var viewPage = viewDoc.children.at(pageOffset);\n            var domContentContainer = viewPage.domContentContainer;\n            pageBoxResult.boundingBoxes.forEach(function (box, boxOffset) {\n                if (!firstPageId) {\n                    firstPageId = pageBoxResult.node.id;\n                    firstBoxOffset = boxOffset;\n                }\n                lastPageId = pageBoxResult.node.id;\n                lastBoxOffset = boxOffset;\n                if (box.width === 0) {\n                    return;\n                }\n                var domSelection = _this.buildDOMSelection(box);\n                if (focused) {\n                    domSelection.style.background = _this.selectionColor;\n                }\n                else {\n                    domSelection.style.background = _this.selectionInactiveColor;\n                }\n                domContentContainer.appendChild(domSelection);\n                _this.domSelections.push(domSelection);\n            });\n        });\n        var headPageId;\n        var headLeft;\n        var headTop;\n        var headHeight;\n        if (head < anchor) {\n            headPageId = firstPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === firstPageId; }).boundingBoxes[firstBoxOffset];\n            headLeft = rect.left;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        else {\n            headPageId = lastPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === lastPageId; }).boundingBoxes[lastBoxOffset];\n            headLeft = rect.left + rect.width;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        if (head === anchor) {\n            this.domCaret.style.display = 'block';\n            this.domCaret.style.top = headTop + \"px\";\n            this.domCaret.style.left = headLeft + \"px\";\n            this.domCaret.style.height = headHeight + \"px\";\n            if (focused) {\n                this.domCaret.style.background = this.caretColor;\n            }\n            else {\n                this.domCaret.style.background = this.caretInactiveColor;\n            }\n            var pageDOMContentContainer = viewDoc.children.find(function (child) { return child.id === headPageId; })\n                .domContentContainer;\n            if (this.domCaret.parentElement && this.domCaret.parentElement !== pageDOMContentContainer) {\n                this.domCaret.parentElement.removeChild(this.domCaret);\n            }\n            if (!this.domCaret.parentElement) {\n                pageDOMContentContainer.appendChild(this.domCaret);\n            }\n            this.blinkStop();\n            if (focused) {\n                this.blinkStart();\n            }\n        }\n        else {\n            this.domCaret.style.display = 'none';\n            this.blinkStop();\n        }\n    };\n    CursorView.prototype.blinkStart = function () {\n        var _this = this;\n        if (this.blinkInterval !== null) {\n            return;\n        }\n        this.blinkState = true;\n        this.blinkInterval = window.setInterval(function () {\n            _this.blinkState = !_this.blinkState;\n            _this.updateDOMBlink();\n        }, 500);\n    };\n    CursorView.prototype.blinkStop = function () {\n        if (this.blinkInterval === null) {\n            return;\n        }\n        this.domCaret.style.visibility = 'visible';\n        clearInterval(this.blinkInterval);\n        this.blinkInterval = null;\n    };\n    CursorView.prototype.updateDOMBlink = function () {\n        if (this.blinkState) {\n            this.domCaret.style.visibility = 'visible';\n        }\n        else {\n            this.domCaret.style.visibility = 'hidden';\n        }\n    };\n    CursorView.prototype.clearDOMSelections = function () {\n        this.domSelections.forEach(function (domSelection) {\n            if (domSelection.parentElement) {\n                domSelection.parentElement.removeChild(domSelection);\n            }\n        });\n        this.domSelections = [];\n    };\n    CursorView.prototype.buildDOMSelection = function (box) {\n        var domSelection = document.createElement('div');\n        domSelection.className = 'tw--cursor--selection';\n        domSelection.setAttribute('data-tw-instance', this.instanceId);\n        domSelection.style.position = 'absolute';\n        domSelection.style.top = box.top + \"px\";\n        domSelection.style.left = box.left + \"px\";\n        domSelection.style.width = box.width + \"px\";\n        domSelection.style.height = box.height + \"px\";\n        domSelection.style.userSelect = 'none';\n        domSelection.style.pointerEvents = 'none';\n        return domSelection;\n    };\n    CursorView.prototype.handleDidApplyTransformation = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidFocus = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidBlur = function (event) {\n        this.updateView();\n    };\n    return CursorView;\n}());\nexport { CursorView };\n","import { EventEmitter } from '../event/emitter';\nvar ClipboardObserver = /** @class */ (function () {\n    function ClipboardObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didCopyEventEmitter = new EventEmitter();\n        this.didPasteEventEmitter = new EventEmitter();\n        this.handleCopy = function (event) {\n            event.preventDefault();\n            _this.didCopyEventEmitter.emit({});\n        };\n        this.handlePaste = function (event) {\n            event.preventDefault();\n            var data = event.clipboardData;\n            if (!data) {\n                return;\n            }\n            _this.didPasteEventEmitter.emit({ data: data });\n        };\n        $contentEditable.addEventListener('copy', this.handleCopy);\n        $contentEditable.addEventListener('paste', this.handlePaste);\n    }\n    ClipboardObserver.prototype.onDidCopy = function (listener) {\n        return this.didCopyEventEmitter.on(listener);\n    };\n    ClipboardObserver.prototype.onDidPaste = function (listener) {\n        return this.didPasteEventEmitter.on(listener);\n    };\n    return ClipboardObserver;\n}());\nexport { ClipboardObserver };\n","import { EventEmitter } from '../event/emitter';\nvar FocusObserver = /** @class */ (function () {\n    function FocusObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didFocusEventEmitter = new EventEmitter();\n        this.didBlurEventEmitter = new EventEmitter();\n        this.handleFocus = function () {\n            _this.didFocusEventEmitter.emit({});\n        };\n        this.handleBlur = function () {\n            _this.didBlurEventEmitter.emit({});\n        };\n        $contentEditable.addEventListener('focus', this.handleFocus);\n        $contentEditable.addEventListener('blur', this.handleBlur);\n    }\n    FocusObserver.prototype.onDidFocus = function (listener) {\n        return this.didFocusEventEmitter.on(listener);\n    };\n    FocusObserver.prototype.onDidBlur = function (listener) {\n        return this.didBlurEventEmitter.on(listener);\n    };\n    return FocusObserver;\n}());\nexport { FocusObserver };\n","import { EventEmitter } from '../event/emitter';\nimport { detectPlatform } from '../util/platform';\nvar KeyboardObserver = /** @class */ (function () {\n    function KeyboardObserver($contentEditable, domService) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.domService = domService;\n        this.composing = false;\n        this.didInsertEventEmitter = new EventEmitter();\n        this.didPressKeyEventEmitter = new EventEmitter();\n        this.compositionDidStartEventEmitter = new EventEmitter();\n        this.compositionDidEndEventEmitter = new EventEmitter();\n        this.keyInterpreter = new KeyInterpreter();\n        this.handleDidMutate = function () {\n            setTimeout(function () {\n                if (_this.composing) {\n                    return;\n                }\n                var content = _this.$contentEditable.innerText;\n                _this.$contentEditable.innerHTML = '';\n                if (content.length === 0) {\n                    return;\n                }\n                _this.didInsertEventEmitter.emit({ content: content });\n            });\n        };\n        this.handleKeyDown = function (event) {\n            var key = _this.keyInterpreter.interpretFromKeyboardEvent(event);\n            if (!key) {\n                return;\n            }\n            _this.didPressKeyEventEmitter.emit({ key: key, originalKeyboardEvent: event });\n        };\n        this.handleCompositionStart = function () {\n            _this.composing = true;\n        };\n        this.handleCompositionEnd = function () {\n            _this.composing = true;\n        };\n        this.mutationObserver = domService.createMutationObserver(this.handleDidMutate);\n        $contentEditable.addEventListener('keydown', this.handleKeyDown);\n        $contentEditable.addEventListener('compositionstart', this.handleCompositionStart);\n        $contentEditable.addEventListener('compositionend', this.handleCompositionEnd);\n        this.mutationObserver.observe($contentEditable, {\n            subtree: true,\n            characterData: true,\n            childList: true,\n        });\n    }\n    KeyboardObserver.prototype.onDidInsert = function (listener) {\n        return this.didInsertEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onDidPressKey = function (listener) {\n        return this.didPressKeyEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidStart = function (listener) {\n        return this.compositionDidStartEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidEnd = function (listener) {\n        return this.compositionDidEndEventEmitter.on(listener);\n    };\n    return KeyboardObserver;\n}());\nexport { KeyboardObserver };\nvar KeyInterpreter = /** @class */ (function () {\n    function KeyInterpreter() {\n    }\n    KeyInterpreter.prototype.interpretFromKeyboardEvent = function (event) {\n        var key;\n        switch (event.key) {\n            case 'Control':\n            case 'Shift':\n            case 'Alt':\n            case 'Meta':\n                return undefined;\n            case 'ArrowLeft':\n                key = 'left';\n                break;\n            case 'ArrowRight':\n                key = 'right';\n                break;\n            case 'ArrowUp':\n                key = 'up';\n                break;\n            case 'ArrowDown':\n                key = 'down';\n                break;\n            default:\n                key = event.key.toLowerCase();\n        }\n        if (event.metaKey) {\n            switch (detectPlatform()) {\n                case 'macOS':\n                    key = \"cmd+\" + key;\n                    break;\n                case 'Windows':\n                    key = \"win+\" + key;\n                    break;\n                case 'Linux':\n                default:\n                    key = \"meta+\" + key;\n            }\n        }\n        if (event.altKey) {\n            key = \"alt+\" + key;\n        }\n        if (event.shiftKey) {\n            key = \"shift+\" + key;\n        }\n        if (event.ctrlKey) {\n            key = \"ctrl+\" + key;\n        }\n        return key;\n    };\n    return KeyInterpreter;\n}());\n","import { EventEmitter } from '../event/emitter';\nvar PointerObserver = /** @class */ (function () {\n    function PointerObserver(instanceId, viewService, domService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.viewService = viewService;\n        this.domService = domService;\n        this.layoutService = layoutService;\n        this.clickThreshold = 250;\n        this.consecutiveClickThreshold = 250;\n        this.lastPointerDown = null;\n        this.lastClick = null;\n        this.consecutiveClickCount = 0;\n        this.pointerDidDownEventEmitter = new EventEmitter();\n        this.pointerDidMoveEventEmitter = new EventEmitter();\n        this.pointerDidUpEventEmitter = new EventEmitter();\n        this.pointerDidClickEventEmitter = new EventEmitter();\n        this.handleMouseDown = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            // Bypass browser selection\n            event.preventDefault();\n            _this.lastPointerDown = {\n                timestamp: Date.now(),\n                offset: offset,\n            };\n            var consecutive = _this.lastClick !== null && Date.now() - _this.lastClick.timestamp < _this.consecutiveClickThreshold;\n            _this.pointerDidDownEventEmitter.emit({ offset: offset, consecutive: consecutive });\n        };\n        this.handleMouseMove = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            _this.pointerDidMoveEventEmitter.emit({\n                pointerDown: _this.lastPointerDown !== null,\n                offset: offset,\n            });\n        };\n        this.handleMouseUp = function (event) {\n            if (_this.lastPointerDown === null) {\n                return;\n            }\n            var lastPointerDown = _this.lastPointerDown;\n            _this.lastPointerDown = null;\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            var now = Date.now();\n            var clicked = lastPointerDown.offset === offset && now - lastPointerDown.timestamp < _this.clickThreshold;\n            _this.pointerDidUpEventEmitter.emit({});\n            if (clicked) {\n                if (_this.lastClick !== null) {\n                    var delta = now - _this.lastClick.timestamp;\n                    if (delta > _this.consecutiveClickThreshold) {\n                        _this.consecutiveClickCount = 0;\n                    }\n                }\n                _this.consecutiveClickCount++;\n                _this.lastClick = {\n                    timestamp: Date.now(),\n                    offset: offset,\n                };\n                _this.pointerDidClickEventEmitter.emit({\n                    offset: offset,\n                    consecutiveCount: _this.consecutiveClickCount,\n                });\n            }\n        };\n        var window = domService.getWindow();\n        window.addEventListener('mousedown', this.handleMouseDown);\n        window.addEventListener('mousemove', this.handleMouseMove);\n        window.addEventListener('mouseup', this.handleMouseUp);\n    }\n    PointerObserver.prototype.onPointerDidDown = function (listener) {\n        return this.pointerDidDownEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidMove = function (listener) {\n        return this.pointerDidMoveEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidUp = function (listener) {\n        return this.pointerDidUpEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidClick = function (listener) {\n        return this.pointerDidClickEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.resolveOffset = function (x, y) {\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var cumulatedOffset = 0;\n        for (var n = 0, nn = viewDoc.children.length; n < nn; n++) {\n            var viewPage = viewDoc.children.at(n);\n            var layoutPage = layoutDoc.children.at(n);\n            var pageBoundingClientRect = viewPage.domContainer.getBoundingClientRect();\n            if (pageBoundingClientRect.left <= x &&\n                pageBoundingClientRect.right >= x &&\n                pageBoundingClientRect.top <= y &&\n                pageBoundingClientRect.bottom >= y) {\n                var pageX = x - pageBoundingClientRect.left;\n                var pageY = y - pageBoundingClientRect.top;\n                return cumulatedOffset + layoutPage.convertCoordinatesToOffset(pageX, pageY);\n            }\n            cumulatedOffset += layoutPage.size;\n        }\n        return null;\n    };\n    return PointerObserver;\n}());\nexport { PointerObserver };\n","import { ClipboardObserver } from './clipboard-observer';\nimport { FocusObserver } from './focus-observer';\nimport { KeyboardObserver, } from './keyboard-observer';\nimport { PointerObserver, } from './pointer-observer';\nvar DOMController = /** @class */ (function () {\n    function DOMController(instanceId, domService, commandService, modelService, viewService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.domService = domService;\n        this.commandService = commandService;\n        this.modelService = modelService;\n        this.viewService = viewService;\n        this.layoutService = layoutService;\n        this.focused = false;\n        this.composing = false;\n        this.mouseDown = false;\n        this.handleDidInsert = function (event) {\n            _this.commandService.executeCommand('tw.state.insert', event.content);\n        };\n        this.handleCompositionDidStart = function (event) {\n            _this.composing = true;\n        };\n        this.handleCompositionDidEnd = function (event) {\n            _this.composing = false;\n        };\n        this.handlePointerDidDown = function (event) {\n            if (!_this.focused) {\n                _this.commandService.executeCommand('tw.view.focus');\n            }\n            if (!event.consecutive) {\n                _this.commandService.executeCommand('tw.cursor.move', event.offset);\n            }\n        };\n        this.handlePointerDidMove = function (event) {\n            if (event.pointerDown) {\n                _this.commandService.executeCommand('tw.cursor.moveHead', event.offset);\n            }\n        };\n        this.handlePointerDidClick = function (event) {\n            switch (event.consecutiveCount) {\n                case 1: {\n                    break;\n                }\n                case 2:\n                    _this.commandService.executeCommand('tw.cursor.selectWord', event.offset);\n                    break;\n                case 3:\n                default:\n                    _this.commandService.executeCommand('tw.cursor.selectBlock', event.offset);\n                    break;\n            }\n        };\n        this.handleDidFocus = function (event) {\n            _this.focused = true;\n        };\n        this.handleDidBlur = function (event) {\n            _this.focused = false;\n        };\n        this.handleCopy = function (event) {\n            _this.commandService.executeCommand('tw.clipboard.copy');\n        };\n        this.handlePaste = function (event) {\n            var html = event.data.getData('text/html');\n            var $container = _this.domService.createElement('html');\n            $container.innerHTML = html;\n            var $body = $container.querySelector('body');\n            if (!$body) {\n                return;\n            }\n            var domNodes = Array.prototype.slice.call($body.children);\n            var modelNodes = _this.modelService.fromDOM(domNodes);\n            // TODO: Insert modelNodes to cursor location\n            console.log(modelNodes);\n        };\n        this.iframe = domService.createHiddenIframe();\n        this.$contentEditable = this.createContentEditable();\n        this.keyboardObserver = new KeyboardObserver(this.$contentEditable, domService);\n        this.keyboardObserver.onDidInsert(this.handleDidInsert);\n        this.keyboardObserver.onCompositionDidStart(this.handleCompositionDidStart);\n        this.keyboardObserver.onCompositionDidEnd(this.handleCompositionDidEnd);\n        this.pointerObserver = new PointerObserver(instanceId, viewService, domService, layoutService);\n        this.pointerObserver.onPointerDidDown(this.handlePointerDidDown);\n        this.pointerObserver.onPointerDidMove(this.handlePointerDidMove);\n        this.pointerObserver.onPointerDidClick(this.handlePointerDidClick);\n        this.focusObserver = new FocusObserver(this.$contentEditable);\n        this.focusObserver.onDidFocus(this.handleDidFocus);\n        this.focusObserver.onDidBlur(this.handleDidBlur);\n        this.clipboardObserver = new ClipboardObserver(this.$contentEditable);\n        this.clipboardObserver.onDidCopy(this.handleCopy);\n        this.clipboardObserver.onDidPaste(this.handlePaste);\n    }\n    DOMController.prototype.onDidPressKey = function (listener) {\n        this.keyboardObserver.onDidPressKey(listener);\n    };\n    DOMController.prototype.onDidFocus = function (listener) {\n        this.focusObserver.onDidFocus(listener);\n    };\n    DOMController.prototype.onDidBlur = function (listener) {\n        this.focusObserver.onDidBlur(listener);\n    };\n    DOMController.prototype.attach = function () {\n        var _this = this;\n        this.domService.getBody().appendChild(this.iframe);\n        setTimeout(function () {\n            _this.iframe.contentDocument.body.appendChild(_this.$contentEditable);\n        });\n    };\n    DOMController.prototype.requestFocus = function () {\n        this.$contentEditable.focus();\n    };\n    DOMController.prototype.requestBlur = function () {\n        this.$contentEditable.blur();\n    };\n    DOMController.prototype.isFocused = function () {\n        return this.focused;\n    };\n    DOMController.prototype.isComposing = function () {\n        return this.composing;\n    };\n    DOMController.prototype.createContentEditable = function () {\n        var $contentEditable = this.domService.createElement('div');\n        $contentEditable.contentEditable = 'true';\n        $contentEditable.style.whiteSpace = 'pre';\n        return $contentEditable;\n    };\n    return DOMController;\n}());\nexport { DOMController };\n","import { EventEmitter } from '../event/emitter';\nvar ViewState = /** @class */ (function () {\n    function ViewState(instanceId, componentService, layoutService, renderService, domService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.componentService = componentService;\n        this.layoutService = layoutService;\n        this.renderService = renderService;\n        this.domService = domService;\n        this.didUpdateViewStateEventEmitter = new EventEmitter();\n        this.domContainer = null;\n        var layoutDoc = layoutService.getDoc();\n        var renderDoc = renderService.getDoc();\n        this.internalDoc = this.updateNode(null, layoutDoc, renderDoc);\n        layoutService.onDidUpdateLayoutState(function (event) { return _this.handleDidUpdateLayoutStateEvent(event); });\n    }\n    ViewState.prototype.onDidUpdateViewState = function (listener) {\n        return this.didUpdateViewStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(ViewState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewState.prototype.attach = function (domContainer) {\n        this.domContainer = domContainer;\n        this.reattachDoc();\n    };\n    ViewState.prototype.handleDidUpdateLayoutStateEvent = function (event) {\n        this.update();\n    };\n    ViewState.prototype.update = function () {\n        var layoutDoc = this.layoutService.getDoc();\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.updateNode(this.doc, layoutDoc, renderDoc);\n        this.reattachDoc();\n        this.didUpdateViewStateEventEmitter.emit({});\n    };\n    ViewState.prototype.reattachDoc = function () {\n        if (!this.domContainer) {\n            return;\n        }\n        this.domContainer.innerHTML = '';\n        this.domContainer.appendChild(this.doc.domContainer);\n    };\n    ViewState.prototype.updateNode = function (node, layoutNode, renderNode) {\n        var _this = this;\n        if (!layoutNode.needView && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.layoutId) {\n                    return;\n                }\n                childrenMap[child.layoutId] = child;\n            });\n        }\n        var renderChildrenMap = {};\n        if (renderNode) {\n            renderNode.children.forEach(function (renderChild) {\n                renderChildrenMap[renderChild.id] = renderChild;\n            });\n        }\n        var newChildren = [];\n        if (layoutNode.type !== 'text') {\n            layoutNode.children.forEach(function (layoutChild) {\n                var child = childrenMap[layoutChild.id] || null;\n                var renderChild = null;\n                if (layoutChild.renderId) {\n                    renderChild = renderChildrenMap[layoutChild.renderId] || null;\n                    if (!renderChild) {\n                        throw new Error('Render node not found.');\n                    }\n                }\n                newChildren.push(_this.updateNode(child, layoutChild, renderChild || renderNode));\n            });\n        }\n        layoutNode.clearNeedView();\n        var domContainer = node ? node.domContainer : this.domService.createContainer();\n        var newNode = this.buildNode(domContainer, layoutNode, renderNode, newChildren);\n        return newNode;\n    };\n    ViewState.prototype.buildNode = function (domContainer, layoutNode, renderNode, children) {\n        switch (layoutNode.type) {\n            case 'page':\n                return this.buildPageNode(domContainer, layoutNode, children);\n            case 'line':\n                return this.buildLineNode(domContainer, layoutNode, children);\n        }\n        var component = this.componentService.getComponent(renderNode.componentId);\n        var text = layoutNode.type === 'text' ? layoutNode.children.map(function (child) { return child.text; }).join('') : layoutNode.text;\n        var node = component.buildViewNode(domContainer, renderNode.partId, renderNode.id, layoutNode.id, text, renderNode.style, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        if (!node) {\n            throw new Error(\"Error building view node from render node \" + renderNode.id + \".\");\n        }\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildPageNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getPageComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildLineNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getLineComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.applyMetadataToDOMContainer = function (viewNode) {\n        var domContainer = viewNode.domContainer;\n        var componentId = viewNode.componentId;\n        var partId = viewNode.partId;\n        var id = viewNode.id;\n        domContainer.className = \"tw--\" + componentId + \"--\" + partId;\n        domContainer.setAttribute('data-tw-instance', this.instanceId);\n        if (componentId) {\n            domContainer.setAttribute('data-tw-component', componentId);\n        }\n        if (partId) {\n            domContainer.setAttribute('data-tw-part', partId);\n        }\n        domContainer.setAttribute('data-tw-id', id);\n    };\n    return ViewState;\n}());\nexport { ViewState };\n","import { CursorView } from './cursor';\nimport { DOMController } from './dom-controller';\nimport { ViewState } from './state';\nvar ViewService = /** @class */ (function () {\n    function ViewService(instanceId, configService, domService, componentService, modelService, layoutService, cursorService, renderService, commandService, transformService) {\n        this.state = new ViewState(instanceId, componentService, layoutService, renderService, domService);\n        this.domController = new DOMController(instanceId, domService, commandService, modelService, this, layoutService);\n        this.cursor = new CursorView(instanceId, configService, domService, cursorService, layoutService, this, transformService);\n    }\n    ViewService.prototype.onDidUpdateViewState = function (listener) {\n        this.state.onDidUpdateViewState(listener);\n    };\n    ViewService.prototype.onDidFocus = function (listener) {\n        this.domController.onDidFocus(listener);\n    };\n    ViewService.prototype.onDidBlur = function (listener) {\n        this.domController.onDidBlur(listener);\n    };\n    ViewService.prototype.onDidPressKey = function (listener) {\n        this.domController.onDidPressKey(listener);\n    };\n    ViewService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    ViewService.prototype.isFocused = function () {\n        return this.domController.isFocused();\n    };\n    ViewService.prototype.attach = function (domContainer) {\n        this.state.attach(domContainer);\n        this.cursor.attach();\n        this.domController.attach();\n    };\n    ViewService.prototype.requestFocus = function () {\n        this.domController.requestFocus();\n    };\n    ViewService.prototype.requestBlur = function () {\n        this.domController.requestBlur();\n    };\n    return ViewService;\n}());\nexport { ViewService };\n","import * as clipboardCommandHandlers from './command/handlers/clipboard';\nimport * as cursorCommandHandlers from './command/handlers/cursor';\nimport * as historyCommandHandlers from './command/handlers/history';\nimport * as stateCommandHandlers from './command/handlers/state';\nimport * as viewCommandHandlers from './command/handlers/view';\nimport { CommandService } from './command/service';\nimport { DocComponent } from './component/components/doc';\nimport { ParagraphComponent } from './component/components/paragraph';\nimport { TextComponent } from './component/components/text';\nimport { ComponentService } from './component/service';\nimport { ConfigService } from './config/service';\nimport { CursorService } from './cursor/service';\nimport { DOMService } from './dom/service';\nimport { HistoryService } from './history/service';\nimport { KeyBindingService } from './key-binding/service';\nimport { LayoutService } from './layout/service';\nimport { ReplaceChange } from './model/change/replace';\nimport { Fragment } from './model/fragment';\nimport { ModelService } from './model/service';\nimport { RenderService } from './render/service';\nimport { ServiceRegistry } from './service/registry';\nimport { TextService } from './text/service';\nimport { TransformService } from './transform/service';\nimport { Transformation } from './transform/transformation';\nimport { generateId } from './util/id';\nimport { ViewService } from './view/service';\nvar Taleweaver = /** @class */ (function () {\n    function Taleweaver(root, config) {\n        this.instanceId = generateId();\n        this.serviceRegistry = new ServiceRegistry();\n        this.configService = new ConfigService(this.buildBaseConfig(), config);\n        this.serviceRegistry.registerService('config', this.configService);\n        this.domService = new DOMService();\n        this.serviceRegistry.registerService('dom', this.domService);\n        this.textService = new TextService(this.domService);\n        this.serviceRegistry.registerService('text', this.textService);\n        this.commandService = new CommandService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('command', this.commandService);\n        this.componentService = new ComponentService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('component', this.componentService);\n        this.modelService = new ModelService(root, this.componentService);\n        this.serviceRegistry.registerService('model', this.modelService);\n        this.renderService = new RenderService(this.componentService, this.modelService);\n        this.serviceRegistry.registerService('render', this.renderService);\n        this.cursorService = new CursorService(this.configService, this.renderService, this.modelService);\n        this.serviceRegistry.registerService('cursor', this.cursorService);\n        this.layoutService = new LayoutService(this.renderService, this.textService);\n        this.serviceRegistry.registerService('layout', this.layoutService);\n        this.transformService = new TransformService(this.modelService, this.componentService, this.cursorService, this.renderService, this.layoutService);\n        this.serviceRegistry.registerService('transform', this.transformService);\n        this.viewService = new ViewService(this.instanceId, this.configService, this.domService, this.componentService, this.modelService, this.layoutService, this.cursorService, this.renderService, this.commandService, this.transformService);\n        this.serviceRegistry.registerService('view', this.viewService);\n        this.historyService = new HistoryService(this.configService, this.transformService);\n        this.serviceRegistry.registerService('history', this.historyService);\n        this.keyBindingService = new KeyBindingService(this.configService, this.commandService, this.viewService);\n        this.serviceRegistry.registerService('keyBinding', this.keyBindingService);\n    }\n    Taleweaver.prototype.setContent = function (root) {\n        this.transformService.applyTransformation(new Transformation([\n            new ReplaceChange(1, this.modelService.getRootSize() - 1, [new Fragment(root.children.slice(), 0)]),\n        ]));\n    };\n    Taleweaver.prototype.attach = function (domContainer) {\n        this.viewService.attach(domContainer);\n    };\n    Taleweaver.prototype.getServiceRegistry = function () {\n        return this.serviceRegistry;\n    };\n    Taleweaver.prototype.buildBaseConfig = function () {\n        return {\n            commands: {\n                'tw.clipboard.copy': clipboardCommandHandlers.copy,\n                'tw.clipboard.paste': clipboardCommandHandlers.paste,\n                'tw.cursor.move': cursorCommandHandlers.move,\n                'tw.cursor.moveBackwardByLine': cursorCommandHandlers.moveBackwardByLine,\n                'tw.cursor.moveForwardByLine': cursorCommandHandlers.moveForwardByLine,\n                'tw.cursor.moveBackward': cursorCommandHandlers.moveBackward,\n                'tw.cursor.moveForward': cursorCommandHandlers.moveForward,\n                'tw.cursor.moveBackwardByWord': cursorCommandHandlers.moveBackwardByWord,\n                'tw.cursor.moveForwardByWord': cursorCommandHandlers.moveForwardByWord,\n                'tw.cursor.moveToLineStart': cursorCommandHandlers.moveToLineStart,\n                'tw.cursor.moveToLineEnd': cursorCommandHandlers.moveToLineEnd,\n                'tw.cursor.moveToDocStart': cursorCommandHandlers.moveToDocStart,\n                'tw.cursor.moveToDocEnd': cursorCommandHandlers.moveToDocEnd,\n                'tw.cursor.moveHead': cursorCommandHandlers.moveHead,\n                'tw.cursor.moveHeadBackwardByLine': cursorCommandHandlers.moveHeadBackwardByLine,\n                'tw.cursor.moveHeadForwardByLine': cursorCommandHandlers.moveHeadForwardByLine,\n                'tw.cursor.moveHeadBackward': cursorCommandHandlers.moveHeadBackward,\n                'tw.cursor.moveHeadForward': cursorCommandHandlers.moveHeadForward,\n                'tw.cursor.moveHeadBackwardByWord': cursorCommandHandlers.moveHeadBackwardByWord,\n                'tw.cursor.moveHeadForwardByWord': cursorCommandHandlers.moveHeadForwardByWord,\n                'tw.cursor.moveHeadToLineStart': cursorCommandHandlers.moveHeadToLineStart,\n                'tw.cursor.moveHeadToLineEnd': cursorCommandHandlers.moveHeadToLineEnd,\n                'tw.cursor.moveHeadToDocStart': cursorCommandHandlers.moveHeadToDocStart,\n                'tw.cursor.moveHeadToDocEnd': cursorCommandHandlers.moveHeadToDocEnd,\n                'tw.cursor.selectAll': cursorCommandHandlers.selectAll,\n                'tw.cursor.selectWord': cursorCommandHandlers.selectWord,\n                'tw.cursor.selectBlock': cursorCommandHandlers.selectBlock,\n                'tw.history.undo': historyCommandHandlers.undo,\n                'tw.history.redo': historyCommandHandlers.redo,\n                'tw.state.insert': stateCommandHandlers.insert,\n                'tw.state.deleteBackward': stateCommandHandlers.deleteBackward,\n                'tw.state.deleteForward': stateCommandHandlers.deleteForward,\n                'tw.state.breakLine': stateCommandHandlers.breakLine,\n                'tw.state.applyAttribute': stateCommandHandlers.applyAttribute,\n                'tw.view.focus': viewCommandHandlers.focus,\n                'tw.view.blur': viewCommandHandlers.blur,\n            },\n            components: {\n                doc: DocComponent,\n                paragraph: ParagraphComponent,\n                text: TextComponent,\n            },\n            cursor: {\n                disable: false,\n                caretColor: \"hsla(213, 100%, 50%, 1)\",\n                caretInactiveColor: 'hsla(0, 0%, 0%, 0.5)',\n                selectionColor: \"hsla(213, 100%, 50%, 0.2)\",\n                selectionInactiveColor: 'hsla(0, 0%, 0%, 0.08)',\n            },\n            history: {\n                collapseThreshold: 500,\n                maxCollapseDuration: 2000,\n            },\n            keyBindings: {\n                common: {\n                    left: { command: 'tw.cursor.moveBackward', preventDefault: true },\n                    right: { command: 'tw.cursor.moveForward', preventDefault: true },\n                    up: { command: 'tw.cursor.moveBackwardByLine', preventDefault: true },\n                    down: { command: 'tw.cursor.moveForwardByLine', preventDefault: true },\n                    'shift+left': { command: 'tw.cursor.moveHeadBackward', preventDefault: true },\n                    'shift+right': { command: 'tw.cursor.moveHeadForward', preventDefault: true },\n                    'shift+up': { command: 'tw.cursor.moveHeadBackwardByLine', preventDefault: true },\n                    'shift+down': { command: 'tw.cursor.moveHeadForwardByLine', preventDefault: true },\n                    backspace: { command: 'tw.state.deleteBackward', preventDefault: true },\n                    delete: { command: 'tw.state.deleteForward', preventDefault: true },\n                    enter: { command: 'tw.state.breakLine', preventDefault: true },\n                },\n                macos: {\n                    'alt+left': { command: 'tw.cursor.moveBackwardByWord' },\n                    'alt+right': { command: 'tw.cursor.moveForwardByWord' },\n                    'shift+alt+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                    'shift+alt+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                    'cmd+left': { command: 'tw.cursor.moveToLineStart' },\n                    'cmd+right': { command: 'tw.cursor.moveToLineEnd' },\n                    'cmd+up': { command: 'tw.cursor.moveToDocStart' },\n                    'cmd+down': { command: 'tw.cursor.moveToDocEnd' },\n                    'shift+cmd+left': { command: 'tw.cursor.moveHeadToLineStart' },\n                    'shift+cmd+right': { command: 'tw.cursor.moveHeadToLineEnd' },\n                    'shift+cmd+up': { command: 'tw.cursor.moveHeadToDocStart' },\n                    'shift+cmd+down': { command: 'tw.cursor.moveHeadToDocEnd' },\n                    'cmd+a': { command: 'tw.cursor.selectAll' },\n                    'cmd+z': { command: 'tw.history.undo', preventDefault: true },\n                    'shift+cmd+z': { command: 'tw.history.redo', preventDefault: true },\n                },\n                windows: {\n                    'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                    'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                    'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                    'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                    home: { command: 'tw.cursor.moveToLineStart' },\n                    end: { command: 'tw.cursor.moveToLineEnd' },\n                    'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                    'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                    'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                    'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                    'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                    'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                    'ctrl+a': { command: 'tw.cursor.selectAll' },\n                    'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                    'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n                },\n                linux: {\n                    'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                    'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                    'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                    'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                    home: { command: 'tw.cursor.moveToLineStart' },\n                    end: { command: 'tw.cursor.moveToLineEnd' },\n                    'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                    'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                    'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                    'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                    'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                    'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                    'ctrl+a': { command: 'tw.cursor.selectAll' },\n                    'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                    'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n                },\n            },\n            page: {\n                width: 816,\n                height: 1056,\n                paddingTop: 40,\n                paddingBottom: 40,\n                paddingLeft: 40,\n                paddingRight: 40,\n            },\n        };\n    };\n    return Taleweaver;\n}());\nexport { Taleweaver };\n","import { Taleweaver } from '@taleweaver/core';\nimport { ITextStyle } from '@taleweaver/core/dist/tw/component/components/text';\nimport React, { useEffect, useCallback, useState } from 'react';\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n    position: sticky;\n    top: 0;\n    padding: 3px 24px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.09);\n    z-index: 10;\n`;\n\nconst Container = styled.div`\n    display: flex;\n    margin: 0 auto;\n    width: 816px;\n`;\n\nconst Group = styled.div`\n    flex: 0 0 auto;\n    display: flex;\n    border-radius: 4px;\n    padding: 0 6px;\n    position: relative;\n    &::before {\n        content: '';\n        position: absolute;\n        top: 9px;\n        bottom: 9px;\n        left: 0;\n        width: 1px;\n        background: rgba(0, 0, 0, 0.15);\n    }\n    &:last-child {\n        &::after {\n            content: '';\n            position: absolute;\n            top: 9px;\n            bottom: 9px;\n            right: 0;\n            width: 1px;\n            background: rgba(0, 0, 0, 0.15);\n        }\n    }\n`;\n\ninterface ItemProps {\n    disabled: boolean;\n    active: boolean;\n}\n\nconst Item = styled.button<ItemProps>`\n    flex: 0 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    position: relative;\n    color: rgba(0, 0, 0, 0.85);\n    background: transparent;\n    padding: 0;\n    border: none;\n    border-radius: 3px;\n    outline: none;\n    &:after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 3px;\n        right: 3px;\n        height: 3px;\n    }\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n    ${({ active }) =>\n        active &&\n        `\n        color: rgba(255, 0, 0, 1);\n        &:after {\n            background: rgba(255, 0, 0, 1);\n        }\n    `}\n`;\n\ninterface SelectItemProps {\n    disabled: boolean;\n    width: number;\n}\n\nconst SelectItem = styled.select<SelectItemProps>`\n    -webkit-appearance: none;\n    border: none;\n    font-size: 12px;\n    font-weight: 500;\n    width: ${({ width }) => width}px;\n    background: white;\n    border-radius: 3px;\n    padding: 0 9px;\n    outline: none;\n    position: relative;\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    option {\n        color: rgba(0, 0, 0, 0.85);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n`;\n\ninterface ItemColorLineProps {\n    color: string;\n}\n\nconst ItemColorLine = styled.div<ItemColorLineProps>`\n    position: absolute;\n    bottom: 8px;\n    left: 9px;\n    right: 9px;\n    height: 3px;\n    background: ${({ color }) => color};\n`;\n\ninterface Props {\n    taleweaver: Taleweaver | null;\n}\n\nfunction getTextStylesByRange(taleweaver: Taleweaver, from: number, to: number): ITextStyle[] {\n    const renderService = taleweaver.getServiceRegistry().getService('render');\n    const styles = renderService.getStylesBetween(from, to);\n    if (!styles.text || !styles.text.text) {\n        if (styles.paragraph && styles.paragraph['line-break'] && from === to) {\n            return getTextStylesByRange(taleweaver, from - 1, to - 1);\n        }\n        return [];\n    }\n    return styles.text.text as ITextStyle[];\n}\n\nfunction getTextStyles(taleweaver: Taleweaver) {\n    const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n    const { anchor, head } = cursorService.getCursor();\n    return getTextStylesByRange(taleweaver, Math.min(anchor, head), Math.max(anchor, head));\n}\n\nexport default function ToolBar({ taleweaver }: Props) {\n    const [textStyles, setTextStyles] = useState<ITextStyle[]>([]);\n    const updateTextStyle = useCallback((taleweaver: Taleweaver) => {\n        setTextStyles(getTextStyles(taleweaver));\n    }, []);\n    useEffect(() => {\n        if (!taleweaver) {\n            return;\n        }\n        const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n        const renderService = taleweaver.getServiceRegistry().getService('render');\n        cursorService.onDidUpdate((event) => updateTextStyle(taleweaver));\n        renderService.onDidUpdateRenderState((event) => updateTextStyle(taleweaver));\n        updateTextStyle(taleweaver);\n    }, [taleweaver, updateTextStyle]);\n    const family = new Set(textStyles.map((s) => s.family)).size === 1 ? textStyles[0].family : null;\n    const size = new Set(textStyles.map((s) => s.size)).size === 1 ? textStyles[0].size : null;\n    const bold = new Set(textStyles.map((s) => s.weight > 400)).size === 1 ? textStyles[0].weight > 400 : false;\n    const italic = new Set(textStyles.map((s) => s.italic)).size === 1 ? textStyles[0].italic : false;\n    const underline = new Set(textStyles.map((s) => s.underline)).size === 1 ? textStyles[0].underline : false;\n    const strikethrough =\n        new Set(textStyles.map((s) => s.strikethrough)).size === 1 ? textStyles[0].strikethrough : false;\n    const color = new Set(textStyles.map((s) => s.color)).size === 1 ? textStyles[0].color : null;\n    const commandService = taleweaver?.getServiceRegistry().getService('command');\n    return (\n        <Wrapper>\n            <Container>\n                <Group>\n                    <SelectItem width={120} value={'Normal'} disabled={false} onChange={(event) => null}>\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"Normal\">Normal text</option>\n                        <option value=\"Title\">Title</option>\n                        <option value=\"Subtitle\">Subtitle</option>\n                        <option value=\"Heading 1\">Heading 1</option>\n                        <option value=\"Heading 2\">Heading 2</option>\n                        <option value=\"Heading 3\">Heading 3</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem width={120} value={family || ''} disabled={family === null} onChange={(event) => null}>\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"sans-serif\">sans-serif</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem\n                        width={60}\n                        value={size ? size.toString() : ''}\n                        disabled={size === null}\n                        onChange={(event) => null}\n                    >\n                        <option value=\"\" style={{ display: 'hidden' }} />\n                        <option value=\"10\">10</option>\n                        <option value=\"12\">12</option>\n                        <option value=\"14\">14</option>\n                        <option value=\"16\">16</option>\n                        <option value=\"18\">18</option>\n                        <option value=\"24\">24</option>\n                        <option value=\"30\">30</option>\n                        <option value=\"36\">36</option>\n                        <option value=\"42\">42</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <Item\n                        active={bold}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'weight',\n                                bold ? 400 : 700,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-bold\" />\n                    </Item>\n                    <Item\n                        active={italic}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand('tw.state.applyAttribute', 'text', 'text', 'italic', !italic)\n                        }\n                    >\n                        <i className=\"mdi mdi-format-italic\" />\n                    </Item>\n                    <Item\n                        active={underline}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'underline',\n                                !underline,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-underline\" />\n                    </Item>\n                    <Item\n                        active={strikethrough}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'strikethrough',\n                                !strikethrough,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-strikethrough-variant\" />\n                    </Item>\n                    <Item active={false} disabled={color === null} onClick={() => null}>\n                        <i className=\"mdi mdi-format-color-text\" style={{ position: 'relative', top: '-2px' }} />\n                        <ItemColorLine color={color || 'transparent'} />\n                    </Item>\n                </Group>\n            </Container>\n        </Wrapper>\n    );\n}\n","import { IConfig, Taleweaver } from '@taleweaver/core';\nimport { ModelDoc } from '@taleweaver/core/dist/tw/component/components/doc';\nimport { ModelParagraph } from '@taleweaver/core/dist/tw/component/components/paragraph';\nimport { ModelText } from '@taleweaver/core/dist/tw/component/components/text';\nimport { generateId } from '@taleweaver/core/dist/tw/util/id';\nimport { INode, parse } from '@taleweaver/core/dist/tw/util/serialize';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport ToolBar from './ToolBar';\n\nconst Wrapper = styled.div``;\n\nconst EditorWrapper = styled.div`\n    text-align: center;\n    .tw--doc--doc {\n        font-family: 'Source Sans Pro', sans-serif;\n        display: inline-block;\n        padding-bottom: 9px;\n        counter-reset: page-counter;\n    }\n    .tw--page--page {\n        background: rgba(255, 255, 255, 1);\n        margin: 9px auto 0;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);\n        position: relative;\n        &::after {\n            counter-increment: page-counter;\n            content: 'Page ' counter(page-counter) '';\n            position: absolute;\n            top: 12px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px;\n            font-family: 'Quicksand', sans-serif;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.45);\n            pointer-events: none;\n        }\n        *::selection {\n            background: rgba(255, 255, 255, 1);\n        }\n    }\n`;\n\nfunction buildBlankDoc() {\n    return new ModelDoc('doc', generateId(), {}, [\n        new ModelParagraph('paragraph', generateId(), {}, [new ModelText('text', generateId(), '', {})]),\n    ]);\n}\n\ninterface IProps {\n    initialDoc: INode;\n    config?: IConfig['tw.core'];\n}\n\nexport default function Editor({ initialDoc, config }: IProps) {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const container = containerRef.current;\n    const [taleweaver, setTaleweaver] = useState<Taleweaver | null>(null);\n    useEffect(() => {\n        const mergedConfig: IConfig = {};\n        if (config) {\n            mergedConfig['tw.core'] = config;\n        }\n        setTaleweaver(new Taleweaver(buildBlankDoc(), mergedConfig));\n    }, [config]);\n    useEffect(() => {\n        if (taleweaver && container) {\n            taleweaver.setContent(parse(initialDoc, taleweaver.getServiceRegistry().getService('component')));\n            taleweaver.attach(container);\n        }\n    }, [taleweaver, container, initialDoc]);\n    return (\n        <Wrapper>\n            <ToolBar taleweaver={taleweaver} />\n            <EditorWrapper ref={containerRef} />\n        </Wrapper>\n    );\n}\n","import Taleweaver from \"./Editor\";\n\nexport default Taleweaver;\n","export function parse(node, componentService) {\n    return componentService.getComponent(node.componentId).buildModelNode(node.partId, node.id, node.text, node.attributes, node.children.map(function (child) { return parse(child, componentService); }));\n}\n","import { generateId } from '@taleweaver/core/dist/tw/util/id';\nimport { INode } from '@taleweaver/core/dist/tw/util/serialize';\n\nconst doc: INode = {\n    componentId: 'doc',\n    partId: 'doc',\n    id: generateId(),\n    text: '',\n    attributes: {},\n    children: [\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Once upon a time there lived in a certain village a little country girl, the prettiest creature was ever seen. Her mother was excessively fond of her; and her grandmother doted on her still more. This good woman had made for her a little red riding-hood; which became the girl so extremely well that everybody called her Little Red Riding-Hood.',\n                    attributes: { weight: 700 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'One day her mother, having made some custards, said to her:',\n                    attributes: { italic: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Go, my dear, and see how thy grandmamma does, for I hear she has been very ill; carry her a custard, and this little pot of butter.\"',\n                    attributes: { color: 'rgba(255, 0, 0, 1)' },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood set out immediately to go to her grandmother, who lived in another village.',\n                    attributes: { size: 24 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'As she was going through the wood, she met with Gaffer Wolf, who had a very great mind to eat her up, but he dared not, because of some faggot-makers hard by in the forest. He asked her whither she was going. The poor child, who did not know that it was dangerous to stay and hear a wolf talk, said to him:',\n                    attributes: { strikethrough: true, underline: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"I am going to see my grandmamma and carry her a custard and a little pot of butter from my mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Does she live far off?\" said the Wolf.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Oh! ay,\" answered Little Red Riding-Hood; \"it is beyond that mill you see there, at the first house in the village.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Well,\" said the Wolf, \"and I\\'ll go and see her too. I\\'ll go this way and you go that, and we shall see who will be there soonest.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf began to run as fast as he could, taking the nearest way, and the little girl went by that farthest about, diverting herself in gathering nuts, running after butterflies, and making nosegays of such little flowers as she met with. The Wolf was not long before he got to the old woman's house. He knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Your grandchild, Little Red Riding-Hood,\" replied the Wolf, counterfeiting her voice; \"who has brought you a custard and a little pot of butter sent you by mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The good grandmother, who was in bed, because she was somewhat ill, cried out',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf pulled the bobbin, and the door opened, and then presently he fell upon the good woman and ate her up in a moment, for it was above three days that he had not touched a bit. He then shut the door and went into the grandmother's bed, expecting Little Red Riding- Hood, who came some time afterward and knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Who\\'s there?\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood, hearing the big voice of the Wolf, was at first afraid; but believing her grandmother had got a cold and was hoarse, answered:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\" \\'Tis your grandchild, Little Red Riding-Hood, who has brought you a custard and a little pot of butter mamma sends you.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf cried out to her, softening his voice as much as he could:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'Little Red Riding-Hood pulled the bobbin, and the door opened.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf, seeing her come in, said to her, hiding himself under the bed-clothes:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Put the custard and the little pot of butter upon the stool, and come and lie down with me.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood undressed herself and went into bed, where, being greatly amazed to see how her grandmother looked in her night-clothes, she said to her:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great arms you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is the better to hug thee, my dear.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great legs you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to run the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great ears you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to hear the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great eyes you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"It is to see the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great teeth you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to eat thee up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'And, saying these words, this wicked wolf fell upon Little Red Riding-Hood, and ate her all up.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n    ],\n};\n\nexport default doc;\n","import React from 'react';\nimport styled from 'styled-components';\nimport './App.css';\nimport Taleweaver from './Editor';\nimport sample from './samples/littleRedRidingHood';\n\nconst Wrapper = styled.div``;\n\nconst Hero = styled.div`\n    text-align: center;\n    padding: 90px 60px 30px;\n`;\n\nconst BrandWrapper = styled.div``;\n\nconst Brand = styled.span`\n    color: rgba(0, 0, 0, 0.65);\n    font-size: 42px;\n    letter-spacing: 0.02em;\n    padding-bottom: 10px;\n    border-bottom: 2px solid rgba(0, 0, 0, 0.65);\n`;\n\nconst Tagline = styled.h1`\n    font-size: 30px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 90px 0 0;\n`;\n\nconst SupportingTagline = styled.h2`\n    font-size: 20px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 30px 0 0;\n`;\n\nconst Links = styled.div`\n    margin-top: 90px;\n`;\n\nconst Link = styled.a`\n    display: inline-block;\n    padding: 15px 60px;\n    outline: none;\n    color: rgba(0, 0, 0, 0.85);\n    text-decoration: none;\n    font-size: 20px;\n    background: transparent;\n    border-radius: 3px;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    &:hover {\n        color: rgba(0, 0, 0, 1);\n        background: rgba(0, 0, 0, 0.04);\n        border-color: rgba(0, 0, 0, 0.25);\n    }\n`;\n\nconst DemoHintWrapper = styled.div`\n    text-align: center;\n    margin-top: 90px;\n`;\n\nconst DemoHint = styled.span`\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    color: rgba(0, 0, 0, 0.65);\n    border-top: 1px solid rgba(0, 0, 0, 0.45);\n    padding-top: 10px;\n    cursor: default;\n`;\n\nclass App extends React.Component {\n    render() {\n        return (\n            <Wrapper>\n                <Hero>\n                    <BrandWrapper>\n                        <Brand>Taleweaver</Brand>\n                    </BrandWrapper>\n                    <Tagline>Word processing in your browser.</Tagline>\n                    <SupportingTagline>\n                        Open source editor delivering true word processing experience.\n                    </SupportingTagline>\n                    <Links>\n                        <Link href=\"https://github.com/yuzhenmi/taleweaver\">GitHub</Link>\n                    </Links>\n                    <DemoHintWrapper>\n                        <DemoHint>&darr; Check it out &darr;</DemoHint>\n                    </DemoHintWrapper>\n                </Hero>\n                <Taleweaver\n                    initialDoc={sample}\n                    config={{\n                        page: {\n                            width: 816,\n                            height: 1056,\n                            paddingTop: 60,\n                            paddingBottom: 60,\n                            paddingLeft: 60,\n                            paddingRight: 60,\n                        },\n                    }}\n                />\n            </Wrapper>\n        );\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}