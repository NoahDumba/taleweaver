(this["webpackJsonp@taleweaver/example-react"]=this["webpackJsonp@taleweaver/example-react"]||[]).push([[0],{1:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));var r=n(103),o=n.n(r),i=new Uint8Array(16);function a(){return t.from(String.fromCharCode.apply(String,Array.from(o.a.randomFillSync(i)))).toString("base64")}}).call(this,n(6).Buffer)},107:function(t,e,n){t.exports=n(216)},112:function(t,e,n){},113:function(t,e,n){},117:function(t,e){},119:function(t,e){},131:function(t,e){},133:function(t,e){},160:function(t,e){},162:function(t,e){},163:function(t,e){},170:function(t,e){},172:function(t,e){},190:function(t,e){},193:function(t,e){},209:function(t,e){},212:function(t,e){},216:function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),i=n(102),a=n.n(i),c=(n(112),n(4)),s=n(5),u=(n(113),n(34)),d=function(){function t(){this.listeners=[]}return t.prototype.on=function(t){var e=this;return this.listeners.push(t),{dispose:function(){var n=e.listeners.indexOf(t);n<0||e.listeners.splice(n,1)}}},t.prototype.emit=function(t){this.listeners.forEach((function(e){return e(t)}))},t}(),l=function(){function t(){this.commandsMap=new Map}return t.prototype.registerCommand=function(t,e){this.commandsMap.set(t,e)},t.prototype.getCommandHandler=function(t){return this.commandsMap.get(t)},t}(),h=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},p=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},f=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},g=function(){function t(t,e){this.serviceRegistry=e,this.willExecuteCommandEventEmitter=new d,this.didExecuteCommandEventEmitter=new d,this.registry=new l;for(var n=0,r=Object.entries(t.getConfig().commands);n<r.length;n++){var o=r[n],i=o[0],a=o[1];this.registry.registerCommand(i,a)}}return t.prototype.onWillExecuteCommand=function(t){return this.willExecuteCommandEventEmitter.on(t)},t.prototype.onDidExecuteCommand=function(t){return this.didExecuteCommandEventEmitter.on(t)},t.prototype.executeCommand=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return h(this,void 0,void 0,(function(){var n;return p(this,(function(r){switch(r.label){case 0:return(n=this.registry.getCommandHandler(t))?(this.willExecuteCommandEventEmitter.emit({commandId:t,args:e}),[4,n.apply(void 0,f([this.serviceRegistry],e))]):[2];case 1:return r.sent(),this.didExecuteCommandEventEmitter.emit({commandId:t,args:e}),[2]}}))}))},t}(),v=function(){function t(t){void 0===t&&(t=[]),this.nodes=t}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length},enumerable:!1,configurable:!0}),t.prototype.at=function(t){if(t<0||t>=this.nodes.length)throw new Error("Index "+t+" is out of range.");return this.nodes[t]},t.prototype.indexOf=function(t){return this.nodes.findIndex((function(e){return e.id===t.id}))},t.prototype.forEach=function(t){return this.nodes.forEach(t)},t.prototype.map=function(t){return this.nodes.map(t)},t.prototype.reduce=function(t,e){return this.nodes.reduce(t,e)},t.prototype.filter=function(t){return this.nodes.filter(t)},t.prototype.slice=function(t,e){return this.nodes.slice(t,e)},t.prototype.find=function(t){return this.nodes.find(t)},t}(),m=function(){function t(t){this.id=t,this.parent=null,this.internalChildren=new v}return Object.defineProperty(t.prototype,"children",{get:function(){return this.internalChildren},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return 0===this.children.length?null:this.children.at(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return 0===this.children.length?null:this.children.at(this.children.length-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){if(!this.parent)return null;var t=this.parent.children,e=t.indexOf(this);if(e<0)throw new Error("Node is not a child of parent.");return 0===e?null:t.at(e-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){if(!this.parent)return null;var t=this.parent.children,e=t.indexOf(this);if(e<0)throw new Error("Node is not a child of parent.");return e===t.length-1?null:t.at(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousCrossParentSibling",{get:function(){var t=this.previousSibling;if(t)return t;var e=this.parent;if(!e||e.root)return null;var n=e.previousCrossParentSibling;return n?n.lastChild:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextCrossParentSibling",{get:function(){var t=this.nextSibling;if(t)return t;var e=this.parent;if(!e||e.root)return null;var n=e.nextCrossParentSibling;return n?n.firstChild:null},enumerable:!1,configurable:!0}),t.prototype.findDescendant=function(t){if(this.id===t)return this;if(this.leaf)return null;for(var e=0,n=this.children.length;e<n;e++){var r=this.children.at(e).findDescendant(t);if(r)return r}return null},t.prototype.boundOffset=function(t){return Math.min(this.contentLength,Math.max(0,t))},t}(),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(t){function e(e,n,r,o,i,a,c,s){var u=t.call(this,o)||this;return u.domContainer=e,u.componentId=n,u.renderId=r,u.layoutId=o,u.text=i,u.style=a,u.domService=s,u.internalChildren=new v(c),c.forEach((function(t){t.parent=u})),u}return y(e,t),Object.defineProperty(e.prototype,"contentLength",{get:function(){return this.leaf?this.text.length:this.children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.text.length:this.internalSize=this.children.reduce((function(t,e){return t+e.size}),0)),this.internalSize},enumerable:!1,configurable:!0}),e}(m),w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,null,r,"",null,o,i)||this;return a.layoutId=r,a}return w(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(b),S=function(t,e){this.id=t,this.serviceRegistry=e},C=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=function(t){function e(e,n,r,o,i,a,c,s,u,d,l){var h=t.call(this,e,n,r,o,l)||this;return h.width=i,h.height=a,h.paddingTop=c,h.paddingBottom=s,h.paddingLeft=u,h.paddingRight=d,h.domContainer.style.width=i+"px",h.domContainer.style.height=a+"px",h.domContainer.style.paddingTop=c+"px",h.domContainer.style.paddingBottom=s+"px",h.domContainer.style.paddingLeft=u+"px",h.domContainer.style.paddingRight=d+"px",h.domContainer.innerHTML="",o.map((function(t){return h.domContainer.appendChild(t.domContainer)})),h}return C(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(x),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return C(e,t),e.prototype.buildViewNode=function(t,e,n,r,o,i,a,c,s){var u=this.serviceRegistry.getService("dom");return new O(t,this.id,e,n,r,o,i,a,c,s,u)},e}(S),P=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,null,r,"",null,o,i)||this;return a.layoutId=r,a}return P(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"page"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(b),T=function(t,e){this.id=t,this.serviceRegistry=e},I=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),D=function(t){function e(e,n,r,o,i,a,c,s,u,d,l){var h=t.call(this,e,n,r,o,l)||this;return h.domContainer.style.position="relative",h.domContainer.style.marginLeft="auto",h.domContainer.style.marginRight="auto",h.domContainer.style.width=i+"px",h.domContainer.style.height=a+"px",h.domContainer.style.paddingTop=c+"px",h.domContainer.style.paddingBottom=s+"px",h.domContainer.style.paddingLeft=u+"px",h.domContainer.style.paddingRight=d+"px",h.domContainer.innerHTML="",h.domContentContainer=h.findOrCreateDOMContentContainer(),h.domContentContainer.setAttribute("data-tw-role","content-container"),o.map((function(t){return h.domContentContainer.appendChild(t.domContainer)})),h.domContainer.appendChild(h.domContentContainer),h}return I(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"page"},enumerable:!1,configurable:!0}),e.prototype.findOrCreateDOMContentContainer=function(){for(var t=0,e=this.domContainer.children.length;t<e;t++){var n=this.domContainer.children[t];if("content-container"===n.getAttribute("data-tw-role"))return n}return this.domService.createElement("div")},e}(j),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return I(e,t),e.prototype.buildViewNode=function(t,e,n,r,o,i,a,c,s){var u=this.serviceRegistry.getService("dom");return new D(t,this.id,e,n,r,o,i,a,c,s,u)},e}(T),_=function(){function t(){this.componentsMap=new Map}return t.prototype.registerComponent=function(t,e){this.componentsMap.set(t,e)},t.prototype.registerPageComponent=function(t){this.pageComponent=t},t.prototype.registerLineComponent=function(t){this.lineComponent=t},t.prototype.getComponent=function(t){var e=this.componentsMap.get(t);if(!e)throw new Error("Component "+t+" is not registered.");return e},t.prototype.getPageComponent=function(){if(!this.pageComponent)throw new Error("Page component is not registered.");return this.pageComponent},t.prototype.getLineComponent=function(){if(!this.lineComponent)throw new Error("Line component is not registered.");return this.lineComponent},t}(),M=function(){function t(t,e){this.configService=t,this.serviceRegistry=e,this.registry=new _;for(var n=0,r=Object.entries(t.getConfig().components);n<r.length;n++){var o=r[n],i=o[0],a=o[1];this.registry.registerComponent(i,new a(i,e))}this.registry.registerPageComponent(new k("page",e)),this.registry.registerLineComponent(new E("line",e))}return t.prototype.getComponent=function(t){return this.registry.getComponent(t)},t.prototype.getPageComponent=function(){return this.registry.getPageComponent()},t.prototype.getLineComponent=function(){return this.registry.getLineComponent()},t.prototype.convertModelToDOM=function(t,e,n){var r=e?e[0].offset:0,o=n?n[0].offset:t.contentLength-1,i=this.getComponent(t.componentId);if(t.leaf)return i.toDOM(t.partId,t.attributes,t.text.substring(r,o),[]);for(var a=[],c=r;c<=o;c++){var s=t.children.at(c);a.push(this.convertModelToDOM(s,e&&c===r?e.slice(1):null,n&&c===o?n.slice(1):null))}return i.toDOM(t.partId,t.attributes,"",a)},t}(),R=function(){function t(t,e){this.config=t,this.applyExternalConfig(e)}return t.prototype.getConfig=function(){return this.config},t.prototype.applyExternalConfig=function(t){var e=t["tw.core"];e&&e.page&&(this.config.page=e.page)},t}();var B,L=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},z=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};"undefined"!==typeof window&&(B=function(){var t=document.createElement("iframe");return t.scrolling="no",t.src="about:blank",t.style.width="0",t.style.height="0",t.style.border="none",t.style.position="fixed",t.style.zIndex="-1",t.style.opacity="0",t.style.overflow="hidden",t.style.left="-1000000px",t.style.top="-1000000px",t}(),document.body.appendChild(B));var A=function(t){return L(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u;return z(this,(function(d){return B?(e=t.getService("cursor"),n=t.getService("model"),r=t.getService("render"),o=t.getService("component"),e.hasCursor()?(i=e.getCursor(),a=i.anchor,c=i.head,a===c?[2]:(s=o.convertModelToDOM(n.getRoot(),n.resolvePosition(r.convertRenderToModelPosition(Math.min(a,c))),n.resolvePosition(r.convertRenderToModelPosition(Math.max(a,c)))).outerHTML,(u=B.contentDocument)?(u.body.innerHTML=s,u.execCommand("selectAll"),u.execCommand("copy"),u.body.innerHTML="",[2]):[2])):[2]):[2]}))}))},H=function(t){return L(void 0,void 0,void 0,(function(){return z(this,(function(t){return[2]}))}))};function N(t){for(var e=t.length-1;e>=0;e--)if("line"===t[e].node.type)return t[e];throw new Error("No line found.")}function W(t){for(var e=t.length-1;e>=0;e--)if("word"===t[e].node.type)return t[e];throw new Error("No word found.")}var U=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},F=function(){function t(t,e,n,r){void 0===r&&(r=!1),this.changes=t,this.modelCursorHead=e,this.modelCursorAnchor=n,this.keepLeftLock=r}return t.prototype.apply=function(e,n,r,o){var i=void 0,a=void 0;if(n.hasCursor()){var c=n.getCursor(),s=c.anchor,u=c.head;i=r.convertRenderToModelPosition(s),a=r.convertRenderToModelPosition(u)}var d=this.applyChanges(e);if(n.hasCursor()){var l=n.getCursor(),h=l.anchor,p=l.head;if(void 0!==this.modelCursorHead&&(h=p=r.convertModelToRenderPosition(this.modelCursorHead),void 0!==this.modelCursorAnchor&&(h=r.convertModelToRenderPosition(this.modelCursorAnchor))),h=this.boundOffset(h,r),p=this.boundOffset(p,r),n.setCursor(h,p),!this.keepLeftLock){var f=N(o.resolvePosition(n.getCursor().head)),g=f.node,v=f.position;n.setLeftLock(g.resolveBoundingBoxes(v,v).boundingBoxes[0].left)}}for(var m=[],y=[],b=d.length-1;b>=0;b--){var w=d[b];m.push(y.reduce((function(t,e){return t.map(e)}),w.reverseChange)),y.push(w.mapping.reverse())}return new V(this,d,new t(m,a,i,this.keepLeftLock))},t.prototype.applyChanges=function(t){for(var e=[],n=[],r=U(this.changes),o=function(){var o=r.shift(),i=t.applyChange(o),a=i.mapping;n.push(a),r=r.map((function(t){return t.map(a)})),e.push(i)};r.length>0;)o();return e},t.prototype.boundOffset=function(t,e){return Math.max(0,Math.min(e.getDocSize()-1,t))},t}(),V=function(t,e,n){this.transformation=t,this.changeResults=e,this.reverseTransformation=n},K=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},$=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};function G(t,e,n){var r=N(n.resolvePosition(t)),o=r.node,i=r.position,a=o.previousCrossParentSibling;return a?t-i-a.size+a.convertCoordinatesToPosition(e,0):t-i}function q(t,e,n){var r=N(n.resolvePosition(t)),o=r.node,i=r.position,a=o.nextCrossParentSibling;return a?t-i+o.size+a.convertCoordinatesToPosition(e,0):t-i+o.size-1}function J(t,e){var n=W(e.resolvePosition(t)),r=n.node,o=n.offset;if(o>0)return t-o;var i=r.previousCrossParentSibling;return i?t-i.size:t}function X(t,e){var n=W(e.resolvePosition(t)),r=n.node,o=n.offset;if(o<r.size-1)return t-o+r.size-r.whitespaceSize;var i=r.nextCrossParentSibling;return i?t-o+r.size+i.size-i.whitespaceSize:t}function Y(t,e){var n=N(e.resolvePosition(t)).position;return 0===n?t:t-n}function Q(t,e){var n=N(e.resolvePosition(t)),r=n.node,o=n.position;return o>=r.size-1?t:t-o+r.size-1}var Z=function(t,e){return K(void 0,void 0,void 0,(function(){var n,r,o;return $(this,(function(i){return n=t.getService("transform"),r=t.getService("render"),o=r.convertRenderToModelPosition(e),n.applyTransformation(new F([],o)),[2]}))}))},tt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s;return $(this,(function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,i===a?c=r.convertRenderToModelPosition(i-1):(s=Math.min(i,a),c=r.convertRenderToModelPosition(s)),e.applyTransformation(new F([],c)),[2]}))}))},et=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s;return $(this,(function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,i===a?c=r.convertRenderToModelPosition(i+1):(s=Math.max(i,a),c=r.convertRenderToModelPosition(s)),e.applyTransformation(new F([],c)),[2]}))}))},nt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d,l;return $(this,(function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=o.leftLock,s=Math.min(i,a),u=G(s,c,r),d=t.getService("render"),l=d.convertRenderToModelPosition(u),e.applyTransformation(new F([],l,l,!0)),[2]):[2]}))}))},rt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d,l;return $(this,(function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=o.leftLock,s=Math.max(i,a),u=q(s,c,r),d=t.getService("render"),l=d.convertRenderToModelPosition(u),e.applyTransformation(new F([],l,l,!0)),[2]):[2]}))}))},ot=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=Math.min(i,a),s=J(c,r),u=t.getService("render"),d=u.convertRenderToModelPosition(s),e.applyTransformation(new F([],d)),[2]):[2]}))}))},it=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=Math.max(i,a),s=X(c,r),u=t.getService("render"),d=u.convertRenderToModelPosition(s),e.applyTransformation(new F([],d)),[2]):[2]}))}))},at=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=Math.min(i,a),s=Y(c,r),u=t.getService("render"),d=u.convertRenderToModelPosition(s),e.applyTransformation(new F([],d)),[2]):[2]}))}))},ct=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("layout"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=Math.max(i,a),s=Q(c,r),u=t.getService("render"),d=u.convertRenderToModelPosition(s),e.applyTransformation(new F([],d)),[2]):[2]}))}))},st=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r;return $(this,(function(o){return e=t.getService("transform"),n=t.getService("render"),0,r=n.convertRenderToModelPosition(0),e.applyTransformation(new F([],r)),[2]}))}))},ut=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o;return $(this,(function(i){return e=t.getService("transform"),n=t.getService("render"),r=n.getDocSize()-1,o=n.convertRenderToModelPosition(r),e.applyTransformation(new F([],o)),[2]}))}))},dt=function(t,e){return K(void 0,void 0,void 0,(function(){var n,r,o,i,a,c;return $(this,(function(s){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=r.getCursor().anchor,a=o.convertRenderToModelPosition(i),c=o.convertRenderToModelPosition(e),n.applyTransformation(new F([],c,a)),[2]}))}))},lt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s;return $(this,(function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,c=r.convertRenderToModelPosition(i),s=r.convertRenderToModelPosition(a-1),e.applyTransformation(new F([],s,c)),[2]}))}))},ht=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s;return $(this,(function(u){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor(),i=o.anchor,a=o.head,c=r.convertRenderToModelPosition(i),s=r.convertRenderToModelPosition(a+1),e.applyTransformation(new F([],s,c)),[2]}))}))},pt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d,l;return $(this,(function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=i.leftLock,u=G(c,s,o),d=r.convertRenderToModelPosition(a),l=r.convertRenderToModelPosition(u),e.applyTransformation(new F([],l,d)),[2]):[2]}))}))},ft=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d,l;return $(this,(function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=i.leftLock,u=q(c,s,o),d=r.convertRenderToModelPosition(a),l=r.convertRenderToModelPosition(u),e.applyTransformation(new F([],l,d)),[2]):[2]}))}))},gt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=J(c,o),u=r.convertRenderToModelPosition(a),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([],d,u)),[2]):[2]}))}))},vt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=X(c,o),u=r.convertRenderToModelPosition(a),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([],d,u)),[2]):[2]}))}))},mt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=Y(c,o),u=r.convertRenderToModelPosition(a),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([],d,u)),[2]):[2]}))}))},yt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return $(this,(function(l){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=t.getService("layout"),n.hasCursor()?(i=n.getCursor(),a=i.anchor,c=i.head,s=Q(c,o),u=r.convertRenderToModelPosition(a),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([],d,u)),[2]):[2]}))}))},bt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a;return $(this,(function(c){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor().anchor,0,i=r.convertRenderToModelPosition(o),a=r.convertRenderToModelPosition(0),e.applyTransformation(new F([],a,i)),[2]}))}))},wt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c;return $(this,(function(s){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),o=n.getCursor().anchor,i=r.getDocSize()-1,a=r.convertRenderToModelPosition(o),c=r.convertRenderToModelPosition(i),e.applyTransformation(new F([],c,a)),[2]}))}))},xt=function(t){return K(void 0,void 0,void 0,(function(){var e,n,r,o,i,a;return $(this,(function(c){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),n.hasCursor()?(0,o=r.getDocSize()-1,i=r.convertRenderToModelPosition(0),a=r.convertRenderToModelPosition(o),e.applyTransformation(new F([],a,i)),[2]):[2]}))}))},St=function(t,e){return K(void 0,void 0,void 0,(function(){var n,r,o,i,a,c,s,u,d,l,h,p;return $(this,(function(f){if(n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=t.getService("layout"),!r.hasCursor())return[2];if(a=W(i.resolvePosition(e)),c=a.node,s=a.position,c.size-c.whitespaceSize===0){if(!(u=c.previousCrossParentSibling))return[2];s+=(c=u).size}return d=e-s+c.size-c.whitespaceSize,l=e-s,h=o.convertRenderToModelPosition(d),p=o.convertRenderToModelPosition(l),n.applyTransformation(new F([],h,p)),[2]}))}))},Ct=function(t,e){return K(void 0,void 0,void 0,(function(){var n,r,o,i,a,c,s,u,d,l,h;return $(this,(function(p){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),i=t.getService("layout"),r.hasCursor()?(a=function(t){for(var e=t.length-1;e>=0;e--)if("block"===t[e].node.type)return t[e];throw new Error("No block found.")}(i.resolvePosition(e)),c=a.node,s=a.position,u=e-s+c.size-1,d=e-s,l=o.convertRenderToModelPosition(u),h=o.convertRenderToModelPosition(d),n.applyTransformation(new F([],l,h)),[2]):[2]}))}))},Ot=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},Et=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Pt=function(t){return Ot(void 0,void 0,void 0,(function(){return Et(this,(function(e){return t.getService("history").undo(),[2]}))}))},jt=function(t){return Ot(void 0,void 0,void 0,(function(){return Et(this,(function(e){return t.getService("history").redo(),[2]}))}))},Tt=function(){},It=function(){function t(t){this.descs=t}return t.prototype.map=function(t){var e=this;return this.descs.reduce((function(t,n){return e.internalMap(t,n.from,n.toBefore,n.toAfter)}),t)},t.prototype.reverse=function(){return new t(this.descs.map((function(t){return{from:t.from,toBefore:t.toAfter,toAfter:t.toBefore}})))},t.prototype.internalMap=function(t,e,n,r){if(!function t(e,n){if(0===e.length||0===n.length)return!1;if(e[0]<n[0])return!1;if(e[0]>n[0])return!0;if(1===e.length&&1===n.length)return!0;return t(e.slice(1),n.slice(1))}(t,n))return t;console.log(t,n);var o=[r[0]+t[0]-n[0]];return console.log(t[0],r[0],n[0]),t[0]===n[0]?o.push.apply(o,this.internalMap(t.slice(1),e.slice(1),n.slice(1),r.slice(1))):o.push.apply(o,t.slice(1)),o},t}(),Dt={map:function(t){return t},reverse:function(){return Dt}};var kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_t=function(t){function e(e,n,r){var o=t.call(this)||this;return o.position=e,o.key=n,o.value=r,o}return kt(e,t),e.prototype.map=function(t){return this},e.prototype.apply=function(t,e){return this.applyNode(t,this.position)},e.prototype.applyNode=function(t,n){if(0===n.length){var r=t.applyAttribute(this.key,this.value);return{change:this,reverseChange:new e(this.position,this.key,r),mapping:Dt}}var o=n[0];return this.applyNode(t.children.at(o),n.slice(1))},e}(Tt),Mt=n(1),Rt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bt=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},Lt=function(){function t(t,e,n){this.root=t,this.from=e,this.to=n,this.ran=!1}return t.prototype.run=function(){if(this.ran)throw new Error("Remover already ran.");this.remove(this.root,this.from,this.to),this.ran=!0},t.prototype.remove=function(t,e,n){if(t.leaf)return[t.replace(e[0],n[0],"")];var r=[],o=t.children.at(e[0]),i=0;e[0]<n[0]&&(r.push(t.replace(e[0]+1,n[0],[])),i=o.contentLength,this.joinNodes(o,t.children.at(e[0]+1)));var a=this.remove(o,e.slice(1),Bt([i+n[1]],n.slice(2)));return r.splice.apply(r,Bt([0,0],a.slice(0,i))),r.push.apply(r,a.slice(i)),r},t.prototype.joinNodes=function(t,e){t.leaf?t.replace(0,t.text.length,t.text+e.text):t.replace(0,t.children.length,Bt(t.children.slice(),e.children.slice()));var n=t.parent;n.replace(0,n.children.length,n.children.filter((function(t){return t!==e})))},t}(),zt=function(){function t(t,e,n,r){this.root=t,this.position=e,this.fragment=n,this.componentService=r,this.ran=!1,this.internalInsertedTo=[]}return Object.defineProperty(t.prototype,"insertedTo",{get:function(){return this.internalInsertedTo},enumerable:!1,configurable:!0}),t.prototype.run=function(){if(this.ran)throw new Error("Inserter already ran.");this.insertedTo.push(this.position[0]),this.insert(this.root,this.position,this.fragment),this.trimEnds(),this.ran=!0},t.prototype.insert=function(t,e,n){var r=e[0],o=Math.ceil(n.length/2),i=e.length;if(o<i)return this.insertedTo.push(e[1]),this.insert(t.children.at(r),e.slice(1),n),0;var a=n.slice(0,o-1),c=n.slice(n.length-o+1);if(i>1){this.insertedTo.push(0);var s=t.children.at(r),u=this.insert(s,e.slice(1),Bt(a,c)),d=e[1]+a[a.length-1].length+u,l=this.splitNode(s,d),h=l[0],p=l[1];t.replace(r,r+1,[h,p]),r++}var f=n.slice(o-1,n.length-o+1);return t.replace(r,r,this.mergeContents(f)),this.insertedTo[this.insertedTo.length-e.length]+=f[f.length-1].length,t.leaf||this.insertedTo[this.insertedTo.length-e.length]++,r-e[0]},t.prototype.trimEnds=function(){var t=this.position,e=this.root.resolvePosition(t),n=e[e.length-1].node;if(0===n.text.length&&n.nextSibling){this.removeNode(n);var r=t,o=Bt(t.slice(0,t.length-2),[t[t.length-2]+1,0]),i=new It([{from:r,toBefore:o,toAfter:t}]);this.internalInsertedTo=i.map(this.insertedTo)}var a=this.insertedTo,c=this.root.resolvePosition(a),s=c[c.length-1].node;if(0===s.text.length){var u=s.previousSibling;if(u){this.removeNode(s);r=Bt(a.slice(0,a.length-2),[a[a.length-2]-1,u.contentLength]),i=new It([{from:r,toBefore:o=a,toAfter:r}]);this.internalInsertedTo=i.map(this.insertedTo)}}},t.prototype.removeNode=function(t){var e=t.parent;e.replace(0,e.children.length,e.children.filter((function(e){return e!==t})))},t.prototype.splitNode=function(t,e){var n,r=this.componentService.getComponent(t.componentId);if(t.leaf){var o=t.replace(0,e,"");n=r.buildModelNode(t.partId,Object(Mt.a)(),o,t.attributes,[])}else{o=t.replace(0,e,[]);n=r.buildModelNode(t.partId,Object(Mt.a)(),"",t.attributes,o)}return[n,t]},t.prototype.mergeContents=function(t){return"string"===typeof t[0]?t.reduce((function(t,e){return t+e}),""):t.reduce((function(t,e){return t.concat(e)}),[])},t}(),At=function(t){function e(e,n,r){var o=t.call(this)||this;if(o.from=e,o.to=n,o.fragment=r,r.length%2!==1)throw new Error("Fragment is invalid.");return o}return Rt(e,t),e.prototype.map=function(t){return new e(t.map(this.from),t.map(this.to),this.fragment)},e.prototype.apply=function(t,n){var r=this.correctPosition(t,this.from),o=this.correctPosition(t,this.to);new Lt(t,r,o).run();var i=new zt(t,r,this.fragment,n);return i.run(),{change:this,reverseChange:new e(r,i.insertedTo,["TODO"]),mapping:new It([{from:r,toBefore:o,toAfter:i.insertedTo}])}},e.prototype.correctPosition=function(t,e){return t.resolvePosition(e).map((function(t){return t.offset}))},e}(Tt),Ht=function(){return(Ht=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Nt=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},Wt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Ut=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r};function Ft(t,e,n,r,o,i){void 0===i&&(i=[]);var a=[];if(t.componentId===e&&t.partId===n&&a.push({node:t,position:i,from:r?r[0].offset:0,to:o?o[0].offset:t.contentLength}),!t.leaf)for(var c=r?r[0].offset:0,s=o?o[0].offset:t.contentLength-1,u=c;u<=s;u++){var d=t.children.at(u);a.push.apply(a,Ft(d,e,n,r&&u===c?r.slice(1):null,o&&u===s?o.slice(1):null,Ut(i,[u])))}return a}function Vt(t,e,n,r,o,i){var a,c,s=i.getComponent(t.componentId);if(t.leaf){var u=Math.max(0,r),d=Math.min(t.text.length,o);return s.buildModelNode(t.partId,Object(Mt.a)(),t.text.substring(u,d),Ht(Ht({},t.attributes),((a={})[e]=n,a)),[])}var l=[],h=1;return t.children.forEach((function(t){var a=Math.max(0,r-h),c=Math.min(t.size,o-h);h<=o&&r<=h+t.size&&l.push(Vt(t,e,n,a,c,i)),h+=t.size})),s.buildModelNode(t.partId,Object(Mt.a)(),"",Ht(Ht({},t.attributes),((c={})[e]=n,c)),l)}var Kt=function(t,e){return Nt(void 0,void 0,void 0,(function(){var n,r,o,i,a,c,s,u,d,l,h;return Wt(this,(function(p){return n=t.getService("transform"),r=t.getService("cursor"),o=t.getService("render"),r.hasCursor()?(i=r.getCursor(),a=i.anchor,c=i.head,s=Math.min(a,c),u=Math.max(a,c),d=o.convertRenderToModelPosition(s),l=o.convertRenderToModelPosition(u),(h=Ut(d))[h.length-1]+=e.length,n.applyTransformation(new F([new At(d,l,[e])],h)),[2]):[2]}))}))},$t=function(t){return Nt(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return Wt(this,(function(l){if(e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),!n.hasCursor())return[2];if(o=n.getCursor(),i=o.anchor,a=o.head,i===a){if(0===a)return[2];c=a-1,s=a}else c=Math.min(i,a),s=Math.max(i,a);return u=r.convertRenderToModelPosition(c),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([new At(u,d,[""])],u)),[2]}))}))},Gt=function(t){return Nt(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d;return Wt(this,(function(l){if(e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),!n.hasCursor())return[2];if(o=n.getCursor(),i=o.anchor,a=o.head,i===a){if(a>=r.getDocSize()-1)return[2];c=a,s=a+1}else c=Math.min(i,a),s=Math.max(i,a);return u=r.convertRenderToModelPosition(c),d=r.convertRenderToModelPosition(s),e.applyTransformation(new F([new At(u,d,[""])],u)),[2]}))}))},qt=function(t){return Nt(void 0,void 0,void 0,(function(){var e,n,r,o,i,a,c,s,u,d,l;return Wt(this,(function(h){return e=t.getService("transform"),n=t.getService("cursor"),r=t.getService("render"),n.hasCursor()?(o=n.getCursor(),i=o.anchor,a=o.head,c=Math.min(i,a),s=Math.max(i,a),u=r.convertRenderToModelPosition(c),d=r.convertRenderToModelPosition(s),(l=Ut(u))[l.length-3]++,l[l.length-2]=0,l[l.length-1]=0,e.applyTransformation(new F([new At(u,d,["",[],[],[],""])],l)),[2]):[2]}))}))},Jt=function(t,e,n,r,o){return Nt(void 0,void 0,void 0,(function(){var i,a,c,s,u,d,l,h,p,f,g,v,m;return Wt(this,(function(y){return i=t.getService("transform"),a=t.getService("component"),c=t.getService("cursor"),s=t.getService("render"),u=t.getService("model"),d=c.getCursor(),l=d.anchor,h=d.head,p=Math.min(l,h),f=Math.max(l,h),g=s.convertRenderToModelPosition(p),v=s.convertRenderToModelPosition(f),m=Ft(u.getRoot(),e,n,u.resolvePosition(g),u.resolvePosition(v)),i.applyTransformation(new F(m.filter((function(t){return t.node.attributes[r]!==o})).filter((function(t){return t.from!==t.to})).map((function(t){var e=t.node,n=t.position,i=t.from,c=t.to;if(0===i&&c===e.size)return new _t(n,r,o);for(var s=function(t){for(var e=t,n=-1;e;)n++,e=e.firstChild;return n}(Vt(e,r,o,i,c,a)),u=[[Vt(e,r,o,i,c,a)]],d=0;d<s;d++)u.unshift([]),u.push([]);return u.unshift(""),u.push(""),new At(Ut(n,[i]),Ut(n,[c]),u)})))),[2]}))}))},Xt=function(t,e,n,r,o){return Nt(void 0,void 0,void 0,(function(){var i,a,c,s,u,d,l,h,p,f,g,v;return Wt(this,(function(m){return i=t.getService("transform"),a=t.getService("cursor"),c=t.getService("render"),s=t.getService("model"),u=a.getCursor(),d=u.anchor,l=u.head,h=Math.min(d,l),p=Math.max(d,l),f=c.convertRenderToModelPosition(h),g=c.convertRenderToModelPosition(p),v=Ft(s.getRoot(),e,n,s.resolvePosition(f),s.resolvePosition(g)),i.applyTransformation(new F(v.map((function(t){var e=t.node;return new _t(function(t){for(var e=[],n=t;n.parent;)e.unshift(n.parent.children.indexOf(n)),n=n.parent;return e}(e),r,o)})))),[2]}))}))},Yt=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},Qt=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Zt=function(t){return Yt(void 0,void 0,void 0,(function(){return Qt(this,(function(e){return t.getService("view").requestFocus(),[2]}))}))},te=function(t){return Yt(void 0,void 0,void 0,(function(){return Qt(this,(function(e){return t.getService("view").requestBlur(),[2]}))}))},ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ne=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},re=function(t){function e(e,n,r,o,i){var a=t.call(this,n)||this;return a.componentId=e,a.attributes=o,a.internalNeedRender=!0,a.childDidUpdateDisposableMap=new Map,a.didUpdateEventEmitter=new d,a.handleChildDidUpdate=function(){a.didUpdateEventEmitter.emit({})},a.internalText=r,a.internalChildren=new v(i),i.forEach((function(t){t.parent=a,a.childDidUpdateDisposableMap.set(t.id,t.onDidUpdate(a.handleChildDidUpdate))})),a.onDidUpdate((function(){a.internalSize=void 0,a.internalNeedRender=!0})),a}return ee(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this.internalText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentLength",{get:function(){return this.leaf?this.text.length:this.children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=2+this.text.length:this.internalSize=this.children.reduce((function(t,e){return t+e.size}),2)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needRender",{get:function(){return this.internalNeedRender},enumerable:!1,configurable:!0}),e.prototype.canJoin=function(t){return!1},e.prototype.clearNeedRender=function(){this.internalNeedRender=!1},e.prototype.applyAttribute=function(t,e){var n=this.attributes[t];return this.attributes[t]=e,this.didUpdateEventEmitter.emit({}),n},e.prototype.replace=function(t,e,n){var r,o=this;if(t>e)throw new Error("Range is invalid.");if(this.leaf){if("string"!==typeof n)throw new Error("Leaf node content must be string.");if(t<0||e>this.text.length)throw new Error("Range is invalid.")}else{if("string"===typeof n)throw new Error("Non-leaf node content must not be string.");if(t<0||e>this.children.length)throw new Error("Range is invalid.")}"string"===typeof n?(r=this.internalText.substring(t,e),this.internalText=this.internalText.slice(0,t)+n+this.internalText.slice(e)):(r=this.children.slice(t,e),this.internalChildren=new v(ne(this.children.slice(0,t),n,this.children.slice(e))),this.children.slice(t,e).forEach((function(t){var e;return null===(e=o.childDidUpdateDisposableMap.get(t.id))||void 0===e?void 0:e.dispose()})),n.forEach((function(t){t.parent=o,o.childDidUpdateDisposableMap.set(t.id,t.onDidUpdate(o.handleChildDidUpdate))})));return this.didUpdateEventEmitter.emit({}),r},e.prototype.resolvePosition=function(t){0===t.length&&(t=[0]);var e=this.boundOffset(t[0]),n=[{node:this,offset:e}];if(!this.leaf)if(e<this.children.length){var r=this.children.at(e);n.push.apply(n,r.resolvePosition(t.slice(1)))}else{r=this.children.at(this.children.length-1);n.push.apply(n,r.resolvePosition([r.contentLength]))}return n},e.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},e}(m),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ie=function(t){function e(e,n,r,o){var i=t.call(this,e,n,"",r,o)||this;if(0===o.length)throw new Error("Doc node must have children.");return i}return oe(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(re),ae=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ce=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},se=function(t){function e(e,n,r,o,i){var a=t.call(this,Object(Mt.a)())||this;return a.componentId=e,a.modelId=n,a.text=r,a.attributes=o,a.internalNeedLayout=!0,a.internalChildren=new v(i),i.forEach((function(t){t.parent=a})),a}return ae(e,t),Object.defineProperty(e.prototype,"contentLength",{get:function(){return this.leaf?this.text.length:this.children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.contentLength:this.internalSize=this.children.reduce((function(t,e){return t+e.size}),0)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needLayout",{get:function(){return this.internalNeedLayout},enumerable:!1,configurable:!0}),e.prototype.clearNeedLayout=function(){this.internalNeedLayout=!1},e.prototype.resolvePosition=function(t){if(t<0||t>=this.size)throw new Error("Offset "+t+" is out of range.");if(this.leaf)return[{node:this,offset:t,position:t}];for(var e=0,n=0,r=this.children.length;n<r;n++){var o=this.children.at(n),i=o.size;if(e+i>t)return ce([{node:this,offset:n,position:e}],o.resolvePosition(t-e));e+=i}throw new Error("Offset cannot be resolved.")},e.prototype.convertModelToRenderPosition=function(t){var e=this.boundOffset(t[0]);if(this.leaf)return e;for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o);if(a.modelId){if(n===e)return r+a.convertModelToRenderPosition(t.slice(1));n++}r+=a.size}throw new Error("Model offset "+e+" is out of range.")},e.prototype.convertRenderToModelPosition=function(t){if(t<0||t>this.size)throw new Error("Render position is out of range.");if(this.leaf)return[this.boundOffset(t)];for(var e=0,n=0,r=0,o=this.children.length;r<o;r++){var i=this.children.at(r),a=i.size;if(i.modelId){for(var c=0,s=r+1;s<o;s++){var u=this.children.at(s);if(u.modelId)break;c+=u.size}if(e+a+c>t)return ce([n],i.convertRenderToModelPosition(t-e));n++}e+=a}throw new Error("Render offset "+t+" is out of range.")},e}(m),ue=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(t){function e(e,n,r,o){return t.call(this,e,n,"",r,o)||this}return ue(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(se),le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),he=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,e,n,r,o,"",i,a,c)||this;return s.attached=!1,s}return le(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(b),pe=function(t,e){this.id=t,this.serviceRegistry=e},fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),e}(ie),ve=function(t){function e(e,n,r,o,i,a,c,s,u,d){var l=t.call(this,e,n,r,o)||this;return l.width=i,l.height=a,l.paddingTop=c,l.paddingBottom=s,l.paddingLeft=u,l.paddingRight=d,l}return fe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return{}},enumerable:!1,configurable:!0}),e}(de),me=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,e,n,r,o,i,a,c)||this;s.domContainer.style.textAlign="left",s.domContainer.style.cursor="text",s.domContainer.style.userSelect="none",s.domContainer.innerHTML="";var u=c.createElement("div");return u.setAttribute("data-tw-role","content-container"),a.map((function(t){return u.appendChild(t.domContainer)})),s.domContainer.appendChild(u),s}return fe(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"doc"},enumerable:!1,configurable:!0}),e}(he),ye=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fe(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new ge(this.id,e,r,o)},e.prototype.buildRenderNode=function(t,e,n,r,o){var i=this.serviceRegistry.getService("config");switch(t){case"doc":var a=i.getConfig().page;return new ve(this.id,e,r,o,a.width,a.height,a.paddingTop,a.paddingBottom,a.paddingLeft,a.paddingRight);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,c,s,u,d,l,h){var p=this.serviceRegistry.getService("dom");switch(e){case"doc":return new me(t,this.id,n,r,i,a,p);default:throw new Error("Invalid part ID.")}},e.prototype.toDOM=function(t,e,n,r){switch(t){case"doc":var o=document.createElement("div");return r.forEach((function(t){return o.appendChild(t)})),o;default:throw new Error("Invalid part ID.")}},e}(pe),be=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),we=function(t){function e(e,n,r,o){var i=t.call(this,e,n,"",r,o)||this;if(0===o.length)throw new Error("Branch node must have children.");return i}return be(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(re),xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=function(t){function e(e,n,r,o){return t.call(this,e,n,"",r,o)||this}return xe(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(se),Ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oe=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o,[])||this}return Ce(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(se),Ee={weight:400,size:16,family:"sans-serif",letterSpacing:0,underline:!1,italic:!1,strikethrough:!1,color:"black"},Pe=[" ","\n","\t"],je=function(){function t(t){this.$canvas=t.createElement("canvas")}return t.prototype.measure=function(t,e){var n=this.applyDefaultFont(e),r=this.$canvas.getContext("2d"),o=n.weight,i=n.size,a=this.fixFontFamily(n.family),c=n.letterSpacing;r.font=o+" "+i+"px "+a;var s=r.measureText(t);return{width:0===c||t.length<=1?s.width:s.width+(t.length-1)*c,height:i}},t.prototype.breakIntoWords=function(t){for(var e=[],n="",r=0,o=t.length;r<o;r++){var i=t[r];n+=i,Pe.includes(i)&&(e.push({text:n,whitespaceSize:1}),n="")}return n.length>0&&e.push({text:n,whitespaceSize:0}),e},t.prototype.applyDefaultFont=function(t){var e={};for(var n in Ee)n in t&&void 0!==t[n]?e[n]=t[n]:e[n]=Ee[n];return e},t.prototype.fixFontFamily=function(t){return t.indexOf(" ")>=0?"'"+t+"'":t},t}(),Te=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ie=function(t){function e(e,n,r,o,i,a,c){return t.call(this,e,n,r,o,"",i,a,c)||this}return Te(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(b),De=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ke=function(t){function e(e,n,r,o,i,a,c){return t.call(this,e,n,r,o,i,a,[],c)||this}return De(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(b),_e=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Me=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},Re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _e(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),e}(we),Be=function(t){function e(e,n,r,o){return t.call(this,e,n,r,Me(o,[new Le(e)]))||this}return _e(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return{}},enumerable:!1,configurable:!0}),e}(Se),Le=function(t){function e(e){var n=t.call(this,e,null," ",null)||this;return n.componentId=e,n}return _e(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line-break"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){for(var t=this.previousSibling;t;){if("text"===t.type)return t.font;t=t.previousSibling}return Ee},enumerable:!1,configurable:!0}),e}(Oe),ze=function(t){function e(e,n,r,o,i,a,c,s,u,d,l,h,p){var f=t.call(this,e,n,r,o,i,a,p)||this;return f.domContainer.style.width=c+"px",f.domContainer.style.height=s+"px",f.domContainer.style.paddingTop=u+"px",f.domContainer.style.paddingBottom=d+"px",f.domContainer.style.paddingLeft=l+"px",f.domContainer.style.paddingRight=h+"px",f.domContainer.style.lineHeight="1em",f.domContainer.innerHTML="",a.map((function(t){return f.domContainer.appendChild(t.domContainer)})),f}return _e(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(Ie),Ae=function(t){function e(e,n,r,o,i){return t.call(this,e,n,r,o," ",null,i)||this}return _e(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"line-break"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"domContentContainer",{get:function(){return this.domContainer},enumerable:!1,configurable:!0}),e}(ke),He=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _e(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new Re(this.id,e,r,o)},e.prototype.buildRenderNode=function(t,e,n,r,o){switch(t){case"paragraph":return new Be(this.id,e,r,o);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,c,s,u,d,l,h){var p=this.serviceRegistry.getService("dom");switch(e){case"paragraph":return new ze(t,this.id,n,r,i,a,c,s,u,d,l,h,p);case"line-break":return new Ae(t,this.id,n,r,p);default:throw new Error("Invalid part ID.")}},e.prototype.toDOM=function(t,e,n,r){switch(t){case"paragraph":var o=document.createElement("p");return r.forEach((function(t){return o.appendChild(t)})),o;default:throw new Error("Invalid part ID.")}},e}(pe),Ne=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),We=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o,[])||this}return Ne(e,t),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(re),Ue=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ue(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),e.prototype.canJoin=function(t){return this.componentId===t.componentId&&(this.partId===t.partId&&JSON.stringify(this.attributes)===JSON.stringify(t.attributes))},e}(We),Ve=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,o,i)||this;return a.textService=r,a}return Ue(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudo",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.textService.applyDefaultFont(this.attributes)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this.style},enumerable:!1,configurable:!0}),e}(Oe),Ke=function(t){function e(e,n,r,o,i,a,c,s,u,d,l,h,p){var f=t.call(this,e,n,r,o,i,a,p)||this;f.domContainer.style.display="inline-block",f.domContainer.style.whiteSpace="pre",f.domContainer.style.lineHeight="1em",f.domContainer.style.width=c+"px",f.domContainer.style.height=s+"px",f.domContainer.style.paddingTop=u+"px",f.domContainer.style.paddingBottom=d+"px",f.domContainer.style.paddingLeft=l+"px",f.domContainer.style.paddingRight=h+"px",f.domContainer.style.fontFamily=a.family,f.domContainer.style.fontSize=a.size+"px",f.domContainer.style.letterSpacing=a.letterSpacing+"px",f.domContainer.style.fontWeight=""+a.weight,f.domContainer.style.color=a.color,f.domContainer.style.textDecoration=a.underline?"underline":"",f.domContainer.style.fontStyle=a.italic?"italic":"",f.domContainer.innerHTML="";var g=f.findOrCreateDOMContentContainer();return g.setAttribute("data-tw-role","content-container"),g.style.textDecoration=a.strikethrough?"line-through":"",g.innerHTML=i,f.domContainer.appendChild(g),f}return Ue(e,t),Object.defineProperty(e.prototype,"partId",{get:function(){return"text"},enumerable:!1,configurable:!0}),e.prototype.findOrCreateDOMContentContainer=function(){for(var t=0,e=this.domContainer.children.length;t<e;t++){var n=this.domContainer.children[t];if("content-container"===n.getAttribute("data-tw-role"))return n}return this.domService.createElement("span")},e}(ke),$e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ue(e,t),e.prototype.buildModelNode=function(t,e,n,r,o){return new Fe(this.id,e,n,r)},e.prototype.buildRenderNode=function(t,e,n,r,o){var i=this.serviceRegistry.getService("text");switch(t){case"text":return new Ve(this.id,e,i,n,r);default:throw new Error("Invalid part ID.")}},e.prototype.buildViewNode=function(t,e,n,r,o,i,a,c,s,u,d,l,h){var p=this.serviceRegistry.getService("dom");switch(e){case"text":return new Ke(t,this.id,n,r,o,i,c,s,u,d,l,h,p);default:throw new Error("Invalid part ID.")}},e.prototype.toDOM=function(t,e,n,r){switch(t){case"text":var o=document.createElement("span");return o.innerText=n,o;default:throw new Error("Invalid part ID.")}},e}(pe);function Ge(){return{commands:{"tw.clipboard.copy":A,"tw.clipboard.paste":H,"tw.cursor.move":Z,"tw.cursor.moveBackwardByLine":nt,"tw.cursor.moveForwardByLine":rt,"tw.cursor.moveBackward":tt,"tw.cursor.moveForward":et,"tw.cursor.moveBackwardByWord":ot,"tw.cursor.moveForwardByWord":it,"tw.cursor.moveToLineStart":at,"tw.cursor.moveToLineEnd":ct,"tw.cursor.moveToDocStart":st,"tw.cursor.moveToDocEnd":ut,"tw.cursor.moveHead":dt,"tw.cursor.moveHeadBackwardByLine":pt,"tw.cursor.moveHeadForwardByLine":ft,"tw.cursor.moveHeadBackward":lt,"tw.cursor.moveHeadForward":ht,"tw.cursor.moveHeadBackwardByWord":gt,"tw.cursor.moveHeadForwardByWord":vt,"tw.cursor.moveHeadToLineStart":mt,"tw.cursor.moveHeadToLineEnd":yt,"tw.cursor.moveHeadToDocStart":bt,"tw.cursor.moveHeadToDocEnd":wt,"tw.cursor.selectAll":xt,"tw.cursor.selectWord":St,"tw.cursor.selectBlock":Ct,"tw.history.undo":Pt,"tw.history.redo":jt,"tw.state.insert":Kt,"tw.state.deleteBackward":$t,"tw.state.deleteForward":Gt,"tw.state.breakLine":qt,"tw.state.applyAttribute":Jt,"tw.state.applyAttributeAround":Xt,"tw.view.focus":Zt,"tw.view.blur":te},components:{doc:ye,paragraph:He,text:$e},cursor:{disable:!1,caretColor:"hsla(213, 100%, 50%, 1)",caretInactiveColor:"hsla(0, 0%, 0%, 0.5)",selectionColor:"hsla(213, 100%, 50%, 0.2)",selectionInactiveColor:"hsla(0, 0%, 0%, 0.08)"},history:{collapseThreshold:500,maxCollapseDuration:2e3},keyBindings:{common:{left:{command:"tw.cursor.moveBackward",preventDefault:!0},right:{command:"tw.cursor.moveForward",preventDefault:!0},up:{command:"tw.cursor.moveBackwardByLine",preventDefault:!0},down:{command:"tw.cursor.moveForwardByLine",preventDefault:!0},"shift+left":{command:"tw.cursor.moveHeadBackward",preventDefault:!0},"shift+right":{command:"tw.cursor.moveHeadForward",preventDefault:!0},"shift+up":{command:"tw.cursor.moveHeadBackwardByLine",preventDefault:!0},"shift+down":{command:"tw.cursor.moveHeadForwardByLine",preventDefault:!0},backspace:{command:"tw.state.deleteBackward",preventDefault:!0},delete:{command:"tw.state.deleteForward",preventDefault:!0},enter:{command:"tw.state.breakLine",preventDefault:!0}},macos:{"alt+left":{command:"tw.cursor.moveBackwardByWord"},"alt+right":{command:"tw.cursor.moveForwardByWord"},"shift+alt+left":{command:"tw.cursor.moveHeadBackwardByWord"},"shift+alt+right":{command:"tw.cursor.moveHeadForwardByWord"},"cmd+left":{command:"tw.cursor.moveToLineStart"},"cmd+right":{command:"tw.cursor.moveToLineEnd"},"cmd+up":{command:"tw.cursor.moveToDocStart"},"cmd+down":{command:"tw.cursor.moveToDocEnd"},"shift+cmd+left":{command:"tw.cursor.moveHeadToLineStart"},"shift+cmd+right":{command:"tw.cursor.moveHeadToLineEnd"},"shift+cmd+up":{command:"tw.cursor.moveHeadToDocStart"},"shift+cmd+down":{command:"tw.cursor.moveHeadToDocEnd"},"cmd+a":{command:"tw.cursor.selectAll"},"cmd+z":{command:"tw.history.undo",preventDefault:!0},"shift+cmd+z":{command:"tw.history.redo",preventDefault:!0}},windows:{"ctrl+left":{command:"tw.cursor.moveBackwardByWord"},"ctrl+right":{command:"tw.cursor.moveForwardByWord"},"ctrl+shift+left":{command:"tw.cursor.moveHeadBackwardByWord"},"ctrl+shift+right":{command:"tw.cursor.moveHeadForwardByWord"},home:{command:"tw.cursor.moveToLineStart"},end:{command:"tw.cursor.moveToLineEnd"},"ctrl+home":{command:"tw.cursor.moveToDocStart"},"ctrl+end":{command:"tw.cursor.moveToDocEnd"},"shift+home":{command:"tw.cursor.moveHeadToLineStart"},"shift+end":{command:"tw.cursor.moveHeadToLineEnd"},"ctrl+shift+home":{command:"tw.cursor.moveHeadToDocStart"},"ctrl+shift+end":{command:"tw.cursor.moveHeadToDocEnd"},"ctrl+a":{command:"tw.cursor.selectAll"},"ctrl+z":{command:"tw.history.undo",preventDefault:!0},"ctrl+shift+z":{command:"tw.history.redo",preventDefault:!0}},linux:{"ctrl+left":{command:"tw.cursor.moveBackwardByWord"},"ctrl+right":{command:"tw.cursor.moveForwardByWord"},"ctrl+shift+left":{command:"tw.cursor.moveHeadBackwardByWord"},"ctrl+shift+right":{command:"tw.cursor.moveHeadForwardByWord"},home:{command:"tw.cursor.moveToLineStart"},end:{command:"tw.cursor.moveToLineEnd"},"ctrl+home":{command:"tw.cursor.moveToDocStart"},"ctrl+end":{command:"tw.cursor.moveToDocEnd"},"shift+home":{command:"tw.cursor.moveHeadToLineStart"},"shift+end":{command:"tw.cursor.moveHeadToLineEnd"},"ctrl+shift+home":{command:"tw.cursor.moveHeadToDocStart"},"ctrl+shift+end":{command:"tw.cursor.moveHeadToDocEnd"},"ctrl+a":{command:"tw.cursor.selectAll"},"ctrl+z":{command:"tw.history.undo",preventDefault:!0},"ctrl+shift+z":{command:"tw.history.redo",preventDefault:!0}}},page:{width:816,height:1056,paddingTop:40,paddingBottom:40,paddingLeft:40,paddingRight:40}}}var qe=function(){return(qe=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Je=function(){function t(t,e,n){this.renderService=e,this.modelService=n,this.internalCursor=null,this.didUpdateEventEmitter=new d,t.getConfig().cursor.disable||(this.internalCursor={anchor:0,head:0,leftLock:0})}return Object.defineProperty(t.prototype,"hasCursor",{get:function(){return!!this.internalCursor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{get:function(){return this.assertCursor(),qe({},this.internalCursor)},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e){this.assertCursor(),this.internalCursor={anchor:t,head:e,leftLock:this.internalCursor.leftLock},this.didUpdateEventEmitter.emit({})},t.prototype.setLeftLock=function(t){this.assertCursor(),this.internalCursor={anchor:this.internalCursor.anchor,head:this.internalCursor.head,leftLock:t}},t.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},t.prototype.assertCursor=function(){if(!this.internalCursor)throw new Error("Cursor is disabled.")},t}(),Xe=function(){function t(t,e,n){this.state=new Je(t,e,n)}return t.prototype.hasCursor=function(){return this.state.hasCursor},t.prototype.getCursor=function(){return this.state.cursor},t.prototype.setCursor=function(t,e){this.state.set(t,e)},t.prototype.setLeftLock=function(t){this.state.setLeftLock(t)},t.prototype.onDidUpdate=function(t){return this.state.onDidUpdate(t)},t}(),Ye=function(){function t(){}return t.prototype.getWindow=function(){return window},t.prototype.getDocument=function(){return document},t.prototype.getBody=function(){return document.body},t.prototype.createElement=function(t){return document.createElement(t)},t.prototype.createContainer=function(){var t=this.createElement("div");return t.setAttribute("data-tw-role","container"),t},t.prototype.createHiddenIframe=function(){var t=this.createElement("iframe");return t.scrolling="no",t.src="about:blank",t.style.width="0",t.style.height="0",t.style.border="none",t.style.position="fixed",t.style.zIndex="-1",t.style.opacity="0",t.style.overflow="hidden",t.style.left="-1000000px",t.style.top="-1000000px",t},t.prototype.createMutationObserver=function(t){return new MutationObserver(t)},t}(),Qe=function(){function t(){this.internalTransformationResults=[],this.beganAt=Date.now(),this.internalEndedAt=this.beganAt}return Object.defineProperty(t.prototype,"endedAt",{get:function(){return this.internalEndedAt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transformationResults",{get:function(){return this.internalTransformationResults},enumerable:!1,configurable:!0}),t.prototype.recordTransformationResult=function(t){this.transformationResults.push(t),this.internalEndedAt=Date.now()},t}(),Ze=function(){function t(t,e){var n=this;this.configService=t,this.transformService=e,this.actions=[],this.offset=-1,this.handleDidApplyTransformation=function(t){var e=t.result;if(!(n.offset+1<n.actions.length&&n.actions[n.offset+1].transformationResults.some((function(t){return t.reverseTransformation===e.transformation})))&&!(n.offset>=0&&n.actions[n.offset].transformationResults.some((function(t){return t.transformation===e.transformation}))))if(n.offset<0)n.recordToNewAction(e);else{var r=n.actions[n.offset],o=Date.now();o-r.beganAt<n.maxCollapseDuration&&o-r.endedAt<n.collapseThreshold?n.recordToLastAction(e):n.recordToNewAction(e)}};var r=t.getConfig();this.maxCollapseDuration=r.history.maxCollapseDuration,this.collapseThreshold=r.history.collapseThreshold,e.onDidApplyTransformation(this.handleDidApplyTransformation)}return t.prototype.undo=function(){var t=this.consumeNextUndoableAction();if(t){var e=t.transformationResults;if(0!==e.length)for(var n=e.length-1;n>=0;n--){var r=e[n];this.transformService.applyTransformation(r.reverseTransformation)}}},t.prototype.redo=function(){var t=this,e=this.consumeNextRedoableAction();e&&e.transformationResults.forEach((function(e){return t.transformService.applyTransformation(e.transformation)}))},t.prototype.consumeNextUndoableAction=function(){if(!(this.offset<0)){var t=this.actions[this.offset];return this.offset--,t}},t.prototype.consumeNextRedoableAction=function(){if(!(this.offset>=this.actions.length-1))return this.offset++,this.actions[this.offset]},t.prototype.recordToNewAction=function(t){if(0!==t.changeResults.length){this.offset<this.actions.length-1&&this.actions.splice(this.offset+1,this.actions.length-1-this.offset);var e=new Qe;e.recordTransformationResult(t),this.actions.push(e),this.offset++}},t.prototype.recordToLastAction=function(t){var e=this.actions[this.offset];if(!e)throw new Error("Error recording applied transformation, history is empty.");this.offset<this.actions.length-1&&this.actions.splice(this.offset+1,this.actions.length-1-this.offset),e.recordTransformationResult(t)},t}(),tn=function(){function t(t,e){this.state=new Ze(t,e)}return t.prototype.undo=function(){this.state.undo()},t.prototype.redo=function(){this.state.redo()},t}();function en(){return navigator.platform.startsWith("Linux")?"Linux":["Windows","Win16","Win32"].includes(navigator.platform)?"Windows":["Macintosh","MacIntel","MacPPC","Mac68K"].includes(navigator.platform)?"macOS":"Unknown"}var nn=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},rn=function(){function t(t,e,n){var r=this;this.configService=t,this.commandService=e,this.viewService=n,this.keyBindings=new Map,this.handleDidPressKey=function(t){var e,n=r.keyBindings.get(t.key);n&&(n.preventDefault&&t.originalKeyboardEvent.preventDefault(),(e=r.commandService).executeCommand.apply(e,nn([n.command],n.args)))};var o=this.configService.getConfig().keyBindings;switch(this.bindKeys(o.common),en()){case"macOS":o.macos&&this.bindKeys(o.macos);break;case"Windows":o.windows&&this.bindKeys(o.windows);break;case"Linux":o.linux&&this.bindKeys(o.linux)}n.onDidPressKey(this.handleDidPressKey)}return t.prototype.bindKeys=function(t){for(var e in t){var n=t[e];this.keyBindings.set(e,{command:n.command,args:n.args||[],preventDefault:n.preventDefault||!1})}},t}(),on=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),an=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r},cn=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,Object(Mt.a)())||this;return s.renderId=e,s.text=n,s.paddingTop=o,s.paddingBottom=i,s.paddingLeft=a,s.paddingRight=c,s.internalNeedView=!0,s.internalChildren=new v(r),r.forEach((function(t){t.parent=s})),s}return on(e,t),Object.defineProperty(e.prototype,"contentLength",{get:function(){return this.leaf?this.text.length:this.children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return void 0===this.internalSize&&(this.leaf?this.internalSize=this.text.length:this.internalSize=this.children.reduce((function(t,e){return t+e.size}),0)),this.internalSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingVertical",{get:function(){return this.paddingTop+this.paddingBottom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingHorizontal",{get:function(){return this.paddingLeft+this.paddingRight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerWidth",{get:function(){return this.width-this.paddingHorizontal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerHeight",{get:function(){return this.height-this.paddingVertical},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needView",{get:function(){return this.internalNeedView},enumerable:!1,configurable:!0}),e.prototype.clearNeedView=function(){this.internalNeedView=!1},e.prototype.resolvePosition=function(t){if(t<0||t>=this.size)throw new Error("Offset "+t+" is out of range.");if(this.leaf)return[{node:this,offset:t,position:t}];for(var e=0,n=0,r=this.children.length;n<r;n++){var o=this.children.at(n),i=o.size;if(e+i>t)return an([{node:this,offset:n,position:t}],o.resolvePosition(t-e));e+=i}throw new Error("Offset cannot be resolved.")},e}(m),sn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),un=function(t){function e(e,n,r){var o=t.call(this,e," ",[],0,0,0,0)||this;return o.width=n,o.height=r,o}return sn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"atom"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){return t<this.innerWidth/2?0:1},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");return{node:this,boundingBoxes:[{from:t,to:e,width:t===e?0:this.innerWidth,height:this.innerHeight,left:0===t?this.paddingLeft:this.paddingLeft+this.innerWidth,right:1===e?this.paddingRight:this.paddingRight+this.innerWidth,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}},e}(cn),dn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ln=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,e,"",n,o,i,a,c)||this;return s.width=r,s}return dn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"block"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce((function(t,e){return t+e.height}),this.paddingVertical)),this.internalHeight},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),c=a.height;if(e>=r&&e<=r+c){n+=a.convertCoordinatesToPosition(t,0);break}n+=a.size,r+=c}if(n===this.size){var s=this.lastChild;s&&(n-=s.size,n+=s.convertCoordinatesToPosition(t,s.height))}return n},e.prototype.resolveBoundingBoxes=function(t,e){var n=this;if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var r=[],o=[],i=0,a=0;return this.children.forEach((function(c){if(i+c.size>t&&i<=e){var s=Math.max(0,t-i),u=Math.min(c.size,e-i),d=c.resolveBoundingBoxes(s,u);r.push(d),d.boundingBoxes.forEach((function(t){o.push({from:i+s,to:i+u,width:t.width,height:t.height,top:a+n.paddingTop+t.top,bottom:n.height-n.paddingTop-a-c.height+t.bottom,left:t.left,right:t.right})}))}i+=c.size,a+=c.height})),{node:this,boundingBoxes:o,children:r}},e}(cn),hn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t){function e(e,n,r,o,i,a,c,s){var u=t.call(this,e,"",n,i,a,c,s)||this;return u.width=r,u.height=o,u}return hn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){throw new Error("Use page to convert coordinates to position.")},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var n=[],r=0;return this.children.forEach((function(o){if(r+o.size>t&&r<=e){var i=Math.max(0,t-r),a=Math.min(o.size,e-r),c=o.resolveBoundingBoxes(i,a);n.push(c)}r+=o.size})),{node:this,boundingBoxes:[],children:n}},e}(cn),fn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gn=function(t){function e(e,n){var r=t.call(this,null,"",e,0,8,0,0)||this;return r.width=n,r}return fn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"line"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce((function(t,e){return Math.max(t,e.height)}),0)+this.paddingVertical),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentWidth",{get:function(){return void 0===this.internalContentWidth&&(this.internalContentWidth=this.children.reduce((function(t,e){return t+e.width}),0)),this.internalContentWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),c=a.width;if(t>=r&&t<=r+c){n+=a.convertCoordinatesToPosition(t-r,0);break}n+=a.size,r+=c}if(n===this.size){var s=this.lastChild;if(s&&"text"===s.type){var u=s.lastChild;u&&u.whitespaceSize>0&&n--}}return n},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");for(var n=[],r=0,o=null,i=0,a=0,c=this.children.length;a<c&&!(r>e);a++){var s=this.children.at(a);if(r+s.size>t){var u=Math.max(0,t-r),d=Math.min(s.size,e-r),l=s.resolveBoundingBoxes(u,d);n.push(l),null===o&&(o=i+l.boundingBoxes[0].left),i+=l.boundingBoxes.slice(0,l.boundingBoxes.length-1).reduce((function(t,e){return t+e.left+e.width+e.right}),0),i+=l.boundingBoxes[0].left+l.boundingBoxes[0].width}else i+=s.width;r+=s.size}return{node:this,boundingBoxes:[{from:t,to:e,width:i-o,height:t===e?this.innerHeight:this.height,left:this.paddingLeft+o,right:this.width-this.paddingLeft-i,top:t===e?this.paddingTop:0,bottom:t===e?this.paddingBottom:0}],children:n}},e}(cn),vn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mn=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,null,"",e,o,i,a,c)||this;return s.width=n,s.height=r,s}return vn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"page"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentHeight",{get:function(){return void 0===this.internalContentHeight&&(this.internalContentHeight=this.children.reduce((function(t,e){return t+e.height}),0)),this.internalContentHeight},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){for(var n=0,r=0,o=Math.min(Math.max(t-this.paddingLeft,0),this.innerWidth),i=Math.min(Math.max(e-this.paddingTop,0),this.innerHeight),a=0,c=this.children.length;a<c;a++){var s=this.children.at(a),u=s.height;if(i>=r&&i<=r+u){n+=s.convertCoordinatesToPosition(o,i-r);break}n+=s.size,r+=u}if(n===this.size){var d=this.lastChild;d&&(n-=d.size,n+=d.convertCoordinatesToPosition(o,d.height))}return n},e.prototype.resolveBoundingBoxes=function(t,e){var n=this;if(t<0||e>this.size||t>e)throw new Error("Invalid range.");var r=[],o=[],i=0,a=0;return this.children.forEach((function(c){if(i+c.size>t&&i<=e){var s=Math.max(0,t-i),u=Math.min(c.size,e-i),d=c.resolveBoundingBoxes(s,u);r.push(d),d.boundingBoxes.forEach((function(t){o.push({from:i+s,to:i+u,width:t.width,height:t.height,top:a+n.paddingTop+t.top,bottom:n.height-n.paddingTop-a-c.height+t.bottom,left:t.left+n.paddingLeft,right:t.right+n.paddingRight})}))}i+=c.size,a+=c.height})),{node:this,boundingBoxes:o,children:r}},e}(cn),yn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bn=function(t){function e(e,n,r,o,i,a,c){var s=t.call(this,e,"",n,r,o,i,a)||this;return s.font=c,s}return yn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return void 0===this.internalWidth&&(this.internalWidth=this.children.reduce((function(t,e){return t+e.width}),this.paddingHorizontal)),this.internalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return void 0===this.internalHeight&&(this.internalHeight=this.children.reduce((function(t,e){return Math.max(t,e.height)}),0)+this.paddingVertical),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trimmedWidth",{get:function(){if(void 0===this.internalTrimmedWidth){var t=this.lastChild;this.internalTrimmedWidth=t?this.width-t.width+t.trimmedWidth:0}return this.internalTrimmedWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){for(var n=0,r=0,o=0,i=this.children.length;o<i;o++){var a=this.children.at(o),c=a.width;if(r+c>=t){n+=a.convertCoordinatesToPosition(t-r,0);break}n+=a.size,r+=c}return n},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");for(var n=[],r=0,o=null,i=0,a=0,c=this.children.length;a<c&&!(r>e);a++){var s=this.children.at(a);if(r+s.size>t){var u=Math.max(0,t-r),d=Math.min(s.size,e-r),l=s.resolveBoundingBoxes(u,d);n.push(l),null===o&&(o=i+l.boundingBoxes[0].left),i+=l.boundingBoxes.slice(0,l.boundingBoxes.length-1).reduce((function(t,e){return t+e.left+e.width+e.right}),0),i+=l.boundingBoxes[0].left+l.boundingBoxes[0].width}else i+=s.width;r+=s.size}return{node:this,boundingBoxes:[{from:t,to:e,width:i-o,height:this.innerHeight,left:this.paddingLeft+o,right:this.width-this.paddingLeft-i,top:this.paddingTop,bottom:this.paddingBottom}],children:n}},e}(cn),wn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xn=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,[],0,0,0,0)||this;return a.whitespaceSize=r,a.font=o,a.textService=i,a}return wn(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return"word"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leaf",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t;return void 0===this.internalWidth&&(t=this.measure(),this.internalWidth=t[0],this.internalHeight=t[1]),this.internalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t;return void 0===this.internalHeight&&(t=this.measure(),this.internalWidth=t[0],this.internalHeight=t[1]),this.internalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trimmedWidth",{get:function(){if(void 0===this.internalTrimmedWidth){var t=this.text.substring(0,this.text.length-this.whitespaceSize);this.internalTrimmedWidth=this.textService.measure(t,this.font).width}return this.internalTrimmedWidth},enumerable:!1,configurable:!0}),e.prototype.convertCoordinatesToPosition=function(t,e){for(var n=0,r=this.text,o=0,i=r.length;o<i;o++){var a=this.textService.measure(r.substring(0,o),this.font).width;if(!(a<t))return t-n<a-t?o-1:o;n=a}return t-n<this.width-t?r.length-1:r.length},e.prototype.resolveBoundingBoxes=function(t,e){if(t<0||e>this.size||t>e)throw new Error("Invalid range.");if(0===t&&e===this.size)return{node:this,boundingBoxes:[{from:t,to:e,width:this.innerWidth,height:this.innerHeight,left:this.paddingLeft,right:this.paddingRight,top:this.paddingTop,bottom:this.paddingBottom}],children:[]};if(t===e){var n=this.textService.measure(this.text.slice(0,t),this.font).width;return{node:this,boundingBoxes:[{from:t,to:e,width:0,height:this.innerHeight,left:this.paddingLeft+n,right:this.width-this.paddingLeft-n,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}}var r=this.textService.measure(this.text.slice(0,t),this.font).width,o=this.textService.measure(this.text.slice(0,e),this.font).width;return{node:this,boundingBoxes:[{from:t,to:e,width:o-r,height:this.innerHeight,left:this.paddingLeft+r,right:this.innerWidth-this.paddingLeft-o,top:this.paddingTop,bottom:this.paddingBottom}],children:[]}},e.prototype.breakAt=function(t){return[new e(this.renderId,this.text.substring(0,t),0,this.font,this.textService),new e(this.renderId,this.text.substring(t),this.whitespaceSize,this.font,this.textService)]},e.prototype.measure=function(){var t=this.textService.measure(this.text,this.font);return[t.width,t.height]},e}(cn),Sn=function(){function t(t){this.textService=t}return t.prototype.updateDoc=function(t,e){var n=this;if(!e.needLayout&&t)return t;var r=[],o={};t&&t.children.forEach((function(t){r.push(t),t.children.forEach((function(t){if(!t.renderId)throw new Error("Render ID missing on layout node.");o[t.renderId]=o[t.renderId]||[],o[t.renderId].push(t)}))}));var i=[];return e.children.forEach((function(t){switch(t.type){case"block":i.push.apply(i,n.updateBlock(o[t.id]||[],t,e.width-e.paddingLeft-e.paddingRight));break;default:throw new Error("Child type "+t.type+" is invalid.")}})),e.clearNeedLayout(),this.buildDoc(e,this.reflowPages(r,i,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight))},t.prototype.updateBlock=function(t,e,n){var r=this;if(!e.needLayout&&t.length>0)return t;for(var o=[],i={},a=0,c=t;a<c.length;a++){c[a].children.forEach((function(t){o.push(t),t.children.forEach((function(t){if(!t.renderId)throw new Error("Render ID missing on layout node.");i[t.renderId]=i[t.renderId]||[],i[t.renderId].push(t)}))}))}var s=[];return e.children.forEach((function(t){switch(t.type){case"text":s.push.apply(s,r.updateText(i[t.id]||[],t));break;case"atom":s.push.apply(s,r.updateAtom(i[t.id]||[],t));break;default:throw new Error("Child type "+t.type+" is invalid.")}})),e.clearNeedLayout(),[this.buildBlock(e,this.reflowLines(o,s,n-e.paddingLeft-e.paddingRight),n)]},t.prototype.updateText=function(t,e){var n=this;if(!e.needLayout&&t.length>0)return t;var r=[];return this.textService.breakIntoWords(e.text).forEach((function(t){r.push(n.buildWord(e,t.text,t.whitespaceSize))})),e.clearNeedLayout(),[this.buildText(e,r)]},t.prototype.updateAtom=function(t,e){return!e.needLayout&&t.length>0?t:(e.clearNeedLayout(),[this.buildAtom(e)])},t.prototype.buildDoc=function(t,e){return new pn(t.id,e,t.width,t.height,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight)},t.prototype.buildBlock=function(t,e,n){if("block"!==t.type)throw new Error("Expected block.");return new ln(t.id,e,n,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight)},t.prototype.buildText=function(t,e){if("text"!==t.type)throw new Error("Expected text.");return new bn(t.id,e,t.paddingTop,t.paddingBottom,t.paddingLeft,t.paddingRight,t.font)},t.prototype.buildWord=function(t,e,n){if("text"!==t.type)throw new Error("Expected text.");return new xn(t.id,e,n,t.font,this.textService)},t.prototype.buildAtom=function(t){if("atom"!==t.type)throw new Error("Expected atom.");return new un(t.id,t.width,t.height)},t.prototype.reflowPages=function(t,e,n,r,o,i,a,c){var s=r-o-i;e=e.slice();for(var u=[];e.length>0;){if(u.length<t.length){for(var d=t[u.length],l=!1,h=0,p=d.children.length;h<p;h++){if(d.children.at(h).id!==e[h].id){l=!0;break}}if(!l){u.push(d),e.splice(0,d.children.length);continue}}for(var f=[],g=0,v=e.shift();v&&g+v.height<=s;)f.push(v),g+=v.height,v=e.shift();if(v){for(var m=[],y=0,b=v.children.length;y<b;y++){var w=v.children.at(y);if(g+w.height+v.paddingVertical>s)break;m.push(w),g+=w.height}if(m.length>0)switch(v.type){case"block":var x=new ln(v.renderId,m,n,v.paddingTop,v.paddingBottom,v.paddingLeft,v.paddingRight);f.push(x),g+=x.height;var S=new ln(v.renderId,v.children.slice(m.length),n,v.paddingTop,v.paddingBottom,v.paddingLeft,v.paddingRight);e.unshift(S);break;default:throw new Error("Invalid node type encountered while reflowing page.")}else e.unshift(v)}var C=new mn(f,n,r,o,i,a,c);u.push(C)}return u},t.prototype.reflowLines=function(t,e,n){e=e.slice();for(var r=[];e.length>0;){if(r.length<r.length){for(var o=t[r.length],i=!1,a=0,c=o.children.length;a<c;a++){if(o.children.at(a).id!==e[a].id){i=!0;break}}if(!i){r.push(o),e.splice(0,o.children.length);continue}}for(var s=[],u=0,d=e.shift();d&&u+d.width<=n;)s.push(d),u+=d.width,d=e.shift();if(d){for(var l=d.children.slice(),h=[],p=0;p<l.length;p++){var f=l[p];if("word"===f.type&&f.width>n){var g=f.convertCoordinatesToPosition(n,0);f.resolveBoundingBoxes(g,g).boundingBoxes[0].left>n&&g--;var v=f.breakAt(g),m=v[0],y=v[1];f=m,l.splice(p,1,m,y)}if(u+f.width>n)break;h.push(f),u+=f.width}if(h.length>0)switch(d.type){case"text":var b=d,w=new bn(b.renderId,h,b.paddingTop,b.paddingBottom,b.paddingLeft,b.paddingRight,b.font);s.push(w),u+=w.width;var x=new bn(b.renderId,l.slice(h.length),b.paddingTop,b.paddingBottom,b.paddingLeft,b.paddingRight,b.font);e.unshift(x);break;case"atom":d.width>n&&0===s.length?s.push(d):e.unshift(d);break;default:throw new Error("Invalid node type encountered while reflowing page.")}else e.unshift(d)}var S=new gn(s,n);r.push(S)}return r},t}(),Cn=function(){function t(t,e){var n=this;this.renderService=t,this.textService=e,this.didUpdateLayoutStateEventEmitter=new d,this.engine=new Sn(e),this.internalDoc=this.engine.updateDoc(null,t.getDoc()),t.onDidUpdateRenderState((function(t){return n.handleDidUpdateRenderStateEvent(t)}))}return Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.onDidUpdateLayoutState=function(t){return this.didUpdateLayoutStateEventEmitter.on(t)},t.prototype.handleDidUpdateRenderStateEvent=function(t){this.update()},t.prototype.update=function(){var t=this.renderService.getDoc();this.internalDoc=this.engine.updateDoc(this.doc,t),this.didUpdateLayoutStateEventEmitter.emit({})},t}(),On=function(){function t(t,e){this.state=new Cn(t,e)}return t.prototype.onDidUpdateLayoutState=function(t){this.state.onDidUpdateLayoutState(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.resolvePosition=function(t){return this.state.doc.resolvePosition(t)},t.prototype.resolveBoundingBoxes=function(t,e){return this.state.doc.resolveBoundingBoxes(t,e)},t}(),En=function(){function t(t,e){this.root=t,this.componentService=e,this.didUpdateEventEmitter=new d}return t.prototype.applyChange=function(t){var e=t.apply(this.root,this.componentService);return this.didUpdateEventEmitter.emit({changeResult:e}),e},t.prototype.onDidUpdate=function(t){return this.didUpdateEventEmitter.on(t)},t}(),Pn=function(){function t(t,e){this.state=new En(t,e)}return t.prototype.getRoot=function(){return this.state.root},t.prototype.getRootSize=function(){return this.state.root.size},t.prototype.applyChange=function(t){return this.state.applyChange(t)},t.prototype.resolvePosition=function(t){return this.state.root.resolvePosition(t)},t.prototype.onDidUpdateModelState=function(t){this.state.onDidUpdate(t)},t}(),jn=function(){function t(t,e){var n=this;this.componentService=t,this.modelService=e,this.didUpdateRenderStateEventEmitter=new d;var r=e.getRoot();this.internalDoc=this.updateNode(null,r),e.onDidUpdateModelState((function(t){return n.handleDidUpdateModelState(t)}))}return t.prototype.onDidUpdateRenderState=function(t){return this.didUpdateRenderStateEventEmitter.on(t)},Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.handleDidUpdateModelState=function(t){this.update()},t.prototype.update=function(){var t=this.modelService.getRoot();this.internalDoc=this.updateNode(this.doc,t),this.didUpdateRenderStateEventEmitter.emit({})},t.prototype.updateNode=function(t,e){var n=this;if(!e.needRender&&t)return t;var r={};t&&t.children.forEach((function(t){t.modelId&&(r[t.modelId]=t)}));var o=[];return e.children.forEach((function(t){o.push(n.updateNode(r[t.id]||null,t))})),e.clearNeedRender(),this.buildNode(e,o)},t.prototype.buildNode=function(t,e){var n=this.componentService.getComponent(t.componentId).buildRenderNode(t.partId,t.id,t.text,t.attributes,e);if(!n)throw new Error("Error building render node from model node "+t.id+".");return n},t}(),Tn=function(){function t(t,e){this.state=new jn(t,e)}return t.prototype.onDidUpdateRenderState=function(t){this.state.onDidUpdateRenderState(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.getDocSize=function(){return this.state.doc.size},t.prototype.resolvePosition=function(t){return this.state.doc.resolvePosition(t)},t.prototype.resolveFont=function(t,e){for(var n,r,o,i,a,c,s,u,d={},l=[[this.state.doc,0]],h=function(){var n=l.shift(),r=n[0],o=n[1];if(r.text){var i=r.font,a=void 0;for(a in i)a in d?d[a]!==i[a]&&(d[a]=null):d[a]=i[a]}else{var c=0;r.children.forEach((function(n,r){var i=n.size,a=o+c,s=a+i;(t===e?a<=e&&s>t:a<e&&s>t)&&l.push([n,a]),c+=i}))}};l.length>0;)h();return{weight:null!==(n=d.weight)&&void 0!==n?n:null,size:null!==(r=d.size)&&void 0!==r?r:null,family:null!==(o=d.family)&&void 0!==o?o:null,letterSpacing:null!==(i=d.letterSpacing)&&void 0!==i?i:null,underline:null!==(a=d.underline)&&void 0!==a?a:null,italic:null!==(c=d.italic)&&void 0!==c?c:null,strikethrough:null!==(s=d.strikethrough)&&void 0!==s?s:null,color:null!==(u=d.color)&&void 0!==u?u:null}},t.prototype.convertModelToRenderPosition=function(t){return this.state.doc.convertModelToRenderPosition(t)},t.prototype.convertRenderToModelPosition=function(t){return this.state.doc.convertRenderToModelPosition(t)},t}(),In=function(){function t(){this.services={}}return t.prototype.registerService=function(t,e){this.services[t]=e},t.prototype.getService=function(t){var e=this.services[t];if(!e)throw new Error("Service "+t+" is not registered.");return e},t}(),Dn=function(){function t(t,e,n,r,o){this.modelService=t,this.componentService=e,this.cursorService=n,this.renderService=r,this.layoutService=o,this.didApplyTransformationEventEmitter=new d}return t.prototype.applyTransformation=function(t){var e=t.apply(this.modelService,this.cursorService,this.renderService,this.layoutService);return this.didApplyTransformationEventEmitter.emit({result:e}),e},t.prototype.onDidApplyTransformation=function(t){return this.didApplyTransformationEventEmitter.on(t)},t}(),kn=function(){function t(t,e,n,r,o,i,a){var c=this;this.instanceId=t,this.configService=e,this.domService=n,this.cursorService=r,this.layoutService=o,this.viewService=i,this.transformService=a,this.blinkInterval=null,this.blinkState=!0,this.domSelections=[],this.attached=!1;var s=e.getConfig().cursor;this.caretColor=s.caretColor,this.caretInactiveColor=s.caretInactiveColor,this.selectionColor=s.selectionColor,this.selectionInactiveColor=s.selectionInactiveColor,this.domCaret=n.createElement("div"),this.domCaret.className="tw--cursor--caret",this.domCaret.setAttribute("data-tw-instance",this.instanceId),this.domCaret.style.position="absolute",this.domCaret.style.userSelect="none",this.domCaret.style.pointerEvents="none",this.domCaret.style.width="2px",this.domCaret.style.marginLeft="-1px",a.onDidApplyTransformation((function(t){return c.handleDidApplyTransformation(t)})),i.onDidFocus((function(t){return c.handleDidFocus(t)})),i.onDidBlur((function(t){return c.handleDidBlur(t)}))}return t.prototype.attach=function(){if(this.attached)throw new Error("Already attached to the DOM.");this.attached=!0,this.updateView()},t.prototype.updateView=function(){var t=this;if(this.attached){this.clearDOMSelections();var e,n,r,o,i,a=this.cursorService.getCursor(),c=a.anchor,s=a.head,u=Math.min(c,s),d=Math.max(c,s),l=this.layoutService.resolveBoundingBoxes(u,d),h=this.viewService.getDoc(),p=this.layoutService.getDoc(),f=this.viewService.isFocused(),g="",v=-1,m="",y=-1;if(l.children.forEach((function(e){var n=p.children.indexOf(e.node),r=h.children.at(n).domContentContainer;e.boundingBoxes.forEach((function(n,o){if(g||(g=e.node.id,v=o),m=e.node.id,y=o,0!==n.width){var i=t.buildDOMSelection(n);i.style.background=f?t.selectionColor:t.selectionInactiveColor,r.appendChild(i),t.domSelections.push(i)}}))})),s<c)e=g,n=(i=l.children.find((function(t){return t.node.id===g})).boundingBoxes[v]).left,r=i.top,o=i.height;else e=m,n=(i=l.children.find((function(t){return t.node.id===m})).boundingBoxes[y]).left+i.width,r=i.top,o=i.height;if(s===c){this.domCaret.style.display="block",this.domCaret.style.top=r+"px",this.domCaret.style.left=n+"px",this.domCaret.style.height=o+"px",this.domCaret.style.background=f?this.caretColor:this.caretInactiveColor;var b=h.children.find((function(t){return t.id===e})).domContentContainer;this.domCaret.parentElement&&this.domCaret.parentElement!==b&&this.domCaret.parentElement.removeChild(this.domCaret),this.domCaret.parentElement||b.appendChild(this.domCaret),this.blinkStop(),f&&this.blinkStart()}else this.domCaret.style.display="none",this.blinkStop()}},t.prototype.blinkStart=function(){var t=this;null===this.blinkInterval&&(this.blinkState=!0,this.blinkInterval=window.setInterval((function(){t.blinkState=!t.blinkState,t.updateDOMBlink()}),500))},t.prototype.blinkStop=function(){null!==this.blinkInterval&&(this.domCaret.style.visibility="visible",clearInterval(this.blinkInterval),this.blinkInterval=null)},t.prototype.updateDOMBlink=function(){this.blinkState?this.domCaret.style.visibility="visible":this.domCaret.style.visibility="hidden"},t.prototype.clearDOMSelections=function(){this.domSelections.forEach((function(t){t.parentElement&&t.parentElement.removeChild(t)})),this.domSelections=[]},t.prototype.buildDOMSelection=function(t){var e=document.createElement("div");return e.className="tw--cursor--selection",e.setAttribute("data-tw-instance",this.instanceId),e.style.position="absolute",e.style.top=t.top+"px",e.style.left=t.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e.style.userSelect="none",e.style.pointerEvents="none",e},t.prototype.handleDidApplyTransformation=function(t){this.updateView()},t.prototype.handleDidFocus=function(t){this.updateView()},t.prototype.handleDidBlur=function(t){this.updateView()},t}(),_n=function(){function t(t){var e=this;this.$contentEditable=t,this.didCopyEventEmitter=new d,this.didPasteEventEmitter=new d,this.handleCopy=function(t){t.preventDefault(),e.didCopyEventEmitter.emit({})},this.handlePaste=function(t){t.preventDefault();var n=t.clipboardData;n&&e.didPasteEventEmitter.emit({data:n})},t.addEventListener("copy",this.handleCopy),t.addEventListener("paste",this.handlePaste)}return t.prototype.onDidCopy=function(t){return this.didCopyEventEmitter.on(t)},t.prototype.onDidPaste=function(t){return this.didPasteEventEmitter.on(t)},t}(),Mn=function(){function t(t){var e=this;this.$contentEditable=t,this.didFocusEventEmitter=new d,this.didBlurEventEmitter=new d,this.handleFocus=function(){e.didFocusEventEmitter.emit({})},this.handleBlur=function(){e.didBlurEventEmitter.emit({})},t.addEventListener("focus",this.handleFocus),t.addEventListener("blur",this.handleBlur)}return t.prototype.onDidFocus=function(t){return this.didFocusEventEmitter.on(t)},t.prototype.onDidBlur=function(t){return this.didBlurEventEmitter.on(t)},t}(),Rn=function(){function t(t,e){var n=this;this.$contentEditable=t,this.domService=e,this.composing=!1,this.didInsertEventEmitter=new d,this.didPressKeyEventEmitter=new d,this.compositionDidStartEventEmitter=new d,this.compositionDidEndEventEmitter=new d,this.keyInterpreter=new Bn,this.handleDidMutate=function(){setTimeout((function(){if(!n.composing){var t=n.$contentEditable.innerText;n.$contentEditable.innerHTML="",0!==t.length&&n.didInsertEventEmitter.emit({content:t})}}))},this.handleKeyDown=function(t){var e=n.keyInterpreter.interpretFromKeyboardEvent(t);e&&n.didPressKeyEventEmitter.emit({key:e,originalKeyboardEvent:t})},this.handleCompositionStart=function(){n.composing=!0},this.handleCompositionEnd=function(){n.composing=!0},this.mutationObserver=e.createMutationObserver(this.handleDidMutate),t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("compositionstart",this.handleCompositionStart),t.addEventListener("compositionend",this.handleCompositionEnd),this.mutationObserver.observe(t,{subtree:!0,characterData:!0,childList:!0})}return t.prototype.onDidInsert=function(t){return this.didInsertEventEmitter.on(t)},t.prototype.onDidPressKey=function(t){return this.didPressKeyEventEmitter.on(t)},t.prototype.onCompositionDidStart=function(t){return this.compositionDidStartEventEmitter.on(t)},t.prototype.onCompositionDidEnd=function(t){return this.compositionDidEndEventEmitter.on(t)},t}(),Bn=function(){function t(){}return t.prototype.interpretFromKeyboardEvent=function(t){var e;switch(t.key){case"Control":case"Shift":case"Alt":case"Meta":return;case"ArrowLeft":e="left";break;case"ArrowRight":e="right";break;case"ArrowUp":e="up";break;case"ArrowDown":e="down";break;default:e=t.key.toLowerCase()}if(t.metaKey)switch(en()){case"macOS":e="cmd+"+e;break;case"Windows":e="win+"+e;break;case"Linux":default:e="meta+"+e}return t.altKey&&(e="alt+"+e),t.shiftKey&&(e="shift+"+e),t.ctrlKey&&(e="ctrl+"+e),e},t}(),Ln=function(){function t(t,e,n,r){var o=this;this.instanceId=t,this.viewService=e,this.domService=n,this.layoutService=r,this.clickThreshold=250,this.consecutiveClickThreshold=250,this.lastPointerDown=null,this.lastClick=null,this.consecutiveClickCount=0,this.pointerDidDownEventEmitter=new d,this.pointerDidMoveEventEmitter=new d,this.pointerDidUpEventEmitter=new d,this.pointerDidClickEventEmitter=new d,this.handleMouseDown=function(t){var e=o.resolveOffset(t.clientX,t.clientY);if(null!==e){t.preventDefault(),o.lastPointerDown={timestamp:Date.now(),offset:e};var n=null!==o.lastClick&&Date.now()-o.lastClick.timestamp<o.consecutiveClickThreshold;o.pointerDidDownEventEmitter.emit({offset:e,consecutive:n})}},this.handleMouseMove=function(t){var e=o.resolveOffset(t.clientX,t.clientY);null!==e&&o.pointerDidMoveEventEmitter.emit({pointerDown:null!==o.lastPointerDown,offset:e})},this.handleMouseUp=function(t){if(null!==o.lastPointerDown){var e=o.lastPointerDown;o.lastPointerDown=null;var n=o.resolveOffset(t.clientX,t.clientY);if(null!==n){var r=Date.now(),i=e.offset===n&&r-e.timestamp<o.clickThreshold;if(o.pointerDidUpEventEmitter.emit({}),i){if(null!==o.lastClick)r-o.lastClick.timestamp>o.consecutiveClickThreshold&&(o.consecutiveClickCount=0);o.consecutiveClickCount++,o.lastClick={timestamp:Date.now(),offset:n},o.pointerDidClickEventEmitter.emit({offset:n,consecutiveCount:o.consecutiveClickCount})}}}};var i=n.getWindow();i.addEventListener("mousedown",this.handleMouseDown),i.addEventListener("mousemove",this.handleMouseMove),i.addEventListener("mouseup",this.handleMouseUp)}return t.prototype.onPointerDidDown=function(t){return this.pointerDidDownEventEmitter.on(t)},t.prototype.onPointerDidMove=function(t){return this.pointerDidMoveEventEmitter.on(t)},t.prototype.onPointerDidUp=function(t){return this.pointerDidUpEventEmitter.on(t)},t.prototype.onPointerDidClick=function(t){return this.pointerDidClickEventEmitter.on(t)},t.prototype.resolveOffset=function(t,e){for(var n=this.viewService.getDoc(),r=this.layoutService.getDoc(),o=0,i=0,a=n.children.length;i<a;i++){var c=n.children.at(i),s=r.children.at(i),u=c.domContainer.getBoundingClientRect();if(u.left<=t&&u.right>=t&&u.top<=e&&u.bottom>=e){var d=t-u.left,l=e-u.top;return o+s.convertCoordinatesToPosition(d,l)}o+=s.size}return null},t}(),zn=function(){function t(t,e,n,r,o,i){var a=this;this.instanceId=t,this.domService=e,this.commandService=n,this.modelService=r,this.viewService=o,this.layoutService=i,this.focused=!1,this.composing=!1,this.mouseDown=!1,this.handleDidInsert=function(t){a.commandService.executeCommand("tw.state.insert",t.content)},this.handleCompositionDidStart=function(t){a.composing=!0},this.handleCompositionDidEnd=function(t){a.composing=!1},this.handlePointerDidDown=function(t){a.focused||a.commandService.executeCommand("tw.view.focus"),t.consecutive||a.commandService.executeCommand("tw.cursor.move",t.offset)},this.handlePointerDidMove=function(t){t.pointerDown&&a.commandService.executeCommand("tw.cursor.moveHead",t.offset)},this.handlePointerDidClick=function(t){switch(t.consecutiveCount){case 1:break;case 2:a.commandService.executeCommand("tw.cursor.selectWord",t.offset);break;case 3:a.commandService.executeCommand("tw.cursor.selectBlock",t.offset);break;case 4:default:a.commandService.executeCommand("tw.cursor.selectAll")}},this.handleDidFocus=function(t){a.focused=!0},this.handleDidBlur=function(t){a.focused=!1},this.handleCopy=function(t){a.commandService.executeCommand("tw.clipboard.copy")},this.handlePaste=function(t){var e=t.data.getData("text/html"),n=a.domService.createElement("html");n.innerHTML=e;var r=n.querySelector("body");if(r){var o=Array.prototype.slice.call(r.children);console.log(o)}},this.iframe=e.createHiddenIframe(),this.$contentEditable=this.createContentEditable(),this.keyboardObserver=new Rn(this.$contentEditable,e),this.keyboardObserver.onDidInsert(this.handleDidInsert),this.keyboardObserver.onCompositionDidStart(this.handleCompositionDidStart),this.keyboardObserver.onCompositionDidEnd(this.handleCompositionDidEnd),this.pointerObserver=new Ln(t,o,e,i),this.pointerObserver.onPointerDidDown(this.handlePointerDidDown),this.pointerObserver.onPointerDidMove(this.handlePointerDidMove),this.pointerObserver.onPointerDidClick(this.handlePointerDidClick),this.focusObserver=new Mn(this.$contentEditable),this.focusObserver.onDidFocus(this.handleDidFocus),this.focusObserver.onDidBlur(this.handleDidBlur),this.clipboardObserver=new _n(this.$contentEditable),this.clipboardObserver.onDidCopy(this.handleCopy),this.clipboardObserver.onDidPaste(this.handlePaste)}return t.prototype.onDidPressKey=function(t){this.keyboardObserver.onDidPressKey(t)},t.prototype.onDidFocus=function(t){this.focusObserver.onDidFocus(t)},t.prototype.onDidBlur=function(t){this.focusObserver.onDidBlur(t)},t.prototype.attach=function(){var t=this;this.domService.getBody().appendChild(this.iframe),setTimeout((function(){t.iframe.contentDocument.body.appendChild(t.$contentEditable)}))},t.prototype.requestFocus=function(){this.$contentEditable.focus()},t.prototype.requestBlur=function(){this.$contentEditable.blur()},t.prototype.isFocused=function(){return this.focused},t.prototype.isComposing=function(){return this.composing},t.prototype.createContentEditable=function(){var t=this.domService.createElement("div");return t.contentEditable="true",t.style.whiteSpace="pre",t},t}(),An=function(){function t(t,e,n,r,o){var i=this;this.instanceId=t,this.componentService=e,this.layoutService=n,this.renderService=r,this.domService=o,this.didUpdateViewStateEventEmitter=new d,this.domContainer=null;var a=n.getDoc(),c=r.getDoc();this.internalDoc=this.updateNode(null,a,c),n.onDidUpdateLayoutState((function(t){return i.handleDidUpdateLayoutStateEvent(t)}))}return t.prototype.onDidUpdateViewState=function(t){return this.didUpdateViewStateEventEmitter.on(t)},Object.defineProperty(t.prototype,"doc",{get:function(){return this.internalDoc},enumerable:!1,configurable:!0}),t.prototype.attach=function(t){this.domContainer=t,this.reattachDoc()},t.prototype.handleDidUpdateLayoutStateEvent=function(t){this.update()},t.prototype.update=function(){var t=this.layoutService.getDoc(),e=this.renderService.getDoc();this.internalDoc=this.updateNode(this.doc,t,e),this.reattachDoc(),this.didUpdateViewStateEventEmitter.emit({})},t.prototype.reattachDoc=function(){this.domContainer&&(this.domContainer.innerHTML="",this.domContainer.appendChild(this.doc.domContainer))},t.prototype.updateNode=function(t,e,n){var r=this;if(!e.needView&&t)return t;var o={};t&&t.children.forEach((function(t){t.layoutId&&(o[t.layoutId]=t)}));var i={};n&&n.children.forEach((function(t){i[t.id]=t}));var a=[];"text"!==e.type&&e.children.forEach((function(t){var e=o[t.id]||null,c=null;if(t.renderId&&!(c=i[t.renderId]||null))throw new Error("Render node not found.");a.push(r.updateNode(e,t,c||n))})),e.clearNeedView();var c=t?t.domContainer:this.domService.createContainer();return this.buildNode(c,e,n,a)},t.prototype.buildNode=function(t,e,n,r){switch(e.type){case"page":return this.buildPageNode(t,e,r);case"line":return this.buildLineNode(t,e,r)}var o=this.componentService.getComponent(n.componentId),i="text"===e.type?e.children.map((function(t){return t.text})).join(""):e.text,a=o.buildViewNode(t,n.partId,n.id,e.id,i,n.style,r,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);if(!a)throw new Error("Error building view node from render node "+n.id+".");return this.applyMetadataToDOMContainer(a),a},t.prototype.buildPageNode=function(t,e,n){var r=this.componentService.getPageComponent().buildViewNode(t,e.id,n,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);return this.applyMetadataToDOMContainer(r),r},t.prototype.buildLineNode=function(t,e,n){var r=this.componentService.getLineComponent().buildViewNode(t,e.id,n,e.width,e.height,e.paddingTop,e.paddingBottom,e.paddingLeft,e.paddingRight);return this.applyMetadataToDOMContainer(r),r},t.prototype.applyMetadataToDOMContainer=function(t){var e=t.domContainer,n=t.componentId,r=t.partId,o=t.id;e.className="tw--"+n+"--"+r,e.setAttribute("data-tw-instance",this.instanceId),n&&e.setAttribute("data-tw-component",n),r&&e.setAttribute("data-tw-part",r),e.setAttribute("data-tw-id",o)},t}(),Hn=function(){function t(t,e,n,r,o,i,a,c,s,u){this.state=new An(t,r,i,c,n),this.domController=new zn(t,n,s,o,this,i),this.cursor=new kn(t,e,n,a,i,this,u)}return t.prototype.onDidUpdateViewState=function(t){this.state.onDidUpdateViewState(t)},t.prototype.onDidFocus=function(t){this.domController.onDidFocus(t)},t.prototype.onDidBlur=function(t){this.domController.onDidBlur(t)},t.prototype.onDidPressKey=function(t){this.domController.onDidPressKey(t)},t.prototype.getDoc=function(){return this.state.doc},t.prototype.isFocused=function(){return this.domController.isFocused()},t.prototype.attach=function(t){this.state.attach(t),this.cursor.attach(),this.domController.attach()},t.prototype.requestFocus=function(){this.domController.requestFocus()},t.prototype.requestBlur=function(){this.domController.requestBlur()},t}(),Nn=function(){function t(t,e){this.instanceId=Object(Mt.a)(),this.serviceRegistry=new In,this.configService=new R(Ge(),e),this.serviceRegistry.registerService("config",this.configService),this.domService=new Ye,this.serviceRegistry.registerService("dom",this.domService),this.textService=new je(this.domService),this.serviceRegistry.registerService("text",this.textService),this.commandService=new g(this.configService,this.serviceRegistry),this.serviceRegistry.registerService("command",this.commandService),this.componentService=new M(this.configService,this.serviceRegistry),this.serviceRegistry.registerService("component",this.componentService),this.modelService=new Pn(t,this.componentService),this.serviceRegistry.registerService("model",this.modelService),this.renderService=new Tn(this.componentService,this.modelService),this.serviceRegistry.registerService("render",this.renderService),this.cursorService=new Xe(this.configService,this.renderService,this.modelService),this.serviceRegistry.registerService("cursor",this.cursorService),this.layoutService=new On(this.renderService,this.textService),this.serviceRegistry.registerService("layout",this.layoutService),this.transformService=new Dn(this.modelService,this.componentService,this.cursorService,this.renderService,this.layoutService),this.serviceRegistry.registerService("transform",this.transformService),this.viewService=new Hn(this.instanceId,this.configService,this.domService,this.componentService,this.modelService,this.layoutService,this.cursorService,this.renderService,this.commandService,this.transformService),this.serviceRegistry.registerService("view",this.viewService),this.historyService=new tn(this.configService,this.transformService),this.serviceRegistry.registerService("history",this.historyService),this.keyBindingService=new rn(this.configService,this.commandService,this.viewService),this.serviceRegistry.registerService("keyBinding",this.keyBindingService)}return t.prototype.attach=function(t){this.viewService.attach(t)},t.prototype.getServiceRegistry=function(){return this.serviceRegistry},t}();function Wn(){const t=Object(c.a)(["\n    position: absolute;\n    bottom: 8px;\n    left: 9px;\n    right: 9px;\n    height: 3px;\n    background: ",";\n"]);return Wn=function(){return t},t}function Un(){const t=Object(c.a)(["\n    -webkit-appearance: none;\n    border: none;\n    font-size: 12px;\n    font-weight: 500;\n    width: ","px;\n    background: white;\n    border-radius: 3px;\n    padding: 0 9px;\n    outline: none;\n    position: relative;\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    option {\n        color: rgba(0, 0, 0, 0.85);\n    }\n    ","\n"]);return Un=function(){return t},t}function Fn(){const t=Object(c.a)(["\n    flex: 0 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    position: relative;\n    color: rgba(0, 0, 0, 0.85);\n    background: transparent;\n    padding: 0;\n    border: none;\n    border-radius: 3px;\n    outline: none;\n    &:after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 3px;\n        right: 3px;\n        height: 3px;\n    }\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    ","\n    ","\n"]);return Fn=function(){return t},t}function Vn(){const t=Object(c.a)(["\n    flex: 0 0 auto;\n    display: flex;\n    border-radius: 4px;\n    padding: 0 6px;\n    position: relative;\n    &::before {\n        content: '';\n        position: absolute;\n        top: 9px;\n        bottom: 9px;\n        left: 0;\n        width: 1px;\n        background: rgba(0, 0, 0, 0.15);\n    }\n    &:last-child {\n        &::after {\n            content: '';\n            position: absolute;\n            top: 9px;\n            bottom: 9px;\n            right: 0;\n            width: 1px;\n            background: rgba(0, 0, 0, 0.15);\n        }\n    }\n"]);return Vn=function(){return t},t}function Kn(){const t=Object(c.a)(["\n    display: flex;\n    margin: 0 auto;\n    width: 816px;\n"]);return Kn=function(){return t},t}function $n(){const t=Object(c.a)(["\n    position: sticky;\n    top: 0;\n    padding: 3px 24px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.09);\n    z-index: 10;\n"]);return $n=function(){return t},t}const Gn=s.a.div($n()),qn=s.a.div(Kn()),Jn=s.a.div(Vn()),Xn=s.a.button(Fn(),({disabled:t})=>t&&"\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    ",({active:t})=>t&&"\n        color: rgba(255, 0, 0, 1);\n        &:after {\n            background: rgba(255, 0, 0, 1);\n        }\n    "),Yn=s.a.select(Un(),({width:t})=>t,({disabled:t})=>t&&"\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    "),Qn=s.a.div(Wn(),({color:t})=>t);function Zn({taleweaver:t}){const e=Object(r.useState)(null),n=Object(u.a)(e,2),i=n[0],a=n[1],c=Object(r.useCallback)(t=>{a(function(t){const e=t.getServiceRegistry().getService("cursor"),n=t.getServiceRegistry().getService("render"),r=e.getCursor(),o=r.anchor,i=r.head;return n.resolveFont(Math.min(o,i),Math.max(o,i))}(t))},[]);Object(r.useEffect)(()=>{if(!t)return;const e=t.getServiceRegistry().getService("cursor"),n=t.getServiceRegistry().getService("render");e.onDidUpdate(e=>c(t)),n.onDidUpdateRenderState(e=>c(t)),c(t)},[t,c]);const s=null===t||void 0===t?void 0:t.getServiceRegistry().getService("command");return i?o.a.createElement(Gn,null,o.a.createElement(qn,null,o.a.createElement(Jn,null,o.a.createElement(Yn,{width:120,value:"Normal",disabled:!1,onChange:t=>null},o.a.createElement("option",{value:"",style:{display:"none"}}),o.a.createElement("option",{value:"Normal"},"Normal text"),o.a.createElement("option",{value:"Title"},"Title"),o.a.createElement("option",{value:"Subtitle"},"Subtitle"),o.a.createElement("option",{value:"Heading 1"},"Heading 1"),o.a.createElement("option",{value:"Heading 2"},"Heading 2"),o.a.createElement("option",{value:"Heading 3"},"Heading 3"))),o.a.createElement(Jn,null,o.a.createElement(Yn,{width:120,value:i.family||"",disabled:null===i.family,onChange:t=>null},o.a.createElement("option",{value:"",style:{display:"none"}}),o.a.createElement("option",{value:"sans-serif"},"sans-serif"))),o.a.createElement(Jn,null,o.a.createElement(Yn,{width:60,value:i.size?i.size.toString():"",disabled:null===i.size,onChange:t=>null},o.a.createElement("option",{value:"",style:{display:"hidden"}}),o.a.createElement("option",{value:"10"},"10"),o.a.createElement("option",{value:"12"},"12"),o.a.createElement("option",{value:"14"},"14"),o.a.createElement("option",{value:"16"},"16"),o.a.createElement("option",{value:"18"},"18"),o.a.createElement("option",{value:"24"},"24"),o.a.createElement("option",{value:"30"},"30"),o.a.createElement("option",{value:"36"},"36"),o.a.createElement("option",{value:"42"},"42"))),o.a.createElement(Jn,null,o.a.createElement(Xn,{active:!!i.weight&&i.weight>400,disabled:!1,onClick:()=>s.executeCommand("tw.state.applyAttribute","text","text","weight",i.weight&&i.weight>400?400:700)},o.a.createElement("i",{className:"mdi mdi-format-bold"})),o.a.createElement(Xn,{active:!!i.italic,disabled:!1,onClick:()=>s.executeCommand("tw.state.applyAttribute","text","text","italic",!i.italic)},o.a.createElement("i",{className:"mdi mdi-format-italic"})),o.a.createElement(Xn,{active:!!i.underline,disabled:!1,onClick:()=>s.executeCommand("tw.state.applyAttribute","text","text","underline",!i.underline)},o.a.createElement("i",{className:"mdi mdi-format-underline"})),o.a.createElement(Xn,{active:!!i.strikethrough,disabled:!1,onClick:()=>s.executeCommand("tw.state.applyAttribute","text","text","strikethrough",!i.strikethrough)},o.a.createElement("i",{className:"mdi mdi-format-strikethrough-variant"})),o.a.createElement(Xn,{active:!1,disabled:null===i.color,onClick:()=>null},o.a.createElement("i",{className:"mdi mdi-format-color-text",style:{position:"relative",top:"-2px"}}),o.a.createElement(Qn,{color:i.color||"transparent"}))))):null}function tr(){const t=Object(c.a)(["\n    text-align: center;\n    .tw--doc--doc {\n        font-family: 'Source Sans Pro', sans-serif;\n        display: inline-block;\n        padding-bottom: 9px;\n        counter-reset: page-counter;\n    }\n    .tw--page--page {\n        background: rgba(255, 255, 255, 1);\n        margin: 9px auto 0;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);\n        position: relative;\n        &::after {\n            counter-increment: page-counter;\n            content: 'Page ' counter(page-counter) '';\n            position: absolute;\n            top: 12px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px;\n            font-family: 'Quicksand', sans-serif;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.45);\n            pointer-events: none;\n        }\n        *::selection {\n            background: rgba(255, 255, 255, 1);\n        }\n    }\n"]);return tr=function(){return t},t}function er(){const t=Object(c.a)([""]);return er=function(){return t},t}const nr=s.a.div(er()),rr=s.a.div(tr());var or=function({initialDoc:t,config:e}){const n=Object(r.useRef)(null),i=n.current,a=Object(r.useState)(null),c=Object(u.a)(a,2),s=c[0],d=c[1];return Object(r.useEffect)(()=>{const n={};e&&(n["tw.core"]=e);const r=function(t,e){var n=new In,r=new R(Ge(),e),o=new M(r,n);return function t(e){return o.getComponent(e.componentId).buildModelNode(e.partId,e.id,e.text,e.attributes,e.children.map((function(e){return t(e)})))}(t)}(t,n);d(new Nn(r,n))},[e,t]),Object(r.useEffect)(()=>{s&&i&&s.attach(i)},[s,i,t]),o.a.createElement(nr,null,o.a.createElement(Zn,{taleweaver:s}),o.a.createElement(rr,{ref:n}))};var ir={componentId:"doc",partId:"doc",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"Once upon a time there lived in a certain village a little country girl, the prettiest creature was ever seen. Her mother was excessively fond of her; and her grandmother doted on her still more. This good woman had made for her a little red riding-hood; which became the girl so extremely well that everybody called her Little Red Riding-Hood.",attributes:{weight:700},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"One day her mother, having made some custards, said to her:",attributes:{italic:!0},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Go, my dear, and see how thy grandmamma does, for I hear she has been very ill; carry her a custard, and this little pot of butter."',attributes:{color:"rgba(255, 0, 0, 1)"},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"Little Red Riding-Hood set out immediately to go to her grandmother, who lived in another village.",attributes:{size:24},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"As she was going through the wood, she met with Gaffer Wolf, who had a very great mind to eat her up, but he dared not, because of some faggot-makers hard by in the forest. He asked her whither she was going. The poor child, who did not know that it was dangerous to stay and hear a wolf talk, said to him:",attributes:{strikethrough:!0,underline:!0},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"I am going to see my grandmamma and carry her a custard and a little pot of butter from my mamma."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Does she live far off?" said the Wolf.',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Oh! ay," answered Little Red Riding-Hood; "it is beyond that mill you see there, at the first house in the village."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Well," said the Wolf, "and I\'ll go and see her too. I\'ll go this way and you go that, and we shall see who will be there soonest."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"The Wolf began to run as fast as he could, taking the nearest way, and the little girl went by that farthest about, diverting herself in gathering nuts, running after butterflies, and making nosegays of such little flowers as she met with. The Wolf was not long before he got to the old woman's house. He knocked at the door--tap, tap.",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Your grandchild, Little Red Riding-Hood," replied the Wolf, counterfeiting her voice; "who has brought you a custard and a little pot of butter sent you by mamma."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"The good grandmother, who was in bed, because she was somewhat ill, cried out",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Pull the bobbin, and the latch will go up."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"The Wolf pulled the bobbin, and the door opened, and then presently he fell upon the good woman and ate her up in a moment, for it was above three days that he had not touched a bit. He then shut the door and went into the grandmother's bed, expecting Little Red Riding- Hood, who came some time afterward and knocked at the door--tap, tap.",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Who\'s there?"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"Little Red Riding-Hood, hearing the big voice of the Wolf, was at first afraid; but believing her grandmother had got a cold and was hoarse, answered:",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'" \'Tis your grandchild, Little Red Riding-Hood, who has brought you a custard and a little pot of butter mamma sends you."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"The Wolf cried out to her, softening his voice as much as he could:",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Pull the bobbin, and the latch will go up."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"Little Red Riding-Hood pulled the bobbin, and the door opened.",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"The Wolf, seeing her come in, said to her, hiding himself under the bed-clothes:",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Put the custard and the little pot of butter upon the stool, and come and lie down with me."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"Little Red Riding-Hood undressed herself and went into bed, where, being greatly amazed to see how her grandmother looked in her night-clothes, she said to her:",attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Grandmamma, what great arms you have got!"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"That is the better to hug thee, my dear."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Grandmamma, what great legs you have got!"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"That is to run the better, my child."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Grandmamma, what great ears you have got!"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"That is to hear the better, my child."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Grandmamma, what great eyes you have got!"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"It is to see the better, my child."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"Grandmamma, what great teeth you have got!"',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:'"That is to eat thee up."',attributes:{},children:[]}]},{componentId:"paragraph",partId:"paragraph",id:Object(Mt.a)(),text:"",attributes:{},children:[{componentId:"text",partId:"text",id:Object(Mt.a)(),text:"And, saying these words, this wicked wolf fell upon Little Red Riding-Hood, and ate her all up.",attributes:{},children:[]}]}]};function ar(){const t=Object(c.a)(["\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    color: rgba(0, 0, 0, 0.65);\n    border-top: 1px solid rgba(0, 0, 0, 0.45);\n    padding-top: 10px;\n    cursor: default;\n"]);return ar=function(){return t},t}function cr(){const t=Object(c.a)(["\n    text-align: center;\n    margin-top: 90px;\n"]);return cr=function(){return t},t}function sr(){const t=Object(c.a)(["\n    display: inline-block;\n    padding: 15px 60px;\n    outline: none;\n    color: rgba(0, 0, 0, 0.85);\n    text-decoration: none;\n    font-size: 20px;\n    background: transparent;\n    border-radius: 3px;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    &:hover {\n        color: rgba(0, 0, 0, 1);\n        background: rgba(0, 0, 0, 0.04);\n        border-color: rgba(0, 0, 0, 0.25);\n    }\n"]);return sr=function(){return t},t}function ur(){const t=Object(c.a)(["\n    margin-top: 90px;\n"]);return ur=function(){return t},t}function dr(){const t=Object(c.a)(["\n    font-size: 20px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 30px 0 0;\n"]);return dr=function(){return t},t}function lr(){const t=Object(c.a)(["\n    font-size: 30px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 90px 0 0;\n"]);return lr=function(){return t},t}function hr(){const t=Object(c.a)(["\n    color: rgba(0, 0, 0, 0.65);\n    font-size: 42px;\n    letter-spacing: 0.02em;\n    padding-bottom: 10px;\n    border-bottom: 2px solid rgba(0, 0, 0, 0.65);\n"]);return hr=function(){return t},t}function pr(){const t=Object(c.a)([""]);return pr=function(){return t},t}function fr(){const t=Object(c.a)(["\n    text-align: center;\n    padding: 90px 60px 30px;\n"]);return fr=function(){return t},t}function gr(){const t=Object(c.a)([""]);return gr=function(){return t},t}const vr=s.a.div(gr()),mr=s.a.div(fr()),yr=s.a.div(pr()),br=s.a.span(hr()),wr=s.a.h1(lr()),xr=s.a.h2(dr()),Sr=s.a.div(ur()),Cr=s.a.a(sr()),Or=s.a.div(cr()),Er=s.a.span(ar());class Pr extends o.a.Component{render(){return o.a.createElement(vr,null,o.a.createElement(mr,null,o.a.createElement(yr,null,o.a.createElement(br,null,"Taleweaver")),o.a.createElement(wr,null,"Word processing in your browser."),o.a.createElement(xr,null,"Open source editor delivering true word processing experience."),o.a.createElement(Sr,null,o.a.createElement(Cr,{href:"https://github.com/yuzhenmi/taleweaver"},"GitHub")),o.a.createElement(Or,null,o.a.createElement(Er,null,"\u2193 Check it out \u2193"))),o.a.createElement(or,{initialDoc:ir,config:{page:{width:816,height:1056,paddingTop:60,paddingBottom:60,paddingLeft:60,paddingRight:60}}}))}}var jr=Pr;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(jr,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}},[[107,1,2]]]);
//# sourceMappingURL=main.5a1a4242.chunk.js.map