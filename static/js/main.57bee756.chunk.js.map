{"version":3,"sources":["../../../packages/core/dist/tw/util/id.js","../../../packages/core/dist/tw/event/emitter.js","../../../packages/core/dist/tw/command/registry.js","../../../packages/core/dist/tw/command/service.js","../../../packages/core/dist/tw/tree/node-list.js","../../../packages/core/dist/tw/tree/node.js","../../../packages/core/dist/tw/view/node.js","../../../packages/core/dist/tw/view/line.js","../../../packages/core/dist/tw/component/line-component.js","../../../packages/core/dist/tw/component/components/line.js","../../../packages/core/dist/tw/view/page.js","../../../packages/core/dist/tw/component/page-component.js","../../../packages/core/dist/tw/component/components/page.js","../../../packages/core/dist/tw/component/registry.js","../../../packages/core/dist/tw/component/service.js","../../../packages/core/dist/tw/config/service.js","../../../packages/core/dist/tw/command/handlers/clipboard.js","../../../packages/core/dist/tw/util/dom.js","../../../packages/core/dist/tw/layout/position.js","../../../packages/core/dist/tw/transform/transformation.js","../../../packages/core/dist/tw/command/handlers/cursor.js","../../../packages/core/dist/tw/command/handlers/history.js","../../../packages/core/dist/tw/model/change/change.js","../../../packages/core/dist/tw/model/change/mapping.js","../../../packages/core/dist/tw/model/position.js","../../../packages/core/dist/tw/model/change/apply-attribute.js","../../../packages/core/dist/tw/model/change/replace.js","../../../packages/core/dist/tw/command/handlers/state.js","../../../packages/core/dist/tw/command/handlers/view.js","../../../packages/core/dist/tw/model/node.js","../../../packages/core/dist/tw/model/root.js","../../../packages/core/dist/tw/render/node.js","../../../packages/core/dist/tw/render/doc.js","../../../packages/core/dist/tw/view/doc.js","../../../packages/core/dist/tw/component/component.js","../../../packages/core/dist/tw/component/components/doc.js","../../../packages/core/dist/tw/model/branch.js","../../../packages/core/dist/tw/render/block.js","../../../packages/core/dist/tw/render/text.js","../../../packages/core/dist/tw/text/service.js","../../../packages/core/dist/tw/view/block.js","../../../packages/core/dist/tw/view/text.js","../../../packages/core/dist/tw/component/components/paragraph.js","../../../packages/core/dist/tw/model/leaf.js","../../../packages/core/dist/tw/component/components/text.js","../../../packages/core/dist/tw/config/util.js","../../../packages/core/dist/tw/cursor/state.js","../../../packages/core/dist/tw/cursor/service.js","../../../packages/core/dist/tw/dom/service.js","../../../packages/core/dist/tw/history/action.js","../../../packages/core/dist/tw/history/state.js","../../../packages/core/dist/tw/history/service.js","../../../packages/core/dist/tw/util/platform.js","../../../packages/core/dist/tw/key-binding/service.js","../../../packages/core/dist/tw/layout/node.js","../../../packages/core/dist/tw/layout/atom.js","../../../packages/core/dist/tw/layout/block.js","../../../packages/core/dist/tw/layout/doc.js","../../../packages/core/dist/tw/layout/line.js","../../../packages/core/dist/tw/layout/page.js","../../../packages/core/dist/tw/layout/text.js","../../../packages/core/dist/tw/layout/word.js","../../../packages/core/dist/tw/layout/engine.js","../../../packages/core/dist/tw/layout/state.js","../../../packages/core/dist/tw/layout/service.js","../../../packages/core/dist/tw/model/state.js","../../../packages/core/dist/tw/model/service.js","../../../packages/core/dist/tw/render/state.js","../../../packages/core/dist/tw/render/service.js","../../../packages/core/dist/tw/service/registry.js","../../../packages/core/dist/tw/transform/service.js","../../../packages/core/dist/tw/view/cursor.js","../../../packages/core/dist/tw/view/clipboard-observer.js","../../../packages/core/dist/tw/view/focus-observer.js","../../../packages/core/dist/tw/view/keyboard-observer.js","../../../packages/core/dist/tw/view/pointer-observer.js","../../../packages/core/dist/tw/view/dom-controller.js","../../../packages/core/dist/tw/view/state.js","../../../packages/core/dist/tw/view/service.js","../../../packages/core/dist/tw/taleweaver.js","Editor/ToolBar.tsx","Editor/Editor.tsx","Editor/index.ts","../../../packages/core/dist/tw/util/serialize.js","samples/littleRedRidingHood.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["bytes16","Uint8Array","generateId","Buffer","from","String","fromCharCode","apply","Array","crypto","randomFillSync","toString","EventEmitter","this","listeners","prototype","on","listener","_this","push","dispose","index","indexOf","splice","emit","event","forEach","CommandRegistry","commandsMap","Map","registerCommand","commandId","commandHandler","set","getCommandHandler","get","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","__spreadArrays","s","i","il","arguments","r","k","a","j","jl","CommandService","configService","serviceRegistry","willExecuteCommandEventEmitter","didExecuteCommandEventEmitter","registry","_i","_a","Object","entries","getConfig","commands","_b","onWillExecuteCommand","onDidExecuteCommand","executeCommand","args","NodeList","nodes","defineProperty","enumerable","configurable","at","Error","node","findIndex","id","callbackFn","map","reduce","initialValue","filter","callbackfn","slice","start","end","find","Node","parent","internalChildren","children","siblings","ownIndex","previousSibling","root","parentPreviousSibling","previousCrossParentSibling","lastChild","nextSibling","parentNextSibling","nextCrossParentSibling","firstChild","findDescendant","leaf","nn","boundOffset","offset","Math","min","contentLength","max","__extends","extendStatics","d","b","setPrototypeOf","__proto__","p","hasOwnProperty","__","constructor","create","ViewNode","_super","domContainer","componentId","renderId","layoutId","text","style","domService","child","undefined","internalSize","size","ViewLine","LineComponent","width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","innerHTML","appendChild","AbstractViewLine","buildViewNode","getService","AbstractLineComponent","ViewPage","PageComponent","position","marginLeft","marginRight","domContentContainer","findOrCreateDOMContentContainer","setAttribute","getAttribute","createElement","AbstractViewPage","AbstractPageComponent","ComponentRegistry","componentsMap","registerComponent","component","registerPageComponent","pageComponent","registerLineComponent","lineComponent","getComponent","getPageComponent","getLineComponent","ComponentService","components","Component","convertModelToDOM","to","fromOffset","toOffset","toDOM","partId","attributes","substring","domChildren","ConfigService","config","externalConfig","applyExternalConfig","coreConfig","page","iframe","window","document","scrolling","src","border","zIndex","opacity","overflow","left","top","createHiddenIframe","copy","cursorService","modelService","renderService","componentService","anchor","head","html","iframeDocument","hasCursor","getCursor","getRoot","resolvePosition","convertRenderToModelPosition","outerHTML","contentDocument","execCommand","paste","atLine","type","atWord","Transformation","changes","modelCursorHead","modelCursorAnchor","keepLeftLock","layoutService","originalCursorModelAnchor","originalCursorModelHead","changeResults","applyChanges","cursorAnchor","cursorHead","convertModelToRenderPosition","setCursor","_c","line","linePosition","setLeftLock","resolveBoundingBoxes","boundingBoxes","reverseChanges","reverseMappings","changeResult","reverseChange","reverseMapping","mapping","reverse","TransformationResult","mappings","_loop_1","change","shift","applyChange","c","getDocSize","transformation","reverseTransformation","atPreviousLine","leftLock","previousLine","convertCoordinatesToPosition","atNextLine","nextLine","atPreviousWord","word","wordPosition","previousWord","atNextWord","whitespaceSize","nextWord","atLineStart","atLineEnd","move","transformService","modelOffset","applyTransformation","moveBackward","newModelPosition","newPosition","moveForward","moveBackwardByLine","moveForwardByLine","moveBackwardByWord","moveForwardByWord","moveToLineStart","moveToLineEnd","moveToDocStart","moveToDocEnd","moveHead","modelAnchor","newModelHead","moveHeadBackward","moveHeadForward","moveHeadBackwardByLine","newHead","moveHeadForwardByLine","moveHeadBackwardByWord","moveHeadForwardByWord","moveHeadToLineStart","moveHeadToLineEnd","moveHeadToDocStart","moveHeadToDocEnd","selectAll","newModelAnchor","selectWord","newAnchor","selectBlock","block","blockPosition","atBlock","undo","redo","ModelChange","Mapping","descs","desc","internalMap","toBefore","toAfter","testPositionGreaterThan","position1","position2","identity","ApplyAttribute","key","applyNode","originalValue","applyAttribute","Remover","ran","run","remove","replace","removed","joinedChildrenAt","joinNodes","removedChildFragment","node1","node2","Inserter","fragment","insert","ownOffset","ceil","contentIndex1","contentIndex2","content1","content2","text2","buildModelNode","children2","contentIndex","content","ReplaceChange","modelFrom","modelTo","newModelOffset","deleteBackward","deleteForward","breakLine","attributeKey","attributeValue","findNodesByComponentIdAndPartId","currentNode","unshift","buildModelPosition","focus","requestFocus","blur","requestBlur","ModelNode","internalNeedRender","childDidUpdateDisposableMap","didUpdateEventEmitter","handleChildDidUpdate","internalText","onDidUpdate","canJoin","clearNeedRender","replacedContent","resolvedPosition","ModelRoot","RenderNode","modelId","internalNeedLayout","clearNeedLayout","cumulatedSize","childSize","modelPosition","renderPosition","nextNonModelSize","m","nextChild","RenderDoc","ViewDoc","attached","ModelDoc","AbstractRenderDoc","textAlign","cursor","userSelect","AbstractViewDoc","DocComponent","buildRenderNode","pageConfig","$element_1","ModelBranch","RenderBlock","RenderText","DEFAULT_FONT","weight","family","letterSpacing","underline","italic","strikethrough","color","BREAKABLE_CHARS","TextService","$canvas","measure","font","fontWithDefault","applyDefaultFont","ctx","getContext","fixFontFamily","measurement","measureText","breakIntoWords","words","char","includes","fontConfigWithDefault","fontFamily","ViewBlock","ViewText","ModelParagraph","RenderParagraph","RenderParagraphLineBreak","ViewParagraph","lineHeight","ViewParagraphLineBreak","ParagraphComponent","ModelLeaf","ModelText","JSON","stringify","textService","AbstractRenderText","display","whiteSpace","fontSize","fontWeight","textDecoration","fontStyle","AbstractViewText","TextComponent","$element","innerText","buildBaseConfig","clipboardCommandHandlers","cursorCommandHandlers","historyCommandHandlers","stateCommandHandlers","viewCommandHandlers","doc","paragraph","disable","caretColor","caretInactiveColor","selectionColor","selectionInactiveColor","history","collapseThreshold","maxCollapseDuration","keyBindings","common","command","preventDefault","right","up","down","backspace","delete","enter","macos","windows","home","linux","__assign","assign","CursorState","internalCursor","assertCursor","CursorService","state","DOMService","getWindow","getDocument","getBody","tagName","createContainer","container","createMutationObserver","callback","MutationObserver","HistoryAction","internalTransformationResults","beganAt","Date","now","internalEndedAt","recordTransformationResult","transformationResult","transformationResults","HistoryState","actions","handleDidApplyTransformation","some","tnResult","recordToNewAction","currentItem","endedAt","recordToLastAction","onDidApplyTransformation","action","consumeNextUndoableAction","results","consumeNextRedoableAction","HistoryService","detectPlatform","navigator","platform","startsWith","KeyBindingService","commandService","viewService","handleDidPressKey","keyBinding","originalKeyboardEvent","keyBindingsConfig","bindKeys","onDidPressKey","binding","LayoutNode","internalNeedView","paddingHorizontal","paddingVertical","clearNeedView","LayoutAtom","x","innerWidth","innerHeight","bottom","LayoutBlock","internalHeight","cumulatedHeight","childHeight","resolvedChildren","cumulatedOffset","childFrom_1","childTo_1","childResult","boundingBox","LayoutDoc","childFrom","childTo","resolvedChild","LayoutLine","internalContentWidth","contentWidth","cumulatedWidth","childWidth","lastWord","left1","left2","box","LayoutPage","internalContentHeight","contentHeight","contentX","contentY","LayoutText","internalWidth","internalTrimmedWidth","trimmedWidth","LayoutWord","trimmedText","lastWidth","width_1","breakAt","LayoutEngine","updateDoc","renderDoc","needLayout","pages","childrenMap","newChildren","updateBlock","buildDoc","reflowPages","blocks","renderBlock","lines","blocks_1","renderChild","updateText","updateAtom","buildBlock","reflowLines","texts","renderText","buildWord","buildText","atoms","renderAtom","buildAtom","newPages","reflowNeeded","currentHeight","nodeChildren","mm","nodeChild","newPage","newLines","currentWidth","newNodeChildren","brokenNodeChild1","brokenNodeChild2","newLine","LayoutState","didUpdateLayoutStateEventEmitter","engine","internalDoc","getDoc","onDidUpdateRenderState","handleDidUpdateRenderStateEvent","onDidUpdateLayoutState","update","LayoutService","ModelState","ModelService","getRootSize","onDidUpdateModelState","RenderState","didUpdateRenderStateEventEmitter","modelRoot","updateNode","handleDidUpdateModelState","modelNode","needRender","modelChild","buildNode","RenderService","getStylesBetween","resolvedFrom","resolvedTo","styles","extractStyle","componentStyles","ServiceRegistry","services","registerService","service","TransformService","didApplyTransformationEventEmitter","tn","CursorView","instanceId","blinkInterval","blinkState","domSelections","cursorConfig","domCaret","className","pointerEvents","onDidFocus","handleDidFocus","onDidBlur","handleDidBlur","attach","updateView","clearDOMSelections","headPageId","headLeft","headTop","headHeight","rect","docBoxResult","viewDoc","layoutDoc","focused","isFocused","firstPageId","firstBoxOffset","lastPageId","lastBoxOffset","pageBoxResult","pageOffset","boxOffset","domSelection","buildDOMSelection","background","pageDOMContentContainer","parentElement","removeChild","blinkStop","blinkStart","setInterval","updateDOMBlink","visibility","clearInterval","ClipboardObserver","$contentEditable","didCopyEventEmitter","didPasteEventEmitter","handleCopy","handlePaste","data","clipboardData","addEventListener","onDidCopy","onDidPaste","FocusObserver","didFocusEventEmitter","didBlurEventEmitter","handleFocus","handleBlur","KeyboardObserver","composing","didInsertEventEmitter","didPressKeyEventEmitter","compositionDidStartEventEmitter","compositionDidEndEventEmitter","keyInterpreter","KeyInterpreter","handleDidMutate","setTimeout","handleKeyDown","interpretFromKeyboardEvent","handleCompositionStart","handleCompositionEnd","mutationObserver","observe","subtree","characterData","childList","onDidInsert","onCompositionDidStart","onCompositionDidEnd","toLowerCase","metaKey","altKey","shiftKey","ctrlKey","PointerObserver","clickThreshold","consecutiveClickThreshold","lastPointerDown","lastClick","consecutiveClickCount","pointerDidDownEventEmitter","pointerDidMoveEventEmitter","pointerDidUpEventEmitter","pointerDidClickEventEmitter","handleMouseDown","resolveOffset","clientX","clientY","timestamp","consecutive","handleMouseMove","pointerDown","handleMouseUp","clicked","consecutiveCount","onPointerDidDown","onPointerDidMove","onPointerDidUp","onPointerDidClick","viewPage","layoutPage","pageBoundingClientRect","getBoundingClientRect","pageX","pageY","DOMController","mouseDown","handleDidInsert","handleCompositionDidStart","handleCompositionDidEnd","handlePointerDidDown","handlePointerDidMove","handlePointerDidClick","getData","$container","$body","querySelector","domNodes","console","log","createContentEditable","keyboardObserver","pointerObserver","focusObserver","clipboardObserver","isComposing","contentEditable","ViewState","didUpdateViewStateEventEmitter","handleDidUpdateLayoutStateEvent","onDidUpdateViewState","reattachDoc","layoutNode","renderNode","needView","renderChildrenMap","layoutChild","buildPageNode","buildLineNode","join","applyMetadataToDOMContainer","viewNode","ViewService","domController","Taleweaver","historyService","keyBindingService","getServiceRegistry","Wrapper","styled","div","Container","Group","Item","button","disabled","active","SelectItem","select","ItemColorLine","getTextStyles","taleweaver","getTextStylesByRange","ToolBar","useState","textStyles","setTextStyles","updateTextStyle","useCallback","useEffect","Set","bold","onChange","onClick","EditorWrapper","initialDoc","containerRef","useRef","current","setTaleweaver","mergedConfig","internalParse","parse","ref","Hero","BrandWrapper","Brand","span","Tagline","h1","SupportingTagline","h2","Links","Link","DemoHintWrapper","DemoHint","App","React","render","href","sample","Boolean","location","hostname","match","ReactDOM","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.57bee756.chunk.js","sourcesContent":["import crypto from 'crypto';\nvar bytes16 = new Uint8Array(16);\nfunction generateRandomBytes16() {\n    return crypto.randomFillSync(bytes16);\n}\nexport function generateId() {\n    return Buffer.from(String.fromCharCode.apply(String, Array.from(generateRandomBytes16()))).toString('base64');\n}\n","var EventEmitter = /** @class */ (function () {\n    function EventEmitter() {\n        this.listeners = [];\n    }\n    EventEmitter.prototype.on = function (listener) {\n        var _this = this;\n        this.listeners.push(listener);\n        return {\n            dispose: function () {\n                var index = _this.listeners.indexOf(listener);\n                if (index < 0) {\n                    return;\n                }\n                _this.listeners.splice(index, 1);\n            },\n        };\n    };\n    EventEmitter.prototype.emit = function (event) {\n        this.listeners.forEach(function (listener) { return listener(event); });\n    };\n    return EventEmitter;\n}());\nexport { EventEmitter };\n","var CommandRegistry = /** @class */ (function () {\n    function CommandRegistry() {\n        this.commandsMap = new Map();\n    }\n    CommandRegistry.prototype.registerCommand = function (commandId, commandHandler) {\n        this.commandsMap.set(commandId, commandHandler);\n    };\n    CommandRegistry.prototype.getCommandHandler = function (commandId) {\n        return this.commandsMap.get(commandId);\n    };\n    return CommandRegistry;\n}());\nexport { CommandRegistry };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { CommandRegistry } from './registry';\nvar CommandService = /** @class */ (function () {\n    function CommandService(configService, serviceRegistry) {\n        this.serviceRegistry = serviceRegistry;\n        this.willExecuteCommandEventEmitter = new EventEmitter();\n        this.didExecuteCommandEventEmitter = new EventEmitter();\n        this.registry = new CommandRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().commands); _i < _a.length; _i++) {\n            var _b = _a[_i], commandId = _b[0], commandHandler = _b[1];\n            this.registry.registerCommand(commandId, commandHandler);\n        }\n    }\n    CommandService.prototype.onWillExecuteCommand = function (listener) {\n        return this.willExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.onDidExecuteCommand = function (listener) {\n        return this.didExecuteCommandEventEmitter.on(listener);\n    };\n    CommandService.prototype.executeCommand = function (commandId) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var commandHandler;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        commandHandler = this.registry.getCommandHandler(commandId);\n                        if (!commandHandler) {\n                            return [2 /*return*/];\n                        }\n                        this.willExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [4 /*yield*/, commandHandler.apply(void 0, __spreadArrays([this.serviceRegistry], args))];\n                    case 1:\n                        _a.sent();\n                        this.didExecuteCommandEventEmitter.emit({ commandId: commandId, args: args });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return CommandService;\n}());\nexport { CommandService };\n","var NodeList = /** @class */ (function () {\n    function NodeList(nodes) {\n        if (nodes === void 0) { nodes = []; }\n        this.nodes = nodes;\n    }\n    Object.defineProperty(NodeList.prototype, \"length\", {\n        get: function () {\n            return this.nodes.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    NodeList.prototype.at = function (index) {\n        if (index < 0 || index >= this.nodes.length) {\n            throw new Error(\"Index \" + index + \" is out of range.\");\n        }\n        return this.nodes[index];\n    };\n    NodeList.prototype.indexOf = function (node) {\n        return this.nodes.findIndex(function (n) { return n.id === node.id; });\n    };\n    NodeList.prototype.forEach = function (callbackFn) {\n        return this.nodes.forEach(callbackFn);\n    };\n    NodeList.prototype.map = function (callbackFn) {\n        return this.nodes.map(callbackFn);\n    };\n    NodeList.prototype.reduce = function (callbackFn, initialValue) {\n        return this.nodes.reduce(callbackFn, initialValue);\n    };\n    NodeList.prototype.filter = function (callbackfn) {\n        return this.nodes.filter(callbackfn);\n    };\n    NodeList.prototype.slice = function (start, end) {\n        return this.nodes.slice(start, end);\n    };\n    NodeList.prototype.find = function (callbackFn) {\n        return this.nodes.find(callbackFn);\n    };\n    return NodeList;\n}());\nexport { NodeList };\n","import { NodeList } from './node-list';\nvar Node = /** @class */ (function () {\n    function Node(id) {\n        this.id = id;\n        this.parent = null;\n        this.internalChildren = new NodeList();\n    }\n    Object.defineProperty(Node.prototype, \"children\", {\n        get: function () {\n            return this.internalChildren;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"firstChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(0);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"lastChild\", {\n        get: function () {\n            if (this.children.length === 0) {\n                return null;\n            }\n            return this.children.at(this.children.length - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === 0) {\n                return null;\n            }\n            return siblings.at(ownIndex - 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextSibling\", {\n        get: function () {\n            if (!this.parent) {\n                return null;\n            }\n            var siblings = this.parent.children;\n            var ownIndex = siblings.indexOf(this);\n            if (ownIndex < 0) {\n                throw new Error('Node is not a child of parent.');\n            }\n            if (ownIndex === siblings.length - 1) {\n                return null;\n            }\n            return siblings.at(ownIndex + 1);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"previousCrossParentSibling\", {\n        get: function () {\n            var previousSibling = this.previousSibling;\n            if (previousSibling) {\n                return previousSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentPreviousSibling = parent.previousCrossParentSibling;\n            if (!parentPreviousSibling) {\n                return null;\n            }\n            return parentPreviousSibling.lastChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Node.prototype, \"nextCrossParentSibling\", {\n        get: function () {\n            var nextSibling = this.nextSibling;\n            if (nextSibling) {\n                return nextSibling;\n            }\n            var parent = this.parent;\n            if (!parent || parent.root) {\n                return null;\n            }\n            var parentNextSibling = parent.nextCrossParentSibling;\n            if (!parentNextSibling) {\n                return null;\n            }\n            return parentNextSibling.firstChild;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Node.prototype.findDescendant = function (id) {\n        if (this.id === id) {\n            return this;\n        }\n        if (this.leaf) {\n            return null;\n        }\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var result = child.findDescendant(id);\n            if (result) {\n                return result;\n            }\n        }\n        return null;\n    };\n    Node.prototype.boundOffset = function (offset) {\n        return Math.min(this.contentLength, Math.max(0, offset));\n    };\n    return Node;\n}());\nexport { Node };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar ViewNode = /** @class */ (function (_super) {\n    __extends(ViewNode, _super);\n    function ViewNode(domContainer, componentId, renderId, layoutId, text, style, children, domService) {\n        var _this = _super.call(this, layoutId) || this;\n        _this.domContainer = domContainer;\n        _this.componentId = componentId;\n        _this.renderId = renderId;\n        _this.layoutId = layoutId;\n        _this.text = text;\n        _this.style = style;\n        _this.domService = domService;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(ViewNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewNode;\n}(Node));\nexport { ViewNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(ViewNode));\nexport { ViewLine };\n","var LineComponent = /** @class */ (function () {\n    function LineComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return LineComponent;\n}());\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewLine as AbstractViewLine } from '../../view/line';\nimport { LineComponent as AbstractLineComponent } from '../line-component';\nvar ViewLine = /** @class */ (function (_super) {\n    __extends(ViewLine, _super);\n    function ViewLine(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewLine.prototype, \"partId\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewLine.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewLine;\n}(AbstractViewLine));\nexport { ViewLine };\nvar LineComponent = /** @class */ (function (_super) {\n    __extends(LineComponent, _super);\n    function LineComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    LineComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewLine(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return LineComponent;\n}(AbstractLineComponent));\nexport { LineComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, null, layoutId, '', null, children, domService) || this;\n        _this.layoutId = layoutId;\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewPage;\n}(ViewNode));\nexport { ViewPage };\n","var PageComponent = /** @class */ (function () {\n    function PageComponent(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return PageComponent;\n}());\nexport { PageComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewPage as AbstractViewPage } from '../../view/page';\nimport { PageComponent as AbstractPageComponent } from '../page-component';\nvar ViewPage = /** @class */ (function (_super) {\n    __extends(ViewPage, _super);\n    function ViewPage(domContainer, componentId, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, layoutId, children, domService) || this;\n        _this.domContainer.style.position = 'relative';\n        _this.domContainer.style.marginLeft = 'auto';\n        _this.domContainer.style.marginRight = 'auto';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.innerHTML = '';\n        _this.domContentContainer = _this.findOrCreateDOMContentContainer();\n        _this.domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return _this.domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(_this.domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewPage.prototype, \"partId\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewPage.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('div');\n    };\n    return ViewPage;\n}(AbstractViewPage));\nexport { ViewPage };\nvar PageComponent = /** @class */ (function (_super) {\n    __extends(PageComponent, _super);\n    function PageComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PageComponent.prototype.buildViewNode = function (domContainer, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        return new ViewPage(domContainer, this.id, layoutId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n    };\n    return PageComponent;\n}(AbstractPageComponent));\nexport { PageComponent };\n","var ComponentRegistry = /** @class */ (function () {\n    function ComponentRegistry() {\n        this.componentsMap = new Map();\n    }\n    ComponentRegistry.prototype.registerComponent = function (componentId, component) {\n        this.componentsMap.set(componentId, component);\n    };\n    ComponentRegistry.prototype.registerPageComponent = function (pageComponent) {\n        this.pageComponent = pageComponent;\n    };\n    ComponentRegistry.prototype.registerLineComponent = function (lineComponent) {\n        this.lineComponent = lineComponent;\n    };\n    ComponentRegistry.prototype.getComponent = function (componentId) {\n        var component = this.componentsMap.get(componentId);\n        if (!component) {\n            throw new Error(\"Component \" + componentId + \" is not registered.\");\n        }\n        return component;\n    };\n    ComponentRegistry.prototype.getPageComponent = function () {\n        if (!this.pageComponent) {\n            throw new Error('Page component is not registered.');\n        }\n        return this.pageComponent;\n    };\n    ComponentRegistry.prototype.getLineComponent = function () {\n        if (!this.lineComponent) {\n            throw new Error('Line component is not registered.');\n        }\n        return this.lineComponent;\n    };\n    return ComponentRegistry;\n}());\nexport { ComponentRegistry };\n","import { LineComponent } from './components/line';\nimport { PageComponent } from './components/page';\nimport { ComponentRegistry } from './registry';\nvar ComponentService = /** @class */ (function () {\n    function ComponentService(configService, serviceRegistry) {\n        this.configService = configService;\n        this.serviceRegistry = serviceRegistry;\n        this.registry = new ComponentRegistry();\n        for (var _i = 0, _a = Object.entries(configService.getConfig().components); _i < _a.length; _i++) {\n            var _b = _a[_i], componentId = _b[0], Component = _b[1];\n            this.registry.registerComponent(componentId, new Component(componentId, serviceRegistry));\n        }\n        this.registry.registerPageComponent(new PageComponent('page', serviceRegistry));\n        this.registry.registerLineComponent(new LineComponent('line', serviceRegistry));\n    }\n    ComponentService.prototype.getComponent = function (componentId) {\n        return this.registry.getComponent(componentId);\n    };\n    ComponentService.prototype.getPageComponent = function () {\n        return this.registry.getPageComponent();\n    };\n    ComponentService.prototype.getLineComponent = function () {\n        return this.registry.getLineComponent();\n    };\n    ComponentService.prototype.convertModelToDOM = function (node, from, to) {\n        var fromOffset = from ? from[0].offset : 0;\n        var toOffset = to ? to[0].offset : node.contentLength - 1;\n        var component = this.getComponent(node.componentId);\n        if (node.leaf) {\n            return component.toDOM(node.partId, node.attributes, node.text.substring(fromOffset, toOffset), []);\n        }\n        var domChildren = [];\n        for (var n = fromOffset; n <= toOffset; n++) {\n            var child = node.children.at(n);\n            domChildren.push(this.convertModelToDOM(child, from && n === fromOffset ? from.slice(1) : null, to && n === toOffset ? to.slice(1) : null));\n        }\n        return component.toDOM(node.partId, node.attributes, '', domChildren);\n    };\n    return ComponentService;\n}());\nexport { ComponentService };\n","var ConfigService = /** @class */ (function () {\n    function ConfigService(config, externalConfig) {\n        this.config = config;\n        this.applyExternalConfig(externalConfig);\n    }\n    ConfigService.prototype.getConfig = function () {\n        return this.config;\n    };\n    ConfigService.prototype.applyExternalConfig = function (externalConfig) {\n        var coreConfig = externalConfig['tw.core'];\n        if (coreConfig) {\n            if (coreConfig.page) {\n                this.config.page = coreConfig.page;\n            }\n        }\n    };\n    return ConfigService;\n}());\nexport { ConfigService };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { createHiddenIframe, isDOMAvailable } from '../../util/dom';\nvar iframe;\nif (isDOMAvailable()) {\n    iframe = createHiddenIframe();\n    document.body.appendChild(iframe);\n}\nexport var copy = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var cursorService, modelService, renderService, componentService, _a, anchor, head, html, iframeDocument;\n    return __generator(this, function (_b) {\n        if (!iframe) {\n            return [2 /*return*/];\n        }\n        cursorService = serviceRegistry.getService('cursor');\n        modelService = serviceRegistry.getService('model');\n        renderService = serviceRegistry.getService('render');\n        componentService = serviceRegistry.getService('component');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            return [2 /*return*/];\n        }\n        html = componentService.convertModelToDOM(modelService.getRoot(), modelService.resolvePosition(renderService.convertRenderToModelPosition(Math.min(anchor, head))), modelService.resolvePosition(renderService.convertRenderToModelPosition(Math.max(anchor, head)))).outerHTML;\n        iframeDocument = iframe.contentDocument;\n        if (!iframeDocument) {\n            return [2 /*return*/];\n        }\n        iframeDocument.body.innerHTML = html;\n        iframeDocument.execCommand('selectAll');\n        iframeDocument.execCommand('copy');\n        iframeDocument.body.innerHTML = '';\n        return [2 /*return*/];\n    });\n}); };\nexport var paste = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        return [2 /*return*/];\n    });\n}); };\n","export function isDOMAvailable() {\n    return typeof window !== 'undefined';\n}\nexport function createHiddenIframe() {\n    var iframe = document.createElement('iframe');\n    iframe.scrolling = 'no';\n    iframe.src = 'about:blank';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = 'none';\n    iframe.style.position = 'fixed';\n    iframe.style.zIndex = '-1';\n    iframe.style.opacity = '0';\n    iframe.style.overflow = 'hidden';\n    iframe.style.left = '-1000000px';\n    iframe.style.top = '-1000000px';\n    return iframe;\n}\n","export function atLine(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'line') {\n            return position[n];\n        }\n    }\n    throw new Error('No line found.');\n}\nexport function atWord(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'word') {\n            return position[n];\n        }\n    }\n    throw new Error('No word found.');\n}\nexport function atBlock(position) {\n    for (var n = position.length - 1; n >= 0; n--) {\n        if (position[n].node.type === 'block') {\n            return position[n];\n        }\n    }\n    throw new Error('No block found.');\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { atLine } from '../layout/position';\nvar Transformation = /** @class */ (function () {\n    function Transformation(changes, modelCursorHead, modelCursorAnchor, keepLeftLock) {\n        if (keepLeftLock === void 0) { keepLeftLock = false; }\n        this.changes = changes;\n        this.modelCursorHead = modelCursorHead;\n        this.modelCursorAnchor = modelCursorAnchor;\n        this.keepLeftLock = keepLeftLock;\n    }\n    Transformation.prototype.apply = function (modelService, cursorService, renderService, layoutService) {\n        var originalCursorModelAnchor = undefined;\n        var originalCursorModelHead = undefined;\n        if (cursorService.hasCursor()) {\n            var _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n            originalCursorModelAnchor = renderService.convertRenderToModelPosition(anchor);\n            originalCursorModelHead = renderService.convertRenderToModelPosition(head);\n        }\n        var changeResults = this.applyChanges(modelService);\n        if (cursorService.hasCursor()) {\n            var _b = cursorService.getCursor(), cursorAnchor = _b.anchor, cursorHead = _b.head;\n            if (this.modelCursorHead !== undefined) {\n                cursorHead = renderService.convertModelToRenderPosition(this.modelCursorHead);\n                cursorAnchor = cursorHead;\n                if (this.modelCursorAnchor !== undefined) {\n                    cursorAnchor = renderService.convertModelToRenderPosition(this.modelCursorAnchor);\n                }\n            }\n            cursorAnchor = this.boundOffset(cursorAnchor, renderService);\n            cursorHead = this.boundOffset(cursorHead, renderService);\n            cursorService.setCursor(cursorAnchor, cursorHead);\n            if (!this.keepLeftLock) {\n                var _c = atLine(layoutService.resolvePosition(cursorService.getCursor().head)), line = _c.node, linePosition = _c.position;\n                cursorService.setLeftLock(line.resolveBoundingBoxes(linePosition, linePosition).boundingBoxes[0].left);\n            }\n        }\n        var reverseChanges = [];\n        var reverseMappings = [];\n        for (var n = changeResults.length - 1; n >= 0; n--) {\n            var changeResult = changeResults[n];\n            reverseChanges.push(reverseMappings.reduce(function (reverseChange, reverseMapping) { return reverseChange.map(reverseMapping); }, changeResult.reverseChange));\n            reverseMappings.push(changeResult.mapping.reverse());\n        }\n        return new TransformationResult(this, changeResults, new Transformation(reverseChanges, originalCursorModelHead, originalCursorModelAnchor, this.keepLeftLock));\n    };\n    Transformation.prototype.applyChanges = function (modelService) {\n        var changeResults = [];\n        var mappings = [];\n        var changes = __spreadArrays(this.changes);\n        var _loop_1 = function () {\n            var change = changes.shift();\n            var changeResult = modelService.applyChange(change);\n            var mapping = changeResult.mapping;\n            mappings.push(mapping);\n            changes = changes.map(function (c) { return c.map(mapping); });\n            changeResults.push(changeResult);\n        };\n        while (changes.length > 0) {\n            _loop_1();\n        }\n        return changeResults;\n    };\n    Transformation.prototype.boundOffset = function (offset, renderService) {\n        return Math.max(0, Math.min(renderService.getDocSize() - 1, offset));\n    };\n    return Transformation;\n}());\nexport { Transformation };\nvar TransformationResult = /** @class */ (function () {\n    function TransformationResult(transformation, changeResults, reverseTransformation) {\n        this.transformation = transformation;\n        this.changeResults = changeResults;\n        this.reverseTransformation = reverseTransformation;\n    }\n    return TransformationResult;\n}());\nexport { TransformationResult };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { atBlock, atLine, atWord } from '../../layout/position';\nimport { Transformation } from '../../transform/transformation';\nfunction atPreviousLine(position, leftLock, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    var previousLine = line.previousCrossParentSibling;\n    if (!previousLine) {\n        return position - linePosition;\n    }\n    return position - linePosition - previousLine.size + previousLine.convertCoordinatesToPosition(leftLock, 0);\n}\nfunction atNextLine(position, leftLock, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    var nextLine = line.nextCrossParentSibling;\n    if (!nextLine) {\n        return position - linePosition + line.size - 1;\n    }\n    return position - linePosition + line.size + nextLine.convertCoordinatesToPosition(leftLock, 0);\n}\nfunction atPreviousWord(position, layoutService) {\n    var _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.offset;\n    if (wordPosition > 0) {\n        return position - wordPosition;\n    }\n    var previousWord = word.previousCrossParentSibling;\n    if (!previousWord) {\n        return position;\n    }\n    return position - previousWord.size;\n}\nfunction atNextWord(position, layoutService) {\n    var _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.offset;\n    if (wordPosition < word.size - 1) {\n        return position - wordPosition + word.size - word.whitespaceSize;\n    }\n    var nextWord = word.nextCrossParentSibling;\n    if (!nextWord) {\n        return position;\n    }\n    return position - wordPosition + word.size + nextWord.size - nextWord.whitespaceSize;\n}\nfunction atLineStart(position, layoutService) {\n    var linePosition = atLine(layoutService.resolvePosition(position)).position;\n    if (linePosition === 0) {\n        return position;\n    }\n    return position - linePosition;\n}\nfunction atLineEnd(position, layoutService) {\n    var _a = atLine(layoutService.resolvePosition(position)), line = _a.node, linePosition = _a.position;\n    if (linePosition >= line.size - 1) {\n        return position;\n    }\n    return position - linePosition + line.size - 1;\n}\nexport var move = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, modelOffset;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        modelOffset = renderService.convertRenderToModelPosition(position);\n        transformService.applyTransformation(new Transformation([], modelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelPosition, newPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelPosition = renderService.convertRenderToModelPosition(anchor - 1);\n        }\n        else {\n            newPosition = Math.min(anchor, head);\n            newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        }\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, newModelPosition, newPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            newModelPosition = renderService.convertRenderToModelPosition(anchor + 1);\n        }\n        else {\n            newPosition = Math.max(anchor, head);\n            newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        }\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        position = Math.min(anchor, head);\n        newPosition = atPreviousLine(position, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition, newModelPosition, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, leftLock, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        position = Math.max(anchor, head);\n        newPosition = atNextLine(position, leftLock, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition, newModelPosition, true));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.min(anchor, head);\n        newPosition = atPreviousWord(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.max(anchor, head);\n        newPosition = atNextWord(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.min(anchor, head);\n        newPosition = atLineStart(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, layoutService, _a, anchor, head, position, newPosition, renderService, newModelPosition;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        position = Math.max(anchor, head);\n        newPosition = atLineEnd(position, layoutService);\n        renderService = serviceRegistry.getService('render');\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newPosition, newModelPosition;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newPosition = 0;\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, renderService, newPosition, newModelPosition;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        renderService = serviceRegistry.getService('render');\n        newPosition = renderService.getDocSize() - 1;\n        newModelPosition = renderService.convertRenderToModelPosition(newPosition);\n        transformService.applyTransformation(new Transformation([], newModelPosition));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHead = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(position);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(head - 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(head + 1);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atPreviousLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, leftLock, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head, leftLock = _a.leftLock;\n        newHead = atNextLine(head, leftLock, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadBackwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atPreviousWord(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadForwardByWord = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atNextWord(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineStart(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToLineEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, anchor, head, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        newHead = atLineEnd(head, layoutService);\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocStart = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = 0;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var moveHeadToDocEnd = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, anchor, newHead, modelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        anchor = cursorService.getCursor().anchor;\n        newHead = renderService.getDocSize() - 1;\n        modelAnchor = renderService.convertRenderToModelPosition(anchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, modelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectAll = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, newAnchor, newHead, newModelAnchor, newModelHead;\n    return __generator(this, function (_a) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        newAnchor = 0;\n        newHead = renderService.getDocSize() - 1;\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectWord = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, word, wordPosition, previousWord, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = atWord(layoutService.resolvePosition(position)), word = _a.node, wordPosition = _a.position;\n        if (word.size - word.whitespaceSize === 0) {\n            previousWord = word.previousCrossParentSibling;\n            if (!previousWord) {\n                return [2 /*return*/];\n            }\n            word = previousWord;\n            wordPosition += word.size;\n        }\n        newHead = position - wordPosition + word.size - word.whitespaceSize;\n        newAnchor = position - wordPosition;\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\nexport var selectBlock = function (serviceRegistry, position) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, layoutService, _a, block, blockPosition, newHead, newAnchor, newModelHead, newModelAnchor;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        layoutService = serviceRegistry.getService('layout');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = atBlock(layoutService.resolvePosition(position)), block = _a.node, blockPosition = _a.position;\n        newHead = position - blockPosition + block.size - 1;\n        newAnchor = position - blockPosition;\n        newModelHead = renderService.convertRenderToModelPosition(newHead);\n        newModelAnchor = renderService.convertRenderToModelPosition(newAnchor);\n        transformService.applyTransformation(new Transformation([], newModelHead, newModelAnchor));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var undo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').undo();\n        return [2 /*return*/];\n    });\n}); };\nexport var redo = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('history').redo();\n        return [2 /*return*/];\n    });\n}); };\n","var ModelChange = /** @class */ (function () {\n    function ModelChange() {\n    }\n    return ModelChange;\n}());\nexport { ModelChange };\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { testPositionGreaterThan } from '../position';\nvar Mapping = /** @class */ (function () {\n    function Mapping(descs) {\n        this.descs = descs;\n    }\n    Mapping.prototype.map = function (position) {\n        var _this = this;\n        return this.descs.reduce(function (newPosition, desc) { return _this.internalMap(newPosition, desc.from, desc.toBefore, desc.toAfter); }, position);\n    };\n    Mapping.prototype.reverse = function () {\n        return new Mapping(this.descs.map(function (desc) { return ({ from: desc.from, toBefore: desc.toAfter, toAfter: desc.toBefore }); }));\n    };\n    Mapping.prototype.internalMap = function (position, from, toBefore, toAfter) {\n        if (!testPositionGreaterThan(position, toBefore)) {\n            return position;\n        }\n        return __spreadArrays([\n            position[0] + toAfter[0] - toBefore[0]\n        ], this.internalMap(position.slice(1), from.slice(1), toBefore.slice(1), toAfter.slice(1)));\n    };\n    return Mapping;\n}());\nexport { Mapping };\nexport var identity = {\n    map: function (position) { return position; },\n    reverse: function () { return identity; },\n};\n","export function testPositionLessThan(position1, position2) {\n    if (position1.length === 0 || position2.length === 0) {\n        return false;\n    }\n    if (position1[0] < position2[0]) {\n        return true;\n    }\n    if (position1.length === 1 || position2.length === 1) {\n        return false;\n    }\n    return testPositionLessThan(position1.slice(1), position2.slice(1));\n}\nexport function testPositionGreaterThan(position1, position2) {\n    if (position1.length === 0 || position2.length === 0) {\n        return false;\n    }\n    if (position1[0] > position2[0]) {\n        return true;\n    }\n    if (position1.length === 1 || position2.length === 1) {\n        return false;\n    }\n    return testPositionGreaterThan(position1.slice(1), position2.slice(1));\n}\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelChange } from './change';\nimport { identity } from './mapping';\nvar ApplyAttribute = /** @class */ (function (_super) {\n    __extends(ApplyAttribute, _super);\n    function ApplyAttribute(position, key, value) {\n        var _this = _super.call(this) || this;\n        _this.position = position;\n        _this.key = key;\n        _this.value = value;\n        return _this;\n    }\n    ApplyAttribute.prototype.map = function (mapping) {\n        return this;\n    };\n    ApplyAttribute.prototype.apply = function (root, componentService) {\n        return this.applyNode(root, this.position);\n    };\n    ApplyAttribute.prototype.applyNode = function (node, position) {\n        if (position.length === 0) {\n            var originalValue = node.applyAttribute(this.key, this.value);\n            return {\n                change: this,\n                reverseChange: new ApplyAttribute(this.position, this.key, originalValue),\n                mapping: identity,\n            };\n        }\n        var offset = position[0];\n        return this.applyNode(node.children.at(offset), position.slice(1));\n    };\n    return ApplyAttribute;\n}(ModelChange));\nexport { ApplyAttribute };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { generateId } from '../../util/id';\nimport { ModelChange } from './change';\nimport { Mapping } from './mapping';\nvar Remover = /** @class */ (function () {\n    function Remover(root, from, to) {\n        this.root = root;\n        this.from = from;\n        this.to = to;\n        this.ran = false;\n    }\n    Remover.prototype.run = function () {\n        if (this.ran) {\n            throw new Error('Remover already ran.');\n        }\n        this.remove(this.root, this.from, this.to);\n        this.ran = true;\n    };\n    Remover.prototype.remove = function (node, from, to) {\n        if (node.leaf) {\n            return [node.replace(from[0], to[0], '')];\n        }\n        var removed = [];\n        var child = node.children.at(from[0]);\n        var joinedChildrenAt = 0;\n        if (from[0] < to[0]) {\n            removed.push(node.replace(from[0], to[0] - 1, []));\n            joinedChildrenAt = child.contentLength;\n            this.joinNodes(child, node.children.at(to[0]));\n        }\n        var removedChildFragment = this.remove(child, from.slice(1), __spreadArrays([to[1] + joinedChildrenAt], to.slice(2)));\n        removed.splice.apply(removed, __spreadArrays([0, 0], removedChildFragment.slice(0, joinedChildrenAt)));\n        removed.push.apply(removed, removedChildFragment.slice(joinedChildrenAt));\n        return removed;\n    };\n    Remover.prototype.joinNodes = function (node1, node2) {\n        if (node1.leaf) {\n            node1.replace(0, node1.text.length, node1.text + node2.text);\n        }\n        else {\n            node1.replace(0, node1.children.length, __spreadArrays(node1.children.slice(), node2.children.slice()));\n        }\n        var parent = node1.parent;\n        parent.replace(0, parent.children.length, parent.children.filter(function (child) { return child !== node2; }));\n    };\n    return Remover;\n}());\nvar Inserter = /** @class */ (function () {\n    function Inserter(root, position, fragment, componentService) {\n        this.root = root;\n        this.position = position;\n        this.fragment = fragment;\n        this.componentService = componentService;\n        this.ran = false;\n    }\n    Inserter.prototype.run = function () {\n        if (this.ran) {\n            throw new Error('Inserter already ran.');\n        }\n        this.insert(null, this.root, this.position, this.fragment);\n        this.ran = true;\n    };\n    Inserter.prototype.insert = function (ownOffset, node, position, fragment) {\n        if (Math.ceil(fragment.length / 2) < position.length) {\n            this.insert(position[0], node.children.at(position[0]), position.slice(1), fragment);\n            return;\n        }\n        if (fragment.length % 2 === 1) {\n            var contentIndex = (fragment.length - 1) / 2;\n            if (position.length > 1) {\n                this.insert(position[0], node.children.at(position[0]), position.slice(1), __spreadArrays(fragment.slice(0, contentIndex), fragment.slice(contentIndex + 1)));\n            }\n            var content = fragment[contentIndex];\n            if (node.leaf) {\n                node.replace(position[0], position[0], content);\n            }\n            else {\n                node.replace(position[0] + 1, position[0] + 1, content);\n            }\n            return;\n        }\n        var contentIndex1 = fragment.length / 2 - 1;\n        var contentIndex2 = fragment.length / 2;\n        if (position.length > 1) {\n            this.insert(position[0], node.children.at(position[0]), position.slice(1), __spreadArrays(fragment.slice(0, contentIndex1), fragment.slice(contentIndex2 + 1)));\n        }\n        var content1 = fragment[contentIndex1];\n        var content2 = fragment[contentIndex2];\n        var component = this.componentService.getComponent(node.componentId);\n        var node2;\n        if (node.leaf) {\n            var text2 = node.text.substring(position[0]);\n            node.replace(position[0], node.contentLength, content1);\n            node2 = component.buildModelNode(node.partId, generateId(), content2 + text2, node.attributes, []);\n        }\n        else {\n            var children2 = node.children.slice(position[0] + 1);\n            node.replace(position[0] + 1, node.contentLength, content1);\n            node2 = component.buildModelNode(node.partId, generateId(), '', node.attributes, __spreadArrays(content2, children2));\n        }\n        node.parent.replace(ownOffset + 1, ownOffset + 1, [node2]);\n    };\n    return Inserter;\n}());\nvar ReplaceChange = /** @class */ (function (_super) {\n    __extends(ReplaceChange, _super);\n    function ReplaceChange(from, to, fragment) {\n        var _this = _super.call(this) || this;\n        _this.from = from;\n        _this.to = to;\n        _this.fragment = fragment;\n        if (fragment.length % 2 !== 1) {\n            throw new Error('Fragment is invalid.');\n        }\n        return _this;\n    }\n    ReplaceChange.prototype.map = function (mapping) {\n        var from = mapping.map(this.from);\n        var to = mapping.map(this.to);\n        return new ReplaceChange(from, to, this.fragment);\n    };\n    ReplaceChange.prototype.apply = function (root, componentService) {\n        var remover = new Remover(root, this.from, this.to);\n        remover.run();\n        var inserter = new Inserter(root, this.from, this.fragment, componentService);\n        inserter.run();\n        return {\n            change: this,\n            reverseChange: new ReplaceChange(this.from, this.from, ['TODO']),\n            mapping: new Mapping([{ from: this.from, toBefore: this.to, toAfter: this.to }]),\n        };\n    };\n    return ReplaceChange;\n}(ModelChange));\nexport { ReplaceChange };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { ApplyAttribute } from '../../model/change/apply-attribute';\nimport { ReplaceChange } from '../../model/change/replace';\nimport { Transformation } from '../../transform/transformation';\nfunction findNodesByComponentIdAndPartId(node, componentId, partId, from, to) {\n    var nodes = [];\n    if (node.componentId === componentId && node.partId === partId) {\n        nodes.push(node);\n    }\n    if (!node.leaf) {\n        var fromOffset = from ? from[0].offset : 0;\n        var toOffset = to ? to[0].offset : node.contentLength - 1;\n        for (var n = fromOffset; n <= toOffset; n++) {\n            var child = node.children.at(n);\n            nodes.push.apply(nodes, findNodesByComponentIdAndPartId(child, componentId, partId, from && n === fromOffset ? from.slice(1) : null, to && n === toOffset ? to.slice(1) : null));\n        }\n    }\n    return nodes;\n}\nfunction buildModelPosition(node) {\n    var position = [];\n    var currentNode = node;\n    while (currentNode.parent) {\n        position.unshift(currentNode.parent.children.indexOf(currentNode));\n        currentNode = currentNode.parent;\n    }\n    return position;\n}\nexport var insert = function (serviceRegistry, content) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        newModelOffset = __spreadArrays(modelFrom);\n        newModelOffset[newModelOffset.length - 1] += content.length;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [content])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteBackward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head === 0) {\n                return [2 /*return*/];\n            }\n            from = head - 1;\n            to = head;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [''])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var deleteForward = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        if (anchor === head) {\n            if (head >= renderService.getDocSize() - 1) {\n                return [2 /*return*/];\n            }\n            from = head;\n            to = head + 1;\n        }\n        else {\n            from = Math.min(anchor, head);\n            to = Math.max(anchor, head);\n        }\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, [''])], modelFrom));\n        return [2 /*return*/];\n    });\n}); };\nexport var breakLine = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, _a, anchor, head, from, to, modelFrom, modelTo, newModelOffset;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        if (!cursorService.hasCursor()) {\n            return [2 /*return*/];\n        }\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        newModelOffset = __spreadArrays(modelFrom);\n        newModelOffset[newModelOffset.length - 3]++;\n        newModelOffset[newModelOffset.length - 2] = 0;\n        newModelOffset[newModelOffset.length - 1] = 0;\n        transformService.applyTransformation(new Transformation([new ReplaceChange(modelFrom, modelTo, ['', [], [], [], ''])], newModelOffset));\n        return [2 /*return*/];\n    });\n}); };\nexport var applyAttribute = function (serviceRegistry, componentId, partId, attributeKey, attributeValue) { return __awaiter(void 0, void 0, void 0, function () {\n    var transformService, cursorService, renderService, modelService, _a, anchor, head, from, to, modelFrom, modelTo, nodes;\n    return __generator(this, function (_b) {\n        transformService = serviceRegistry.getService('transform');\n        cursorService = serviceRegistry.getService('cursor');\n        renderService = serviceRegistry.getService('render');\n        modelService = serviceRegistry.getService('model');\n        _a = cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        from = Math.min(anchor, head);\n        to = Math.max(anchor, head);\n        modelFrom = renderService.convertRenderToModelPosition(from);\n        modelTo = renderService.convertRenderToModelPosition(to);\n        nodes = findNodesByComponentIdAndPartId(modelService.getRoot(), componentId, partId, modelService.resolvePosition(modelFrom), modelService.resolvePosition(modelTo));\n        transformService.applyTransformation(new Transformation(nodes.map(function (node) { return new ApplyAttribute(buildModelPosition(node), attributeKey, attributeValue); })));\n        return [2 /*return*/];\n    });\n}); };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var focus = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestFocus();\n        return [2 /*return*/];\n    });\n}); };\nexport var blur = function (serviceRegistry) { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        serviceRegistry.getService('view').requestBlur();\n        return [2 /*return*/];\n    });\n}); };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { EventEmitter } from '../event/emitter';\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nvar ModelNode = /** @class */ (function (_super) {\n    __extends(ModelNode, _super);\n    function ModelNode(componentId, id, text, attributes, children) {\n        var _this = _super.call(this, id) || this;\n        _this.componentId = componentId;\n        _this.attributes = attributes;\n        _this.internalNeedRender = true;\n        _this.childDidUpdateDisposableMap = new Map();\n        _this.didUpdateEventEmitter = new EventEmitter();\n        _this.handleChildDidUpdate = function () {\n            _this.didUpdateEventEmitter.emit({});\n        };\n        _this.internalText = text;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n            _this.childDidUpdateDisposableMap.set(child.id, child.onDidUpdate(_this.handleChildDidUpdate));\n        });\n        _this.onDidUpdate(function () {\n            _this.internalSize = undefined;\n            _this.internalNeedRender = true;\n        });\n        return _this;\n    }\n    Object.defineProperty(ModelNode.prototype, \"text\", {\n        get: function () {\n            return this.internalText;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = 2 + this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 2);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelNode.prototype, \"needRender\", {\n        get: function () {\n            return this.internalNeedRender;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelNode.prototype.canJoin = function (node) {\n        return false;\n    };\n    ModelNode.prototype.clearNeedRender = function () {\n        this.internalNeedRender = false;\n    };\n    ModelNode.prototype.applyAttribute = function (key, value) {\n        // @ts-ignore\n        var originalValue = this.attributes[key];\n        // @ts-ignore\n        this.attributes[key] = value;\n        this.didUpdateEventEmitter.emit({});\n        return originalValue;\n    };\n    ModelNode.prototype.replace = function (from, to, content) {\n        var _this = this;\n        if (from > to) {\n            throw new Error('Range is invalid.');\n        }\n        if (this.leaf) {\n            if (typeof content !== 'string') {\n                throw new Error('Leaf node content must be string.');\n            }\n            if (from < 0 || to > this.text.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        else {\n            if (typeof content === 'string') {\n                throw new Error('Non-leaf node content must not be string.');\n            }\n            if (from < 0 || to > this.children.length) {\n                throw new Error('Range is invalid.');\n            }\n        }\n        var replacedContent;\n        if (typeof content === 'string') {\n            replacedContent = this.internalText.substring(from, to);\n            this.internalText = this.internalText.slice(0, from) + content + this.internalText.slice(to);\n        }\n        else {\n            replacedContent = this.children.slice(from, to);\n            this.internalChildren = new NodeList(__spreadArrays(this.children.slice(0, from), content, this.children.slice(to)));\n            var removedNodes = this.children.slice(from, to);\n            removedNodes.forEach(function (node) { var _a; return (_a = _this.childDidUpdateDisposableMap.get(node.id)) === null || _a === void 0 ? void 0 : _a.dispose(); });\n            content.forEach(function (node) {\n                node.parent = _this;\n                _this.childDidUpdateDisposableMap.set(node.id, node.onDidUpdate(_this.handleChildDidUpdate));\n            });\n        }\n        this.didUpdateEventEmitter.emit({});\n        return replacedContent;\n    };\n    ModelNode.prototype.resolvePosition = function (position) {\n        if (position.length === 0) {\n            position = [0];\n        }\n        var offset = this.boundOffset(position[0]);\n        var resolvedPosition = [{ node: this, offset: offset }];\n        if (!this.leaf) {\n            if (offset < this.children.length) {\n                var child = this.children.at(offset);\n                resolvedPosition.push.apply(resolvedPosition, child.resolvePosition(position.slice(1)));\n            }\n            else {\n                var child = this.children.at(this.children.length - 1);\n                resolvedPosition.push.apply(resolvedPosition, child.resolvePosition([child.contentLength]));\n            }\n        }\n        return resolvedPosition;\n    };\n    ModelNode.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelNode;\n}(Node));\nexport { ModelNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelRoot = /** @class */ (function (_super) {\n    __extends(ModelRoot, _super);\n    function ModelRoot(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Doc node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelRoot.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelRoot.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelRoot;\n}(ModelNode));\nexport { ModelRoot };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { generateId } from '../util/id';\nvar RenderNode = /** @class */ (function (_super) {\n    __extends(RenderNode, _super);\n    function RenderNode(componentId, modelId, text, attributes, children) {\n        var _this = _super.call(this, generateId()) || this;\n        _this.componentId = componentId;\n        _this.modelId = modelId;\n        _this.text = text;\n        _this.attributes = attributes;\n        _this.internalNeedLayout = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(RenderNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.contentLength;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderNode.prototype, \"needLayout\", {\n        get: function () {\n            return this.internalNeedLayout;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderNode.prototype.clearNeedLayout = function () {\n        this.internalNeedLayout = false;\n    };\n    RenderNode.prototype.resolvePosition = function (position) {\n        if (position < 0 || position >= this.size) {\n            throw new Error(\"Offset \" + position + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return [{ node: this, offset: position, position: position }];\n        }\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedSize + childSize > position) {\n                return __spreadArrays([\n                    { node: this, offset: n, position: cumulatedSize }\n                ], child.resolvePosition(position - cumulatedSize));\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    RenderNode.prototype.convertModelToRenderPosition = function (modelPosition) {\n        var modelOffset = this.boundOffset(modelPosition[0]);\n        if (this.leaf) {\n            return modelOffset;\n        }\n        var offset = 0;\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            if (child.modelId) {\n                if (offset === modelOffset) {\n                    return cumulatedSize + child.convertModelToRenderPosition(modelPosition.slice(1));\n                }\n                offset++;\n            }\n            cumulatedSize += child.size;\n        }\n        throw new Error(\"Model offset \" + modelOffset + \" is out of range.\");\n    };\n    RenderNode.prototype.convertRenderToModelPosition = function (renderPosition) {\n        if (renderPosition < 0 || renderPosition > this.size) {\n            throw new Error('Render position is out of range.');\n        }\n        if (this.leaf) {\n            return [this.boundOffset(renderPosition)];\n        }\n        var cumulatedSize = 0;\n        var modelOffset = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (child.modelId) {\n                var nextNonModelSize = 0;\n                for (var m = n + 1; m < nn; m++) {\n                    var nextChild = this.children.at(m);\n                    if (nextChild.modelId) {\n                        break;\n                    }\n                    nextNonModelSize += nextChild.size;\n                }\n                if (cumulatedSize + childSize + nextNonModelSize > renderPosition) {\n                    return __spreadArrays([modelOffset], child.convertRenderToModelPosition(renderPosition - cumulatedSize));\n                }\n                modelOffset++;\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error(\"Render offset \" + renderPosition + \" is out of range.\");\n    };\n    return RenderNode;\n}(Node));\nexport { RenderNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(RenderNode));\nexport { RenderDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n        _this.attached = false;\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(ViewNode));\nexport { ViewDoc };\n","var Component = /** @class */ (function () {\n    function Component(id, serviceRegistry) {\n        this.id = id;\n        this.serviceRegistry = serviceRegistry;\n    }\n    return Component;\n}());\nexport { Component };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelRoot } from '../../model/root';\nimport { RenderDoc as AbstractRenderDoc } from '../../render/doc';\nimport { ViewDoc as AbstractViewDoc } from '../../view/doc';\nimport { Component } from '../component';\nvar ModelDoc = /** @class */ (function (_super) {\n    __extends(ModelDoc, _super);\n    function ModelDoc() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelDoc;\n}(ModelRoot));\nexport { ModelDoc };\nvar RenderDoc = /** @class */ (function (_super) {\n    __extends(RenderDoc, _super);\n    function RenderDoc(componentId, modelId, attributes, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, componentId, modelId, attributes, children) || this;\n        _this.width = width;\n        _this.height = height;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        return _this;\n    }\n    Object.defineProperty(RenderDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderDoc.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderDoc;\n}(AbstractRenderDoc));\nexport { RenderDoc };\nvar ViewDoc = /** @class */ (function (_super) {\n    __extends(ViewDoc, _super);\n    function ViewDoc(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.textAlign = 'left';\n        _this.domContainer.style.cursor = 'text';\n        _this.domContainer.style.userSelect = 'none';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = domService.createElement('div');\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        children.map(function (child) { return domContentContainer.appendChild(child.domContainer); });\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewDoc.prototype, \"partId\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewDoc;\n}(AbstractViewDoc));\nexport { ViewDoc };\nvar DocComponent = /** @class */ (function (_super) {\n    __extends(DocComponent, _super);\n    function DocComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DocComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelDoc(this.id, id, attributes, children);\n    };\n    DocComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var configService = this.serviceRegistry.getService('config');\n        switch (partId) {\n            case 'doc':\n                var pageConfig = configService.getConfig().page;\n                return new RenderDoc(this.id, modelId, attributes, children, pageConfig.width, pageConfig.height, pageConfig.paddingTop, pageConfig.paddingBottom, pageConfig.paddingLeft, pageConfig.paddingRight);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    DocComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'doc':\n                return new ViewDoc(domContainer, this.id, renderId, layoutId, style, children, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    DocComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'doc': {\n                var $element_1 = document.createElement('div');\n                children.forEach(function (child) { return $element_1.appendChild(child); });\n                return $element_1;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return DocComponent;\n}(Component));\nexport { DocComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelBranch = /** @class */ (function (_super) {\n    __extends(ModelBranch, _super);\n    function ModelBranch(componentId, id, attributes, children) {\n        var _this = _super.call(this, componentId, id, '', attributes, children) || this;\n        if (children.length === 0) {\n            throw new Error('Branch node must have children.');\n        }\n        return _this;\n    }\n    Object.defineProperty(ModelBranch.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelBranch.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelBranch;\n}(ModelNode));\nexport { ModelBranch };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderBlock = /** @class */ (function (_super) {\n    __extends(RenderBlock, _super);\n    function RenderBlock(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, '', attributes, children) || this;\n    }\n    Object.defineProperty(RenderBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderBlock;\n}(RenderNode));\nexport { RenderBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { RenderNode } from './node';\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, text, attributes) {\n        return _super.call(this, componentId, modelId, text, attributes, []) || this;\n    }\n    Object.defineProperty(RenderText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(RenderNode));\nexport { RenderText };\n","export var DEFAULT_FONT = {\n    weight: 400,\n    size: 16,\n    family: 'sans-serif',\n    letterSpacing: 0,\n    underline: false,\n    italic: false,\n    strikethrough: false,\n    color: 'black',\n};\nexport var BREAKABLE_CHARS = [' ', '\\n', '\\t'];\nvar TextService = /** @class */ (function () {\n    function TextService(domService) {\n        this.$canvas = domService.createElement('canvas');\n    }\n    TextService.prototype.measure = function (text, font) {\n        var fontWithDefault = this.applyDefaultFont(font);\n        var ctx = this.$canvas.getContext('2d');\n        var weight = fontWithDefault.weight;\n        var size = fontWithDefault.size;\n        var family = this.fixFontFamily(fontWithDefault.family);\n        var letterSpacing = fontWithDefault.letterSpacing;\n        ctx.font = weight + \" \" + size + \"px \" + family;\n        var measurement = ctx.measureText(text);\n        var width = letterSpacing === 0 || text.length <= 1\n            ? measurement.width\n            : measurement.width + (text.length - 1) * letterSpacing;\n        return {\n            width: width,\n            height: size,\n        };\n    };\n    TextService.prototype.breakIntoWords = function (text) {\n        var words = [];\n        var word = '';\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var char = text[n];\n            word += char;\n            if (BREAKABLE_CHARS.includes(char)) {\n                words.push({\n                    text: word,\n                    whitespaceSize: 1,\n                });\n                word = '';\n            }\n        }\n        if (word.length > 0) {\n            words.push({\n                text: word,\n                whitespaceSize: 0,\n            });\n        }\n        return words;\n    };\n    TextService.prototype.applyDefaultFont = function (font) {\n        var fontConfigWithDefault = {};\n        for (var key in DEFAULT_FONT) {\n            if (key in font && font[key] !== undefined) {\n                fontConfigWithDefault[key] = font[key];\n            }\n            else {\n                fontConfigWithDefault[key] = DEFAULT_FONT[key];\n            }\n        }\n        return fontConfigWithDefault;\n    };\n    TextService.prototype.fixFontFamily = function (fontFamily) {\n        if (fontFamily.indexOf(' ') >= 0) {\n            return \"'\" + fontFamily + \"'\";\n        }\n        return fontFamily;\n    };\n    return TextService;\n}());\nexport { TextService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewBlock = /** @class */ (function (_super) {\n    __extends(ViewBlock, _super);\n    function ViewBlock(domContainer, componentId, renderId, layoutId, style, children, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, '', style, children, domService) || this;\n    }\n    Object.defineProperty(ViewBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewBlock;\n}(ViewNode));\nexport { ViewBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ViewNode } from './node';\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, text, style, [], domService) || this;\n    }\n    Object.defineProperty(ViewText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewText.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewText;\n}(ViewNode));\nexport { ViewText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { ModelBranch } from '../../model/branch';\nimport { RenderBlock } from '../../render/block';\nimport { RenderText } from '../../render/text';\nimport { DEFAULT_FONT } from '../../text/service';\nimport { ViewBlock } from '../../view/block';\nimport { ViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelParagraph = /** @class */ (function (_super) {\n    __extends(ModelParagraph, _super);\n    function ModelParagraph() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelParagraph;\n}(ModelBranch));\nexport { ModelParagraph };\nvar RenderParagraph = /** @class */ (function (_super) {\n    __extends(RenderParagraph, _super);\n    function RenderParagraph(componentId, modelId, attributes, children) {\n        return _super.call(this, componentId, modelId, attributes, __spreadArrays(children, [new RenderParagraphLineBreak(componentId)])) || this;\n    }\n    Object.defineProperty(RenderParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingBottom\", {\n        get: function () {\n            return 12;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraph.prototype, \"style\", {\n        get: function () {\n            return {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderParagraph;\n}(RenderBlock));\nexport { RenderParagraph };\nvar RenderParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(RenderParagraphLineBreak, _super);\n    function RenderParagraphLineBreak(componentId) {\n        var _this = _super.call(this, componentId, null, ' ', null) || this;\n        _this.componentId = componentId;\n        return _this;\n    }\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"pseudo\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"style\", {\n        get: function () {\n            return null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderParagraphLineBreak.prototype, \"font\", {\n        get: function () {\n            var node = this.previousSibling;\n            while (node) {\n                if (node.type === 'text') {\n                    return node.font;\n                }\n                node = node.previousSibling;\n            }\n            return DEFAULT_FONT;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderParagraphLineBreak;\n}(RenderText));\nexport { RenderParagraphLineBreak };\nvar ViewParagraph = /** @class */ (function (_super) {\n    __extends(ViewParagraph, _super);\n    function ViewParagraph(domContainer, componentId, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, style, children, domService) || this;\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.innerHTML = '';\n        children.map(function (child) { return _this.domContainer.appendChild(child.domContainer); });\n        return _this;\n    }\n    Object.defineProperty(ViewParagraph.prototype, \"partId\", {\n        get: function () {\n            return 'paragraph';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraph.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraph;\n}(ViewBlock));\nexport { ViewParagraph };\nvar ViewParagraphLineBreak = /** @class */ (function (_super) {\n    __extends(ViewParagraphLineBreak, _super);\n    function ViewParagraphLineBreak(domContainer, componentId, renderId, layoutId, domService) {\n        return _super.call(this, domContainer, componentId, renderId, layoutId, ' ', null, domService) || this;\n    }\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"partId\", {\n        get: function () {\n            return 'line-break';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ViewParagraphLineBreak.prototype, \"domContentContainer\", {\n        get: function () {\n            return this.domContainer;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ViewParagraphLineBreak;\n}(ViewText));\nexport { ViewParagraphLineBreak };\nvar ParagraphComponent = /** @class */ (function (_super) {\n    __extends(ParagraphComponent, _super);\n    function ParagraphComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ParagraphComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelParagraph(this.id, id, attributes, children);\n    };\n    ParagraphComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        switch (partId) {\n            case 'paragraph':\n                return new RenderParagraph(this.id, modelId, attributes, children);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    ParagraphComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'paragraph':\n                return new ViewParagraph(domContainer, this.id, renderId, layoutId, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            case 'line-break':\n                return new ViewParagraphLineBreak(domContainer, this.id, renderId, layoutId, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    ParagraphComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'paragraph': {\n                var $element_1 = document.createElement('p');\n                children.forEach(function (child) { return $element_1.appendChild(child); });\n                return $element_1;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return ParagraphComponent;\n}(Component));\nexport { ParagraphComponent };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelNode } from './node';\nvar ModelLeaf = /** @class */ (function (_super) {\n    __extends(ModelLeaf, _super);\n    function ModelLeaf(componentId, id, text, attributes) {\n        return _super.call(this, componentId, id, text, attributes, []) || this;\n    }\n    Object.defineProperty(ModelLeaf.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ModelLeaf.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ModelLeaf;\n}(ModelNode));\nexport { ModelLeaf };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ModelLeaf } from '../../model/leaf';\nimport { RenderText as AbstractRenderText } from '../../render/text';\nimport { ViewText as AbstractViewText } from '../../view/text';\nimport { Component } from '../component';\nvar ModelText = /** @class */ (function (_super) {\n    __extends(ModelText, _super);\n    function ModelText() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Object.defineProperty(ModelText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ModelText.prototype.canJoin = function (node) {\n        if (this.componentId !== node.componentId) {\n            return false;\n        }\n        if (this.partId !== node.partId) {\n            return false;\n        }\n        if (JSON.stringify(this.attributes) !== JSON.stringify(node.attributes)) {\n            return false;\n        }\n        return true;\n    };\n    return ModelText;\n}(ModelLeaf));\nexport { ModelText };\nvar RenderText = /** @class */ (function (_super) {\n    __extends(RenderText, _super);\n    function RenderText(componentId, modelId, textService, text, attributes) {\n        var _this = _super.call(this, componentId, modelId, text, attributes) || this;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(RenderText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"pseudo\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingTop\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingBottom\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingLeft\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"paddingRight\", {\n        get: function () {\n            return 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"style\", {\n        get: function () {\n            return this.textService.applyDefaultFont(this.attributes);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RenderText.prototype, \"font\", {\n        get: function () {\n            return this.style;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RenderText;\n}(AbstractRenderText));\nexport { RenderText };\nvar ViewText = /** @class */ (function (_super) {\n    __extends(ViewText, _super);\n    function ViewText(domContainer, componentId, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService) {\n        var _this = _super.call(this, domContainer, componentId, renderId, layoutId, text, style, domService) || this;\n        _this.domContainer.style.display = 'inline-block';\n        _this.domContainer.style.whiteSpace = 'pre';\n        _this.domContainer.style.lineHeight = '1em';\n        _this.domContainer.style.width = width + \"px\";\n        _this.domContainer.style.height = height + \"px\";\n        _this.domContainer.style.paddingTop = paddingTop + \"px\";\n        _this.domContainer.style.paddingBottom = paddingBottom + \"px\";\n        _this.domContainer.style.paddingLeft = paddingLeft + \"px\";\n        _this.domContainer.style.paddingRight = paddingRight + \"px\";\n        _this.domContainer.style.fontFamily = style.family;\n        _this.domContainer.style.fontSize = style.size + \"px\";\n        _this.domContainer.style.letterSpacing = style.letterSpacing + \"px\";\n        _this.domContainer.style.fontWeight = \"\" + style.weight;\n        _this.domContainer.style.color = style.color;\n        _this.domContainer.style.textDecoration = style.underline ? 'underline' : '';\n        _this.domContainer.style.fontStyle = style.italic ? 'italic' : '';\n        _this.domContainer.innerHTML = '';\n        var domContentContainer = _this.findOrCreateDOMContentContainer();\n        domContentContainer.setAttribute('data-tw-role', 'content-container');\n        domContentContainer.style.textDecoration = style.strikethrough ? 'line-through' : '';\n        domContentContainer.innerHTML = text;\n        _this.domContainer.appendChild(domContentContainer);\n        return _this;\n    }\n    Object.defineProperty(ViewText.prototype, \"partId\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewText.prototype.findOrCreateDOMContentContainer = function () {\n        for (var n = 0, nn = this.domContainer.children.length; n < nn; n++) {\n            var child = this.domContainer.children[n];\n            if (child.getAttribute('data-tw-role') === 'content-container') {\n                return child;\n            }\n        }\n        return this.domService.createElement('span');\n    };\n    return ViewText;\n}(AbstractViewText));\nexport { ViewText };\nvar TextComponent = /** @class */ (function (_super) {\n    __extends(TextComponent, _super);\n    function TextComponent() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TextComponent.prototype.buildModelNode = function (partId, id, text, attributes, children) {\n        return new ModelText(this.id, id, text, attributes);\n    };\n    TextComponent.prototype.buildRenderNode = function (partId, modelId, text, attributes, children) {\n        var textService = this.serviceRegistry.getService('text');\n        switch (partId) {\n            case 'text':\n                return new RenderText(this.id, modelId, textService, text, attributes);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    TextComponent.prototype.buildViewNode = function (domContainer, partId, renderId, layoutId, text, style, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var domService = this.serviceRegistry.getService('dom');\n        switch (partId) {\n            case 'text':\n                return new ViewText(domContainer, this.id, renderId, layoutId, text, style, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight, domService);\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    TextComponent.prototype.toDOM = function (partId, attributes, text, children) {\n        switch (partId) {\n            case 'text': {\n                var $element = document.createElement('span');\n                $element.innerText = text;\n                return $element;\n            }\n            default:\n                throw new Error('Invalid part ID.');\n        }\n    };\n    return TextComponent;\n}(Component));\nexport { TextComponent };\n","import * as clipboardCommandHandlers from '../command/handlers/clipboard';\nimport * as cursorCommandHandlers from '../command/handlers/cursor';\nimport * as historyCommandHandlers from '../command/handlers/history';\nimport * as stateCommandHandlers from '../command/handlers/state';\nimport * as viewCommandHandlers from '../command/handlers/view';\nimport { DocComponent } from '../component/components/doc';\nimport { ParagraphComponent } from '../component/components/paragraph';\nimport { TextComponent } from '../component/components/text';\nexport function buildBaseConfig() {\n    return {\n        commands: {\n            'tw.clipboard.copy': clipboardCommandHandlers.copy,\n            'tw.clipboard.paste': clipboardCommandHandlers.paste,\n            'tw.cursor.move': cursorCommandHandlers.move,\n            'tw.cursor.moveBackwardByLine': cursorCommandHandlers.moveBackwardByLine,\n            'tw.cursor.moveForwardByLine': cursorCommandHandlers.moveForwardByLine,\n            'tw.cursor.moveBackward': cursorCommandHandlers.moveBackward,\n            'tw.cursor.moveForward': cursorCommandHandlers.moveForward,\n            'tw.cursor.moveBackwardByWord': cursorCommandHandlers.moveBackwardByWord,\n            'tw.cursor.moveForwardByWord': cursorCommandHandlers.moveForwardByWord,\n            'tw.cursor.moveToLineStart': cursorCommandHandlers.moveToLineStart,\n            'tw.cursor.moveToLineEnd': cursorCommandHandlers.moveToLineEnd,\n            'tw.cursor.moveToDocStart': cursorCommandHandlers.moveToDocStart,\n            'tw.cursor.moveToDocEnd': cursorCommandHandlers.moveToDocEnd,\n            'tw.cursor.moveHead': cursorCommandHandlers.moveHead,\n            'tw.cursor.moveHeadBackwardByLine': cursorCommandHandlers.moveHeadBackwardByLine,\n            'tw.cursor.moveHeadForwardByLine': cursorCommandHandlers.moveHeadForwardByLine,\n            'tw.cursor.moveHeadBackward': cursorCommandHandlers.moveHeadBackward,\n            'tw.cursor.moveHeadForward': cursorCommandHandlers.moveHeadForward,\n            'tw.cursor.moveHeadBackwardByWord': cursorCommandHandlers.moveHeadBackwardByWord,\n            'tw.cursor.moveHeadForwardByWord': cursorCommandHandlers.moveHeadForwardByWord,\n            'tw.cursor.moveHeadToLineStart': cursorCommandHandlers.moveHeadToLineStart,\n            'tw.cursor.moveHeadToLineEnd': cursorCommandHandlers.moveHeadToLineEnd,\n            'tw.cursor.moveHeadToDocStart': cursorCommandHandlers.moveHeadToDocStart,\n            'tw.cursor.moveHeadToDocEnd': cursorCommandHandlers.moveHeadToDocEnd,\n            'tw.cursor.selectAll': cursorCommandHandlers.selectAll,\n            'tw.cursor.selectWord': cursorCommandHandlers.selectWord,\n            'tw.cursor.selectBlock': cursorCommandHandlers.selectBlock,\n            'tw.history.undo': historyCommandHandlers.undo,\n            'tw.history.redo': historyCommandHandlers.redo,\n            'tw.state.insert': stateCommandHandlers.insert,\n            'tw.state.deleteBackward': stateCommandHandlers.deleteBackward,\n            'tw.state.deleteForward': stateCommandHandlers.deleteForward,\n            'tw.state.breakLine': stateCommandHandlers.breakLine,\n            'tw.state.applyAttribute': stateCommandHandlers.applyAttribute,\n            'tw.view.focus': viewCommandHandlers.focus,\n            'tw.view.blur': viewCommandHandlers.blur,\n        },\n        components: {\n            doc: DocComponent,\n            paragraph: ParagraphComponent,\n            text: TextComponent,\n        },\n        cursor: {\n            disable: false,\n            caretColor: \"hsla(213, 100%, 50%, 1)\",\n            caretInactiveColor: 'hsla(0, 0%, 0%, 0.5)',\n            selectionColor: \"hsla(213, 100%, 50%, 0.2)\",\n            selectionInactiveColor: 'hsla(0, 0%, 0%, 0.08)',\n        },\n        history: {\n            collapseThreshold: 500,\n            maxCollapseDuration: 2000,\n        },\n        keyBindings: {\n            common: {\n                left: { command: 'tw.cursor.moveBackward', preventDefault: true },\n                right: { command: 'tw.cursor.moveForward', preventDefault: true },\n                up: { command: 'tw.cursor.moveBackwardByLine', preventDefault: true },\n                down: { command: 'tw.cursor.moveForwardByLine', preventDefault: true },\n                'shift+left': { command: 'tw.cursor.moveHeadBackward', preventDefault: true },\n                'shift+right': { command: 'tw.cursor.moveHeadForward', preventDefault: true },\n                'shift+up': { command: 'tw.cursor.moveHeadBackwardByLine', preventDefault: true },\n                'shift+down': { command: 'tw.cursor.moveHeadForwardByLine', preventDefault: true },\n                backspace: { command: 'tw.state.deleteBackward', preventDefault: true },\n                delete: { command: 'tw.state.deleteForward', preventDefault: true },\n                enter: { command: 'tw.state.breakLine', preventDefault: true },\n            },\n            macos: {\n                'alt+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'alt+right': { command: 'tw.cursor.moveForwardByWord' },\n                'shift+alt+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'shift+alt+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                'cmd+left': { command: 'tw.cursor.moveToLineStart' },\n                'cmd+right': { command: 'tw.cursor.moveToLineEnd' },\n                'cmd+up': { command: 'tw.cursor.moveToDocStart' },\n                'cmd+down': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+cmd+left': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+cmd+right': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'shift+cmd+up': { command: 'tw.cursor.moveHeadToDocStart' },\n                'shift+cmd+down': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'cmd+a': { command: 'tw.cursor.selectAll' },\n                'cmd+z': { command: 'tw.history.undo', preventDefault: true },\n                'shift+cmd+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n            windows: {\n                'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                home: { command: 'tw.cursor.moveToLineStart' },\n                end: { command: 'tw.cursor.moveToLineEnd' },\n                'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'ctrl+a': { command: 'tw.cursor.selectAll' },\n                'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n            linux: {\n                'ctrl+left': { command: 'tw.cursor.moveBackwardByWord' },\n                'ctrl+right': { command: 'tw.cursor.moveForwardByWord' },\n                'ctrl+shift+left': { command: 'tw.cursor.moveHeadBackwardByWord' },\n                'ctrl+shift+right': { command: 'tw.cursor.moveHeadForwardByWord' },\n                home: { command: 'tw.cursor.moveToLineStart' },\n                end: { command: 'tw.cursor.moveToLineEnd' },\n                'ctrl+home': { command: 'tw.cursor.moveToDocStart' },\n                'ctrl+end': { command: 'tw.cursor.moveToDocEnd' },\n                'shift+home': { command: 'tw.cursor.moveHeadToLineStart' },\n                'shift+end': { command: 'tw.cursor.moveHeadToLineEnd' },\n                'ctrl+shift+home': { command: 'tw.cursor.moveHeadToDocStart' },\n                'ctrl+shift+end': { command: 'tw.cursor.moveHeadToDocEnd' },\n                'ctrl+a': { command: 'tw.cursor.selectAll' },\n                'ctrl+z': { command: 'tw.history.undo', preventDefault: true },\n                'ctrl+shift+z': { command: 'tw.history.redo', preventDefault: true },\n            },\n        },\n        page: {\n            width: 816,\n            height: 1056,\n            paddingTop: 40,\n            paddingBottom: 40,\n            paddingLeft: 40,\n            paddingRight: 40,\n        },\n    };\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { EventEmitter } from '../event/emitter';\nvar CursorState = /** @class */ (function () {\n    function CursorState(configService, renderService, modelService) {\n        this.renderService = renderService;\n        this.modelService = modelService;\n        this.internalCursor = null;\n        this.didUpdateEventEmitter = new EventEmitter();\n        if (!configService.getConfig().cursor.disable) {\n            this.internalCursor = {\n                anchor: 0,\n                head: 0,\n                leftLock: 0,\n            };\n        }\n    }\n    Object.defineProperty(CursorState.prototype, \"hasCursor\", {\n        get: function () {\n            return !!this.internalCursor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CursorState.prototype, \"cursor\", {\n        get: function () {\n            this.assertCursor();\n            return __assign({}, this.internalCursor);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CursorState.prototype.set = function (anchor, head) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: anchor,\n            head: head,\n            leftLock: this.internalCursor.leftLock,\n        };\n        this.didUpdateEventEmitter.emit({});\n    };\n    CursorState.prototype.setLeftLock = function (leftLock) {\n        this.assertCursor();\n        this.internalCursor = {\n            anchor: this.internalCursor.anchor,\n            head: this.internalCursor.head,\n            leftLock: leftLock,\n        };\n    };\n    CursorState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    CursorState.prototype.assertCursor = function () {\n        if (!this.internalCursor) {\n            throw new Error('Cursor is disabled.');\n        }\n    };\n    return CursorState;\n}());\nexport { CursorState };\n","import { CursorState } from './state';\nvar CursorService = /** @class */ (function () {\n    function CursorService(configService, renderService, modelService) {\n        this.state = new CursorState(configService, renderService, modelService);\n    }\n    CursorService.prototype.hasCursor = function () {\n        return this.state.hasCursor;\n    };\n    CursorService.prototype.getCursor = function () {\n        return this.state.cursor;\n    };\n    CursorService.prototype.setCursor = function (anchor, head) {\n        this.state.set(anchor, head);\n    };\n    CursorService.prototype.setLeftLock = function (leftLock) {\n        this.state.setLeftLock(leftLock);\n    };\n    CursorService.prototype.onDidUpdate = function (listener) {\n        return this.state.onDidUpdate(listener);\n    };\n    return CursorService;\n}());\nexport { CursorService };\n","var DOMService = /** @class */ (function () {\n    function DOMService() {\n    }\n    DOMService.prototype.getWindow = function () {\n        return window;\n    };\n    DOMService.prototype.getDocument = function () {\n        return document;\n    };\n    DOMService.prototype.getBody = function () {\n        return document.body;\n    };\n    DOMService.prototype.createElement = function (tagName) {\n        return document.createElement(tagName);\n    };\n    DOMService.prototype.createContainer = function () {\n        var container = this.createElement('div');\n        container.setAttribute('data-tw-role', 'container');\n        return container;\n    };\n    DOMService.prototype.createHiddenIframe = function () {\n        var iframe = this.createElement('iframe');\n        iframe.scrolling = 'no';\n        iframe.src = 'about:blank';\n        iframe.style.width = '0';\n        iframe.style.height = '0';\n        iframe.style.border = 'none';\n        iframe.style.position = 'fixed';\n        iframe.style.zIndex = '-1';\n        iframe.style.opacity = '0';\n        iframe.style.overflow = 'hidden';\n        iframe.style.left = '-1000000px';\n        iframe.style.top = '-1000000px';\n        return iframe;\n    };\n    DOMService.prototype.createMutationObserver = function (callback) {\n        return new MutationObserver(callback);\n    };\n    return DOMService;\n}());\nexport { DOMService };\n","var HistoryAction = /** @class */ (function () {\n    function HistoryAction() {\n        this.internalTransformationResults = [];\n        this.beganAt = Date.now();\n        this.internalEndedAt = this.beganAt;\n    }\n    Object.defineProperty(HistoryAction.prototype, \"endedAt\", {\n        get: function () {\n            return this.internalEndedAt;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HistoryAction.prototype, \"transformationResults\", {\n        get: function () {\n            return this.internalTransformationResults;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    HistoryAction.prototype.recordTransformationResult = function (transformationResult) {\n        this.transformationResults.push(transformationResult);\n        this.internalEndedAt = Date.now();\n    };\n    return HistoryAction;\n}());\nexport { HistoryAction };\n","import { HistoryAction } from './action';\nvar HistoryState = /** @class */ (function () {\n    function HistoryState(configService, transformService) {\n        var _this = this;\n        this.configService = configService;\n        this.transformService = transformService;\n        this.actions = [];\n        this.offset = -1;\n        this.handleDidApplyTransformation = function (event) {\n            var result = event.result;\n            // Do not record undo\n            if (_this.offset + 1 < _this.actions.length &&\n                _this.actions[_this.offset + 1].transformationResults.some(function (tnResult) { return tnResult.reverseTransformation === result.transformation; })) {\n                return;\n            }\n            // Do not record redo\n            if (_this.offset >= 0 &&\n                _this.actions[_this.offset].transformationResults.some(function (tnResult) { return tnResult.transformation === result.transformation; })) {\n                return;\n            }\n            if (_this.offset < 0) {\n                _this.recordToNewAction(result);\n                return;\n            }\n            var currentItem = _this.actions[_this.offset];\n            var now = Date.now();\n            if (now - currentItem.beganAt < _this.maxCollapseDuration &&\n                now - currentItem.endedAt < _this.collapseThreshold) {\n                _this.recordToLastAction(result);\n            }\n            else {\n                _this.recordToNewAction(result);\n            }\n        };\n        var config = configService.getConfig();\n        this.maxCollapseDuration = config.history.maxCollapseDuration;\n        this.collapseThreshold = config.history.collapseThreshold;\n        transformService.onDidApplyTransformation(this.handleDidApplyTransformation);\n    }\n    HistoryState.prototype.undo = function () {\n        var action = this.consumeNextUndoableAction();\n        if (!action) {\n            return;\n        }\n        var results = action.transformationResults;\n        if (results.length === 0) {\n            return;\n        }\n        for (var n = results.length - 1; n >= 0; n--) {\n            var result = results[n];\n            this.transformService.applyTransformation(result.reverseTransformation);\n        }\n    };\n    HistoryState.prototype.redo = function () {\n        var _this = this;\n        var action = this.consumeNextRedoableAction();\n        if (!action) {\n            return;\n        }\n        action.transformationResults.forEach(function (result) {\n            return _this.transformService.applyTransformation(result.transformation);\n        });\n    };\n    HistoryState.prototype.consumeNextUndoableAction = function () {\n        if (this.offset < 0) {\n            return undefined;\n        }\n        var action = this.actions[this.offset];\n        this.offset--;\n        return action;\n    };\n    HistoryState.prototype.consumeNextRedoableAction = function () {\n        if (this.offset >= this.actions.length - 1) {\n            return undefined;\n        }\n        this.offset++;\n        return this.actions[this.offset];\n    };\n    HistoryState.prototype.recordToNewAction = function (result) {\n        if (result.changeResults.length === 0) {\n            return;\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        var action = new HistoryAction();\n        action.recordTransformationResult(result);\n        this.actions.push(action);\n        this.offset++;\n    };\n    HistoryState.prototype.recordToLastAction = function (result) {\n        var action = this.actions[this.offset];\n        if (!action) {\n            throw new Error('Error recording applied transformation, history is empty.');\n        }\n        if (this.offset < this.actions.length - 1) {\n            this.actions.splice(this.offset + 1, this.actions.length - 1 - this.offset);\n        }\n        action.recordTransformationResult(result);\n    };\n    return HistoryState;\n}());\nexport { HistoryState };\n","import { HistoryState } from './state';\nvar HistoryService = /** @class */ (function () {\n    function HistoryService(configService, transformService) {\n        this.state = new HistoryState(configService, transformService);\n    }\n    HistoryService.prototype.undo = function () {\n        this.state.undo();\n    };\n    HistoryService.prototype.redo = function () {\n        this.state.redo();\n    };\n    return HistoryService;\n}());\nexport { HistoryService };\n","export function detectPlatform() {\n    if (navigator.platform.startsWith('Linux')) {\n        return 'Linux';\n    }\n    if (['Windows', 'Win16', 'Win32'].includes(navigator.platform)) {\n        return 'Windows';\n    }\n    if (['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'].includes(navigator.platform)) {\n        return 'macOS';\n    }\n    return 'Unknown';\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { detectPlatform } from '../util/platform';\nvar KeyBindingService = /** @class */ (function () {\n    function KeyBindingService(configService, commandService, viewService) {\n        var _this = this;\n        this.configService = configService;\n        this.commandService = commandService;\n        this.viewService = viewService;\n        this.keyBindings = new Map();\n        this.handleDidPressKey = function (event) {\n            var _a;\n            var keyBinding = _this.keyBindings.get(event.key);\n            if (!keyBinding) {\n                return;\n            }\n            if (keyBinding.preventDefault) {\n                event.originalKeyboardEvent.preventDefault();\n            }\n            (_a = _this.commandService).executeCommand.apply(_a, __spreadArrays([keyBinding.command], keyBinding.args));\n        };\n        var keyBindingsConfig = this.configService.getConfig().keyBindings;\n        this.bindKeys(keyBindingsConfig.common);\n        switch (detectPlatform()) {\n            case 'macOS':\n                if (keyBindingsConfig.macos) {\n                    this.bindKeys(keyBindingsConfig.macos);\n                }\n                break;\n            case 'Windows':\n                if (keyBindingsConfig.windows) {\n                    this.bindKeys(keyBindingsConfig.windows);\n                }\n                break;\n            case 'Linux':\n                if (keyBindingsConfig.linux) {\n                    this.bindKeys(keyBindingsConfig.linux);\n                }\n                break;\n        }\n        viewService.onDidPressKey(this.handleDidPressKey);\n    }\n    KeyBindingService.prototype.bindKeys = function (config) {\n        for (var key in config) {\n            var binding = config[key];\n            this.keyBindings.set(key, {\n                command: binding.command,\n                args: binding.args || [],\n                preventDefault: binding.preventDefault || false,\n            });\n        }\n    };\n    return KeyBindingService;\n}());\nexport { KeyBindingService };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { Node } from '../tree/node';\nimport { NodeList } from '../tree/node-list';\nimport { generateId } from '../util/id';\nvar LayoutNode = /** @class */ (function (_super) {\n    __extends(LayoutNode, _super);\n    function LayoutNode(renderId, text, children, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, generateId()) || this;\n        _this.renderId = renderId;\n        _this.text = text;\n        _this.paddingTop = paddingTop;\n        _this.paddingBottom = paddingBottom;\n        _this.paddingLeft = paddingLeft;\n        _this.paddingRight = paddingRight;\n        _this.internalNeedView = true;\n        _this.internalChildren = new NodeList(children);\n        children.forEach(function (child) {\n            child.parent = _this;\n        });\n        return _this;\n    }\n    Object.defineProperty(LayoutNode.prototype, \"contentLength\", {\n        get: function () {\n            if (this.leaf) {\n                return this.text.length;\n            }\n            return this.children.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"size\", {\n        get: function () {\n            if (this.internalSize === undefined) {\n                if (this.leaf) {\n                    this.internalSize = this.text.length;\n                }\n                else {\n                    this.internalSize = this.children.reduce(function (size, child) { return size + child.size; }, 0);\n                }\n            }\n            return this.internalSize;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingVertical\", {\n        get: function () {\n            return this.paddingTop + this.paddingBottom;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"paddingHorizontal\", {\n        get: function () {\n            return this.paddingLeft + this.paddingRight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerWidth\", {\n        get: function () {\n            return this.width - this.paddingHorizontal;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"innerHeight\", {\n        get: function () {\n            return this.height - this.paddingVertical;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutNode.prototype, \"needView\", {\n        get: function () {\n            return this.internalNeedView;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutNode.prototype.clearNeedView = function () {\n        this.internalNeedView = false;\n    };\n    LayoutNode.prototype.resolvePosition = function (position) {\n        if (position < 0 || position >= this.size) {\n            throw new Error(\"Offset \" + position + \" is out of range.\");\n        }\n        if (this.leaf) {\n            return [{ node: this, offset: position, position: position }];\n        }\n        var cumulatedSize = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childSize = child.size;\n            if (cumulatedSize + childSize > position) {\n                return __spreadArrays([{ node: this, offset: n, position: position }], child.resolvePosition(position - cumulatedSize));\n            }\n            cumulatedSize += childSize;\n        }\n        throw new Error('Offset cannot be resolved.');\n    };\n    return LayoutNode;\n}(Node));\nexport { LayoutNode };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutAtom = /** @class */ (function (_super) {\n    __extends(LayoutAtom, _super);\n    function LayoutAtom(renderId, width, height) {\n        var _this = _super.call(this, renderId, ' ', [], 0, 0, 0, 0) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutAtom.prototype, \"type\", {\n        get: function () {\n            return 'atom';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutAtom.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutAtom.prototype.convertCoordinatesToPosition = function (x, y) {\n        if (x < this.innerWidth / 2) {\n            return 0;\n        }\n        return 1;\n    };\n    LayoutAtom.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: from === to ? 0 : this.innerWidth,\n                    height: this.innerHeight,\n                    left: from === 0 ? this.paddingLeft : this.paddingLeft + this.innerWidth,\n                    right: to === 1 ? this.paddingRight : this.paddingRight + this.innerWidth,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    return LayoutAtom;\n}(LayoutNode));\nexport { LayoutAtom };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutBlock = /** @class */ (function (_super) {\n    __extends(LayoutBlock, _super);\n    function LayoutBlock(renderId, children, width, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        return _this;\n    }\n    Object.defineProperty(LayoutBlock.prototype, \"type\", {\n        get: function () {\n            return 'block';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutBlock.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight = this.children.reduce(function (height, child) { return height + child.height; }, this.paddingVertical);\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutBlock.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (y >= cumulatedHeight && y <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToPosition(x, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToPosition(x, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutBlock.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var childResult = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                resolvedChildren.push(childResult);\n                childResult.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left,\n                        right: boundingBox.right,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: resolvedChildren,\n        };\n    };\n    return LayoutBlock;\n}(LayoutNode));\nexport { LayoutBlock };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutDoc = /** @class */ (function (_super) {\n    __extends(LayoutDoc, _super);\n    function LayoutDoc(renderId, children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutDoc.prototype, \"type\", {\n        get: function () {\n            return 'doc';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"root\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutDoc.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutDoc.prototype.convertCoordinatesToPosition = function (x, y) {\n        throw new Error('Use page to convert coordinates to position.');\n    };\n    LayoutDoc.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n            }\n            cumulatedOffset += child.size;\n        });\n        return {\n            node: this,\n            boundingBoxes: [],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutDoc;\n}(LayoutNode));\nexport { LayoutDoc };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutLine = /** @class */ (function (_super) {\n    __extends(LayoutLine, _super);\n    function LayoutLine(children, width) {\n        var _this = _super.call(this, null, '', children, 0, 8, 0, 0) || this;\n        _this.width = width;\n        return _this;\n    }\n    Object.defineProperty(LayoutLine.prototype, \"type\", {\n        get: function () {\n            return 'line';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutLine.prototype, \"contentWidth\", {\n        get: function () {\n            if (this.internalContentWidth === undefined) {\n                this.internalContentWidth = this.children.reduce(function (contentWidth, child) { return contentWidth + child.width; }, 0);\n            }\n            return this.internalContentWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutLine.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (x >= cumulatedWidth && x <= cumulatedWidth + childWidth) {\n                offset += child.convertCoordinatesToPosition(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild && lastChild.type === 'text') {\n                var lastWord = lastChild.lastChild;\n                if (lastWord && lastWord.whitespaceSize > 0) {\n                    offset--;\n                }\n            }\n        }\n        return offset;\n    };\n    LayoutLine.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n                if (left1 === null) {\n                    left1 = left2 + resolvedChild.boundingBoxes[0].left;\n                }\n                left2 += resolvedChild.boundingBoxes\n                    .slice(0, resolvedChild.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += resolvedChild.boundingBoxes[0].left + resolvedChild.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: from === to ? this.innerHeight : this.height,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: from === to ? this.paddingTop : 0,\n                    bottom: from === to ? this.paddingBottom : 0,\n                },\n            ],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutLine;\n}(LayoutNode));\nexport { LayoutLine };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutPage = /** @class */ (function (_super) {\n    __extends(LayoutPage, _super);\n    function LayoutPage(children, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var _this = _super.call(this, null, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.width = width;\n        _this.height = height;\n        return _this;\n    }\n    Object.defineProperty(LayoutPage.prototype, \"type\", {\n        get: function () {\n            return 'page';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutPage.prototype, \"contentHeight\", {\n        get: function () {\n            if (this.internalContentHeight === undefined) {\n                this.internalContentHeight = this.children.reduce(function (contentHeight, child) { return contentHeight + child.height; }, 0);\n            }\n            return this.internalContentHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutPage.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedHeight = 0;\n        var contentX = Math.min(Math.max(x - this.paddingLeft, 0), this.innerWidth);\n        var contentY = Math.min(Math.max(y - this.paddingTop, 0), this.innerHeight);\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childHeight = child.height;\n            if (contentY >= cumulatedHeight && contentY <= cumulatedHeight + childHeight) {\n                offset += child.convertCoordinatesToPosition(contentX, contentY - cumulatedHeight);\n                break;\n            }\n            offset += child.size;\n            cumulatedHeight += childHeight;\n        }\n        if (offset === this.size) {\n            var lastChild = this.lastChild;\n            if (lastChild) {\n                offset -= lastChild.size;\n                offset += lastChild.convertCoordinatesToPosition(contentX, lastChild.height);\n            }\n        }\n        return offset;\n    };\n    LayoutPage.prototype.resolveBoundingBoxes = function (from, to) {\n        var _this = this;\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var boundingBoxes = [];\n        var cumulatedOffset = 0;\n        var cumulatedHeight = 0;\n        this.children.forEach(function (child) {\n            if (cumulatedOffset + child.size > from && cumulatedOffset <= to) {\n                var childFrom_1 = Math.max(0, from - cumulatedOffset);\n                var childTo_1 = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom_1, childTo_1);\n                resolvedChildren.push(resolvedChild);\n                resolvedChild.boundingBoxes.forEach(function (boundingBox) {\n                    boundingBoxes.push({\n                        from: cumulatedOffset + childFrom_1,\n                        to: cumulatedOffset + childTo_1,\n                        width: boundingBox.width,\n                        height: boundingBox.height,\n                        top: cumulatedHeight + _this.paddingTop + boundingBox.top,\n                        bottom: _this.height - _this.paddingTop - cumulatedHeight - child.height + boundingBox.bottom,\n                        left: boundingBox.left + _this.paddingLeft,\n                        right: boundingBox.right + _this.paddingRight,\n                    });\n                });\n            }\n            cumulatedOffset += child.size;\n            cumulatedHeight += child.height;\n        });\n        return {\n            node: this,\n            boundingBoxes: boundingBoxes,\n            children: resolvedChildren,\n        };\n    };\n    return LayoutPage;\n}(LayoutNode));\nexport { LayoutPage };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutText = /** @class */ (function (_super) {\n    __extends(LayoutText, _super);\n    function LayoutText(renderId, children, paddingTop, paddingBottom, paddingLeft, paddingRight, font) {\n        var _this = _super.call(this, renderId, '', children, paddingTop, paddingBottom, paddingLeft, paddingRight) || this;\n        _this.font = font;\n        return _this;\n    }\n    Object.defineProperty(LayoutText.prototype, \"type\", {\n        get: function () {\n            return 'text';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"leaf\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"width\", {\n        get: function () {\n            if (this.internalWidth === undefined) {\n                this.internalWidth = this.children.reduce(function (width, child) { return width + child.width; }, this.paddingHorizontal);\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"height\", {\n        get: function () {\n            if (this.internalHeight === undefined) {\n                this.internalHeight =\n                    this.children.reduce(function (height, child) { return Math.max(height, child.height); }, 0) + this.paddingVertical;\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutText.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var lastChild = this.lastChild;\n                if (!lastChild) {\n                    this.internalTrimmedWidth = 0;\n                }\n                else {\n                    this.internalTrimmedWidth = this.width - lastChild.width + lastChild.trimmedWidth;\n                }\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutText.prototype.convertCoordinatesToPosition = function (x, y) {\n        var offset = 0;\n        var cumulatedWidth = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            var child = this.children.at(n);\n            var childWidth = child.width;\n            if (cumulatedWidth + childWidth >= x) {\n                offset += child.convertCoordinatesToPosition(x - cumulatedWidth, 0);\n                break;\n            }\n            offset += child.size;\n            cumulatedWidth += childWidth;\n        }\n        return offset;\n    };\n    LayoutText.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        var resolvedChildren = [];\n        var cumulatedOffset = 0;\n        var left1 = null;\n        var left2 = 0;\n        for (var n = 0, nn = this.children.length; n < nn; n++) {\n            if (cumulatedOffset > to) {\n                break;\n            }\n            var child = this.children.at(n);\n            if (cumulatedOffset + child.size > from) {\n                var childFrom = Math.max(0, from - cumulatedOffset);\n                var childTo = Math.min(child.size, to - cumulatedOffset);\n                var resolvedChild = child.resolveBoundingBoxes(childFrom, childTo);\n                resolvedChildren.push(resolvedChild);\n                if (left1 === null) {\n                    left1 = left2 + resolvedChild.boundingBoxes[0].left;\n                }\n                left2 += resolvedChild.boundingBoxes\n                    .slice(0, resolvedChild.boundingBoxes.length - 1)\n                    .reduce(function (width, box) { return width + box.left + box.width + box.right; }, 0);\n                left2 += resolvedChild.boundingBoxes[0].left + resolvedChild.boundingBoxes[0].width;\n            }\n            else {\n                left2 += child.width;\n            }\n            cumulatedOffset += child.size;\n        }\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.width - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: resolvedChildren,\n        };\n    };\n    return LayoutText;\n}(LayoutNode));\nexport { LayoutText };\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { LayoutNode } from './node';\nvar LayoutWord = /** @class */ (function (_super) {\n    __extends(LayoutWord, _super);\n    function LayoutWord(renderId, text, whitespaceSize, font, textService) {\n        var _this = _super.call(this, renderId, text, [], 0, 0, 0, 0) || this;\n        _this.whitespaceSize = whitespaceSize;\n        _this.font = font;\n        _this.textService = textService;\n        return _this;\n    }\n    Object.defineProperty(LayoutWord.prototype, \"type\", {\n        get: function () {\n            return 'word';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"root\", {\n        get: function () {\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"leaf\", {\n        get: function () {\n            return true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"width\", {\n        get: function () {\n            var _a;\n            if (this.internalWidth === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"height\", {\n        get: function () {\n            var _a;\n            if (this.internalHeight === undefined) {\n                _a = this.measure(), this.internalWidth = _a[0], this.internalHeight = _a[1];\n            }\n            return this.internalHeight;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LayoutWord.prototype, \"trimmedWidth\", {\n        get: function () {\n            if (this.internalTrimmedWidth === undefined) {\n                var trimmedText = this.text.substring(0, this.text.length - this.whitespaceSize);\n                this.internalTrimmedWidth = this.textService.measure(trimmedText, this.font).width;\n            }\n            return this.internalTrimmedWidth;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutWord.prototype.convertCoordinatesToPosition = function (x, y) {\n        var lastWidth = 0;\n        var text = this.text;\n        for (var n = 0, nn = text.length; n < nn; n++) {\n            var measurement = this.textService.measure(text.substring(0, n), this.font);\n            var width_1 = measurement.width;\n            if (width_1 < x) {\n                lastWidth = width_1;\n                continue;\n            }\n            if (x - lastWidth < width_1 - x) {\n                return n - 1;\n            }\n            return n;\n        }\n        var width = this.width;\n        if (x - lastWidth < width - x) {\n            return text.length - 1;\n        }\n        return text.length;\n    };\n    LayoutWord.prototype.resolveBoundingBoxes = function (from, to) {\n        if (from < 0 || to > this.size || from > to) {\n            throw new Error('Invalid range.');\n        }\n        if (from === 0 && to === this.size) {\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: this.innerWidth,\n                        height: this.innerHeight,\n                        left: this.paddingLeft,\n                        right: this.paddingRight,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        if (from === to) {\n            var left = this.textService.measure(this.text.slice(0, from), this.font).width;\n            return {\n                node: this,\n                boundingBoxes: [\n                    {\n                        from: from,\n                        to: to,\n                        width: 0,\n                        height: this.innerHeight,\n                        left: this.paddingLeft + left,\n                        right: this.width - this.paddingLeft - left,\n                        top: this.paddingTop,\n                        bottom: this.paddingBottom,\n                    },\n                ],\n                children: [],\n            };\n        }\n        var left1 = this.textService.measure(this.text.slice(0, from), this.font).width;\n        var left2 = this.textService.measure(this.text.slice(0, to), this.font).width;\n        return {\n            node: this,\n            boundingBoxes: [\n                {\n                    from: from,\n                    to: to,\n                    width: left2 - left1,\n                    height: this.innerHeight,\n                    left: this.paddingLeft + left1,\n                    right: this.innerWidth - this.paddingLeft - left2,\n                    top: this.paddingTop,\n                    bottom: this.paddingBottom,\n                },\n            ],\n            children: [],\n        };\n    };\n    LayoutWord.prototype.breakAt = function (offset) {\n        return [\n            new LayoutWord(this.renderId, this.text.substring(0, offset), 0, this.font, this.textService),\n            new LayoutWord(this.renderId, this.text.substring(offset), this.whitespaceSize, this.font, this.textService),\n        ];\n    };\n    LayoutWord.prototype.measure = function () {\n        var measurement = this.textService.measure(this.text, this.font);\n        return [measurement.width, measurement.height];\n    };\n    return LayoutWord;\n}(LayoutNode));\nexport { LayoutWord };\n","import { LayoutAtom } from './atom';\nimport { LayoutBlock } from './block';\nimport { LayoutDoc } from './doc';\nimport { LayoutLine } from './line';\nimport { LayoutPage } from './page';\nimport { LayoutText } from './text';\nimport { LayoutWord } from './word';\nvar LayoutEngine = /** @class */ (function () {\n    function LayoutEngine(textService) {\n        this.textService = textService;\n    }\n    LayoutEngine.prototype.updateDoc = function (doc, renderDoc) {\n        var _this = this;\n        if (!renderDoc.needLayout && doc) {\n            return doc;\n        }\n        var pages = [];\n        var childrenMap = {};\n        if (doc) {\n            doc.children.forEach(function (page) {\n                pages.push(page);\n                page.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderDoc.children.forEach(function (child) {\n            switch (child.type) {\n                case 'block':\n                    newChildren.push.apply(newChildren, _this.updateBlock(childrenMap[child.id] || [], child, renderDoc.width - renderDoc.paddingLeft - renderDoc.paddingRight));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + child.type + \" is invalid.\");\n            }\n        });\n        renderDoc.clearNeedLayout();\n        return this.buildDoc(renderDoc, this.reflowPages(pages, newChildren, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight));\n    };\n    LayoutEngine.prototype.updateBlock = function (blocks, renderBlock, width) {\n        var _this = this;\n        if (!renderBlock.needLayout && blocks.length > 0) {\n            return blocks;\n        }\n        var lines = [];\n        var childrenMap = {};\n        for (var _i = 0, blocks_1 = blocks; _i < blocks_1.length; _i++) {\n            var block = blocks_1[_i];\n            block.children.forEach(function (line) {\n                lines.push(line);\n                line.children.forEach(function (child) {\n                    if (!child.renderId) {\n                        throw new Error('Render ID missing on layout node.');\n                    }\n                    childrenMap[child.renderId] = childrenMap[child.renderId] || [];\n                    childrenMap[child.renderId].push(child);\n                });\n            });\n        }\n        var newChildren = [];\n        renderBlock.children.forEach(function (renderChild) {\n            switch (renderChild.type) {\n                case 'text':\n                    newChildren.push.apply(newChildren, _this.updateText(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                case 'atom':\n                    newChildren.push.apply(newChildren, _this.updateAtom(childrenMap[renderChild.id] || [], renderChild));\n                    break;\n                default:\n                    throw new Error(\"Child type \" + renderChild.type + \" is invalid.\");\n            }\n        });\n        renderBlock.clearNeedLayout();\n        return [\n            this.buildBlock(renderBlock, this.reflowLines(lines, newChildren, width - renderBlock.paddingLeft - renderBlock.paddingRight), width),\n        ];\n    };\n    LayoutEngine.prototype.updateText = function (texts, renderText) {\n        var _this = this;\n        if (!renderText.needLayout && texts.length > 0) {\n            return texts;\n        }\n        var newChildren = [];\n        this.textService.breakIntoWords(renderText.text).forEach(function (word) {\n            newChildren.push(_this.buildWord(renderText, word.text, word.whitespaceSize));\n        });\n        renderText.clearNeedLayout();\n        return [this.buildText(renderText, newChildren)];\n    };\n    LayoutEngine.prototype.updateAtom = function (atoms, renderAtom) {\n        if (!renderAtom.needLayout && atoms.length > 0) {\n            return atoms;\n        }\n        renderAtom.clearNeedLayout();\n        return [this.buildAtom(renderAtom)];\n    };\n    LayoutEngine.prototype.buildDoc = function (renderDoc, children) {\n        return new LayoutDoc(renderDoc.id, children, renderDoc.width, renderDoc.height, renderDoc.paddingTop, renderDoc.paddingBottom, renderDoc.paddingLeft, renderDoc.paddingRight);\n    };\n    LayoutEngine.prototype.buildBlock = function (renderBlock, children, width) {\n        if (renderBlock.type !== 'block') {\n            throw new Error('Expected block.');\n        }\n        return new LayoutBlock(renderBlock.id, children, width, renderBlock.paddingTop, renderBlock.paddingBottom, renderBlock.paddingLeft, renderBlock.paddingRight);\n    };\n    LayoutEngine.prototype.buildText = function (renderText, children) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutText(renderText.id, children, renderText.paddingTop, renderText.paddingBottom, renderText.paddingLeft, renderText.paddingRight, renderText.font);\n    };\n    LayoutEngine.prototype.buildWord = function (renderText, text, whitespaceSize) {\n        if (renderText.type !== 'text') {\n            throw new Error('Expected text.');\n        }\n        return new LayoutWord(renderText.id, text, whitespaceSize, renderText.font, this.textService);\n    };\n    LayoutEngine.prototype.buildAtom = function (renderAtom) {\n        if (renderAtom.type !== 'atom') {\n            throw new Error('Expected atom.');\n        }\n        return new LayoutAtom(renderAtom.id, renderAtom.width, renderAtom.height);\n    };\n    LayoutEngine.prototype.reflowPages = function (pages, nodes, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight) {\n        var innerHeight = height - paddingTop - paddingBottom;\n        nodes = nodes.slice();\n        var newPages = [];\n        while (nodes.length > 0) {\n            if (newPages.length < pages.length) {\n                var page = pages[newPages.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = page.children.length; n < nn; n++) {\n                    var child = page.children.at(n);\n                    if (child.id !== nodes[n].id) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newPages.push(page);\n                    nodes.splice(0, page.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentHeight = 0;\n            // Push whole nodes to page until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentHeight + node.height <= innerHeight) {\n                newChildren.push(node);\n                currentHeight += node.height;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to page\n            if (node) {\n                var nodeChildren = [];\n                for (var m = 0, mm = node.children.length; m < mm; m++) {\n                    var nodeChild = node.children.at(m);\n                    if (currentHeight + nodeChild.height + node.paddingVertical > innerHeight) {\n                        break;\n                    }\n                    nodeChildren.push(nodeChild);\n                    currentHeight += nodeChild.height;\n                }\n                if (nodeChildren.length > 0) {\n                    switch (node.type) {\n                        case 'block':\n                            // Split block to two, one to push to this page, other goes back\n                            // to list of nodes to process\n                            var node1 = new LayoutBlock(node.renderId, nodeChildren, width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            newChildren.push(node1);\n                            currentHeight += node1.height;\n                            var node2 = new LayoutBlock(node.renderId, node.children.slice(nodeChildren.length), width, node.paddingTop, node.paddingBottom, node.paddingLeft, node.paddingRight);\n                            nodes.unshift(node2);\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newPage = new LayoutPage(newChildren, width, height, paddingTop, paddingBottom, paddingLeft, paddingRight);\n            newPages.push(newPage);\n        }\n        return newPages;\n    };\n    LayoutEngine.prototype.reflowLines = function (lines, nodes, width) {\n        nodes = nodes.slice();\n        var newLines = [];\n        while (nodes.length > 0) {\n            if (newLines.length < newLines.length) {\n                var line = lines[newLines.length];\n                var reflowNeeded = false;\n                for (var n = 0, nn = line.children.length; n < nn; n++) {\n                    var child = line.children.at(n);\n                    if (child.id !== nodes[n].id) {\n                        reflowNeeded = true;\n                        break;\n                    }\n                }\n                if (!reflowNeeded) {\n                    newLines.push(line);\n                    nodes.splice(0, line.children.length);\n                    continue;\n                }\n            }\n            var newChildren = [];\n            var currentWidth = 0;\n            // Push whole nodes to line until either no more node or no longer fit\n            var node = nodes.shift();\n            while (node && currentWidth + node.width <= width) {\n                newChildren.push(node);\n                currentWidth += node.width;\n                node = nodes.shift();\n            }\n            // If there is remainder node, try to push part of it to line\n            if (node) {\n                var nodeChildren = node.children.slice();\n                var newNodeChildren = [];\n                for (var m = 0; m < nodeChildren.length; m++) {\n                    var nodeChild = nodeChildren[m];\n                    if (nodeChild.type === 'word' && nodeChild.width > width) {\n                        var breakAt = nodeChild.convertCoordinatesToPosition(width, 0);\n                        if (nodeChild.resolveBoundingBoxes(breakAt, breakAt).boundingBoxes[0].left > width) {\n                            breakAt--;\n                        }\n                        var _a = nodeChild.breakAt(breakAt), brokenNodeChild1 = _a[0], brokenNodeChild2 = _a[1];\n                        nodeChild = brokenNodeChild1;\n                        nodeChildren.splice(m, 1, brokenNodeChild1, brokenNodeChild2);\n                    }\n                    if (currentWidth + nodeChild.width > width) {\n                        break;\n                    }\n                    newNodeChildren.push(nodeChild);\n                    currentWidth += nodeChild.width;\n                }\n                if (newNodeChildren.length > 0) {\n                    switch (node.type) {\n                        case 'text':\n                            // Split text to two, one to push to this line, other goes back\n                            // to list of nodes to process\n                            var text = node;\n                            var node1 = new LayoutText(text.renderId, newNodeChildren, text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            newChildren.push(node1);\n                            currentWidth += node1.width;\n                            var node2 = new LayoutText(text.renderId, nodeChildren.slice(newNodeChildren.length), text.paddingTop, text.paddingBottom, text.paddingLeft, text.paddingRight, text.font);\n                            nodes.unshift(node2);\n                            break;\n                        case 'atom':\n                            // If atom is wider than line and line is empty, push atom to line\n                            // and let it clip\n                            if (node.width > width && newChildren.length === 0) {\n                                newChildren.push(node);\n                            }\n                            else {\n                                // Atom cannot be split, goes back to list of nodes to process\n                                nodes.unshift(node);\n                            }\n                            break;\n                        default:\n                            throw new Error('Invalid node type encountered while reflowing page.');\n                    }\n                }\n                else {\n                    nodes.unshift(node);\n                }\n            }\n            var newLine = new LayoutLine(newChildren, width);\n            newLines.push(newLine);\n        }\n        return newLines;\n    };\n    return LayoutEngine;\n}());\nexport { LayoutEngine };\n","import { EventEmitter } from '../event/emitter';\nimport { LayoutEngine } from './engine';\nvar LayoutState = /** @class */ (function () {\n    function LayoutState(renderService, textService) {\n        var _this = this;\n        this.renderService = renderService;\n        this.textService = textService;\n        this.didUpdateLayoutStateEventEmitter = new EventEmitter();\n        this.engine = new LayoutEngine(textService);\n        this.internalDoc = this.engine.updateDoc(null, renderService.getDoc());\n        renderService.onDidUpdateRenderState(function (event) { return _this.handleDidUpdateRenderStateEvent(event); });\n    }\n    Object.defineProperty(LayoutState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LayoutState.prototype.onDidUpdateLayoutState = function (listener) {\n        return this.didUpdateLayoutStateEventEmitter.on(listener);\n    };\n    LayoutState.prototype.handleDidUpdateRenderStateEvent = function (event) {\n        this.update();\n    };\n    LayoutState.prototype.update = function () {\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.engine.updateDoc(this.doc, renderDoc);\n        this.didUpdateLayoutStateEventEmitter.emit({});\n    };\n    return LayoutState;\n}());\nexport { LayoutState };\n","import { LayoutState } from './state';\nvar LayoutService = /** @class */ (function () {\n    function LayoutService(renderService, textService) {\n        this.state = new LayoutState(renderService, textService);\n    }\n    LayoutService.prototype.onDidUpdateLayoutState = function (listener) {\n        this.state.onDidUpdateLayoutState(listener);\n    };\n    LayoutService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    LayoutService.prototype.resolvePosition = function (position) {\n        return this.state.doc.resolvePosition(position);\n    };\n    LayoutService.prototype.resolveBoundingBoxes = function (from, to) {\n        return this.state.doc.resolveBoundingBoxes(from, to);\n    };\n    return LayoutService;\n}());\nexport { LayoutService };\n","import { EventEmitter } from '../event/emitter';\nvar ModelState = /** @class */ (function () {\n    function ModelState(root, componentService) {\n        this.root = root;\n        this.componentService = componentService;\n        this.didUpdateEventEmitter = new EventEmitter();\n    }\n    ModelState.prototype.applyChange = function (change) {\n        var changeResult = change.apply(this.root, this.componentService);\n        this.didUpdateEventEmitter.emit({ changeResult: changeResult });\n        return changeResult;\n    };\n    ModelState.prototype.onDidUpdate = function (listener) {\n        return this.didUpdateEventEmitter.on(listener);\n    };\n    return ModelState;\n}());\nexport { ModelState };\n","import { ModelState } from './state';\nvar ModelService = /** @class */ (function () {\n    function ModelService(root, componentService) {\n        this.state = new ModelState(root, componentService);\n    }\n    ModelService.prototype.getRoot = function () {\n        return this.state.root;\n    };\n    ModelService.prototype.getRootSize = function () {\n        return this.state.root.size;\n    };\n    ModelService.prototype.applyChange = function (change) {\n        return this.state.applyChange(change);\n    };\n    ModelService.prototype.resolvePosition = function (position) {\n        return this.state.root.resolvePosition(position);\n    };\n    ModelService.prototype.onDidUpdateModelState = function (listener) {\n        this.state.onDidUpdate(listener);\n    };\n    return ModelService;\n}());\nexport { ModelService };\n","import { EventEmitter } from '../event/emitter';\nvar RenderState = /** @class */ (function () {\n    function RenderState(componentService, modelService) {\n        var _this = this;\n        this.componentService = componentService;\n        this.modelService = modelService;\n        this.didUpdateRenderStateEventEmitter = new EventEmitter();\n        var modelRoot = modelService.getRoot();\n        this.internalDoc = this.updateNode(null, modelRoot);\n        modelService.onDidUpdateModelState(function (event) { return _this.handleDidUpdateModelState(event); });\n    }\n    RenderState.prototype.onDidUpdateRenderState = function (listener) {\n        return this.didUpdateRenderStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(RenderState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    RenderState.prototype.handleDidUpdateModelState = function (event) {\n        this.update();\n    };\n    RenderState.prototype.update = function () {\n        var modelRoot = this.modelService.getRoot();\n        this.internalDoc = this.updateNode(this.doc, modelRoot);\n        this.didUpdateRenderStateEventEmitter.emit({});\n    };\n    RenderState.prototype.updateNode = function (node, modelNode) {\n        var _this = this;\n        if (!modelNode.needRender && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.modelId) {\n                    return;\n                }\n                childrenMap[child.modelId] = child;\n            });\n        }\n        var newChildren = [];\n        modelNode.children.forEach(function (modelChild) {\n            newChildren.push(_this.updateNode(childrenMap[modelChild.id] || null, modelChild));\n        });\n        modelNode.clearNeedRender();\n        return this.buildNode(modelNode, newChildren);\n    };\n    RenderState.prototype.buildNode = function (modelNode, children) {\n        var component = this.componentService.getComponent(modelNode.componentId);\n        var node = component.buildRenderNode(modelNode.partId, modelNode.id, modelNode.text, modelNode.attributes, children);\n        if (!node) {\n            throw new Error(\"Error building render node from model node \" + modelNode.id + \".\");\n        }\n        return node;\n    };\n    return RenderState;\n}());\nexport { RenderState };\n","import { RenderState } from './state';\nvar RenderService = /** @class */ (function () {\n    function RenderService(componentService, modelService) {\n        this.state = new RenderState(componentService, modelService);\n    }\n    RenderService.prototype.onDidUpdateRenderState = function (listener) {\n        this.state.onDidUpdateRenderState(listener);\n    };\n    RenderService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    RenderService.prototype.getDocSize = function () {\n        return this.state.doc.size;\n    };\n    RenderService.prototype.resolvePosition = function (position) {\n        return this.state.doc.resolvePosition(position);\n    };\n    RenderService.prototype.convertModelToRenderPosition = function (modelPosition) {\n        return this.state.doc.convertModelToRenderPosition(modelPosition);\n    };\n    RenderService.prototype.convertRenderToModelPosition = function (renderPosition) {\n        return this.state.doc.convertRenderToModelPosition(renderPosition);\n    };\n    RenderService.prototype.getStylesBetween = function (from, to) {\n        var resolvedFrom = this.resolvePosition(from);\n        var resolvedTo = this.resolvePosition(to);\n        var styles = {};\n        var doc = this.state.doc;\n        this.extractStyle(styles, doc, resolvedFrom, resolvedTo);\n        return styles;\n    };\n    RenderService.prototype.extractStyle = function (styles, node, from, to) {\n        var componentStyles = (styles[node.componentId] = styles[node.componentId] || {});\n        var partStyles = (componentStyles[node.partId || ''] = componentStyles[node.partId || ''] || []);\n        partStyles.push(node.style);\n        if (node.leaf) {\n            return;\n        }\n        var fromOffset = from ? from[0].offset : 0;\n        var toOffset = to ? to[0].offset : node.contentLength - 1;\n        for (var n = fromOffset; n <= toOffset; n++) {\n            var child = node.children.at(n);\n            this.extractStyle(styles, child, from && n === fromOffset ? from.slice(1) : null, to && n === toOffset ? to.slice(1) : null);\n        }\n    };\n    return RenderService;\n}());\nexport { RenderService };\n","var ServiceRegistry = /** @class */ (function () {\n    function ServiceRegistry() {\n        this.services = {};\n    }\n    ServiceRegistry.prototype.registerService = function (key, service) {\n        this.services[key] = service;\n    };\n    ServiceRegistry.prototype.getService = function (key) {\n        var service = this.services[key];\n        if (!service) {\n            throw new Error(\"Service \" + key + \" is not registered.\");\n        }\n        return service;\n    };\n    return ServiceRegistry;\n}());\nexport { ServiceRegistry };\n","import { EventEmitter } from '../event/emitter';\nvar TransformService = /** @class */ (function () {\n    function TransformService(modelService, componentService, cursorService, renderService, layoutService) {\n        this.modelService = modelService;\n        this.componentService = componentService;\n        this.cursorService = cursorService;\n        this.renderService = renderService;\n        this.layoutService = layoutService;\n        this.didApplyTransformationEventEmitter = new EventEmitter();\n    }\n    TransformService.prototype.applyTransformation = function (tn) {\n        var result = tn.apply(this.modelService, this.cursorService, this.renderService, this.layoutService);\n        this.didApplyTransformationEventEmitter.emit({ result: result });\n        return result;\n    };\n    TransformService.prototype.onDidApplyTransformation = function (listener) {\n        return this.didApplyTransformationEventEmitter.on(listener);\n    };\n    return TransformService;\n}());\nexport { TransformService };\n","var CursorView = /** @class */ (function () {\n    function CursorView(instanceId, configService, domService, cursorService, layoutService, viewService, transformService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.configService = configService;\n        this.domService = domService;\n        this.cursorService = cursorService;\n        this.layoutService = layoutService;\n        this.viewService = viewService;\n        this.transformService = transformService;\n        this.blinkInterval = null;\n        this.blinkState = true;\n        this.domSelections = [];\n        this.attached = false;\n        var cursorConfig = configService.getConfig().cursor;\n        this.caretColor = cursorConfig.caretColor;\n        this.caretInactiveColor = cursorConfig.caretInactiveColor;\n        this.selectionColor = cursorConfig.selectionColor;\n        this.selectionInactiveColor = cursorConfig.selectionInactiveColor;\n        this.domCaret = domService.createElement('div');\n        this.domCaret.className = 'tw--cursor--caret';\n        this.domCaret.setAttribute('data-tw-instance', this.instanceId);\n        this.domCaret.style.position = 'absolute';\n        this.domCaret.style.userSelect = 'none';\n        this.domCaret.style.pointerEvents = 'none';\n        this.domCaret.style.width = '2px';\n        this.domCaret.style.marginLeft = '-1px';\n        transformService.onDidApplyTransformation(function (event) { return _this.handleDidApplyTransformation(event); });\n        viewService.onDidFocus(function (event) { return _this.handleDidFocus(event); });\n        viewService.onDidBlur(function (event) { return _this.handleDidBlur(event); });\n    }\n    CursorView.prototype.attach = function () {\n        if (this.attached) {\n            throw new Error('Already attached to the DOM.');\n        }\n        this.attached = true;\n        this.updateView();\n    };\n    CursorView.prototype.updateView = function () {\n        var _this = this;\n        if (!this.attached) {\n            return;\n        }\n        this.clearDOMSelections();\n        var _a = this.cursorService.getCursor(), anchor = _a.anchor, head = _a.head;\n        var from = Math.min(anchor, head);\n        var to = Math.max(anchor, head);\n        var docBoxResult = this.layoutService.resolveBoundingBoxes(from, to);\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var focused = this.viewService.isFocused();\n        var firstPageId = '';\n        var firstBoxOffset = -1;\n        var lastPageId = '';\n        var lastBoxOffset = -1;\n        docBoxResult.children.forEach(function (pageBoxResult) {\n            var pageOffset = layoutDoc.children.indexOf(pageBoxResult.node);\n            var viewPage = viewDoc.children.at(pageOffset);\n            var domContentContainer = viewPage.domContentContainer;\n            pageBoxResult.boundingBoxes.forEach(function (box, boxOffset) {\n                if (!firstPageId) {\n                    firstPageId = pageBoxResult.node.id;\n                    firstBoxOffset = boxOffset;\n                }\n                lastPageId = pageBoxResult.node.id;\n                lastBoxOffset = boxOffset;\n                if (box.width === 0) {\n                    return;\n                }\n                var domSelection = _this.buildDOMSelection(box);\n                if (focused) {\n                    domSelection.style.background = _this.selectionColor;\n                }\n                else {\n                    domSelection.style.background = _this.selectionInactiveColor;\n                }\n                domContentContainer.appendChild(domSelection);\n                _this.domSelections.push(domSelection);\n            });\n        });\n        var headPageId;\n        var headLeft;\n        var headTop;\n        var headHeight;\n        if (head < anchor) {\n            headPageId = firstPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === firstPageId; }).boundingBoxes[firstBoxOffset];\n            headLeft = rect.left;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        else {\n            headPageId = lastPageId;\n            var rect = docBoxResult.children.find(function (child) { return child.node.id === lastPageId; }).boundingBoxes[lastBoxOffset];\n            headLeft = rect.left + rect.width;\n            headTop = rect.top;\n            headHeight = rect.height;\n        }\n        if (head === anchor) {\n            this.domCaret.style.display = 'block';\n            this.domCaret.style.top = headTop + \"px\";\n            this.domCaret.style.left = headLeft + \"px\";\n            this.domCaret.style.height = headHeight + \"px\";\n            if (focused) {\n                this.domCaret.style.background = this.caretColor;\n            }\n            else {\n                this.domCaret.style.background = this.caretInactiveColor;\n            }\n            var pageDOMContentContainer = viewDoc.children.find(function (child) { return child.id === headPageId; })\n                .domContentContainer;\n            if (this.domCaret.parentElement && this.domCaret.parentElement !== pageDOMContentContainer) {\n                this.domCaret.parentElement.removeChild(this.domCaret);\n            }\n            if (!this.domCaret.parentElement) {\n                pageDOMContentContainer.appendChild(this.domCaret);\n            }\n            this.blinkStop();\n            if (focused) {\n                this.blinkStart();\n            }\n        }\n        else {\n            this.domCaret.style.display = 'none';\n            this.blinkStop();\n        }\n    };\n    CursorView.prototype.blinkStart = function () {\n        var _this = this;\n        if (this.blinkInterval !== null) {\n            return;\n        }\n        this.blinkState = true;\n        this.blinkInterval = window.setInterval(function () {\n            _this.blinkState = !_this.blinkState;\n            _this.updateDOMBlink();\n        }, 500);\n    };\n    CursorView.prototype.blinkStop = function () {\n        if (this.blinkInterval === null) {\n            return;\n        }\n        this.domCaret.style.visibility = 'visible';\n        clearInterval(this.blinkInterval);\n        this.blinkInterval = null;\n    };\n    CursorView.prototype.updateDOMBlink = function () {\n        if (this.blinkState) {\n            this.domCaret.style.visibility = 'visible';\n        }\n        else {\n            this.domCaret.style.visibility = 'hidden';\n        }\n    };\n    CursorView.prototype.clearDOMSelections = function () {\n        this.domSelections.forEach(function (domSelection) {\n            if (domSelection.parentElement) {\n                domSelection.parentElement.removeChild(domSelection);\n            }\n        });\n        this.domSelections = [];\n    };\n    CursorView.prototype.buildDOMSelection = function (box) {\n        var domSelection = document.createElement('div');\n        domSelection.className = 'tw--cursor--selection';\n        domSelection.setAttribute('data-tw-instance', this.instanceId);\n        domSelection.style.position = 'absolute';\n        domSelection.style.top = box.top + \"px\";\n        domSelection.style.left = box.left + \"px\";\n        domSelection.style.width = box.width + \"px\";\n        domSelection.style.height = box.height + \"px\";\n        domSelection.style.userSelect = 'none';\n        domSelection.style.pointerEvents = 'none';\n        return domSelection;\n    };\n    CursorView.prototype.handleDidApplyTransformation = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidFocus = function (event) {\n        this.updateView();\n    };\n    CursorView.prototype.handleDidBlur = function (event) {\n        this.updateView();\n    };\n    return CursorView;\n}());\nexport { CursorView };\n","import { EventEmitter } from '../event/emitter';\nvar ClipboardObserver = /** @class */ (function () {\n    function ClipboardObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didCopyEventEmitter = new EventEmitter();\n        this.didPasteEventEmitter = new EventEmitter();\n        this.handleCopy = function (event) {\n            event.preventDefault();\n            _this.didCopyEventEmitter.emit({});\n        };\n        this.handlePaste = function (event) {\n            event.preventDefault();\n            var data = event.clipboardData;\n            if (!data) {\n                return;\n            }\n            _this.didPasteEventEmitter.emit({ data: data });\n        };\n        $contentEditable.addEventListener('copy', this.handleCopy);\n        $contentEditable.addEventListener('paste', this.handlePaste);\n    }\n    ClipboardObserver.prototype.onDidCopy = function (listener) {\n        return this.didCopyEventEmitter.on(listener);\n    };\n    ClipboardObserver.prototype.onDidPaste = function (listener) {\n        return this.didPasteEventEmitter.on(listener);\n    };\n    return ClipboardObserver;\n}());\nexport { ClipboardObserver };\n","import { EventEmitter } from '../event/emitter';\nvar FocusObserver = /** @class */ (function () {\n    function FocusObserver($contentEditable) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.didFocusEventEmitter = new EventEmitter();\n        this.didBlurEventEmitter = new EventEmitter();\n        this.handleFocus = function () {\n            _this.didFocusEventEmitter.emit({});\n        };\n        this.handleBlur = function () {\n            _this.didBlurEventEmitter.emit({});\n        };\n        $contentEditable.addEventListener('focus', this.handleFocus);\n        $contentEditable.addEventListener('blur', this.handleBlur);\n    }\n    FocusObserver.prototype.onDidFocus = function (listener) {\n        return this.didFocusEventEmitter.on(listener);\n    };\n    FocusObserver.prototype.onDidBlur = function (listener) {\n        return this.didBlurEventEmitter.on(listener);\n    };\n    return FocusObserver;\n}());\nexport { FocusObserver };\n","import { EventEmitter } from '../event/emitter';\nimport { detectPlatform } from '../util/platform';\nvar KeyboardObserver = /** @class */ (function () {\n    function KeyboardObserver($contentEditable, domService) {\n        var _this = this;\n        this.$contentEditable = $contentEditable;\n        this.domService = domService;\n        this.composing = false;\n        this.didInsertEventEmitter = new EventEmitter();\n        this.didPressKeyEventEmitter = new EventEmitter();\n        this.compositionDidStartEventEmitter = new EventEmitter();\n        this.compositionDidEndEventEmitter = new EventEmitter();\n        this.keyInterpreter = new KeyInterpreter();\n        this.handleDidMutate = function () {\n            setTimeout(function () {\n                if (_this.composing) {\n                    return;\n                }\n                var content = _this.$contentEditable.innerText;\n                _this.$contentEditable.innerHTML = '';\n                if (content.length === 0) {\n                    return;\n                }\n                _this.didInsertEventEmitter.emit({ content: content });\n            });\n        };\n        this.handleKeyDown = function (event) {\n            var key = _this.keyInterpreter.interpretFromKeyboardEvent(event);\n            if (!key) {\n                return;\n            }\n            _this.didPressKeyEventEmitter.emit({ key: key, originalKeyboardEvent: event });\n        };\n        this.handleCompositionStart = function () {\n            _this.composing = true;\n        };\n        this.handleCompositionEnd = function () {\n            _this.composing = true;\n        };\n        this.mutationObserver = domService.createMutationObserver(this.handleDidMutate);\n        $contentEditable.addEventListener('keydown', this.handleKeyDown);\n        $contentEditable.addEventListener('compositionstart', this.handleCompositionStart);\n        $contentEditable.addEventListener('compositionend', this.handleCompositionEnd);\n        this.mutationObserver.observe($contentEditable, {\n            subtree: true,\n            characterData: true,\n            childList: true,\n        });\n    }\n    KeyboardObserver.prototype.onDidInsert = function (listener) {\n        return this.didInsertEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onDidPressKey = function (listener) {\n        return this.didPressKeyEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidStart = function (listener) {\n        return this.compositionDidStartEventEmitter.on(listener);\n    };\n    KeyboardObserver.prototype.onCompositionDidEnd = function (listener) {\n        return this.compositionDidEndEventEmitter.on(listener);\n    };\n    return KeyboardObserver;\n}());\nexport { KeyboardObserver };\nvar KeyInterpreter = /** @class */ (function () {\n    function KeyInterpreter() {\n    }\n    KeyInterpreter.prototype.interpretFromKeyboardEvent = function (event) {\n        var key;\n        switch (event.key) {\n            case 'Control':\n            case 'Shift':\n            case 'Alt':\n            case 'Meta':\n                return undefined;\n            case 'ArrowLeft':\n                key = 'left';\n                break;\n            case 'ArrowRight':\n                key = 'right';\n                break;\n            case 'ArrowUp':\n                key = 'up';\n                break;\n            case 'ArrowDown':\n                key = 'down';\n                break;\n            default:\n                key = event.key.toLowerCase();\n        }\n        if (event.metaKey) {\n            switch (detectPlatform()) {\n                case 'macOS':\n                    key = \"cmd+\" + key;\n                    break;\n                case 'Windows':\n                    key = \"win+\" + key;\n                    break;\n                case 'Linux':\n                default:\n                    key = \"meta+\" + key;\n            }\n        }\n        if (event.altKey) {\n            key = \"alt+\" + key;\n        }\n        if (event.shiftKey) {\n            key = \"shift+\" + key;\n        }\n        if (event.ctrlKey) {\n            key = \"ctrl+\" + key;\n        }\n        return key;\n    };\n    return KeyInterpreter;\n}());\n","import { EventEmitter } from '../event/emitter';\nvar PointerObserver = /** @class */ (function () {\n    function PointerObserver(instanceId, viewService, domService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.viewService = viewService;\n        this.domService = domService;\n        this.layoutService = layoutService;\n        this.clickThreshold = 250;\n        this.consecutiveClickThreshold = 250;\n        this.lastPointerDown = null;\n        this.lastClick = null;\n        this.consecutiveClickCount = 0;\n        this.pointerDidDownEventEmitter = new EventEmitter();\n        this.pointerDidMoveEventEmitter = new EventEmitter();\n        this.pointerDidUpEventEmitter = new EventEmitter();\n        this.pointerDidClickEventEmitter = new EventEmitter();\n        this.handleMouseDown = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            // Bypass browser selection\n            event.preventDefault();\n            _this.lastPointerDown = {\n                timestamp: Date.now(),\n                offset: offset,\n            };\n            var consecutive = _this.lastClick !== null && Date.now() - _this.lastClick.timestamp < _this.consecutiveClickThreshold;\n            _this.pointerDidDownEventEmitter.emit({ offset: offset, consecutive: consecutive });\n        };\n        this.handleMouseMove = function (event) {\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            _this.pointerDidMoveEventEmitter.emit({\n                pointerDown: _this.lastPointerDown !== null,\n                offset: offset,\n            });\n        };\n        this.handleMouseUp = function (event) {\n            if (_this.lastPointerDown === null) {\n                return;\n            }\n            var lastPointerDown = _this.lastPointerDown;\n            _this.lastPointerDown = null;\n            var offset = _this.resolveOffset(event.clientX, event.clientY);\n            if (offset === null) {\n                return;\n            }\n            var now = Date.now();\n            var clicked = lastPointerDown.offset === offset && now - lastPointerDown.timestamp < _this.clickThreshold;\n            _this.pointerDidUpEventEmitter.emit({});\n            if (clicked) {\n                if (_this.lastClick !== null) {\n                    var delta = now - _this.lastClick.timestamp;\n                    if (delta > _this.consecutiveClickThreshold) {\n                        _this.consecutiveClickCount = 0;\n                    }\n                }\n                _this.consecutiveClickCount++;\n                _this.lastClick = {\n                    timestamp: Date.now(),\n                    offset: offset,\n                };\n                _this.pointerDidClickEventEmitter.emit({\n                    offset: offset,\n                    consecutiveCount: _this.consecutiveClickCount,\n                });\n            }\n        };\n        var window = domService.getWindow();\n        window.addEventListener('mousedown', this.handleMouseDown);\n        window.addEventListener('mousemove', this.handleMouseMove);\n        window.addEventListener('mouseup', this.handleMouseUp);\n    }\n    PointerObserver.prototype.onPointerDidDown = function (listener) {\n        return this.pointerDidDownEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidMove = function (listener) {\n        return this.pointerDidMoveEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidUp = function (listener) {\n        return this.pointerDidUpEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.onPointerDidClick = function (listener) {\n        return this.pointerDidClickEventEmitter.on(listener);\n    };\n    PointerObserver.prototype.resolveOffset = function (x, y) {\n        var viewDoc = this.viewService.getDoc();\n        var layoutDoc = this.layoutService.getDoc();\n        var cumulatedOffset = 0;\n        for (var n = 0, nn = viewDoc.children.length; n < nn; n++) {\n            var viewPage = viewDoc.children.at(n);\n            var layoutPage = layoutDoc.children.at(n);\n            var pageBoundingClientRect = viewPage.domContainer.getBoundingClientRect();\n            if (pageBoundingClientRect.left <= x &&\n                pageBoundingClientRect.right >= x &&\n                pageBoundingClientRect.top <= y &&\n                pageBoundingClientRect.bottom >= y) {\n                var pageX = x - pageBoundingClientRect.left;\n                var pageY = y - pageBoundingClientRect.top;\n                return cumulatedOffset + layoutPage.convertCoordinatesToPosition(pageX, pageY);\n            }\n            cumulatedOffset += layoutPage.size;\n        }\n        return null;\n    };\n    return PointerObserver;\n}());\nexport { PointerObserver };\n","import { ClipboardObserver } from './clipboard-observer';\nimport { FocusObserver } from './focus-observer';\nimport { KeyboardObserver, } from './keyboard-observer';\nimport { PointerObserver, } from './pointer-observer';\nvar DOMController = /** @class */ (function () {\n    function DOMController(instanceId, domService, commandService, modelService, viewService, layoutService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.domService = domService;\n        this.commandService = commandService;\n        this.modelService = modelService;\n        this.viewService = viewService;\n        this.layoutService = layoutService;\n        this.focused = false;\n        this.composing = false;\n        this.mouseDown = false;\n        this.handleDidInsert = function (event) {\n            _this.commandService.executeCommand('tw.state.insert', event.content);\n        };\n        this.handleCompositionDidStart = function (event) {\n            _this.composing = true;\n        };\n        this.handleCompositionDidEnd = function (event) {\n            _this.composing = false;\n        };\n        this.handlePointerDidDown = function (event) {\n            if (!_this.focused) {\n                _this.commandService.executeCommand('tw.view.focus');\n            }\n            if (!event.consecutive) {\n                _this.commandService.executeCommand('tw.cursor.move', event.offset);\n            }\n        };\n        this.handlePointerDidMove = function (event) {\n            if (event.pointerDown) {\n                _this.commandService.executeCommand('tw.cursor.moveHead', event.offset);\n            }\n        };\n        this.handlePointerDidClick = function (event) {\n            switch (event.consecutiveCount) {\n                case 1: {\n                    break;\n                }\n                case 2:\n                    _this.commandService.executeCommand('tw.cursor.selectWord', event.offset);\n                    break;\n                case 3:\n                default:\n                    _this.commandService.executeCommand('tw.cursor.selectBlock', event.offset);\n                    break;\n            }\n        };\n        this.handleDidFocus = function (event) {\n            _this.focused = true;\n        };\n        this.handleDidBlur = function (event) {\n            _this.focused = false;\n        };\n        this.handleCopy = function (event) {\n            _this.commandService.executeCommand('tw.clipboard.copy');\n        };\n        this.handlePaste = function (event) {\n            var html = event.data.getData('text/html');\n            var $container = _this.domService.createElement('html');\n            $container.innerHTML = html;\n            var $body = $container.querySelector('body');\n            if (!$body) {\n                return;\n            }\n            var domNodes = Array.prototype.slice.call($body.children);\n            console.log(domNodes);\n            // TODO\n        };\n        this.iframe = domService.createHiddenIframe();\n        this.$contentEditable = this.createContentEditable();\n        this.keyboardObserver = new KeyboardObserver(this.$contentEditable, domService);\n        this.keyboardObserver.onDidInsert(this.handleDidInsert);\n        this.keyboardObserver.onCompositionDidStart(this.handleCompositionDidStart);\n        this.keyboardObserver.onCompositionDidEnd(this.handleCompositionDidEnd);\n        this.pointerObserver = new PointerObserver(instanceId, viewService, domService, layoutService);\n        this.pointerObserver.onPointerDidDown(this.handlePointerDidDown);\n        this.pointerObserver.onPointerDidMove(this.handlePointerDidMove);\n        this.pointerObserver.onPointerDidClick(this.handlePointerDidClick);\n        this.focusObserver = new FocusObserver(this.$contentEditable);\n        this.focusObserver.onDidFocus(this.handleDidFocus);\n        this.focusObserver.onDidBlur(this.handleDidBlur);\n        this.clipboardObserver = new ClipboardObserver(this.$contentEditable);\n        this.clipboardObserver.onDidCopy(this.handleCopy);\n        this.clipboardObserver.onDidPaste(this.handlePaste);\n    }\n    DOMController.prototype.onDidPressKey = function (listener) {\n        this.keyboardObserver.onDidPressKey(listener);\n    };\n    DOMController.prototype.onDidFocus = function (listener) {\n        this.focusObserver.onDidFocus(listener);\n    };\n    DOMController.prototype.onDidBlur = function (listener) {\n        this.focusObserver.onDidBlur(listener);\n    };\n    DOMController.prototype.attach = function () {\n        var _this = this;\n        this.domService.getBody().appendChild(this.iframe);\n        setTimeout(function () {\n            _this.iframe.contentDocument.body.appendChild(_this.$contentEditable);\n        });\n    };\n    DOMController.prototype.requestFocus = function () {\n        this.$contentEditable.focus();\n    };\n    DOMController.prototype.requestBlur = function () {\n        this.$contentEditable.blur();\n    };\n    DOMController.prototype.isFocused = function () {\n        return this.focused;\n    };\n    DOMController.prototype.isComposing = function () {\n        return this.composing;\n    };\n    DOMController.prototype.createContentEditable = function () {\n        var $contentEditable = this.domService.createElement('div');\n        $contentEditable.contentEditable = 'true';\n        $contentEditable.style.whiteSpace = 'pre';\n        return $contentEditable;\n    };\n    return DOMController;\n}());\nexport { DOMController };\n","import { EventEmitter } from '../event/emitter';\nvar ViewState = /** @class */ (function () {\n    function ViewState(instanceId, componentService, layoutService, renderService, domService) {\n        var _this = this;\n        this.instanceId = instanceId;\n        this.componentService = componentService;\n        this.layoutService = layoutService;\n        this.renderService = renderService;\n        this.domService = domService;\n        this.didUpdateViewStateEventEmitter = new EventEmitter();\n        this.domContainer = null;\n        var layoutDoc = layoutService.getDoc();\n        var renderDoc = renderService.getDoc();\n        this.internalDoc = this.updateNode(null, layoutDoc, renderDoc);\n        layoutService.onDidUpdateLayoutState(function (event) { return _this.handleDidUpdateLayoutStateEvent(event); });\n    }\n    ViewState.prototype.onDidUpdateViewState = function (listener) {\n        return this.didUpdateViewStateEventEmitter.on(listener);\n    };\n    Object.defineProperty(ViewState.prototype, \"doc\", {\n        get: function () {\n            return this.internalDoc;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ViewState.prototype.attach = function (domContainer) {\n        this.domContainer = domContainer;\n        this.reattachDoc();\n    };\n    ViewState.prototype.handleDidUpdateLayoutStateEvent = function (event) {\n        this.update();\n    };\n    ViewState.prototype.update = function () {\n        var layoutDoc = this.layoutService.getDoc();\n        var renderDoc = this.renderService.getDoc();\n        this.internalDoc = this.updateNode(this.doc, layoutDoc, renderDoc);\n        this.reattachDoc();\n        this.didUpdateViewStateEventEmitter.emit({});\n    };\n    ViewState.prototype.reattachDoc = function () {\n        if (!this.domContainer) {\n            return;\n        }\n        this.domContainer.innerHTML = '';\n        this.domContainer.appendChild(this.doc.domContainer);\n    };\n    ViewState.prototype.updateNode = function (node, layoutNode, renderNode) {\n        var _this = this;\n        if (!layoutNode.needView && node) {\n            return node;\n        }\n        var childrenMap = {};\n        if (node) {\n            node.children.forEach(function (child) {\n                if (!child.layoutId) {\n                    return;\n                }\n                childrenMap[child.layoutId] = child;\n            });\n        }\n        var renderChildrenMap = {};\n        if (renderNode) {\n            renderNode.children.forEach(function (renderChild) {\n                renderChildrenMap[renderChild.id] = renderChild;\n            });\n        }\n        var newChildren = [];\n        if (layoutNode.type !== 'text') {\n            layoutNode.children.forEach(function (layoutChild) {\n                var child = childrenMap[layoutChild.id] || null;\n                var renderChild = null;\n                if (layoutChild.renderId) {\n                    renderChild = renderChildrenMap[layoutChild.renderId] || null;\n                    if (!renderChild) {\n                        throw new Error('Render node not found.');\n                    }\n                }\n                newChildren.push(_this.updateNode(child, layoutChild, renderChild || renderNode));\n            });\n        }\n        layoutNode.clearNeedView();\n        var domContainer = node ? node.domContainer : this.domService.createContainer();\n        var newNode = this.buildNode(domContainer, layoutNode, renderNode, newChildren);\n        return newNode;\n    };\n    ViewState.prototype.buildNode = function (domContainer, layoutNode, renderNode, children) {\n        switch (layoutNode.type) {\n            case 'page':\n                return this.buildPageNode(domContainer, layoutNode, children);\n            case 'line':\n                return this.buildLineNode(domContainer, layoutNode, children);\n        }\n        var component = this.componentService.getComponent(renderNode.componentId);\n        var text = layoutNode.type === 'text' ? layoutNode.children.map(function (child) { return child.text; }).join('') : layoutNode.text;\n        var node = component.buildViewNode(domContainer, renderNode.partId, renderNode.id, layoutNode.id, text, renderNode.style, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        if (!node) {\n            throw new Error(\"Error building view node from render node \" + renderNode.id + \".\");\n        }\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildPageNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getPageComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.buildLineNode = function (domContainer, layoutNode, children) {\n        var node = this.componentService\n            .getLineComponent()\n            .buildViewNode(domContainer, layoutNode.id, children, layoutNode.width, layoutNode.height, layoutNode.paddingTop, layoutNode.paddingBottom, layoutNode.paddingLeft, layoutNode.paddingRight);\n        this.applyMetadataToDOMContainer(node);\n        return node;\n    };\n    ViewState.prototype.applyMetadataToDOMContainer = function (viewNode) {\n        var domContainer = viewNode.domContainer;\n        var componentId = viewNode.componentId;\n        var partId = viewNode.partId;\n        var id = viewNode.id;\n        domContainer.className = \"tw--\" + componentId + \"--\" + partId;\n        domContainer.setAttribute('data-tw-instance', this.instanceId);\n        if (componentId) {\n            domContainer.setAttribute('data-tw-component', componentId);\n        }\n        if (partId) {\n            domContainer.setAttribute('data-tw-part', partId);\n        }\n        domContainer.setAttribute('data-tw-id', id);\n    };\n    return ViewState;\n}());\nexport { ViewState };\n","import { CursorView } from './cursor';\nimport { DOMController } from './dom-controller';\nimport { ViewState } from './state';\nvar ViewService = /** @class */ (function () {\n    function ViewService(instanceId, configService, domService, componentService, modelService, layoutService, cursorService, renderService, commandService, transformService) {\n        this.state = new ViewState(instanceId, componentService, layoutService, renderService, domService);\n        this.domController = new DOMController(instanceId, domService, commandService, modelService, this, layoutService);\n        this.cursor = new CursorView(instanceId, configService, domService, cursorService, layoutService, this, transformService);\n    }\n    ViewService.prototype.onDidUpdateViewState = function (listener) {\n        this.state.onDidUpdateViewState(listener);\n    };\n    ViewService.prototype.onDidFocus = function (listener) {\n        this.domController.onDidFocus(listener);\n    };\n    ViewService.prototype.onDidBlur = function (listener) {\n        this.domController.onDidBlur(listener);\n    };\n    ViewService.prototype.onDidPressKey = function (listener) {\n        this.domController.onDidPressKey(listener);\n    };\n    ViewService.prototype.getDoc = function () {\n        return this.state.doc;\n    };\n    ViewService.prototype.isFocused = function () {\n        return this.domController.isFocused();\n    };\n    ViewService.prototype.attach = function (domContainer) {\n        this.state.attach(domContainer);\n        this.cursor.attach();\n        this.domController.attach();\n    };\n    ViewService.prototype.requestFocus = function () {\n        this.domController.requestFocus();\n    };\n    ViewService.prototype.requestBlur = function () {\n        this.domController.requestBlur();\n    };\n    return ViewService;\n}());\nexport { ViewService };\n","import { CommandService } from './command/service';\nimport { ComponentService } from './component/service';\nimport { ConfigService } from './config/service';\nimport { buildBaseConfig } from './config/util';\nimport { CursorService } from './cursor/service';\nimport { DOMService } from './dom/service';\nimport { HistoryService } from './history/service';\nimport { KeyBindingService } from './key-binding/service';\nimport { LayoutService } from './layout/service';\nimport { ModelService } from './model/service';\nimport { RenderService } from './render/service';\nimport { ServiceRegistry } from './service/registry';\nimport { TextService } from './text/service';\nimport { TransformService } from './transform/service';\nimport { generateId } from './util/id';\nimport { ViewService } from './view/service';\nvar Taleweaver = /** @class */ (function () {\n    function Taleweaver(root, config) {\n        this.instanceId = generateId();\n        this.serviceRegistry = new ServiceRegistry();\n        this.configService = new ConfigService(buildBaseConfig(), config);\n        this.serviceRegistry.registerService('config', this.configService);\n        this.domService = new DOMService();\n        this.serviceRegistry.registerService('dom', this.domService);\n        this.textService = new TextService(this.domService);\n        this.serviceRegistry.registerService('text', this.textService);\n        this.commandService = new CommandService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('command', this.commandService);\n        this.componentService = new ComponentService(this.configService, this.serviceRegistry);\n        this.serviceRegistry.registerService('component', this.componentService);\n        this.modelService = new ModelService(root, this.componentService);\n        this.serviceRegistry.registerService('model', this.modelService);\n        this.renderService = new RenderService(this.componentService, this.modelService);\n        this.serviceRegistry.registerService('render', this.renderService);\n        this.cursorService = new CursorService(this.configService, this.renderService, this.modelService);\n        this.serviceRegistry.registerService('cursor', this.cursorService);\n        this.layoutService = new LayoutService(this.renderService, this.textService);\n        this.serviceRegistry.registerService('layout', this.layoutService);\n        this.transformService = new TransformService(this.modelService, this.componentService, this.cursorService, this.renderService, this.layoutService);\n        this.serviceRegistry.registerService('transform', this.transformService);\n        this.viewService = new ViewService(this.instanceId, this.configService, this.domService, this.componentService, this.modelService, this.layoutService, this.cursorService, this.renderService, this.commandService, this.transformService);\n        this.serviceRegistry.registerService('view', this.viewService);\n        this.historyService = new HistoryService(this.configService, this.transformService);\n        this.serviceRegistry.registerService('history', this.historyService);\n        this.keyBindingService = new KeyBindingService(this.configService, this.commandService, this.viewService);\n        this.serviceRegistry.registerService('keyBinding', this.keyBindingService);\n    }\n    Taleweaver.prototype.attach = function (domContainer) {\n        this.viewService.attach(domContainer);\n    };\n    Taleweaver.prototype.getServiceRegistry = function () {\n        return this.serviceRegistry;\n    };\n    return Taleweaver;\n}());\nexport { Taleweaver };\n","import { Taleweaver } from '@taleweaver/core';\nimport { ITextStyle } from '@taleweaver/core/dist/tw/component/components/text';\nimport React, { useEffect, useCallback, useState } from 'react';\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n    position: sticky;\n    top: 0;\n    padding: 3px 24px;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.09);\n    z-index: 10;\n`;\n\nconst Container = styled.div`\n    display: flex;\n    margin: 0 auto;\n    width: 816px;\n`;\n\nconst Group = styled.div`\n    flex: 0 0 auto;\n    display: flex;\n    border-radius: 4px;\n    padding: 0 6px;\n    position: relative;\n    &::before {\n        content: '';\n        position: absolute;\n        top: 9px;\n        bottom: 9px;\n        left: 0;\n        width: 1px;\n        background: rgba(0, 0, 0, 0.15);\n    }\n    &:last-child {\n        &::after {\n            content: '';\n            position: absolute;\n            top: 9px;\n            bottom: 9px;\n            right: 0;\n            width: 1px;\n            background: rgba(0, 0, 0, 0.15);\n        }\n    }\n`;\n\ninterface ItemProps {\n    disabled: boolean;\n    active: boolean;\n}\n\nconst Item = styled.button<ItemProps>`\n    flex: 0 0 auto;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 36px;\n    height: 36px;\n    font-size: 18px;\n    position: relative;\n    color: rgba(0, 0, 0, 0.85);\n    background: transparent;\n    padding: 0;\n    border: none;\n    border-radius: 3px;\n    outline: none;\n    &:after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 3px;\n        right: 3px;\n        height: 3px;\n    }\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n    ${({ active }) =>\n        active &&\n        `\n        color: rgba(255, 0, 0, 1);\n        &:after {\n            background: rgba(255, 0, 0, 1);\n        }\n    `}\n`;\n\ninterface SelectItemProps {\n    disabled: boolean;\n    width: number;\n}\n\nconst SelectItem = styled.select<SelectItemProps>`\n    -webkit-appearance: none;\n    border: none;\n    font-size: 12px;\n    font-weight: 500;\n    width: ${({ width }) => width}px;\n    background: white;\n    border-radius: 3px;\n    padding: 0 9px;\n    outline: none;\n    position: relative;\n    &:hover,\n    &:focus {\n        background: rgba(0, 0, 0, 0.04);\n    }\n    option {\n        color: rgba(0, 0, 0, 0.85);\n    }\n    ${({ disabled }) =>\n        disabled &&\n        `\n        opacity: 0.45;\n        &:hover,\n        &:focus {\n            background: transparent;\n        }\n    `}\n`;\n\ninterface ItemColorLineProps {\n    color: string;\n}\n\nconst ItemColorLine = styled.div<ItemColorLineProps>`\n    position: absolute;\n    bottom: 8px;\n    left: 9px;\n    right: 9px;\n    height: 3px;\n    background: ${({ color }) => color};\n`;\n\ninterface Props {\n    taleweaver: Taleweaver | null;\n}\n\nfunction getTextStylesByRange(taleweaver: Taleweaver, from: number, to: number): ITextStyle[] {\n    const renderService = taleweaver.getServiceRegistry().getService('render');\n    const styles = renderService.getStylesBetween(from, to);\n    if (!styles.text || !styles.text.text) {\n        if (styles.paragraph && styles.paragraph['line-break'] && from === to) {\n            return getTextStylesByRange(taleweaver, from - 1, to - 1);\n        }\n        return [];\n    }\n    return styles.text.text as ITextStyle[];\n}\n\nfunction getTextStyles(taleweaver: Taleweaver) {\n    const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n    const { anchor, head } = cursorService.getCursor();\n    return getTextStylesByRange(taleweaver, Math.min(anchor, head), Math.max(anchor, head));\n}\n\nexport default function ToolBar({ taleweaver }: Props) {\n    const [textStyles, setTextStyles] = useState<ITextStyle[]>([]);\n    const updateTextStyle = useCallback((taleweaver: Taleweaver) => {\n        setTextStyles(getTextStyles(taleweaver));\n    }, []);\n    useEffect(() => {\n        if (!taleweaver) {\n            return;\n        }\n        const cursorService = taleweaver.getServiceRegistry().getService('cursor');\n        const renderService = taleweaver.getServiceRegistry().getService('render');\n        cursorService.onDidUpdate((event) => updateTextStyle(taleweaver));\n        renderService.onDidUpdateRenderState((event) => updateTextStyle(taleweaver));\n        updateTextStyle(taleweaver);\n    }, [taleweaver, updateTextStyle]);\n    const family = new Set(textStyles.map((s) => s.family)).size === 1 ? textStyles[0].family : null;\n    const size = new Set(textStyles.map((s) => s.size)).size === 1 ? textStyles[0].size : null;\n    const bold = new Set(textStyles.map((s) => s.weight > 400)).size === 1 ? textStyles[0].weight > 400 : false;\n    const italic = new Set(textStyles.map((s) => s.italic)).size === 1 ? textStyles[0].italic : false;\n    const underline = new Set(textStyles.map((s) => s.underline)).size === 1 ? textStyles[0].underline : false;\n    const strikethrough =\n        new Set(textStyles.map((s) => s.strikethrough)).size === 1 ? textStyles[0].strikethrough : false;\n    const color = new Set(textStyles.map((s) => s.color)).size === 1 ? textStyles[0].color : null;\n    const commandService = taleweaver?.getServiceRegistry().getService('command');\n    return (\n        <Wrapper>\n            <Container>\n                <Group>\n                    <SelectItem width={120} value={'Normal'} disabled={false} onChange={(event) => null}>\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"Normal\">Normal text</option>\n                        <option value=\"Title\">Title</option>\n                        <option value=\"Subtitle\">Subtitle</option>\n                        <option value=\"Heading 1\">Heading 1</option>\n                        <option value=\"Heading 2\">Heading 2</option>\n                        <option value=\"Heading 3\">Heading 3</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem width={120} value={family || ''} disabled={family === null} onChange={(event) => null}>\n                        <option value=\"\" style={{ display: 'none' }}></option>\n                        <option value=\"sans-serif\">sans-serif</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <SelectItem\n                        width={60}\n                        value={size ? size.toString() : ''}\n                        disabled={size === null}\n                        onChange={(event) => null}\n                    >\n                        <option value=\"\" style={{ display: 'hidden' }} />\n                        <option value=\"10\">10</option>\n                        <option value=\"12\">12</option>\n                        <option value=\"14\">14</option>\n                        <option value=\"16\">16</option>\n                        <option value=\"18\">18</option>\n                        <option value=\"24\">24</option>\n                        <option value=\"30\">30</option>\n                        <option value=\"36\">36</option>\n                        <option value=\"42\">42</option>\n                    </SelectItem>\n                </Group>\n                <Group>\n                    <Item\n                        active={bold}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'weight',\n                                bold ? 400 : 700,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-bold\" />\n                    </Item>\n                    <Item\n                        active={italic}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand('tw.state.applyAttribute', 'text', 'text', 'italic', !italic)\n                        }\n                    >\n                        <i className=\"mdi mdi-format-italic\" />\n                    </Item>\n                    <Item\n                        active={underline}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'underline',\n                                !underline,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-underline\" />\n                    </Item>\n                    <Item\n                        active={strikethrough}\n                        disabled={false}\n                        onClick={() =>\n                            commandService!.executeCommand(\n                                'tw.state.applyAttribute',\n                                'text',\n                                'text',\n                                'strikethrough',\n                                !strikethrough,\n                            )\n                        }\n                    >\n                        <i className=\"mdi mdi-format-strikethrough-variant\" />\n                    </Item>\n                    <Item active={false} disabled={color === null} onClick={() => null}>\n                        <i className=\"mdi mdi-format-color-text\" style={{ position: 'relative', top: '-2px' }} />\n                        <ItemColorLine color={color || 'transparent'} />\n                    </Item>\n                </Group>\n            </Container>\n        </Wrapper>\n    );\n}\n","import { IConfig, Taleweaver } from '@taleweaver/core';\nimport { INode, parse } from '@taleweaver/core/dist/tw/util/serialize';\nimport React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport ToolBar from './ToolBar';\n\nconst Wrapper = styled.div``;\n\nconst EditorWrapper = styled.div`\n    text-align: center;\n    .tw--doc--doc {\n        font-family: 'Source Sans Pro', sans-serif;\n        display: inline-block;\n        padding-bottom: 9px;\n        counter-reset: page-counter;\n    }\n    .tw--page--page {\n        background: rgba(255, 255, 255, 1);\n        margin: 9px auto 0;\n        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);\n        position: relative;\n        &::after {\n            counter-increment: page-counter;\n            content: 'Page ' counter(page-counter) '';\n            position: absolute;\n            top: 12px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px;\n            font-family: 'Quicksand', sans-serif;\n            font-weight: 500;\n            color: rgba(0, 0, 0, 0.45);\n            pointer-events: none;\n        }\n        *::selection {\n            background: rgba(255, 255, 255, 1);\n        }\n    }\n`;\n\ninterface IProps {\n    initialDoc: INode;\n    config?: IConfig['tw.core'];\n}\n\nexport default function Editor({ initialDoc, config }: IProps) {\n    const containerRef = useRef<HTMLDivElement>(null);\n    const container = containerRef.current;\n    const [taleweaver, setTaleweaver] = useState<Taleweaver | null>(null);\n    useEffect(() => {\n        const mergedConfig: IConfig = {};\n        if (config) {\n            mergedConfig['tw.core'] = config;\n        }\n        const doc = parse(initialDoc, mergedConfig);\n        setTaleweaver(new Taleweaver(doc, mergedConfig));\n    }, [config, initialDoc]);\n    useEffect(() => {\n        if (taleweaver && container) {\n            taleweaver.attach(container);\n        }\n    }, [taleweaver, container, initialDoc]);\n    return (\n        <Wrapper>\n            <ToolBar taleweaver={taleweaver} />\n            <EditorWrapper ref={containerRef} />\n        </Wrapper>\n    );\n}\n","import Taleweaver from \"./Editor\";\n\nexport default Taleweaver;\n","import { ComponentService } from '../component/service';\nimport { ConfigService } from '../config/service';\nimport { buildBaseConfig } from '../config/util';\nimport { ServiceRegistry } from '../service/registry';\nexport function parse(node, config) {\n    var serviceRegistry = new ServiceRegistry();\n    var configService = new ConfigService(buildBaseConfig(), config);\n    var componentService = new ComponentService(configService, serviceRegistry);\n    function internalParse(node) {\n        return componentService.getComponent(node.componentId).buildModelNode(node.partId, node.id, node.text, node.attributes, node.children.map(function (child) { return internalParse(child); }));\n    }\n    return internalParse(node);\n}\n","import { generateId } from '@taleweaver/core/dist/tw/util/id';\nimport { INode } from '@taleweaver/core/dist/tw/util/serialize';\n\nconst doc: INode = {\n    componentId: 'doc',\n    partId: 'doc',\n    id: generateId(),\n    text: '',\n    attributes: {},\n    children: [\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Once upon a time there lived in a certain village a little country girl, the prettiest creature was ever seen. Her mother was excessively fond of her; and her grandmother doted on her still more. This good woman had made for her a little red riding-hood; which became the girl so extremely well that everybody called her Little Red Riding-Hood.',\n                    attributes: { weight: 700 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'One day her mother, having made some custards, said to her:',\n                    attributes: { italic: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Go, my dear, and see how thy grandmamma does, for I hear she has been very ill; carry her a custard, and this little pot of butter.\"',\n                    attributes: { color: 'rgba(255, 0, 0, 1)' },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood set out immediately to go to her grandmother, who lived in another village.',\n                    attributes: { size: 24 },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'As she was going through the wood, she met with Gaffer Wolf, who had a very great mind to eat her up, but he dared not, because of some faggot-makers hard by in the forest. He asked her whither she was going. The poor child, who did not know that it was dangerous to stay and hear a wolf talk, said to him:',\n                    attributes: { strikethrough: true, underline: true },\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"I am going to see my grandmamma and carry her a custard and a little pot of butter from my mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Does she live far off?\" said the Wolf.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Oh! ay,\" answered Little Red Riding-Hood; \"it is beyond that mill you see there, at the first house in the village.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Well,\" said the Wolf, \"and I\\'ll go and see her too. I\\'ll go this way and you go that, and we shall see who will be there soonest.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf began to run as fast as he could, taking the nearest way, and the little girl went by that farthest about, diverting herself in gathering nuts, running after butterflies, and making nosegays of such little flowers as she met with. The Wolf was not long before he got to the old woman's house. He knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Your grandchild, Little Red Riding-Hood,\" replied the Wolf, counterfeiting her voice; \"who has brought you a custard and a little pot of butter sent you by mamma.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The good grandmother, who was in bed, because she was somewhat ill, cried out',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        \"The Wolf pulled the bobbin, and the door opened, and then presently he fell upon the good woman and ate her up in a moment, for it was above three days that he had not touched a bit. He then shut the door and went into the grandmother's bed, expecting Little Red Riding- Hood, who came some time afterward and knocked at the door--tap, tap.\",\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Who\\'s there?\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood, hearing the big voice of the Wolf, was at first afraid; but believing her grandmother had got a cold and was hoarse, answered:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\" \\'Tis your grandchild, Little Red Riding-Hood, who has brought you a custard and a little pot of butter mamma sends you.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf cried out to her, softening his voice as much as he could:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Pull the bobbin, and the latch will go up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'Little Red Riding-Hood pulled the bobbin, and the door opened.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: 'The Wolf, seeing her come in, said to her, hiding himself under the bed-clothes:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        '\"Put the custard and the little pot of butter upon the stool, and come and lie down with me.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'Little Red Riding-Hood undressed herself and went into bed, where, being greatly amazed to see how her grandmother looked in her night-clothes, she said to her:',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great arms you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is the better to hug thee, my dear.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great legs you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to run the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great ears you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to hear the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great eyes you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"It is to see the better, my child.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"Grandmamma, what great teeth you have got!\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text: '\"That is to eat thee up.\"',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n        {\n            componentId: 'paragraph',\n            partId: 'paragraph',\n            id: generateId(),\n            text: '',\n            attributes: {},\n            children: [\n                {\n                    componentId: 'text',\n                    partId: 'text',\n                    id: generateId(),\n                    text:\n                        'And, saying these words, this wicked wolf fell upon Little Red Riding-Hood, and ate her all up.',\n                    attributes: {},\n                    children: [],\n                },\n            ],\n        },\n    ],\n};\n\nexport default doc;\n","import React from 'react';\nimport styled from 'styled-components';\nimport './App.css';\nimport Taleweaver from './Editor';\nimport sample from './samples/littleRedRidingHood';\n\nconst Wrapper = styled.div``;\n\nconst Hero = styled.div`\n    text-align: center;\n    padding: 90px 60px 30px;\n`;\n\nconst BrandWrapper = styled.div``;\n\nconst Brand = styled.span`\n    color: rgba(0, 0, 0, 0.65);\n    font-size: 42px;\n    letter-spacing: 0.02em;\n    padding-bottom: 10px;\n    border-bottom: 2px solid rgba(0, 0, 0, 0.65);\n`;\n\nconst Tagline = styled.h1`\n    font-size: 30px;\n    font-weight: 500;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 90px 0 0;\n`;\n\nconst SupportingTagline = styled.h2`\n    font-size: 20px;\n    font-weight: 400;\n    color: rgba(0, 0, 0, 0.85);\n    margin: 30px 0 0;\n`;\n\nconst Links = styled.div`\n    margin-top: 90px;\n`;\n\nconst Link = styled.a`\n    display: inline-block;\n    padding: 15px 60px;\n    outline: none;\n    color: rgba(0, 0, 0, 0.85);\n    text-decoration: none;\n    font-size: 20px;\n    background: transparent;\n    border-radius: 3px;\n    border: 1px solid rgba(0, 0, 0, 0.15);\n    &:hover {\n        color: rgba(0, 0, 0, 1);\n        background: rgba(0, 0, 0, 0.04);\n        border-color: rgba(0, 0, 0, 0.25);\n    }\n`;\n\nconst DemoHintWrapper = styled.div`\n    text-align: center;\n    margin-top: 90px;\n`;\n\nconst DemoHint = styled.span`\n    text-transform: uppercase;\n    font-weight: 500;\n    font-size: 14px;\n    color: rgba(0, 0, 0, 0.65);\n    border-top: 1px solid rgba(0, 0, 0, 0.45);\n    padding-top: 10px;\n    cursor: default;\n`;\n\nclass App extends React.Component {\n    render() {\n        return (\n            <Wrapper>\n                <Hero>\n                    <BrandWrapper>\n                        <Brand>Taleweaver</Brand>\n                    </BrandWrapper>\n                    <Tagline>Word processing in your browser.</Tagline>\n                    <SupportingTagline>\n                        Open source editor delivering true word processing experience.\n                    </SupportingTagline>\n                    <Links>\n                        <Link href=\"https://github.com/yuzhenmi/taleweaver\">GitHub</Link>\n                    </Links>\n                    <DemoHintWrapper>\n                        <DemoHint>&darr; Check it out &darr;</DemoHint>\n                    </DemoHintWrapper>\n                </Hero>\n                <Taleweaver\n                    initialDoc={sample}\n                    config={{\n                        page: {\n                            width: 816,\n                            height: 1056,\n                            paddingTop: 60,\n                            paddingBottom: 60,\n                            paddingLeft: 60,\n                            paddingRight: 60,\n                        },\n                    }}\n                />\n            </Wrapper>\n        );\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}